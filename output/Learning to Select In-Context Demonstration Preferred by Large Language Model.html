<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Learning to Select In-Context Demonstration Preferred by Large Language Model</title>
<!--Generated on Mon May 26 13:21:45 2025 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2505.19966v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S1" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S2" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S2.SS1" title="In 2 Related work ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>In-context Demonstration Selection</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S2.SS2" title="In 2 Related work ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Preference Learning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Methodology</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS1" title="In 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Problem Setting</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS2" title="In 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Optimization Objective</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS3" title="In 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Demonstration Preference Learning</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS3.SSS0.Px1" title="In 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">The First Stage.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS3.SSS0.Px2" title="In 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">The Second Stage.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.SS4" title="In 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Demonstration Selection in Inference</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS1" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Evaluations Setup</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS1.SSS0.Px1" title="In 4.1 Evaluations Setup ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Datasets.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS1.SSS0.Px2" title="In 4.1 Evaluations Setup ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Baseline.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS1.SSS0.Px3" title="In 4.1 Evaluations Setup ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Implementation Details.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS2" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Main Results</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS3" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Ablation Study</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS4" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>Generalizability and Scalability</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS4.SSS0.Px1" title="In 4.4 Generalizability and Scalability ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Validation on More LLMs.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS4.SSS0.Px2" title="In 4.4 Generalizability and Scalability ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Generalizability of Selected Demonstrations.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS5" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5 </span>The Superiority of Our Optimization Objective</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS6" title="In 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.6 </span>The Impact of the Number and Order of Demonstrations</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S5" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Implementation Details</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1.SS0.SSS0.Px1" title="In Appendix A Implementation Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Implementation Details of CBDS <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <span class="ltx_ref">2024b</span>)</cite>.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1.SS0.SSS0.Px2" title="In Appendix A Implementation Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title">Implementation Details of LLM-R <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <span class="ltx_ref">2023</span>)</cite>.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A2" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Details about useful samples statistics</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A3" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>The Limitations of Contrastive Learning</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A4" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>Derivation of the Optimization Objective</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A5" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">E </span>Dataset Details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A6" title="In Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">F </span>Case Study of Our <span class="ltx_text ltx_font_smallcaps">GenICL</span> Method</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Learning to Select In-Context Demonstration Preferred
<br class="ltx_break"/>by Large Language Model</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Zheng Zhang<sup class="ltx_sup" id="id11.11.id1"><span class="ltx_text ltx_font_italic" id="id11.11.id1.1">1,3</span></sup>, Shaocheng Lan<sup class="ltx_sup" id="id12.12.id2"><span class="ltx_text ltx_font_italic" id="id12.12.id2.1">1</span></sup>, Lei Song<sup class="ltx_sup" id="id13.13.id3"><span class="ltx_text ltx_font_italic" id="id13.13.id3.1">2</span></sup><span class="ltx_note ltx_role_footnotemark" id="footnotex1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">1</span></span></span></span>  , Jiang Bian<sup class="ltx_sup" id="id14.14.id4"><span class="ltx_text ltx_font_italic" id="id14.14.id4.1">2</span></sup>, Yexin Li<sup class="ltx_sup" id="id15.15.id5"><span class="ltx_text ltx_font_italic" id="id15.15.id5.1">3</span></sup>, Kan Ren<sup class="ltx_sup" id="id16.16.id6"><span class="ltx_text ltx_font_italic" id="id16.16.id6.1">1</span></sup>
<br class="ltx_break"/><sup class="ltx_sup" id="id17.17.id7"><span class="ltx_text ltx_font_italic" id="id17.17.id7.1">1</span></sup>School of Information Science and Technology, ShanghaiTech University 
<br class="ltx_break"/><sup class="ltx_sup" id="id18.18.id8"><span class="ltx_text ltx_font_italic" id="id18.18.id8.1">2</span></sup>Microsoft Research Asia 
<br class="ltx_break"/><sup class="ltx_sup" id="id19.19.id9"><span class="ltx_text ltx_font_italic" id="id19.19.id9.1">3</span></sup>State Key Laboratory of General Artificial Intelligence, BIGAI,
Beijing, China 
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id20.20.id10">{zhangzheng2024, lanshch2024, renkan}@shanghaitech.edu.cn</span>
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id21.21.id11">{lei.song, jiang.bian}@microsoft.com, liyexin@bigai.ai</span>
</span><span class="ltx_author_notes">  Corresponding author.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id22.id1">In-context learning (ICL) enables large language models (LLMs) to adapt to new tasks during inference using only a few demonstrations.
However, ICL performance is highly dependent on the selection of these demonstrations.
Recent work explores retrieval-based methods for selecting query-specific demonstrations, but these approaches often rely on surrogate objectives such as metric learning, failing to directly optimize ICL performance.
Consequently, they struggle to identify truly beneficial demonstrations.
Moreover, their discriminative retrieval paradigm is ineffective when the candidate pool lacks sufficient high-quality demonstrations.
To address these challenges, we propose <span class="ltx_text ltx_font_smallcaps" id="id22.id1.1">GenICL</span>, a novel generative preference learning framework that leverages LLM feedback to directly optimize demonstration selection for ICL.
Experiments on 19 datasets across 11 task categories demonstrate that <span class="ltx_text ltx_font_smallcaps" id="id22.id1.2">GenICL</span> achieves superior performance than existing methods in selecting the most effective demonstrations, leading to better ICL performance.
The project website is at <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://foundation-model-research.github.io/GenICL" title="">https://foundation-model-research.github.io/GenICL</a>.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large Language Models (LLMs) have demonstrated remarkable capabilities across a wide range of tasks.
In-context learning (ICL), introduced by <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib3" title="">2020</a>)</cite>, enables LLMs to perform tasks with only a few examples as demonstration, without requiring parameter updates <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib3" title="">2020</a>; Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib22" title="">2021</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Although ICL is promising, the selection of in-context demonstrations is crucial, as it significantly impacts LLM performance <cite class="ltx_cite ltx_citemacro_citep">(Lu et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib24" title="">2021</a>; Min et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib29" title="">2022b</a>)</cite>.
Many existing approaches rely on retrieval-based methods, either using off-the-shelf retrievers <cite class="ltx_cite ltx_citemacro_citep">(Robertson et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib36" title="">2009</a>)</cite> or training specialized ones <cite class="ltx_cite ltx_citemacro_citep">(Reimers, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib35" title="">2019</a>; Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite>.
Training-based methods typically optimize retrievers to approximate the relevance score of the candidate to the given query for downstream ICL tasks, often leveraging metric learning-based proxy tasks, such as contrastive loss <cite class="ltx_cite ltx_citemacro_citep">(Rubin et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib38" title="">2021</a>; Ye et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib50" title="">2023</a>; Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>; Cheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib6" title="">2023</a>; Luo et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib25" title="">2023</a>; Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib23" title="">2024</a>)</cite>.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="382" id="S1.F1.g1" src="extracted/6480001/figures/combined_accuracy_distribution1.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>
The distribution of the useful example ratio across test sets from different datasets.
The x-axis represents the ratio <math alttext="\frac{\text{\# useful examples}}{\text{\# total examples}}" class="ltx_Math" display="inline" id="S1.F1.2.m1.1"><semantics id="S1.F1.2.m1.1b"><mfrac id="S1.F1.2.m1.1.1" xref="S1.F1.2.m1.1.1.cmml"><mtext id="S1.F1.2.m1.1.1.2" xref="S1.F1.2.m1.1.1.2a.cmml"># useful examples</mtext><mtext id="S1.F1.2.m1.1.1.3" xref="S1.F1.2.m1.1.1.3a.cmml"># total examples</mtext></mfrac><annotation-xml encoding="MathML-Content" id="S1.F1.2.m1.1c"><apply id="S1.F1.2.m1.1.1.cmml" xref="S1.F1.2.m1.1.1"><divide id="S1.F1.2.m1.1.1.1.cmml" xref="S1.F1.2.m1.1.1"></divide><ci id="S1.F1.2.m1.1.1.2a.cmml" xref="S1.F1.2.m1.1.1.2"><mtext id="S1.F1.2.m1.1.1.2.cmml" mathsize="70%" xref="S1.F1.2.m1.1.1.2"># useful examples</mtext></ci><ci id="S1.F1.2.m1.1.1.3a.cmml" xref="S1.F1.2.m1.1.1.3"><mtext id="S1.F1.2.m1.1.1.3.cmml" mathsize="70%" xref="S1.F1.2.m1.1.1.3"># total examples</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.2.m1.1d">\frac{\text{\# useful examples}}{\text{\# total examples}}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.2.m1.1e">divide start_ARG # useful examples end_ARG start_ARG # total examples end_ARG</annotation></semantics></math>, where a ‘useful example’ is one that helps the LLM generate an accurate output with in-context learning.
The ratio remains low for most test queries, i.e., the majority of demonstration examples are ineffective for the LLM.
</figcaption>
</figure>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">However, these methods face several challenges.
The most critical issue is the misalignment between the surrogate learning objective of the retriever and the intrinsic optimization goal of ICL.
Specifically, a discriminative model, trained with a metric learning objective to approximate the relevance score between a demonstration candidate and a given query, does not necessarily indicate the candidate’s effectiveness as an in-context demonstration for an LLM.
Furthermore, the scarcity of effective demonstration candidates in the retrieval pool poses another challenge for training a discriminative retriever.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a> illustrates the distribution of test queries regarding the ratio of useful examples that help the LLM achieve accurate output using ICL.
The figure shows that most candidates are ineffective for most queries, making retriever optimization particularly challenging.
This issue is further exacerbated by the properties of hard labels for LLM feedback, as noted by <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">To address these challenges, we propose <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.1">GenICL</span>, a novel generative preference learning framework that directly optimizes demonstration selection for ICL using LLM feedback.
Specifically, we reformulate ICL as a generative Bayesian optimization problem, introducing a latent variable to bridge demonstration selection and LLM inference.
<span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.2">GenICL</span> then optimizes this objective through preference learning, which focuses more on the relative effectiveness between demonstration samples, allowing it to capture finer-grained information in scenarios where effective demonstrations are scarce.
This optimization procedure on demonstration selection more closely aligns with the intrinsic objective of ICL.
Through this approach, <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.3">GenICL</span> can better capture the LLM’s demonstration preference and identify the truly effective demonstrations (preferred by the LLM).
To validate the effectiveness of <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.4">GenICL</span>, we conducted experiments on a diverse set of datasets covering classification, multiple-choice, and generation tasks.
The results demonstrate that <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.5">GenICL</span> achieves superior performance compared to existing methods.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">Our contributions can be summarized as follows:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We propose <span class="ltx_text ltx_font_smallcaps" id="S1.I1.i1.p1.1.1">GenICL</span>, a novel generative preference learning framework that directly optimizes demonstration selection for ICL using LLM feedback, overcoming the limitations of sub-optimality of surrogate learning objective used in traditional retrieval-based methods.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">The preference learning of paired effective and ineffective demonstrations leads to fine-grained distinguishness of demonstration preference of LLM.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">We conduct extensive experiments on 19 datasets across 11 task categories with a quantitative and qualitative analysis of the effectiveness of our proposed method.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related work</h2>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>In-context Demonstration Selection</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">In-context learning <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib3" title="">2020</a>)</cite> enhances large language models by leveraging few-shot examples for task adaptation.
While proficient at using provided examples, LLMs heavily depend on specific demonstrations <cite class="ltx_cite ltx_citemacro_citep">(Min et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib28" title="">2022a</a>; Luo et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib26" title="">2024</a>)</cite>, making demonstration selection crucial for downstream performance.
Existing approaches to demonstration selection can be broadly categorized into two branches.
The first employs off-the-shelf retrievers like BM25 <cite class="ltx_cite ltx_citemacro_citep">(Robertson et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib36" title="">2009</a>)</cite>, SBERT <cite class="ltx_cite ltx_citemacro_citep">(Reimers, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib35" title="">2019</a>)</cite>, and E5<sub class="ltx_sub" id="S2.SS1.p1.1.1">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite>, which prioritize semantic similarity but overlook downstream utility.
The second category involves learning the retriever based on feedback from LLM performance on selected demonstrations <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib19" title="">2023</a>; Cheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib6" title="">2023</a>; Luo et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib25" title="">2023</a>; Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib5" title="">2024</a>)</cite>.
For instance, <cite class="ltx_cite ltx_citemacro_citet">Rubin et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib38" title="">2021</a>)</cite> trained a dense retriever using LLM-generated feedback, while <cite class="ltx_cite ltx_citemacro_citet">Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite> distilled a retriever from a metric function estimating relevance scores between demonstration candidates and the query.
However, these methods approximate the relevant score of the candidate given the query, which is not essentially aligned with the true optimization objective of ICL resulting in a sub-optimal solution.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.1">Moreover, only a minority of candidates truly enhance in-context learning performance (Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a>), making it challenging to learn a reasonably dense retriever.</p>
</div>
<div class="ltx_para" id="S2.SS1.p3">
<p class="ltx_p" id="S2.SS1.p3.1">Therefore, a more promising method is required for directly optimizing the intrinsic ICL objective.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Preference Learning</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Preference learning plays a vital role in training LLMs to align generative models with human values and preferences <cite class="ltx_cite ltx_citemacro_citep">(Christiano et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib7" title="">2017</a>; Ziegler et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib56" title="">2019</a>; Ouyang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib32" title="">2022</a>)</cite>.
It has also emerged as a powerful paradigm for enhancing LLM performance in complex tasks <cite class="ltx_cite ltx_citemacro_citep">(Havrilla et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib13" title="">2024</a>; Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib18" title="">2024</a>)</cite>.
A key approach in this domain is reinforcement learning from human feedback (RLHF) <cite class="ltx_cite ltx_citemacro_citep">(Ouyang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib32" title="">2022</a>)</cite>, which involves training a reward model to capture human preferences and optimizing the model using reinforcement learning algorithms <cite class="ltx_cite ltx_citemacro_citep">(Schulman et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib40" title="">2017</a>)</cite>.
More recent methods, such as Direct Preference Optimization (DPO) <cite class="ltx_cite ltx_citemacro_citep">(Rafailov et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib33" title="">2024</a>)</cite> and Kahneman-Tversky Optimization (KTO) <cite class="ltx_cite ltx_citemacro_citep">(Ethayarajh et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib10" title="">2024</a>)</cite>, bypass explicit reward modeling and instead learn preferences directly from human feedback.
While these methods have advanced preference learning performance, they primarily focus on human feedback without explicitly addressing the issue of the scarcity of effective demonstrations.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="400" id="S2.F2.g1" src="x1.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Training and inference pipeline of <span class="ltx_text ltx_font_smallcaps" id="S2.F2.2.1">GenICL</span>.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Methodology</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Problem Setting</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.8">Consider a task sample <math alttext="x" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><mi id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><ci id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_x</annotation></semantics></math> with ground-truth <math alttext="y" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><mi id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><ci id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">y</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_y</annotation></semantics></math>, denoted as <math alttext="(x,y)" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.2"><semantics id="S3.SS1.p1.3.m3.2a"><mrow id="S3.SS1.p1.3.m3.2.3.2" xref="S3.SS1.p1.3.m3.2.3.1.cmml"><mo id="S3.SS1.p1.3.m3.2.3.2.1" stretchy="false" xref="S3.SS1.p1.3.m3.2.3.1.cmml">(</mo><mi id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml">x</mi><mo id="S3.SS1.p1.3.m3.2.3.2.2" xref="S3.SS1.p1.3.m3.2.3.1.cmml">,</mo><mi id="S3.SS1.p1.3.m3.2.2" xref="S3.SS1.p1.3.m3.2.2.cmml">y</mi><mo id="S3.SS1.p1.3.m3.2.3.2.3" stretchy="false" xref="S3.SS1.p1.3.m3.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.2b"><interval closure="open" id="S3.SS1.p1.3.m3.2.3.1.cmml" xref="S3.SS1.p1.3.m3.2.3.2"><ci id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">𝑥</ci><ci id="S3.SS1.p1.3.m3.2.2.cmml" xref="S3.SS1.p1.3.m3.2.2">𝑦</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.2c">(x,y)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.2d">( italic_x , italic_y )</annotation></semantics></math>, and a set of demonstrations <math alttext="\left\{(x_{k},y_{k})\right\}_{k=1}^{K}\subseteq\mathcal{P}" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><mrow id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml"><msubsup id="S3.SS1.p1.4.m4.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.cmml"><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml"><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml">{</mo><mrow id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml"><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.4" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.2" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.SS1.p1.4.m4.1.1.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S3.SS1.p1.4.m4.1.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.1.3.cmml"><mi id="S3.SS1.p1.4.m4.1.1.1.1.3.2" xref="S3.SS1.p1.4.m4.1.1.1.1.3.2.cmml">k</mi><mo id="S3.SS1.p1.4.m4.1.1.1.1.3.1" xref="S3.SS1.p1.4.m4.1.1.1.1.3.1.cmml">=</mo><mn id="S3.SS1.p1.4.m4.1.1.1.1.3.3" xref="S3.SS1.p1.4.m4.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="S3.SS1.p1.4.m4.1.1.1.3" xref="S3.SS1.p1.4.m4.1.1.1.3.cmml">K</mi></msubsup><mo id="S3.SS1.p1.4.m4.1.1.2" xref="S3.SS1.p1.4.m4.1.1.2.cmml">⊆</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.4.m4.1.1.3" xref="S3.SS1.p1.4.m4.1.1.3.cmml">𝒫</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><apply id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1"><subset id="S3.SS1.p1.4.m4.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.2"></subset><apply id="S3.SS1.p1.4.m4.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1">superscript</csymbol><apply id="S3.SS1.p1.4.m4.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1">subscript</csymbol><set id="S3.SS1.p1.4.m4.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1"><interval closure="open" id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2"><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.2">𝑦</ci><ci id="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="S3.SS1.p1.4.m4.1.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.3"><eq id="S3.SS1.p1.4.m4.1.1.1.1.3.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.3.1"></eq><ci id="S3.SS1.p1.4.m4.1.1.1.1.3.2.cmml" xref="S3.SS1.p1.4.m4.1.1.1.1.3.2">𝑘</ci><cn id="S3.SS1.p1.4.m4.1.1.1.1.3.3.cmml" type="integer" xref="S3.SS1.p1.4.m4.1.1.1.1.3.3">1</cn></apply></apply><ci id="S3.SS1.p1.4.m4.1.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.1.3">𝐾</ci></apply><ci id="S3.SS1.p1.4.m4.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.3">𝒫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">\left\{(x_{k},y_{k})\right\}_{k=1}^{K}\subseteq\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">{ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT ⊆ caligraphic_P</annotation></semantics></math> where each demonstration <math alttext="(x_{k},y_{k})" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.2"><semantics id="S3.SS1.p1.5.m5.2a"><mrow id="S3.SS1.p1.5.m5.2.2.2" xref="S3.SS1.p1.5.m5.2.2.3.cmml"><mo id="S3.SS1.p1.5.m5.2.2.2.3" stretchy="false" xref="S3.SS1.p1.5.m5.2.2.3.cmml">(</mo><msub id="S3.SS1.p1.5.m5.1.1.1.1" xref="S3.SS1.p1.5.m5.1.1.1.1.cmml"><mi id="S3.SS1.p1.5.m5.1.1.1.1.2" xref="S3.SS1.p1.5.m5.1.1.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.5.m5.1.1.1.1.3" xref="S3.SS1.p1.5.m5.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS1.p1.5.m5.2.2.2.4" xref="S3.SS1.p1.5.m5.2.2.3.cmml">,</mo><msub id="S3.SS1.p1.5.m5.2.2.2.2" xref="S3.SS1.p1.5.m5.2.2.2.2.cmml"><mi id="S3.SS1.p1.5.m5.2.2.2.2.2" xref="S3.SS1.p1.5.m5.2.2.2.2.2.cmml">y</mi><mi id="S3.SS1.p1.5.m5.2.2.2.2.3" xref="S3.SS1.p1.5.m5.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS1.p1.5.m5.2.2.2.5" stretchy="false" xref="S3.SS1.p1.5.m5.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.2b"><interval closure="open" id="S3.SS1.p1.5.m5.2.2.3.cmml" xref="S3.SS1.p1.5.m5.2.2.2"><apply id="S3.SS1.p1.5.m5.1.1.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.1.1.1.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.5.m5.1.1.1.1.2.cmml" xref="S3.SS1.p1.5.m5.1.1.1.1.2">𝑥</ci><ci id="S3.SS1.p1.5.m5.1.1.1.1.3.cmml" xref="S3.SS1.p1.5.m5.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS1.p1.5.m5.2.2.2.2.cmml" xref="S3.SS1.p1.5.m5.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.2.2.2.2.1.cmml" xref="S3.SS1.p1.5.m5.2.2.2.2">subscript</csymbol><ci id="S3.SS1.p1.5.m5.2.2.2.2.2.cmml" xref="S3.SS1.p1.5.m5.2.2.2.2.2">𝑦</ci><ci id="S3.SS1.p1.5.m5.2.2.2.2.3.cmml" xref="S3.SS1.p1.5.m5.2.2.2.2.3">𝑘</ci></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.2c">(x_{k},y_{k})</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> is an input-output tuple taken from the demonstration pool <math alttext="\mathcal{P}" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml">𝒫</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><ci id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">𝒫</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">caligraphic_P</annotation></semantics></math> containing all training samples from all tasks.
<math alttext="K" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><mi id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><ci id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">K</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">italic_K</annotation></semantics></math> is the number of demonstrations used for the current query.
Our goal is to provide the appropriate demonstrations for each <math alttext="x" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m8.1"><semantics id="S3.SS1.p1.8.m8.1a"><mi id="S3.SS1.p1.8.m8.1.1" xref="S3.SS1.p1.8.m8.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m8.1b"><ci id="S3.SS1.p1.8.m8.1.1.cmml" xref="S3.SS1.p1.8.m8.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m8.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m8.1d">italic_x</annotation></semantics></math> to improve the ICL performance of LLMs as</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\underset{(x_{k},y_{k})\in\mathcal{P}}{\arg\max}P_{\mathcal{M}}(y\mid\left\{(x%
_{k},y_{k})\right\}_{k=1}^{K},x)" class="ltx_Math" display="block" id="S3.E1.m1.4"><semantics id="S3.E1.m1.4a"><mrow id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml"><munder accentunder="true" id="S3.E1.m1.2.2" xref="S3.E1.m1.2.2.cmml"><mrow id="S3.E1.m1.2.2.3" xref="S3.E1.m1.2.2.3.cmml"><mi id="S3.E1.m1.2.2.3.1" xref="S3.E1.m1.2.2.3.1.cmml">arg</mi><mo id="S3.E1.m1.2.2.3a" lspace="0.167em" xref="S3.E1.m1.2.2.3.cmml">⁡</mo><mi id="S3.E1.m1.2.2.3.2" xref="S3.E1.m1.2.2.3.2.cmml">max</mi></mrow><mrow id="S3.E1.m1.2.2.2" xref="S3.E1.m1.2.2.2.cmml"><mrow id="S3.E1.m1.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.3.cmml"><mo id="S3.E1.m1.2.2.2.2.2.3" stretchy="false" xref="S3.E1.m1.2.2.2.2.3.cmml">(</mo><msub id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.1.1.1.1.1.1.2" xref="S3.E1.m1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E1.m1.1.1.1.1.1.1.3" xref="S3.E1.m1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E1.m1.2.2.2.2.2.4" xref="S3.E1.m1.2.2.2.2.3.cmml">,</mo><msub id="S3.E1.m1.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.cmml"><mi id="S3.E1.m1.2.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.2.cmml">y</mi><mi id="S3.E1.m1.2.2.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.E1.m1.2.2.2.2.2.5" stretchy="false" xref="S3.E1.m1.2.2.2.2.3.cmml">)</mo></mrow><mo id="S3.E1.m1.2.2.2.3" xref="S3.E1.m1.2.2.2.3.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.2.2.2.4" xref="S3.E1.m1.2.2.2.4.cmml">𝒫</mi></mrow></munder><mo id="S3.E1.m1.4.4.2" xref="S3.E1.m1.4.4.2.cmml">⁢</mo><msub id="S3.E1.m1.4.4.3" xref="S3.E1.m1.4.4.3.cmml"><mi id="S3.E1.m1.4.4.3.2" xref="S3.E1.m1.4.4.3.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.4.4.3.3" xref="S3.E1.m1.4.4.3.3.cmml">ℳ</mi></msub><mo id="S3.E1.m1.4.4.2a" xref="S3.E1.m1.4.4.2.cmml">⁢</mo><mrow id="S3.E1.m1.4.4.1.1" xref="S3.E1.m1.4.4.1.1.1.cmml"><mo id="S3.E1.m1.4.4.1.1.2" stretchy="false" xref="S3.E1.m1.4.4.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.4.4.1.1.1" xref="S3.E1.m1.4.4.1.1.1.cmml"><mi id="S3.E1.m1.4.4.1.1.1.3" xref="S3.E1.m1.4.4.1.1.1.3.cmml">y</mi><mo id="S3.E1.m1.4.4.1.1.1.2" xref="S3.E1.m1.4.4.1.1.1.2.cmml">∣</mo><mrow id="S3.E1.m1.4.4.1.1.1.1.1" xref="S3.E1.m1.4.4.1.1.1.1.2.cmml"><msubsup id="S3.E1.m1.4.4.1.1.1.1.1.1" xref="S3.E1.m1.4.4.1.1.1.1.1.1.cmml"><mrow id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.4" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.2" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.1" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="S3.E1.m1.4.4.1.1.1.1.1.1.3" xref="S3.E1.m1.4.4.1.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="S3.E1.m1.4.4.1.1.1.1.1.2" xref="S3.E1.m1.4.4.1.1.1.1.2.cmml">,</mo><mi id="S3.E1.m1.3.3" xref="S3.E1.m1.3.3.cmml">x</mi></mrow></mrow><mo id="S3.E1.m1.4.4.1.1.3" stretchy="false" xref="S3.E1.m1.4.4.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.4b"><apply id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4"><times id="S3.E1.m1.4.4.2.cmml" xref="S3.E1.m1.4.4.2"></times><apply id="S3.E1.m1.2.2.cmml" xref="S3.E1.m1.2.2"><apply id="S3.E1.m1.2.2.2.cmml" xref="S3.E1.m1.2.2.2"><in id="S3.E1.m1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.3"></in><interval closure="open" id="S3.E1.m1.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2"><apply id="S3.E1.m1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E1.m1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E1.m1.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.2.2.2.2.2.2.1.cmml" xref="S3.E1.m1.2.2.2.2.2.2">subscript</csymbol><ci id="S3.E1.m1.2.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2.2">𝑦</ci><ci id="S3.E1.m1.2.2.2.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E1.m1.2.2.2.4.cmml" xref="S3.E1.m1.2.2.2.4">𝒫</ci></apply><apply id="S3.E1.m1.2.2.3.cmml" xref="S3.E1.m1.2.2.3"><arg id="S3.E1.m1.2.2.3.1.cmml" xref="S3.E1.m1.2.2.3.1"></arg><max id="S3.E1.m1.2.2.3.2.cmml" xref="S3.E1.m1.2.2.3.2"></max></apply></apply><apply id="S3.E1.m1.4.4.3.cmml" xref="S3.E1.m1.4.4.3"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.3.1.cmml" xref="S3.E1.m1.4.4.3">subscript</csymbol><ci id="S3.E1.m1.4.4.3.2.cmml" xref="S3.E1.m1.4.4.3.2">𝑃</ci><ci id="S3.E1.m1.4.4.3.3.cmml" xref="S3.E1.m1.4.4.3.3">ℳ</ci></apply><apply id="S3.E1.m1.4.4.1.1.1.cmml" xref="S3.E1.m1.4.4.1.1"><csymbol cd="latexml" id="S3.E1.m1.4.4.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.2">conditional</csymbol><ci id="S3.E1.m1.4.4.1.1.1.3.cmml" xref="S3.E1.m1.4.4.1.1.1.3">𝑦</ci><list id="S3.E1.m1.4.4.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1"><apply id="S3.E1.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1">superscript</csymbol><apply id="S3.E1.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1">subscript</csymbol><set id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1"><interval closure="open" id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2"><apply id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2">𝑦</ci><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3"><eq id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.1"></eq><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.2">𝑘</ci><cn id="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="S3.E1.m1.4.4.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="S3.E1.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.4.4.1.1.1.1.1.1.3">𝐾</ci></apply><ci id="S3.E1.m1.3.3.cmml" xref="S3.E1.m1.3.3">𝑥</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.4c">\underset{(x_{k},y_{k})\in\mathcal{P}}{\arg\max}P_{\mathcal{M}}(y\mid\left\{(x%
_{k},y_{k})\right\}_{k=1}^{K},x)</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.4d">start_UNDERACCENT ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∈ caligraphic_P end_UNDERACCENT start_ARG roman_arg roman_max end_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y ∣ { ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Optimization Objective</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">Most methods based on LLM feedback used metric learning, such as contrastive learning, as a surrogate objective to train a discriminative model as the retriever. However, this optimization objective has a gap with in-context learning performance (details in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A3" title="Appendix C The Limitations of Contrastive Learning ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">C</span></a>).
Additionally, the relevance scores determined by the discriminative retriever come from a feature similarity perspective, overlooking optimizations at the semantic understanding level, which leads to the selected demonstrations that may not be truly useful for improving the LLM’s in-context learning performance.
To address these issues, we propose a generative framework to directly optimize demonstration selection for ICL performance, thereby avoiding the use of surrogate objectives that have a gap. We treat in-context learning as generative Bayesian optimization and introduce a latent variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><mi id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><ci id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_z</annotation></semantics></math> to establish the relationship between demonstration selection and ICL performance.
The optimization problem is formulated as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)=\\
\int_{z}P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=%
1}^{K},X)\,dz" class="ltx_Math" display="block" id="S3.E2.m1.58"><semantics id="S3.E2.m1.58a"><mtable displaystyle="true" id="S3.E2.m1.58.58.6" rowspacing="0pt" xref="S3.E2.m1.55.55.3.cmml"><mtr id="S3.E2.m1.58.58.6a" xref="S3.E2.m1.55.55.3.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E2.m1.58.58.6b" xref="S3.E2.m1.55.55.3.cmml"><mrow id="S3.E2.m1.56.56.4.53.21.21" xref="S3.E2.m1.55.55.3.cmml"><mrow id="S3.E2.m1.56.56.4.53.21.21.21" xref="S3.E2.m1.55.55.3.cmml"><msub id="S3.E2.m1.56.56.4.53.21.21.21.3" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.2.2.2.2.2.2.1" xref="S3.E2.m1.2.2.2.2.2.2.1.cmml">ℳ</mi></msub><mo id="S3.E2.m1.56.56.4.53.21.21.21.2" xref="S3.E2.m1.55.55.3.cmml">⁢</mo><mrow id="S3.E2.m1.56.56.4.53.21.21.21.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.3.3.3.3.3.3" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">(</mo><mrow id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.4.4.4.4.4.4" xref="S3.E2.m1.4.4.4.4.4.4.cmml">Y</mi><mo id="S3.E2.m1.5.5.5.5.5.5" xref="S3.E2.m1.5.5.5.5.5.5.cmml">∣</mo><mrow id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><msubsup id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mrow id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.6.6.6.6.6.6" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">{</mo><mrow id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.7.7.7.7.7.7" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">(</mo><msub id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.8.8.8.8.8.8" xref="S3.E2.m1.8.8.8.8.8.8.cmml">X</mi><mi id="S3.E2.m1.9.9.9.9.9.9.1" xref="S3.E2.m1.9.9.9.9.9.9.1.cmml">k</mi></msub><mo id="S3.E2.m1.10.10.10.10.10.10" xref="S3.E2.m1.55.55.3.cmml">,</mo><msub id="S3.E2.m1.56.56.4.53.21.21.21.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.11.11.11.11.11.11" xref="S3.E2.m1.11.11.11.11.11.11.cmml">Y</mi><mi id="S3.E2.m1.12.12.12.12.12.12.1" xref="S3.E2.m1.12.12.12.12.12.12.1.cmml">k</mi></msub><mo id="S3.E2.m1.13.13.13.13.13.13" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">)</mo></mrow><mo id="S3.E2.m1.14.14.14.14.14.14" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">}</mo></mrow><mrow id="S3.E2.m1.15.15.15.15.15.15.1" xref="S3.E2.m1.15.15.15.15.15.15.1.cmml"><mi id="S3.E2.m1.15.15.15.15.15.15.1.2" xref="S3.E2.m1.15.15.15.15.15.15.1.2.cmml">k</mi><mo id="S3.E2.m1.15.15.15.15.15.15.1.1" xref="S3.E2.m1.15.15.15.15.15.15.1.1.cmml">=</mo><mn id="S3.E2.m1.15.15.15.15.15.15.1.3" xref="S3.E2.m1.15.15.15.15.15.15.1.3.cmml">1</mn></mrow><mi id="S3.E2.m1.16.16.16.16.16.16.1" xref="S3.E2.m1.16.16.16.16.16.16.1.cmml">K</mi></msubsup><mo id="S3.E2.m1.17.17.17.17.17.17" xref="S3.E2.m1.55.55.3.cmml">,</mo><mi id="S3.E2.m1.18.18.18.18.18.18" xref="S3.E2.m1.18.18.18.18.18.18.cmml">X</mi></mrow></mrow><mo id="S3.E2.m1.19.19.19.19.19.19" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.20.20.20.20.20.20" xref="S3.E2.m1.20.20.20.20.20.20.cmml">=</mo><mi id="S3.E2.m1.56.56.4.53.21.21.22" xref="S3.E2.m1.55.55.3.cmml"></mi></mrow></mtd></mtr><mtr id="S3.E2.m1.58.58.6c" xref="S3.E2.m1.55.55.3.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E2.m1.58.58.6d" xref="S3.E2.m1.55.55.3.cmml"><mrow id="S3.E2.m1.58.58.6.55.34.34" xref="S3.E2.m1.55.55.3.cmml"><msub id="S3.E2.m1.58.58.6.55.34.34.35" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.21.21.21.1.1.1" xref="S3.E2.m1.21.21.21.1.1.1.cmml">∫</mo><mi id="S3.E2.m1.22.22.22.2.2.2.1" xref="S3.E2.m1.22.22.22.2.2.2.1.cmml">z</mi></msub><mrow id="S3.E2.m1.58.58.6.55.34.34.34" xref="S3.E2.m1.55.55.3.cmml"><msub id="S3.E2.m1.58.58.6.55.34.34.34.4" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.23.23.23.3.3.3" xref="S3.E2.m1.23.23.23.3.3.3.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.24.24.24.4.4.4.1" xref="S3.E2.m1.24.24.24.4.4.4.1.cmml">ℳ</mi></msub><mo id="S3.E2.m1.58.58.6.55.34.34.34.3" xref="S3.E2.m1.55.55.3.cmml">⁢</mo><mrow id="S3.E2.m1.57.57.5.54.33.33.33.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.25.25.25.5.5.5" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">(</mo><mrow id="S3.E2.m1.57.57.5.54.33.33.33.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.26.26.26.6.6.6" xref="S3.E2.m1.26.26.26.6.6.6.cmml">Y</mi><mo id="S3.E2.m1.27.27.27.7.7.7" xref="S3.E2.m1.27.27.27.7.7.7.cmml">∣</mo><mrow id="S3.E2.m1.57.57.5.54.33.33.33.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.28.28.28.8.8.8" xref="S3.E2.m1.28.28.28.8.8.8.cmml">z</mi><mo id="S3.E2.m1.29.29.29.9.9.9" xref="S3.E2.m1.55.55.3.cmml">,</mo><mi id="S3.E2.m1.30.30.30.10.10.10" xref="S3.E2.m1.30.30.30.10.10.10.cmml">X</mi></mrow></mrow><mo id="S3.E2.m1.31.31.31.11.11.11" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">)</mo></mrow><mo id="S3.E2.m1.58.58.6.55.34.34.34.3a" lspace="0.170em" xref="S3.E2.m1.55.55.3.cmml">⁢</mo><msub id="S3.E2.m1.58.58.6.55.34.34.34.5" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.32.32.32.12.12.12" xref="S3.E2.m1.32.32.32.12.12.12.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.33.33.33.13.13.13.1" xref="S3.E2.m1.33.33.33.13.13.13.1.cmml">ℳ</mi></msub><mo id="S3.E2.m1.58.58.6.55.34.34.34.3b" xref="S3.E2.m1.55.55.3.cmml">⁢</mo><mrow id="S3.E2.m1.58.58.6.55.34.34.34.2.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.34.34.34.14.14.14" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">(</mo><mrow id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.35.35.35.15.15.15" xref="S3.E2.m1.35.35.35.15.15.15.cmml">z</mi><mo id="S3.E2.m1.36.36.36.16.16.16" xref="S3.E2.m1.36.36.36.16.16.16.cmml">∣</mo><mrow id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><msubsup id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mrow id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.37.37.37.17.17.17" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">{</mo><mrow id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.38.38.38.18.18.18" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">(</mo><msub id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.39.39.39.19.19.19" xref="S3.E2.m1.39.39.39.19.19.19.cmml">X</mi><mi id="S3.E2.m1.40.40.40.20.20.20.1" xref="S3.E2.m1.40.40.40.20.20.20.1.cmml">k</mi></msub><mo id="S3.E2.m1.41.41.41.21.21.21" xref="S3.E2.m1.55.55.3.cmml">,</mo><msub id="S3.E2.m1.58.58.6.55.34.34.34.2.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.55.55.3.cmml"><mi id="S3.E2.m1.42.42.42.22.22.22" xref="S3.E2.m1.42.42.42.22.22.22.cmml">Y</mi><mi id="S3.E2.m1.43.43.43.23.23.23.1" xref="S3.E2.m1.43.43.43.23.23.23.1.cmml">k</mi></msub><mo id="S3.E2.m1.44.44.44.24.24.24" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">)</mo></mrow><mo id="S3.E2.m1.45.45.45.25.25.25" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">}</mo></mrow><mrow id="S3.E2.m1.46.46.46.26.26.26.1" xref="S3.E2.m1.46.46.46.26.26.26.1.cmml"><mi id="S3.E2.m1.46.46.46.26.26.26.1.2" xref="S3.E2.m1.46.46.46.26.26.26.1.2.cmml">k</mi><mo id="S3.E2.m1.46.46.46.26.26.26.1.1" xref="S3.E2.m1.46.46.46.26.26.26.1.1.cmml">=</mo><mn id="S3.E2.m1.46.46.46.26.26.26.1.3" xref="S3.E2.m1.46.46.46.26.26.26.1.3.cmml">1</mn></mrow><mi id="S3.E2.m1.47.47.47.27.27.27.1" xref="S3.E2.m1.47.47.47.27.27.27.1.cmml">K</mi></msubsup><mo id="S3.E2.m1.48.48.48.28.28.28" xref="S3.E2.m1.55.55.3.cmml">,</mo><mi id="S3.E2.m1.49.49.49.29.29.29" xref="S3.E2.m1.49.49.49.29.29.29.cmml">X</mi></mrow></mrow><mo id="S3.E2.m1.50.50.50.30.30.30" stretchy="false" xref="S3.E2.m1.55.55.3.cmml">)</mo></mrow><mo id="S3.E2.m1.58.58.6.55.34.34.34.3c" lspace="0.170em" xref="S3.E2.m1.55.55.3.cmml">⁢</mo><mrow id="S3.E2.m1.58.58.6.55.34.34.34.6" xref="S3.E2.m1.55.55.3.cmml"><mo id="S3.E2.m1.51.51.51.31.31.31" rspace="0em" xref="S3.E2.m1.51.51.51.31.31.31.cmml">𝑑</mo><mi id="S3.E2.m1.52.52.52.32.32.32" xref="S3.E2.m1.52.52.52.32.32.32.cmml">z</mi></mrow></mrow></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E2.m1.58b"><apply id="S3.E2.m1.55.55.3.cmml" xref="S3.E2.m1.58.58.6"><eq id="S3.E2.m1.20.20.20.20.20.20.cmml" xref="S3.E2.m1.20.20.20.20.20.20"></eq><apply id="S3.E2.m1.53.53.1.1.cmml" xref="S3.E2.m1.58.58.6"><times id="S3.E2.m1.53.53.1.1.2.cmml" xref="S3.E2.m1.58.58.6"></times><apply id="S3.E2.m1.53.53.1.1.3.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.53.53.1.1.3.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1">𝑃</ci><ci id="S3.E2.m1.2.2.2.2.2.2.1.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1">ℳ</ci></apply><apply id="S3.E2.m1.53.53.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="latexml" id="S3.E2.m1.5.5.5.5.5.5.cmml" xref="S3.E2.m1.5.5.5.5.5.5">conditional</csymbol><ci id="S3.E2.m1.4.4.4.4.4.4.cmml" xref="S3.E2.m1.4.4.4.4.4.4">𝑌</ci><list id="S3.E2.m1.53.53.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6"><apply id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6">superscript</csymbol><apply id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><set id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6"><interval closure="open" id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.58.58.6"><apply id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.8.8.8.8.8.8.cmml" xref="S3.E2.m1.8.8.8.8.8.8">𝑋</ci><ci id="S3.E2.m1.9.9.9.9.9.9.1.cmml" xref="S3.E2.m1.9.9.9.9.9.9.1">𝑘</ci></apply><apply id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.53.53.1.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.11.11.11.11.11.11.cmml" xref="S3.E2.m1.11.11.11.11.11.11">𝑌</ci><ci id="S3.E2.m1.12.12.12.12.12.12.1.cmml" xref="S3.E2.m1.12.12.12.12.12.12.1">𝑘</ci></apply></interval></set><apply id="S3.E2.m1.15.15.15.15.15.15.1.cmml" xref="S3.E2.m1.15.15.15.15.15.15.1"><eq id="S3.E2.m1.15.15.15.15.15.15.1.1.cmml" xref="S3.E2.m1.15.15.15.15.15.15.1.1"></eq><ci id="S3.E2.m1.15.15.15.15.15.15.1.2.cmml" xref="S3.E2.m1.15.15.15.15.15.15.1.2">𝑘</ci><cn id="S3.E2.m1.15.15.15.15.15.15.1.3.cmml" type="integer" xref="S3.E2.m1.15.15.15.15.15.15.1.3">1</cn></apply></apply><ci id="S3.E2.m1.16.16.16.16.16.16.1.cmml" xref="S3.E2.m1.16.16.16.16.16.16.1">𝐾</ci></apply><ci id="S3.E2.m1.18.18.18.18.18.18.cmml" xref="S3.E2.m1.18.18.18.18.18.18">𝑋</ci></list></apply></apply><apply id="S3.E2.m1.55.55.3.3.cmml" xref="S3.E2.m1.58.58.6"><apply id="S3.E2.m1.55.55.3.3.3.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.3.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><int id="S3.E2.m1.21.21.21.1.1.1.cmml" xref="S3.E2.m1.21.21.21.1.1.1"></int><ci id="S3.E2.m1.22.22.22.2.2.2.1.cmml" xref="S3.E2.m1.22.22.22.2.2.2.1">𝑧</ci></apply><apply id="S3.E2.m1.55.55.3.3.2.cmml" xref="S3.E2.m1.58.58.6"><times id="S3.E2.m1.55.55.3.3.2.3.cmml" xref="S3.E2.m1.58.58.6"></times><apply id="S3.E2.m1.55.55.3.3.2.4.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.4.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.23.23.23.3.3.3.cmml" xref="S3.E2.m1.23.23.23.3.3.3">𝑃</ci><ci id="S3.E2.m1.24.24.24.4.4.4.1.cmml" xref="S3.E2.m1.24.24.24.4.4.4.1">ℳ</ci></apply><apply id="S3.E2.m1.54.54.2.2.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="latexml" id="S3.E2.m1.27.27.27.7.7.7.cmml" xref="S3.E2.m1.27.27.27.7.7.7">conditional</csymbol><ci id="S3.E2.m1.26.26.26.6.6.6.cmml" xref="S3.E2.m1.26.26.26.6.6.6">𝑌</ci><list id="S3.E2.m1.54.54.2.2.1.1.1.1.3.cmml" xref="S3.E2.m1.58.58.6"><ci id="S3.E2.m1.28.28.28.8.8.8.cmml" xref="S3.E2.m1.28.28.28.8.8.8">𝑧</ci><ci id="S3.E2.m1.30.30.30.10.10.10.cmml" xref="S3.E2.m1.30.30.30.10.10.10">𝑋</ci></list></apply><apply id="S3.E2.m1.55.55.3.3.2.5.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.5.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.32.32.32.12.12.12.cmml" xref="S3.E2.m1.32.32.32.12.12.12">𝑃</ci><ci id="S3.E2.m1.33.33.33.13.13.13.1.cmml" xref="S3.E2.m1.33.33.33.13.13.13.1">ℳ</ci></apply><apply id="S3.E2.m1.55.55.3.3.2.2.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="latexml" id="S3.E2.m1.36.36.36.16.16.16.cmml" xref="S3.E2.m1.36.36.36.16.16.16">conditional</csymbol><ci id="S3.E2.m1.35.35.35.15.15.15.cmml" xref="S3.E2.m1.35.35.35.15.15.15">𝑧</ci><list id="S3.E2.m1.55.55.3.3.2.2.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6"><apply id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6">superscript</csymbol><apply id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><set id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.58.58.6"><interval closure="open" id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.58.58.6"><apply id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.39.39.39.19.19.19.cmml" xref="S3.E2.m1.39.39.39.19.19.19">𝑋</ci><ci id="S3.E2.m1.40.40.40.20.20.20.1.cmml" xref="S3.E2.m1.40.40.40.20.20.20.1">𝑘</ci></apply><apply id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="ambiguous" id="S3.E2.m1.55.55.3.3.2.2.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E2.m1.58.58.6">subscript</csymbol><ci id="S3.E2.m1.42.42.42.22.22.22.cmml" xref="S3.E2.m1.42.42.42.22.22.22">𝑌</ci><ci id="S3.E2.m1.43.43.43.23.23.23.1.cmml" xref="S3.E2.m1.43.43.43.23.23.23.1">𝑘</ci></apply></interval></set><apply id="S3.E2.m1.46.46.46.26.26.26.1.cmml" xref="S3.E2.m1.46.46.46.26.26.26.1"><eq id="S3.E2.m1.46.46.46.26.26.26.1.1.cmml" xref="S3.E2.m1.46.46.46.26.26.26.1.1"></eq><ci id="S3.E2.m1.46.46.46.26.26.26.1.2.cmml" xref="S3.E2.m1.46.46.46.26.26.26.1.2">𝑘</ci><cn id="S3.E2.m1.46.46.46.26.26.26.1.3.cmml" type="integer" xref="S3.E2.m1.46.46.46.26.26.26.1.3">1</cn></apply></apply><ci id="S3.E2.m1.47.47.47.27.27.27.1.cmml" xref="S3.E2.m1.47.47.47.27.27.27.1">𝐾</ci></apply><ci id="S3.E2.m1.49.49.49.29.29.29.cmml" xref="S3.E2.m1.49.49.49.29.29.29">𝑋</ci></list></apply><apply id="S3.E2.m1.55.55.3.3.2.6.cmml" xref="S3.E2.m1.58.58.6"><csymbol cd="latexml" id="S3.E2.m1.51.51.51.31.31.31.cmml" xref="S3.E2.m1.51.51.51.31.31.31">differential-d</csymbol><ci id="S3.E2.m1.52.52.52.32.32.32.cmml" xref="S3.E2.m1.52.52.52.32.32.32">𝑧</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.58c">P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)=\\
\int_{z}P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=%
1}^{K},X)\,dz</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.58d">start_ROW start_CELL italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) = end_CELL end_ROW start_ROW start_CELL ∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) italic_d italic_z end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.2">This transformation is also supported by the perspectives of <cite class="ltx_cite ltx_citemacro_citet">Xie et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib48" title="">2021</a>)</cite> and <cite class="ltx_cite ltx_citemacro_citet">Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib47" title="">2024b</a>)</cite>, where in-context learning can be viewed as a Bayesian inference process.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.2">The latent variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mi id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><ci id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_z</annotation></semantics></math> is viewed as the representation of the LLM’s demonstration preference.
Through <math alttext="z" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><mi id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><ci id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_z</annotation></semantics></math>, we concretize the LLM’s preference for demonstration and use it to identify effective demonstrations. Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E2" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">2</span></a>) proves from a Bayesian perspective that, during the optimization process, both the ground truth and demonstrations should be considered simultaneously.
However, in the surrogate optimization objectives of retriever-based methods, only the quality of the demonstrations is considered. This is why demonstrations selected by these methods do not necessarily enhance the LLM’s ability to predict the ground truth within ICL.</p>
</div>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1">To obtain the demonstration preference, we propose to fully optimize the latent variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><mi id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><ci id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">italic_z</annotation></semantics></math> by jointly considering the ground truth and the preference of the demonstrations.
We utilize the Evidence Lower Bound (ELBO) <cite class="ltx_cite ltx_citemacro_citep">(Kingma, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib16" title="">2013</a>)</cite> and Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E2" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">2</span></a>) to obtain the following optimization objective, with the detailed derivation provided in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A4" title="Appendix D Derivation of the Optimization Objective ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">D</span></a>.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z,X)\\
-\log P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)" class="ltx_Math" display="block" id="S3.E3.m1.41"><semantics id="S3.E3.m1.41a"><mtable displaystyle="true" id="S3.E3.m1.41.41.4" rowspacing="0pt" xref="S3.E3.m1.39.39.2.cmml"><mtr id="S3.E3.m1.41.41.4a" xref="S3.E3.m1.39.39.2.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E3.m1.41.41.4b" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.40.40.3.38.17.17" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.40.40.3.38.17.17.18" xref="S3.E3.m1.39.39.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E3.m1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.cmml">ℒ</mi><mo id="S3.E3.m1.40.40.3.38.17.17.18.1" xref="S3.E3.m1.39.39.2.cmml">⁢</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.18.2" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.2.2.2.2.2.2" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">(</mo><mi id="S3.E3.m1.3.3.3.3.3.3" xref="S3.E3.m1.3.3.3.3.3.3.cmml">z</mi><mo id="S3.E3.m1.4.4.4.4.4.4" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">)</mo></mrow></mrow><mo id="S3.E3.m1.5.5.5.5.5.5" xref="S3.E3.m1.5.5.5.5.5.5.cmml">=</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.17" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.40.40.3.38.17.17.17a" rspace="0.167em" xref="S3.E3.m1.39.39.2.cmml">−</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.17.1" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.40.40.3.38.17.17.17.1.3" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.7.7.7.7.7.7" xref="S3.E3.m1.7.7.7.7.7.7.cmml">log</mi><mo id="S3.E3.m1.40.40.3.38.17.17.17.1.3a" lspace="0.167em" xref="S3.E3.m1.39.39.2.cmml">⁡</mo><msub id="S3.E3.m1.40.40.3.38.17.17.17.1.3.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.8.8.8.8.8.8" xref="S3.E3.m1.8.8.8.8.8.8.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E3.m1.9.9.9.9.9.9.1" xref="S3.E3.m1.9.9.9.9.9.9.1.cmml">ℳ</mi></msub></mrow><mo id="S3.E3.m1.40.40.3.38.17.17.17.1.2" xref="S3.E3.m1.39.39.2.cmml">⁢</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.17.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.10.10.10.10.10.10" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">(</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.17.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.11.11.11.11.11.11" xref="S3.E3.m1.11.11.11.11.11.11.cmml">Y</mi><mo id="S3.E3.m1.12.12.12.12.12.12" xref="S3.E3.m1.12.12.12.12.12.12.cmml">∣</mo><mrow id="S3.E3.m1.40.40.3.38.17.17.17.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.13.13.13.13.13.13" xref="S3.E3.m1.13.13.13.13.13.13.cmml">z</mi><mo id="S3.E3.m1.14.14.14.14.14.14" xref="S3.E3.m1.39.39.2.cmml">,</mo><mi id="S3.E3.m1.15.15.15.15.15.15" xref="S3.E3.m1.15.15.15.15.15.15.cmml">X</mi></mrow></mrow><mo id="S3.E3.m1.16.16.16.16.16.16" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E3.m1.41.41.4c" xref="S3.E3.m1.39.39.2.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E3.m1.41.41.4d" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.41.41.4.39.22.22" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.41.41.4.39.22.22a" rspace="0.167em" xref="S3.E3.m1.39.39.2.cmml">−</mo><mrow id="S3.E3.m1.41.41.4.39.22.22.22" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.41.41.4.39.22.22.22.3" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.18.18.18.2.2.2" xref="S3.E3.m1.18.18.18.2.2.2.cmml">log</mi><mo id="S3.E3.m1.41.41.4.39.22.22.22.3a" lspace="0.167em" xref="S3.E3.m1.39.39.2.cmml">⁡</mo><msub id="S3.E3.m1.41.41.4.39.22.22.22.3.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.19.19.19.3.3.3" xref="S3.E3.m1.19.19.19.3.3.3.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E3.m1.20.20.20.4.4.4.1" xref="S3.E3.m1.20.20.20.4.4.4.1.cmml">ℳ</mi></msub></mrow><mo id="S3.E3.m1.41.41.4.39.22.22.22.2" xref="S3.E3.m1.39.39.2.cmml">⁢</mo><mrow id="S3.E3.m1.41.41.4.39.22.22.22.1.1" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.21.21.21.5.5.5" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">(</mo><mrow id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.22.22.22.6.6.6" xref="S3.E3.m1.22.22.22.6.6.6.cmml">z</mi><mo id="S3.E3.m1.23.23.23.7.7.7" xref="S3.E3.m1.23.23.23.7.7.7.cmml">∣</mo><mrow id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><msubsup id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mrow id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.24.24.24.8.8.8" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">{</mo><mrow id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mo id="S3.E3.m1.25.25.25.9.9.9" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">(</mo><msub id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.26.26.26.10.10.10" xref="S3.E3.m1.26.26.26.10.10.10.cmml">X</mi><mi id="S3.E3.m1.27.27.27.11.11.11.1" xref="S3.E3.m1.27.27.27.11.11.11.1.cmml">k</mi></msub><mo id="S3.E3.m1.28.28.28.12.12.12" xref="S3.E3.m1.39.39.2.cmml">,</mo><msub id="S3.E3.m1.41.41.4.39.22.22.22.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.E3.m1.39.39.2.cmml"><mi id="S3.E3.m1.29.29.29.13.13.13" xref="S3.E3.m1.29.29.29.13.13.13.cmml">Y</mi><mi id="S3.E3.m1.30.30.30.14.14.14.1" xref="S3.E3.m1.30.30.30.14.14.14.1.cmml">k</mi></msub><mo id="S3.E3.m1.31.31.31.15.15.15" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">)</mo></mrow><mo id="S3.E3.m1.32.32.32.16.16.16" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">}</mo></mrow><mrow id="S3.E3.m1.33.33.33.17.17.17.1" xref="S3.E3.m1.33.33.33.17.17.17.1.cmml"><mi id="S3.E3.m1.33.33.33.17.17.17.1.2" xref="S3.E3.m1.33.33.33.17.17.17.1.2.cmml">k</mi><mo id="S3.E3.m1.33.33.33.17.17.17.1.1" xref="S3.E3.m1.33.33.33.17.17.17.1.1.cmml">=</mo><mn id="S3.E3.m1.33.33.33.17.17.17.1.3" xref="S3.E3.m1.33.33.33.17.17.17.1.3.cmml">1</mn></mrow><mi id="S3.E3.m1.34.34.34.18.18.18.1" xref="S3.E3.m1.34.34.34.18.18.18.1.cmml">K</mi></msubsup><mo id="S3.E3.m1.35.35.35.19.19.19" xref="S3.E3.m1.39.39.2.cmml">,</mo><mi id="S3.E3.m1.36.36.36.20.20.20" xref="S3.E3.m1.36.36.36.20.20.20.cmml">X</mi></mrow></mrow><mo id="S3.E3.m1.37.37.37.21.21.21" stretchy="false" xref="S3.E3.m1.39.39.2.cmml">)</mo></mrow></mrow></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E3.m1.41b"><apply id="S3.E3.m1.39.39.2.cmml" xref="S3.E3.m1.41.41.4"><eq id="S3.E3.m1.5.5.5.5.5.5.cmml" xref="S3.E3.m1.5.5.5.5.5.5"></eq><apply id="S3.E3.m1.39.39.2.4.cmml" xref="S3.E3.m1.41.41.4"><times id="S3.E3.m1.39.39.2.4.1.cmml" xref="S3.E3.m1.41.41.4"></times><ci id="S3.E3.m1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1">ℒ</ci><ci id="S3.E3.m1.3.3.3.3.3.3.cmml" xref="S3.E3.m1.3.3.3.3.3.3">𝑧</ci></apply><apply id="S3.E3.m1.39.39.2.2.cmml" xref="S3.E3.m1.41.41.4"><minus id="S3.E3.m1.17.17.17.1.1.1.cmml" xref="S3.E3.m1.41.41.4"></minus><apply id="S3.E3.m1.38.38.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><minus id="S3.E3.m1.6.6.6.6.6.6.cmml" xref="S3.E3.m1.41.41.4"></minus><apply id="S3.E3.m1.38.38.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><times id="S3.E3.m1.38.38.1.1.1.1.2.cmml" xref="S3.E3.m1.41.41.4"></times><apply id="S3.E3.m1.38.38.1.1.1.1.3.cmml" xref="S3.E3.m1.41.41.4"><log id="S3.E3.m1.7.7.7.7.7.7.cmml" xref="S3.E3.m1.7.7.7.7.7.7"></log><apply id="S3.E3.m1.38.38.1.1.1.1.3.2.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.38.38.1.1.1.1.3.2.1.cmml" xref="S3.E3.m1.41.41.4">subscript</csymbol><ci id="S3.E3.m1.8.8.8.8.8.8.cmml" xref="S3.E3.m1.8.8.8.8.8.8">𝑃</ci><ci id="S3.E3.m1.9.9.9.9.9.9.1.cmml" xref="S3.E3.m1.9.9.9.9.9.9.1">ℳ</ci></apply></apply><apply id="S3.E3.m1.38.38.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="latexml" id="S3.E3.m1.12.12.12.12.12.12.cmml" xref="S3.E3.m1.12.12.12.12.12.12">conditional</csymbol><ci id="S3.E3.m1.11.11.11.11.11.11.cmml" xref="S3.E3.m1.11.11.11.11.11.11">𝑌</ci><list id="S3.E3.m1.38.38.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.41.41.4"><ci id="S3.E3.m1.13.13.13.13.13.13.cmml" xref="S3.E3.m1.13.13.13.13.13.13">𝑧</ci><ci id="S3.E3.m1.15.15.15.15.15.15.cmml" xref="S3.E3.m1.15.15.15.15.15.15">𝑋</ci></list></apply></apply></apply><apply id="S3.E3.m1.39.39.2.2.2.cmml" xref="S3.E3.m1.41.41.4"><times id="S3.E3.m1.39.39.2.2.2.2.cmml" xref="S3.E3.m1.41.41.4"></times><apply id="S3.E3.m1.39.39.2.2.2.3.cmml" xref="S3.E3.m1.41.41.4"><log id="S3.E3.m1.18.18.18.2.2.2.cmml" xref="S3.E3.m1.18.18.18.2.2.2"></log><apply id="S3.E3.m1.39.39.2.2.2.3.2.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.39.39.2.2.2.3.2.1.cmml" xref="S3.E3.m1.41.41.4">subscript</csymbol><ci id="S3.E3.m1.19.19.19.3.3.3.cmml" xref="S3.E3.m1.19.19.19.3.3.3">𝑃</ci><ci id="S3.E3.m1.20.20.20.4.4.4.1.cmml" xref="S3.E3.m1.20.20.20.4.4.4.1">ℳ</ci></apply></apply><apply id="S3.E3.m1.39.39.2.2.2.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="latexml" id="S3.E3.m1.23.23.23.7.7.7.cmml" xref="S3.E3.m1.23.23.23.7.7.7">conditional</csymbol><ci id="S3.E3.m1.22.22.22.6.6.6.cmml" xref="S3.E3.m1.22.22.22.6.6.6">𝑧</ci><list id="S3.E3.m1.39.39.2.2.2.1.1.1.1.2.cmml" xref="S3.E3.m1.41.41.4"><apply id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.41.41.4">superscript</csymbol><apply id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.41.41.4">subscript</csymbol><set id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m1.41.41.4"><interval closure="open" id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m1.41.41.4"><apply id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.41.41.4">subscript</csymbol><ci id="S3.E3.m1.26.26.26.10.10.10.cmml" xref="S3.E3.m1.26.26.26.10.10.10">𝑋</ci><ci id="S3.E3.m1.27.27.27.11.11.11.1.cmml" xref="S3.E3.m1.27.27.27.11.11.11.1">𝑘</ci></apply><apply id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E3.m1.41.41.4"><csymbol cd="ambiguous" id="S3.E3.m1.39.39.2.2.2.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E3.m1.41.41.4">subscript</csymbol><ci id="S3.E3.m1.29.29.29.13.13.13.cmml" xref="S3.E3.m1.29.29.29.13.13.13">𝑌</ci><ci id="S3.E3.m1.30.30.30.14.14.14.1.cmml" xref="S3.E3.m1.30.30.30.14.14.14.1">𝑘</ci></apply></interval></set><apply id="S3.E3.m1.33.33.33.17.17.17.1.cmml" xref="S3.E3.m1.33.33.33.17.17.17.1"><eq id="S3.E3.m1.33.33.33.17.17.17.1.1.cmml" xref="S3.E3.m1.33.33.33.17.17.17.1.1"></eq><ci id="S3.E3.m1.33.33.33.17.17.17.1.2.cmml" xref="S3.E3.m1.33.33.33.17.17.17.1.2">𝑘</ci><cn id="S3.E3.m1.33.33.33.17.17.17.1.3.cmml" type="integer" xref="S3.E3.m1.33.33.33.17.17.17.1.3">1</cn></apply></apply><ci id="S3.E3.m1.34.34.34.18.18.18.1.cmml" xref="S3.E3.m1.34.34.34.18.18.18.1">𝐾</ci></apply><ci id="S3.E3.m1.36.36.36.20.20.20.cmml" xref="S3.E3.m1.36.36.36.20.20.20">𝑋</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.41c">\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z,X)\\
-\log P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.41d">start_ROW start_CELL caligraphic_L ( italic_z ) = - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) end_CELL end_ROW start_ROW start_CELL - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p3.2">Due to the combinatory search space of <math alttext="(X_{1},Y_{1}),(X_{2},Y_{2}),...,(X_{K},Y_{K})" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m1.4"><semantics id="S3.SS2.p3.2.m1.4a"><mrow id="S3.SS2.p3.2.m1.4.4.3" xref="S3.SS2.p3.2.m1.4.4.4.cmml"><mrow id="S3.SS2.p3.2.m1.2.2.1.1.2" xref="S3.SS2.p3.2.m1.2.2.1.1.3.cmml"><mo id="S3.SS2.p3.2.m1.2.2.1.1.2.3" stretchy="false" xref="S3.SS2.p3.2.m1.2.2.1.1.3.cmml">(</mo><msub id="S3.SS2.p3.2.m1.2.2.1.1.1.1" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1.cmml"><mi id="S3.SS2.p3.2.m1.2.2.1.1.1.1.2" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1.2.cmml">X</mi><mn id="S3.SS2.p3.2.m1.2.2.1.1.1.1.3" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS2.p3.2.m1.2.2.1.1.2.4" xref="S3.SS2.p3.2.m1.2.2.1.1.3.cmml">,</mo><msub id="S3.SS2.p3.2.m1.2.2.1.1.2.2" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2.cmml"><mi id="S3.SS2.p3.2.m1.2.2.1.1.2.2.2" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2.2.cmml">Y</mi><mn id="S3.SS2.p3.2.m1.2.2.1.1.2.2.3" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2.3.cmml">1</mn></msub><mo id="S3.SS2.p3.2.m1.2.2.1.1.2.5" stretchy="false" xref="S3.SS2.p3.2.m1.2.2.1.1.3.cmml">)</mo></mrow><mo id="S3.SS2.p3.2.m1.4.4.3.4" xref="S3.SS2.p3.2.m1.4.4.4.cmml">,</mo><mrow id="S3.SS2.p3.2.m1.3.3.2.2.2" xref="S3.SS2.p3.2.m1.3.3.2.2.3.cmml"><mo id="S3.SS2.p3.2.m1.3.3.2.2.2.3" stretchy="false" xref="S3.SS2.p3.2.m1.3.3.2.2.3.cmml">(</mo><msub id="S3.SS2.p3.2.m1.3.3.2.2.1.1" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1.cmml"><mi id="S3.SS2.p3.2.m1.3.3.2.2.1.1.2" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1.2.cmml">X</mi><mn id="S3.SS2.p3.2.m1.3.3.2.2.1.1.3" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1.3.cmml">2</mn></msub><mo id="S3.SS2.p3.2.m1.3.3.2.2.2.4" xref="S3.SS2.p3.2.m1.3.3.2.2.3.cmml">,</mo><msub id="S3.SS2.p3.2.m1.3.3.2.2.2.2" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2.cmml"><mi id="S3.SS2.p3.2.m1.3.3.2.2.2.2.2" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2.2.cmml">Y</mi><mn id="S3.SS2.p3.2.m1.3.3.2.2.2.2.3" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2.3.cmml">2</mn></msub><mo id="S3.SS2.p3.2.m1.3.3.2.2.2.5" stretchy="false" xref="S3.SS2.p3.2.m1.3.3.2.2.3.cmml">)</mo></mrow><mo id="S3.SS2.p3.2.m1.4.4.3.5" xref="S3.SS2.p3.2.m1.4.4.4.cmml">,</mo><mi id="S3.SS2.p3.2.m1.1.1" mathvariant="normal" xref="S3.SS2.p3.2.m1.1.1.cmml">…</mi><mo id="S3.SS2.p3.2.m1.4.4.3.6" xref="S3.SS2.p3.2.m1.4.4.4.cmml">,</mo><mrow id="S3.SS2.p3.2.m1.4.4.3.3.2" xref="S3.SS2.p3.2.m1.4.4.3.3.3.cmml"><mo id="S3.SS2.p3.2.m1.4.4.3.3.2.3" stretchy="false" xref="S3.SS2.p3.2.m1.4.4.3.3.3.cmml">(</mo><msub id="S3.SS2.p3.2.m1.4.4.3.3.1.1" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1.cmml"><mi id="S3.SS2.p3.2.m1.4.4.3.3.1.1.2" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1.2.cmml">X</mi><mi id="S3.SS2.p3.2.m1.4.4.3.3.1.1.3" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1.3.cmml">K</mi></msub><mo id="S3.SS2.p3.2.m1.4.4.3.3.2.4" xref="S3.SS2.p3.2.m1.4.4.3.3.3.cmml">,</mo><msub id="S3.SS2.p3.2.m1.4.4.3.3.2.2" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2.cmml"><mi id="S3.SS2.p3.2.m1.4.4.3.3.2.2.2" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2.2.cmml">Y</mi><mi id="S3.SS2.p3.2.m1.4.4.3.3.2.2.3" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2.3.cmml">K</mi></msub><mo id="S3.SS2.p3.2.m1.4.4.3.3.2.5" stretchy="false" xref="S3.SS2.p3.2.m1.4.4.3.3.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m1.4b"><list id="S3.SS2.p3.2.m1.4.4.4.cmml" xref="S3.SS2.p3.2.m1.4.4.3"><interval closure="open" id="S3.SS2.p3.2.m1.2.2.1.1.3.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.2"><apply id="S3.SS2.p3.2.m1.2.2.1.1.1.1.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.2.2.1.1.1.1.1.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m1.2.2.1.1.1.1.2.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1.2">𝑋</ci><cn id="S3.SS2.p3.2.m1.2.2.1.1.1.1.3.cmml" type="integer" xref="S3.SS2.p3.2.m1.2.2.1.1.1.1.3">1</cn></apply><apply id="S3.SS2.p3.2.m1.2.2.1.1.2.2.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.2.2.1.1.2.2.1.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2">subscript</csymbol><ci id="S3.SS2.p3.2.m1.2.2.1.1.2.2.2.cmml" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2.2">𝑌</ci><cn id="S3.SS2.p3.2.m1.2.2.1.1.2.2.3.cmml" type="integer" xref="S3.SS2.p3.2.m1.2.2.1.1.2.2.3">1</cn></apply></interval><interval closure="open" id="S3.SS2.p3.2.m1.3.3.2.2.3.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.2"><apply id="S3.SS2.p3.2.m1.3.3.2.2.1.1.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.3.3.2.2.1.1.1.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m1.3.3.2.2.1.1.2.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1.2">𝑋</ci><cn id="S3.SS2.p3.2.m1.3.3.2.2.1.1.3.cmml" type="integer" xref="S3.SS2.p3.2.m1.3.3.2.2.1.1.3">2</cn></apply><apply id="S3.SS2.p3.2.m1.3.3.2.2.2.2.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.3.3.2.2.2.2.1.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2">subscript</csymbol><ci id="S3.SS2.p3.2.m1.3.3.2.2.2.2.2.cmml" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2.2">𝑌</ci><cn id="S3.SS2.p3.2.m1.3.3.2.2.2.2.3.cmml" type="integer" xref="S3.SS2.p3.2.m1.3.3.2.2.2.2.3">2</cn></apply></interval><ci id="S3.SS2.p3.2.m1.1.1.cmml" xref="S3.SS2.p3.2.m1.1.1">…</ci><interval closure="open" id="S3.SS2.p3.2.m1.4.4.3.3.3.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.2"><apply id="S3.SS2.p3.2.m1.4.4.3.3.1.1.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.4.4.3.3.1.1.1.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m1.4.4.3.3.1.1.2.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1.2">𝑋</ci><ci id="S3.SS2.p3.2.m1.4.4.3.3.1.1.3.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.1.1.3">𝐾</ci></apply><apply id="S3.SS2.p3.2.m1.4.4.3.3.2.2.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m1.4.4.3.3.2.2.1.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2">subscript</csymbol><ci id="S3.SS2.p3.2.m1.4.4.3.3.2.2.2.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2.2">𝑌</ci><ci id="S3.SS2.p3.2.m1.4.4.3.3.2.2.3.cmml" xref="S3.SS2.p3.2.m1.4.4.3.3.2.2.3">𝐾</ci></apply></interval></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m1.4c">(X_{1},Y_{1}),(X_{2},Y_{2}),...,(X_{K},Y_{K})</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.2.m1.4d">( italic_X start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) , ( italic_X start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) , … , ( italic_X start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT )</annotation></semantics></math> being immense, we simplify the optimization objective to the following formula.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z,X)\\
-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)" class="ltx_Math" display="block" id="S3.E4.m1.37"><semantics id="S3.E4.m1.37a"><mtable displaystyle="true" id="S3.E4.m1.37.37.4" rowspacing="0pt" xref="S3.E4.m1.35.35.2.cmml"><mtr id="S3.E4.m1.37.37.4a" xref="S3.E4.m1.35.35.2.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E4.m1.37.37.4b" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.36.36.3.34.17.17" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.36.36.3.34.17.17.18" xref="S3.E4.m1.35.35.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.cmml">ℒ</mi><mo id="S3.E4.m1.36.36.3.34.17.17.18.1" xref="S3.E4.m1.35.35.2.cmml">⁢</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.18.2" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.2.2.2.2.2.2" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">(</mo><mi id="S3.E4.m1.3.3.3.3.3.3" xref="S3.E4.m1.3.3.3.3.3.3.cmml">z</mi><mo id="S3.E4.m1.4.4.4.4.4.4" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">)</mo></mrow></mrow><mo id="S3.E4.m1.5.5.5.5.5.5" xref="S3.E4.m1.5.5.5.5.5.5.cmml">=</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.17" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.36.36.3.34.17.17.17a" rspace="0.167em" xref="S3.E4.m1.35.35.2.cmml">−</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.17.1" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.36.36.3.34.17.17.17.1.3" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.7.7.7.7.7.7" xref="S3.E4.m1.7.7.7.7.7.7.cmml">log</mi><mo id="S3.E4.m1.36.36.3.34.17.17.17.1.3a" lspace="0.167em" xref="S3.E4.m1.35.35.2.cmml">⁡</mo><msub id="S3.E4.m1.36.36.3.34.17.17.17.1.3.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.8.8.8.8.8.8" xref="S3.E4.m1.8.8.8.8.8.8.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.9.9.9.9.9.9.1" xref="S3.E4.m1.9.9.9.9.9.9.1.cmml">ℳ</mi></msub></mrow><mo id="S3.E4.m1.36.36.3.34.17.17.17.1.2" xref="S3.E4.m1.35.35.2.cmml">⁢</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.17.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.10.10.10.10.10.10" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">(</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.17.1.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.11.11.11.11.11.11" xref="S3.E4.m1.11.11.11.11.11.11.cmml">Y</mi><mo id="S3.E4.m1.12.12.12.12.12.12" xref="S3.E4.m1.12.12.12.12.12.12.cmml">∣</mo><mrow id="S3.E4.m1.36.36.3.34.17.17.17.1.1.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.13.13.13.13.13.13" xref="S3.E4.m1.13.13.13.13.13.13.cmml">z</mi><mo id="S3.E4.m1.14.14.14.14.14.14" xref="S3.E4.m1.35.35.2.cmml">,</mo><mi id="S3.E4.m1.15.15.15.15.15.15" xref="S3.E4.m1.15.15.15.15.15.15.cmml">X</mi></mrow></mrow><mo id="S3.E4.m1.16.16.16.16.16.16" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E4.m1.37.37.4c" xref="S3.E4.m1.35.35.2.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E4.m1.37.37.4d" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.37.37.4.35.18.18" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.37.37.4.35.18.18a" rspace="0.167em" xref="S3.E4.m1.35.35.2.cmml">−</mo><mrow id="S3.E4.m1.37.37.4.35.18.18.18" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.37.37.4.35.18.18.18.3" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.18.18.18.2.2.2" xref="S3.E4.m1.18.18.18.2.2.2.cmml">log</mi><mo id="S3.E4.m1.37.37.4.35.18.18.18.3a" lspace="0.167em" xref="S3.E4.m1.35.35.2.cmml">⁡</mo><msub id="S3.E4.m1.37.37.4.35.18.18.18.3.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.19.19.19.3.3.3" xref="S3.E4.m1.19.19.19.3.3.3.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.20.20.20.4.4.4.1" xref="S3.E4.m1.20.20.20.4.4.4.1.cmml">ℳ</mi></msub></mrow><mo id="S3.E4.m1.37.37.4.35.18.18.18.2" xref="S3.E4.m1.35.35.2.cmml">⁢</mo><mrow id="S3.E4.m1.37.37.4.35.18.18.18.1.1" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.21.21.21.5.5.5" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">(</mo><mrow id="S3.E4.m1.37.37.4.35.18.18.18.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.22.22.22.6.6.6" xref="S3.E4.m1.22.22.22.6.6.6.cmml">z</mi><mo id="S3.E4.m1.23.23.23.7.7.7" xref="S3.E4.m1.23.23.23.7.7.7.cmml">∣</mo><mrow id="S3.E4.m1.37.37.4.35.18.18.18.1.1.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mrow id="S3.E4.m1.37.37.4.35.18.18.18.1.1.1.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mo id="S3.E4.m1.24.24.24.8.8.8" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">(</mo><msub id="S3.E4.m1.37.37.4.35.18.18.18.1.1.1.1.1.1.1.1" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.25.25.25.9.9.9" xref="S3.E4.m1.25.25.25.9.9.9.cmml">X</mi><mi id="S3.E4.m1.26.26.26.10.10.10.1" xref="S3.E4.m1.26.26.26.10.10.10.1.cmml">k</mi></msub><mo id="S3.E4.m1.27.27.27.11.11.11" xref="S3.E4.m1.35.35.2.cmml">,</mo><msub id="S3.E4.m1.37.37.4.35.18.18.18.1.1.1.1.1.1.2.2" xref="S3.E4.m1.35.35.2.cmml"><mi id="S3.E4.m1.28.28.28.12.12.12" xref="S3.E4.m1.28.28.28.12.12.12.cmml">Y</mi><mi id="S3.E4.m1.29.29.29.13.13.13.1" xref="S3.E4.m1.29.29.29.13.13.13.1.cmml">k</mi></msub><mo id="S3.E4.m1.30.30.30.14.14.14" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">)</mo></mrow><mo id="S3.E4.m1.31.31.31.15.15.15" xref="S3.E4.m1.35.35.2.cmml">,</mo><mi id="S3.E4.m1.32.32.32.16.16.16" xref="S3.E4.m1.32.32.32.16.16.16.cmml">X</mi></mrow></mrow><mo id="S3.E4.m1.33.33.33.17.17.17" stretchy="false" xref="S3.E4.m1.35.35.2.cmml">)</mo></mrow></mrow></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E4.m1.37b"><apply id="S3.E4.m1.35.35.2.cmml" xref="S3.E4.m1.37.37.4"><eq id="S3.E4.m1.5.5.5.5.5.5.cmml" xref="S3.E4.m1.5.5.5.5.5.5"></eq><apply id="S3.E4.m1.35.35.2.4.cmml" xref="S3.E4.m1.37.37.4"><times id="S3.E4.m1.35.35.2.4.1.cmml" xref="S3.E4.m1.37.37.4"></times><ci id="S3.E4.m1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1">ℒ</ci><ci id="S3.E4.m1.3.3.3.3.3.3.cmml" xref="S3.E4.m1.3.3.3.3.3.3">𝑧</ci></apply><apply id="S3.E4.m1.35.35.2.2.cmml" xref="S3.E4.m1.37.37.4"><minus id="S3.E4.m1.17.17.17.1.1.1.cmml" xref="S3.E4.m1.37.37.4"></minus><apply id="S3.E4.m1.34.34.1.1.1.cmml" xref="S3.E4.m1.37.37.4"><minus id="S3.E4.m1.6.6.6.6.6.6.cmml" xref="S3.E4.m1.37.37.4"></minus><apply id="S3.E4.m1.34.34.1.1.1.1.cmml" xref="S3.E4.m1.37.37.4"><times id="S3.E4.m1.34.34.1.1.1.1.2.cmml" xref="S3.E4.m1.37.37.4"></times><apply id="S3.E4.m1.34.34.1.1.1.1.3.cmml" xref="S3.E4.m1.37.37.4"><log id="S3.E4.m1.7.7.7.7.7.7.cmml" xref="S3.E4.m1.7.7.7.7.7.7"></log><apply id="S3.E4.m1.34.34.1.1.1.1.3.2.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="ambiguous" id="S3.E4.m1.34.34.1.1.1.1.3.2.1.cmml" xref="S3.E4.m1.37.37.4">subscript</csymbol><ci id="S3.E4.m1.8.8.8.8.8.8.cmml" xref="S3.E4.m1.8.8.8.8.8.8">𝑃</ci><ci id="S3.E4.m1.9.9.9.9.9.9.1.cmml" xref="S3.E4.m1.9.9.9.9.9.9.1">ℳ</ci></apply></apply><apply id="S3.E4.m1.34.34.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="latexml" id="S3.E4.m1.12.12.12.12.12.12.cmml" xref="S3.E4.m1.12.12.12.12.12.12">conditional</csymbol><ci id="S3.E4.m1.11.11.11.11.11.11.cmml" xref="S3.E4.m1.11.11.11.11.11.11">𝑌</ci><list id="S3.E4.m1.34.34.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.37.37.4"><ci id="S3.E4.m1.13.13.13.13.13.13.cmml" xref="S3.E4.m1.13.13.13.13.13.13">𝑧</ci><ci id="S3.E4.m1.15.15.15.15.15.15.cmml" xref="S3.E4.m1.15.15.15.15.15.15">𝑋</ci></list></apply></apply></apply><apply id="S3.E4.m1.35.35.2.2.2.cmml" xref="S3.E4.m1.37.37.4"><times id="S3.E4.m1.35.35.2.2.2.2.cmml" xref="S3.E4.m1.37.37.4"></times><apply id="S3.E4.m1.35.35.2.2.2.3.cmml" xref="S3.E4.m1.37.37.4"><log id="S3.E4.m1.18.18.18.2.2.2.cmml" xref="S3.E4.m1.18.18.18.2.2.2"></log><apply id="S3.E4.m1.35.35.2.2.2.3.2.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="ambiguous" id="S3.E4.m1.35.35.2.2.2.3.2.1.cmml" xref="S3.E4.m1.37.37.4">subscript</csymbol><ci id="S3.E4.m1.19.19.19.3.3.3.cmml" xref="S3.E4.m1.19.19.19.3.3.3">𝑃</ci><ci id="S3.E4.m1.20.20.20.4.4.4.1.cmml" xref="S3.E4.m1.20.20.20.4.4.4.1">ℳ</ci></apply></apply><apply id="S3.E4.m1.35.35.2.2.2.1.1.1.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="latexml" id="S3.E4.m1.23.23.23.7.7.7.cmml" xref="S3.E4.m1.23.23.23.7.7.7">conditional</csymbol><ci id="S3.E4.m1.22.22.22.6.6.6.cmml" xref="S3.E4.m1.22.22.22.6.6.6">𝑧</ci><list id="S3.E4.m1.35.35.2.2.2.1.1.1.1.2.cmml" xref="S3.E4.m1.37.37.4"><interval closure="open" id="S3.E4.m1.35.35.2.2.2.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.37.37.4"><apply id="S3.E4.m1.35.35.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="ambiguous" id="S3.E4.m1.35.35.2.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.37.37.4">subscript</csymbol><ci id="S3.E4.m1.25.25.25.9.9.9.cmml" xref="S3.E4.m1.25.25.25.9.9.9">𝑋</ci><ci id="S3.E4.m1.26.26.26.10.10.10.1.cmml" xref="S3.E4.m1.26.26.26.10.10.10.1">𝑘</ci></apply><apply id="S3.E4.m1.35.35.2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.37.37.4"><csymbol cd="ambiguous" id="S3.E4.m1.35.35.2.2.2.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E4.m1.37.37.4">subscript</csymbol><ci id="S3.E4.m1.28.28.28.12.12.12.cmml" xref="S3.E4.m1.28.28.28.12.12.12">𝑌</ci><ci id="S3.E4.m1.29.29.29.13.13.13.1.cmml" xref="S3.E4.m1.29.29.29.13.13.13.1">𝑘</ci></apply></interval><ci id="S3.E4.m1.32.32.32.16.16.16.cmml" xref="S3.E4.m1.32.32.32.16.16.16">𝑋</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.37c">\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z,X)\\
-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.37d">start_ROW start_CELL caligraphic_L ( italic_z ) = - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) end_CELL end_ROW start_ROW start_CELL - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_X ) end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Demonstration Preference Learning</h3>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.5">The above optimization objective aims to find the variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><mi id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><ci id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">italic_z</annotation></semantics></math> of the demonstration preference of the LLM. From an implementation perspective, <math alttext="z" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><mi id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><ci id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">italic_z</annotation></semantics></math> is a task-specific description, and its corresponding trainable parameters are <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1"><semantics id="S3.SS3.p1.3.m3.1a"><mi id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b"><ci id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.3.m3.1d">italic_θ</annotation></semantics></math>. We optimize <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m4.1"><semantics id="S3.SS3.p1.4.m4.1a"><mi id="S3.SS3.p1.4.m4.1.1" xref="S3.SS3.p1.4.m4.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m4.1b"><ci id="S3.SS3.p1.4.m4.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.4.m4.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.4.m4.1d">italic_θ</annotation></semantics></math> to refine the demonstration preference distribution corresponding to <math alttext="z" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m5.1"><semantics id="S3.SS3.p1.5.m5.1a"><mi id="S3.SS3.p1.5.m5.1.1" xref="S3.SS3.p1.5.m5.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m5.1b"><ci id="S3.SS3.p1.5.m5.1.1.cmml" xref="S3.SS3.p1.5.m5.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.5.m5.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.5.m5.1d">italic_z</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.6">To perform effective optimization in scenarios where effective demonstrations are scarce, we use preference learning, as it focuses more on the relative relationships between demonstrations, enabling it to capture finer-grained information. To learn the preference for effective demonstrations, we adopt the KTO algorithm <cite class="ltx_cite ltx_citemacro_citep">(Ethayarajh et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib10" title="">2024</a>)</cite>, which directly maximizes the utility of LLM generations based on context information, conditioned on either the effective demonstration <math alttext="(x_{k},y_{k})_{w}" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.2"><semantics id="S3.SS3.p2.1.m1.2a"><msub id="S3.SS3.p2.1.m1.2.2" xref="S3.SS3.p2.1.m1.2.2.cmml"><mrow id="S3.SS3.p2.1.m1.2.2.2.2" xref="S3.SS3.p2.1.m1.2.2.2.3.cmml"><mo id="S3.SS3.p2.1.m1.2.2.2.2.3" stretchy="false" xref="S3.SS3.p2.1.m1.2.2.2.3.cmml">(</mo><msub id="S3.SS3.p2.1.m1.1.1.1.1.1" xref="S3.SS3.p2.1.m1.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.1.m1.1.1.1.1.1.2" xref="S3.SS3.p2.1.m1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.p2.1.m1.1.1.1.1.1.3" xref="S3.SS3.p2.1.m1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.p2.1.m1.2.2.2.2.4" xref="S3.SS3.p2.1.m1.2.2.2.3.cmml">,</mo><msub id="S3.SS3.p2.1.m1.2.2.2.2.2" xref="S3.SS3.p2.1.m1.2.2.2.2.2.cmml"><mi id="S3.SS3.p2.1.m1.2.2.2.2.2.2" xref="S3.SS3.p2.1.m1.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.p2.1.m1.2.2.2.2.2.3" xref="S3.SS3.p2.1.m1.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.1.m1.2.2.2.2.5" stretchy="false" xref="S3.SS3.p2.1.m1.2.2.2.3.cmml">)</mo></mrow><mi id="S3.SS3.p2.1.m1.2.2.4" xref="S3.SS3.p2.1.m1.2.2.4.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.2b"><apply id="S3.SS3.p2.1.m1.2.2.cmml" xref="S3.SS3.p2.1.m1.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.2.2.3.cmml" xref="S3.SS3.p2.1.m1.2.2">subscript</csymbol><interval closure="open" id="S3.SS3.p2.1.m1.2.2.2.3.cmml" xref="S3.SS3.p2.1.m1.2.2.2.2"><apply id="S3.SS3.p2.1.m1.1.1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.1.m1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.1.m1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.p2.1.m1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.1.m1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.p2.1.m1.2.2.2.2.2.cmml" xref="S3.SS3.p2.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.2.2.2.2.2.1.cmml" xref="S3.SS3.p2.1.m1.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.1.m1.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.1.m1.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.p2.1.m1.2.2.2.2.2.3.cmml" xref="S3.SS3.p2.1.m1.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.p2.1.m1.2.2.4.cmml" xref="S3.SS3.p2.1.m1.2.2.4">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.2c">(x_{k},y_{k})_{w}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> or the relatively ineffective one <math alttext="(x_{k},y_{k})_{l}" class="ltx_Math" display="inline" id="S3.SS3.p2.2.m2.2"><semantics id="S3.SS3.p2.2.m2.2a"><msub id="S3.SS3.p2.2.m2.2.2" xref="S3.SS3.p2.2.m2.2.2.cmml"><mrow id="S3.SS3.p2.2.m2.2.2.2.2" xref="S3.SS3.p2.2.m2.2.2.2.3.cmml"><mo id="S3.SS3.p2.2.m2.2.2.2.2.3" stretchy="false" xref="S3.SS3.p2.2.m2.2.2.2.3.cmml">(</mo><msub id="S3.SS3.p2.2.m2.1.1.1.1.1" xref="S3.SS3.p2.2.m2.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.2.m2.1.1.1.1.1.2" xref="S3.SS3.p2.2.m2.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.p2.2.m2.1.1.1.1.1.3" xref="S3.SS3.p2.2.m2.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.p2.2.m2.2.2.2.2.4" xref="S3.SS3.p2.2.m2.2.2.2.3.cmml">,</mo><msub id="S3.SS3.p2.2.m2.2.2.2.2.2" xref="S3.SS3.p2.2.m2.2.2.2.2.2.cmml"><mi id="S3.SS3.p2.2.m2.2.2.2.2.2.2" xref="S3.SS3.p2.2.m2.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.p2.2.m2.2.2.2.2.2.3" xref="S3.SS3.p2.2.m2.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.2.m2.2.2.2.2.5" stretchy="false" xref="S3.SS3.p2.2.m2.2.2.2.3.cmml">)</mo></mrow><mi id="S3.SS3.p2.2.m2.2.2.4" xref="S3.SS3.p2.2.m2.2.2.4.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.2.m2.2b"><apply id="S3.SS3.p2.2.m2.2.2.cmml" xref="S3.SS3.p2.2.m2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.2.m2.2.2.3.cmml" xref="S3.SS3.p2.2.m2.2.2">subscript</csymbol><interval closure="open" id="S3.SS3.p2.2.m2.2.2.2.3.cmml" xref="S3.SS3.p2.2.m2.2.2.2.2"><apply id="S3.SS3.p2.2.m2.1.1.1.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.2.m2.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.2.m2.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.2.m2.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.p2.2.m2.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.2.m2.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.p2.2.m2.2.2.2.2.2.cmml" xref="S3.SS3.p2.2.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.2.m2.2.2.2.2.2.1.cmml" xref="S3.SS3.p2.2.m2.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.2.m2.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.2.m2.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.p2.2.m2.2.2.2.2.2.3.cmml" xref="S3.SS3.p2.2.m2.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.p2.2.m2.2.2.4.cmml" xref="S3.SS3.p2.2.m2.2.2.4">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.2.m2.2c">(x_{k},y_{k})_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.2.m2.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>. This ensures that <math alttext="(x_{k},y_{k})_{w}\succ(x_{k},y_{k})_{l}" class="ltx_Math" display="inline" id="S3.SS3.p2.3.m3.4"><semantics id="S3.SS3.p2.3.m3.4a"><mrow id="S3.SS3.p2.3.m3.4.4" xref="S3.SS3.p2.3.m3.4.4.cmml"><msub id="S3.SS3.p2.3.m3.2.2.2" xref="S3.SS3.p2.3.m3.2.2.2.cmml"><mrow id="S3.SS3.p2.3.m3.2.2.2.2.2" xref="S3.SS3.p2.3.m3.2.2.2.2.3.cmml"><mo id="S3.SS3.p2.3.m3.2.2.2.2.2.3" stretchy="false" xref="S3.SS3.p2.3.m3.2.2.2.2.3.cmml">(</mo><msub id="S3.SS3.p2.3.m3.1.1.1.1.1.1" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.3.m3.1.1.1.1.1.1.2" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.p2.3.m3.1.1.1.1.1.1.3" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.p2.3.m3.2.2.2.2.2.4" xref="S3.SS3.p2.3.m3.2.2.2.2.3.cmml">,</mo><msub id="S3.SS3.p2.3.m3.2.2.2.2.2.2" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2.cmml"><mi id="S3.SS3.p2.3.m3.2.2.2.2.2.2.2" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.p2.3.m3.2.2.2.2.2.2.3" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.3.m3.2.2.2.2.2.5" stretchy="false" xref="S3.SS3.p2.3.m3.2.2.2.2.3.cmml">)</mo></mrow><mi id="S3.SS3.p2.3.m3.2.2.2.4" xref="S3.SS3.p2.3.m3.2.2.2.4.cmml">w</mi></msub><mo id="S3.SS3.p2.3.m3.4.4.5" xref="S3.SS3.p2.3.m3.4.4.5.cmml">≻</mo><msub id="S3.SS3.p2.3.m3.4.4.4" xref="S3.SS3.p2.3.m3.4.4.4.cmml"><mrow id="S3.SS3.p2.3.m3.4.4.4.2.2" xref="S3.SS3.p2.3.m3.4.4.4.2.3.cmml"><mo id="S3.SS3.p2.3.m3.4.4.4.2.2.3" stretchy="false" xref="S3.SS3.p2.3.m3.4.4.4.2.3.cmml">(</mo><msub id="S3.SS3.p2.3.m3.3.3.3.1.1.1" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1.cmml"><mi id="S3.SS3.p2.3.m3.3.3.3.1.1.1.2" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1.2.cmml">x</mi><mi id="S3.SS3.p2.3.m3.3.3.3.1.1.1.3" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.p2.3.m3.4.4.4.2.2.4" xref="S3.SS3.p2.3.m3.4.4.4.2.3.cmml">,</mo><msub id="S3.SS3.p2.3.m3.4.4.4.2.2.2" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2.cmml"><mi id="S3.SS3.p2.3.m3.4.4.4.2.2.2.2" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2.2.cmml">y</mi><mi id="S3.SS3.p2.3.m3.4.4.4.2.2.2.3" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.3.m3.4.4.4.2.2.5" stretchy="false" xref="S3.SS3.p2.3.m3.4.4.4.2.3.cmml">)</mo></mrow><mi id="S3.SS3.p2.3.m3.4.4.4.4" xref="S3.SS3.p2.3.m3.4.4.4.4.cmml">l</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.3.m3.4b"><apply id="S3.SS3.p2.3.m3.4.4.cmml" xref="S3.SS3.p2.3.m3.4.4"><csymbol cd="latexml" id="S3.SS3.p2.3.m3.4.4.5.cmml" xref="S3.SS3.p2.3.m3.4.4.5">succeeds</csymbol><apply id="S3.SS3.p2.3.m3.2.2.2.cmml" xref="S3.SS3.p2.3.m3.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.2.2.2.3.cmml" xref="S3.SS3.p2.3.m3.2.2.2">subscript</csymbol><interval closure="open" id="S3.SS3.p2.3.m3.2.2.2.2.3.cmml" xref="S3.SS3.p2.3.m3.2.2.2.2.2"><apply id="S3.SS3.p2.3.m3.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.3.m3.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.p2.3.m3.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.3.m3.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.p2.3.m3.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.2.2.2.2.2.2.1.cmml" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.3.m3.2.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.p2.3.m3.2.2.2.2.2.2.3.cmml" xref="S3.SS3.p2.3.m3.2.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.p2.3.m3.2.2.2.4.cmml" xref="S3.SS3.p2.3.m3.2.2.2.4">𝑤</ci></apply><apply id="S3.SS3.p2.3.m3.4.4.4.cmml" xref="S3.SS3.p2.3.m3.4.4.4"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.4.4.4.3.cmml" xref="S3.SS3.p2.3.m3.4.4.4">subscript</csymbol><interval closure="open" id="S3.SS3.p2.3.m3.4.4.4.2.3.cmml" xref="S3.SS3.p2.3.m3.4.4.4.2.2"><apply id="S3.SS3.p2.3.m3.3.3.3.1.1.1.cmml" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.3.3.3.1.1.1.1.cmml" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.3.m3.3.3.3.1.1.1.2.cmml" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1.2">𝑥</ci><ci id="S3.SS3.p2.3.m3.3.3.3.1.1.1.3.cmml" xref="S3.SS3.p2.3.m3.3.3.3.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.p2.3.m3.4.4.4.2.2.2.cmml" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.3.m3.4.4.4.2.2.2.1.cmml" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.3.m3.4.4.4.2.2.2.2.cmml" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2.2">𝑦</ci><ci id="S3.SS3.p2.3.m3.4.4.4.2.2.2.3.cmml" xref="S3.SS3.p2.3.m3.4.4.4.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.p2.3.m3.4.4.4.4.cmml" xref="S3.SS3.p2.3.m3.4.4.4.4">𝑙</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.3.m3.4c">(x_{k},y_{k})_{w}\succ(x_{k},y_{k})_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.3.m3.4d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ≻ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math> given the input <math alttext="x" class="ltx_Math" display="inline" id="S3.SS3.p2.4.m4.1"><semantics id="S3.SS3.p2.4.m4.1a"><mi id="S3.SS3.p2.4.m4.1.1" xref="S3.SS3.p2.4.m4.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.4.m4.1b"><ci id="S3.SS3.p2.4.m4.1.1.cmml" xref="S3.SS3.p2.4.m4.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.4.m4.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.4.m4.1d">italic_x</annotation></semantics></math>. To achieve this, we reformulate the optimization objectives, <math alttext="-\log P_{\mathcal{M}}(Y\mid z,X)" class="ltx_Math" display="inline" id="S3.SS3.p2.5.m5.3"><semantics id="S3.SS3.p2.5.m5.3a"><mrow id="S3.SS3.p2.5.m5.3.3" xref="S3.SS3.p2.5.m5.3.3.cmml"><mo id="S3.SS3.p2.5.m5.3.3a" rspace="0.167em" xref="S3.SS3.p2.5.m5.3.3.cmml">−</mo><mrow id="S3.SS3.p2.5.m5.3.3.1" xref="S3.SS3.p2.5.m5.3.3.1.cmml"><mrow id="S3.SS3.p2.5.m5.3.3.1.3" xref="S3.SS3.p2.5.m5.3.3.1.3.cmml"><mi id="S3.SS3.p2.5.m5.3.3.1.3.1" xref="S3.SS3.p2.5.m5.3.3.1.3.1.cmml">log</mi><mo id="S3.SS3.p2.5.m5.3.3.1.3a" lspace="0.167em" xref="S3.SS3.p2.5.m5.3.3.1.3.cmml">⁡</mo><msub id="S3.SS3.p2.5.m5.3.3.1.3.2" xref="S3.SS3.p2.5.m5.3.3.1.3.2.cmml"><mi id="S3.SS3.p2.5.m5.3.3.1.3.2.2" xref="S3.SS3.p2.5.m5.3.3.1.3.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.SS3.p2.5.m5.3.3.1.3.2.3" xref="S3.SS3.p2.5.m5.3.3.1.3.2.3.cmml">ℳ</mi></msub></mrow><mo id="S3.SS3.p2.5.m5.3.3.1.2" xref="S3.SS3.p2.5.m5.3.3.1.2.cmml">⁢</mo><mrow id="S3.SS3.p2.5.m5.3.3.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.cmml"><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.2" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.5.m5.3.3.1.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.cmml"><mi id="S3.SS3.p2.5.m5.3.3.1.1.1.1.2" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.2.cmml">Y</mi><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml">∣</mo><mrow id="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.2" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.1.cmml"><mi id="S3.SS3.p2.5.m5.1.1" xref="S3.SS3.p2.5.m5.1.1.cmml">z</mi><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.2.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.1.cmml">,</mo><mi id="S3.SS3.p2.5.m5.2.2" xref="S3.SS3.p2.5.m5.2.2.cmml">X</mi></mrow></mrow><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.3" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.5.m5.3b"><apply id="S3.SS3.p2.5.m5.3.3.cmml" xref="S3.SS3.p2.5.m5.3.3"><minus id="S3.SS3.p2.5.m5.3.3.2.cmml" xref="S3.SS3.p2.5.m5.3.3"></minus><apply id="S3.SS3.p2.5.m5.3.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1"><times id="S3.SS3.p2.5.m5.3.3.1.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.2"></times><apply id="S3.SS3.p2.5.m5.3.3.1.3.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3"><log id="S3.SS3.p2.5.m5.3.3.1.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3.1"></log><apply id="S3.SS3.p2.5.m5.3.3.1.3.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.p2.5.m5.3.3.1.3.2.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3.2">subscript</csymbol><ci id="S3.SS3.p2.5.m5.3.3.1.3.2.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3.2.2">𝑃</ci><ci id="S3.SS3.p2.5.m5.3.3.1.3.2.3.cmml" xref="S3.SS3.p2.5.m5.3.3.1.3.2.3">ℳ</ci></apply></apply><apply id="S3.SS3.p2.5.m5.3.3.1.1.1.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1"><csymbol cd="latexml" id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1">conditional</csymbol><ci id="S3.SS3.p2.5.m5.3.3.1.1.1.1.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.2">𝑌</ci><list id="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.3.2"><ci id="S3.SS3.p2.5.m5.1.1.cmml" xref="S3.SS3.p2.5.m5.1.1">𝑧</ci><ci id="S3.SS3.p2.5.m5.2.2.cmml" xref="S3.SS3.p2.5.m5.2.2">𝑋</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.5.m5.3c">-\log P_{\mathcal{M}}(Y\mid z,X)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.5.m5.3d">- roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X )</annotation></semantics></math> and <math alttext="-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)" class="ltx_Math" display="inline" id="S3.SS3.p2.6.m6.2"><semantics id="S3.SS3.p2.6.m6.2a"><mrow id="S3.SS3.p2.6.m6.2.2" xref="S3.SS3.p2.6.m6.2.2.cmml"><mo id="S3.SS3.p2.6.m6.2.2a" rspace="0.167em" xref="S3.SS3.p2.6.m6.2.2.cmml">−</mo><mrow id="S3.SS3.p2.6.m6.2.2.1" xref="S3.SS3.p2.6.m6.2.2.1.cmml"><mrow id="S3.SS3.p2.6.m6.2.2.1.3" xref="S3.SS3.p2.6.m6.2.2.1.3.cmml"><mi id="S3.SS3.p2.6.m6.2.2.1.3.1" xref="S3.SS3.p2.6.m6.2.2.1.3.1.cmml">log</mi><mo id="S3.SS3.p2.6.m6.2.2.1.3a" lspace="0.167em" xref="S3.SS3.p2.6.m6.2.2.1.3.cmml">⁡</mo><msub id="S3.SS3.p2.6.m6.2.2.1.3.2" xref="S3.SS3.p2.6.m6.2.2.1.3.2.cmml"><mi id="S3.SS3.p2.6.m6.2.2.1.3.2.2" xref="S3.SS3.p2.6.m6.2.2.1.3.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.SS3.p2.6.m6.2.2.1.3.2.3" xref="S3.SS3.p2.6.m6.2.2.1.3.2.3.cmml">ℳ</mi></msub></mrow><mo id="S3.SS3.p2.6.m6.2.2.1.2" xref="S3.SS3.p2.6.m6.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS3.p2.6.m6.2.2.1.1.1" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.cmml"><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.2" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.6.m6.2.2.1.1.1.1" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.cmml"><mi id="S3.SS3.p2.6.m6.2.2.1.1.1.1.3" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.3.cmml">z</mi><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.1.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.2.cmml">∣</mo><mrow id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.2.cmml"><mrow id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.3.cmml"><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.3" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.4" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.3" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.2" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.2.cmml">,</mo><mi id="S3.SS3.p2.6.m6.1.1" xref="S3.SS3.p2.6.m6.1.1.cmml">X</mi></mrow></mrow><mo id="S3.SS3.p2.6.m6.2.2.1.1.1.3" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.6.m6.2b"><apply id="S3.SS3.p2.6.m6.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2"><minus id="S3.SS3.p2.6.m6.2.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2"></minus><apply id="S3.SS3.p2.6.m6.2.2.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1"><times id="S3.SS3.p2.6.m6.2.2.1.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.2"></times><apply id="S3.SS3.p2.6.m6.2.2.1.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3"><log id="S3.SS3.p2.6.m6.2.2.1.3.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3.1"></log><apply id="S3.SS3.p2.6.m6.2.2.1.3.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.2.2.1.3.2.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3.2">subscript</csymbol><ci id="S3.SS3.p2.6.m6.2.2.1.3.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3.2.2">𝑃</ci><ci id="S3.SS3.p2.6.m6.2.2.1.3.2.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.3.2.3">ℳ</ci></apply></apply><apply id="S3.SS3.p2.6.m6.2.2.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1"><csymbol cd="latexml" id="S3.SS3.p2.6.m6.2.2.1.1.1.1.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.2">conditional</csymbol><ci id="S3.SS3.p2.6.m6.2.2.1.1.1.1.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.3">𝑧</ci><list id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1"><interval closure="open" id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2"><apply id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.SS3.p2.6.m6.2.2.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.p2.6.m6.1.1.cmml" xref="S3.SS3.p2.6.m6.1.1">𝑋</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.6.m6.2c">-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.6.m6.2d">- roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_X )</annotation></semantics></math> in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E4" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4</span></a>), as a two-stage alternating optimization process.</p>
</div>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">The First Stage.</h4>
<div class="ltx_para" id="S3.SS3.SSS0.Px1.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p1.1">In this stage, we optimize the demonstration selection part <math alttext="-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p1.1.m1.2"><semantics id="S3.SS3.SSS0.Px1.p1.1.m1.2a"><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.cmml"><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2a" rspace="0.167em" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.cmml">−</mo><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.cmml"><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.cmml"><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.1.cmml">log</mi><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3a" lspace="0.167em" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.cmml">⁡</mo><msub id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.cmml"><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.3" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.3.cmml">ℳ</mi></msub></mrow><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.cmml"><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.2" stretchy="false" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.3" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.3.cmml">z</mi><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.2.cmml">∣</mo><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.2.cmml"><mrow id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.3" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.4" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.3" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.2.cmml">,</mo><mi id="S3.SS3.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.1.1.cmml">X</mi></mrow></mrow><mo id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.3" stretchy="false" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p1.1.m1.2b"><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2"><minus id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2"></minus><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1"><times id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.2"></times><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3"><log id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.1"></log><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.2">𝑃</ci><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.3.2.3">ℳ</ci></apply></apply><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1"><csymbol cd="latexml" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.2">conditional</csymbol><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.3">𝑧</ci><list id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1"><interval closure="open" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2"><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.2.2.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.1.1">𝑋</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p1.1.m1.2c">-\log P_{\mathcal{M}}(z\mid(X_{k},Y_{k}),X)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p1.1.m1.2d">- roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_X )</annotation></semantics></math> in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E4" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4</span></a>) with preference learning.
Preference learning requires both preferred data and non-preferred data.
To obtain the LLM preferences for demonstrations under the in-context learning paradigm, we utilize the ICL performance of LLM given each demonstration candidate as the preference score.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS0.Px1.p2">
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p2.4">The preference score <math alttext="s_{k}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p2.1.m1.1"><semantics id="S3.SS3.SSS0.Px1.p2.1.m1.1a"><msub id="S3.SS3.SSS0.Px1.p2.1.m1.1.1" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.2" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1.2.cmml">s</mi><mi id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.3" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p2.1.m1.1b"><apply id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1.2">𝑠</ci><ci id="S3.SS3.SSS0.Px1.p2.1.m1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p2.1.m1.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p2.1.m1.1c">s_{k}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p2.1.m1.1d">italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> is the log-likelihood of LLM generation w.r.t. the ground-truth output <math alttext="y" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p2.2.m2.1"><semantics id="S3.SS3.SSS0.Px1.p2.2.m2.1a"><mi id="S3.SS3.SSS0.Px1.p2.2.m2.1.1" xref="S3.SS3.SSS0.Px1.p2.2.m2.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p2.2.m2.1b"><ci id="S3.SS3.SSS0.Px1.p2.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.2.m2.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p2.2.m2.1c">y</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p2.2.m2.1d">italic_y</annotation></semantics></math> given the candidate <math alttext="(x_{k},y_{k})" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p2.3.m3.2"><semantics id="S3.SS3.SSS0.Px1.p2.3.m3.2a"><mrow id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.3.cmml"><mo id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.3" stretchy="false" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.3.cmml">(</mo><msub id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.3" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.4" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.3.cmml">,</mo><msub id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.cmml"><mi id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.2" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.3" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.5" stretchy="false" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p2.3.m3.2b"><interval closure="open" id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2"><apply id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.1.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p2.3.m3.2.2.2.2.3">𝑘</ci></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p2.3.m3.2c">(x_{k},y_{k})</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p2.3.m3.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> and the input <math alttext="x" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p2.4.m4.1"><semantics id="S3.SS3.SSS0.Px1.p2.4.m4.1a"><mi id="S3.SS3.SSS0.Px1.p2.4.m4.1.1" xref="S3.SS3.SSS0.Px1.p2.4.m4.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p2.4.m4.1b"><ci id="S3.SS3.SSS0.Px1.p2.4.m4.1.1.cmml" xref="S3.SS3.SSS0.Px1.p2.4.m4.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p2.4.m4.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p2.4.m4.1d">italic_x</annotation></semantics></math>, reflecting the LLM’s preference for the demonstration.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS0.Px1.p3">
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="s_{k}=P(y|(x_{k},y_{k}),x)" class="ltx_Math" display="block" id="S3.E5.m1.2"><semantics id="S3.E5.m1.2a"><mrow id="S3.E5.m1.2.2" xref="S3.E5.m1.2.2.cmml"><msub id="S3.E5.m1.2.2.3" xref="S3.E5.m1.2.2.3.cmml"><mi id="S3.E5.m1.2.2.3.2" xref="S3.E5.m1.2.2.3.2.cmml">s</mi><mi id="S3.E5.m1.2.2.3.3" xref="S3.E5.m1.2.2.3.3.cmml">k</mi></msub><mo id="S3.E5.m1.2.2.2" xref="S3.E5.m1.2.2.2.cmml">=</mo><mrow id="S3.E5.m1.2.2.1" xref="S3.E5.m1.2.2.1.cmml"><mi id="S3.E5.m1.2.2.1.3" xref="S3.E5.m1.2.2.1.3.cmml">P</mi><mo id="S3.E5.m1.2.2.1.2" xref="S3.E5.m1.2.2.1.2.cmml">⁢</mo><mrow id="S3.E5.m1.2.2.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.cmml"><mo id="S3.E5.m1.2.2.1.1.1.2" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.E5.m1.2.2.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.3" xref="S3.E5.m1.2.2.1.1.1.1.3.cmml">y</mi><mo fence="false" id="S3.E5.m1.2.2.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.2.cmml">|</mo><mrow id="S3.E5.m1.2.2.1.1.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.1.2.cmml"><mrow id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.4" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.2" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.3" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.E5.m1.2.2.1.1.1.1.1.1.2" xref="S3.E5.m1.2.2.1.1.1.1.1.2.cmml">,</mo><mi id="S3.E5.m1.1.1" xref="S3.E5.m1.1.1.cmml">x</mi></mrow></mrow><mo id="S3.E5.m1.2.2.1.1.1.3" stretchy="false" xref="S3.E5.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.2b"><apply id="S3.E5.m1.2.2.cmml" xref="S3.E5.m1.2.2"><eq id="S3.E5.m1.2.2.2.cmml" xref="S3.E5.m1.2.2.2"></eq><apply id="S3.E5.m1.2.2.3.cmml" xref="S3.E5.m1.2.2.3"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.3.1.cmml" xref="S3.E5.m1.2.2.3">subscript</csymbol><ci id="S3.E5.m1.2.2.3.2.cmml" xref="S3.E5.m1.2.2.3.2">𝑠</ci><ci id="S3.E5.m1.2.2.3.3.cmml" xref="S3.E5.m1.2.2.3.3">𝑘</ci></apply><apply id="S3.E5.m1.2.2.1.cmml" xref="S3.E5.m1.2.2.1"><times id="S3.E5.m1.2.2.1.2.cmml" xref="S3.E5.m1.2.2.1.2"></times><ci id="S3.E5.m1.2.2.1.3.cmml" xref="S3.E5.m1.2.2.1.3">𝑃</ci><apply id="S3.E5.m1.2.2.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1"><csymbol cd="latexml" id="S3.E5.m1.2.2.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.2">conditional</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.3">𝑦</ci><list id="S3.E5.m1.2.2.1.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1"><interval closure="open" id="S3.E5.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2"><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.2">𝑦</ci><ci id="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E5.m1.2.2.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval><ci id="S3.E5.m1.1.1.cmml" xref="S3.E5.m1.1.1">𝑥</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.2c">s_{k}=P(y|(x_{k},y_{k}),x)</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.2d">italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = italic_P ( italic_y | ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS3.SSS0.Px1.p4">
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p4.5">Since we need to score all the training data based on the above method to obtain the preference dataset, and the demonstration pool for each training sample is <math alttext="\mathcal{P}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.1.m1.1"><semantics id="S3.SS3.SSS0.Px1.p4.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px1.p4.1.m1.1.1" xref="S3.SS3.SSS0.Px1.p4.1.m1.1.1.cmml">𝒫</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.1.m1.1b"><ci id="S3.SS3.SSS0.Px1.p4.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.1.m1.1.1">𝒫</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.1.m1.1c">\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.1.m1.1d">caligraphic_P</annotation></semantics></math>, the complexity of scoring all the data is quadratic in <math alttext="|\mathcal{P}|" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.2.m2.1"><semantics id="S3.SS3.SSS0.Px1.p4.2.m2.1a"><mrow id="S3.SS3.SSS0.Px1.p4.2.m2.1.2.2" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.2.1.cmml"><mo id="S3.SS3.SSS0.Px1.p4.2.m2.1.2.2.1" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.2.1.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px1.p4.2.m2.1.1" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.1.cmml">𝒫</mi><mo id="S3.SS3.SSS0.Px1.p4.2.m2.1.2.2.2" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.2.m2.1b"><apply id="S3.SS3.SSS0.Px1.p4.2.m2.1.2.1.cmml" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.2.2"><abs id="S3.SS3.SSS0.Px1.p4.2.m2.1.2.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.2.2.1"></abs><ci id="S3.SS3.SSS0.Px1.p4.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.2.m2.1.1">𝒫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.2.m2.1c">|\mathcal{P}|</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.2.m2.1d">| caligraphic_P |</annotation></semantics></math>, which is computationally infeasible for an exhaustive search.
Following prior work <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib47" title="">2024b</a>; Cheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib6" title="">2023</a>; Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib46" title="">2024a</a>)</cite>, we use E5<sub class="ltx_sub" id="S3.SS3.SSS0.Px1.p4.5.1">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite> to obtain a more relevant subset <math alttext="\xi\subseteq\mathcal{P}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.3.m3.1"><semantics id="S3.SS3.SSS0.Px1.p4.3.m3.1a"><mrow id="S3.SS3.SSS0.Px1.p4.3.m3.1.1" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.2" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.2.cmml">ξ</mi><mo id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.1" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.1.cmml">⊆</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.3" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.3.cmml">𝒫</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.3.m3.1b"><apply id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1"><subset id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.1"></subset><ci id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.2">𝜉</ci><ci id="S3.SS3.SSS0.Px1.p4.3.m3.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p4.3.m3.1.1.3">𝒫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.3.m3.1c">\xi\subseteq\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.3.m3.1d">italic_ξ ⊆ caligraphic_P</annotation></semantics></math> as the new demonstration pool to reduce search space.
For each training sample, we select the set of candidates with the highest preference scores as preferred demonstrations <math alttext="(x_{k},y_{k})_{w}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.4.m4.2"><semantics id="S3.SS3.SSS0.Px1.p4.4.m4.2a"><msub id="S3.SS3.SSS0.Px1.p4.4.m4.2.2" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.cmml"><mrow id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.3.cmml"><mo id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.3" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.3.cmml">(</mo><msub id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.3" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.4" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.3.cmml">,</mo><msub id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.cmml"><mi id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.3" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.5" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.3.cmml">)</mo></mrow><mi id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.4" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.4.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.4.m4.2b"><apply id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2">subscript</csymbol><interval closure="open" id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2"><apply id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.1.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.SSS0.Px1.p4.4.m4.2.2.4.cmml" xref="S3.SS3.SSS0.Px1.p4.4.m4.2.2.4">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.4.m4.2c">(x_{k},y_{k})_{w}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.4.m4.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math>, and the set of candidates with the lowest preference scores as non-preferred demonstrations <math alttext="(x_{k},y_{k})_{l}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.5.m5.2"><semantics id="S3.SS3.SSS0.Px1.p4.5.m5.2a"><msub id="S3.SS3.SSS0.Px1.p4.5.m5.2.2" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.cmml"><mrow id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.3.cmml"><mo id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.3" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.3.cmml">(</mo><msub id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.2" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.3" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.4" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.3.cmml">,</mo><msub id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.cmml"><mi id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.2" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.3" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.5" stretchy="false" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.3.cmml">)</mo></mrow><mi id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.4" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.4.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.5.m5.2b"><apply id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2">subscript</csymbol><interval closure="open" id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2"><apply id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.1.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.2.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.2">𝑦</ci><ci id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.3.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.SS3.SSS0.Px1.p4.5.m5.2.2.4.cmml" xref="S3.SS3.SSS0.Px1.p4.5.m5.2.2.4">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.5.m5.2c">(x_{k},y_{k})_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.5.m5.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>.
The demonstration-level loss is formulated as follows.</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{d}(\theta)=-\mathbb{E}_{((x_{k},y_{k})_{w},(x_{k},y_{k})_{l},x,z)%
\sim\mathcal{D}}\\
\left[\lambda_{w}\sigma\left(\beta\log\frac{P_{\mathcal{M}}(z\mid(x_{k},y_{k})%
_{w},x)}{P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k})_{w},x)}-s^{d}_{\text{%
ref}}\right)\right.\\
\left.+\lambda_{l}\sigma\left(s^{d}_{\text{ref}}-\beta\log\frac{P_{\mathcal{M}%
}(z\mid(x_{k},y_{k})_{l},x)}{P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k})_{%
l},x)}\right)\right]" class="ltx_Math" display="block" id="S3.E6.m1.37"><semantics id="S3.E6.m1.37a"><mtable displaystyle="true" id="S3.E6.m1.36.36" rowspacing="0pt" xref="S3.E6.m1.37.37.1.cmml"><mtr id="S3.E6.m1.36.36a" xref="S3.E6.m1.37.37.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E6.m1.36.36b" xref="S3.E6.m1.37.37.1.cmml"><mrow id="S3.E6.m1.9.9.9.9.9" xref="S3.E6.m1.37.37.1.cmml"><mrow id="S3.E6.m1.9.9.9.9.9.10" xref="S3.E6.m1.37.37.1.cmml"><msub id="S3.E6.m1.9.9.9.9.9.10.2" xref="S3.E6.m1.37.37.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.1.cmml">ℒ</mi><mi id="S3.E6.m1.2.2.2.2.2.2.1" xref="S3.E6.m1.2.2.2.2.2.2.1.cmml">d</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.10.1" xref="S3.E6.m1.37.37.1.cmml">⁢</mo><mrow id="S3.E6.m1.9.9.9.9.9.10.3" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.3.3.3.3.3.3" stretchy="false" xref="S3.E6.m1.37.37.1.cmml">(</mo><mi id="S3.E6.m1.4.4.4.4.4.4" xref="S3.E6.m1.4.4.4.4.4.4.cmml">θ</mi><mo id="S3.E6.m1.5.5.5.5.5.5" stretchy="false" xref="S3.E6.m1.37.37.1.cmml">)</mo></mrow></mrow><mo id="S3.E6.m1.6.6.6.6.6.6" xref="S3.E6.m1.6.6.6.6.6.6.cmml">=</mo><mrow id="S3.E6.m1.9.9.9.9.9.11" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.9.9.9.9.9.11a" xref="S3.E6.m1.37.37.1.cmml">−</mo><msub id="S3.E6.m1.9.9.9.9.9.11.1" xref="S3.E6.m1.37.37.1.cmml"><mi id="S3.E6.m1.8.8.8.8.8.8" xref="S3.E6.m1.8.8.8.8.8.8.cmml">𝔼</mi><mrow id="S3.E6.m1.9.9.9.9.9.9.1" xref="S3.E6.m1.9.9.9.9.9.9.1.cmml"><mrow id="S3.E6.m1.9.9.9.9.9.9.1.4.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml"><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.3" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml">(</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.cmml"><mrow id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.3.cmml"><mo id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.3" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.3.cmml">(</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.cmml"><mi id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.2" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.3" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.4" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.3.cmml">,</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.cmml"><mi id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.3" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.5" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.4" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.4.cmml">w</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.4" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.cmml"><mrow id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.3.cmml"><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.3" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.3.cmml">(</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.cmml"><mi id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.3" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.4" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.3.cmml">,</mo><msub id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.cmml"><mi id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.2" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.3" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.5" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.4" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.4.cmml">l</mi></msub><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.5" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><mi id="S3.E6.m1.9.9.9.9.9.9.1.1" xref="S3.E6.m1.9.9.9.9.9.9.1.1.cmml">x</mi><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.6" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><mi id="S3.E6.m1.9.9.9.9.9.9.1.2" xref="S3.E6.m1.9.9.9.9.9.9.1.2.cmml">z</mi><mo id="S3.E6.m1.9.9.9.9.9.9.1.4.2.7" stretchy="false" xref="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml">)</mo></mrow><mo id="S3.E6.m1.9.9.9.9.9.9.1.5" xref="S3.E6.m1.9.9.9.9.9.9.1.5.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.9.9.9.9.9.9.1.6" xref="S3.E6.m1.9.9.9.9.9.9.1.6.cmml">𝒟</mi></mrow></msub></mrow></mrow></mtd></mtr><mtr id="S3.E6.m1.36.36c" xref="S3.E6.m1.37.37.1.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E6.m1.36.36d" xref="S3.E6.m1.37.37.1.cmml"><mrow id="S3.E6.m1.22.22.22.13.13" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.10.10.10.1.1.1" xref="S3.E6.m1.37.37.1.cmml">[</mo><msub id="S3.E6.m1.22.22.22.13.13.14" xref="S3.E6.m1.37.37.1.cmml"><mi id="S3.E6.m1.11.11.11.2.2.2" xref="S3.E6.m1.11.11.11.2.2.2.cmml">λ</mi><mi id="S3.E6.m1.12.12.12.3.3.3.1" xref="S3.E6.m1.12.12.12.3.3.3.1.cmml">w</mi></msub><mi id="S3.E6.m1.13.13.13.4.4.4" xref="S3.E6.m1.13.13.13.4.4.4.cmml">σ</mi><mrow id="S3.E6.m1.22.22.22.13.13.15" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.14.14.14.5.5.5" xref="S3.E6.m1.37.37.1.cmml">(</mo><mi id="S3.E6.m1.15.15.15.6.6.6" xref="S3.E6.m1.15.15.15.6.6.6.cmml">β</mi><mi id="S3.E6.m1.16.16.16.7.7.7" xref="S3.E6.m1.16.16.16.7.7.7.cmml">log</mi><mfrac id="S3.E6.m1.17.17.17.8.8.8" xref="S3.E6.m1.17.17.17.8.8.8.cmml"><mrow id="S3.E6.m1.17.17.17.8.8.8.2" xref="S3.E6.m1.17.17.17.8.8.8.2.cmml"><msub id="S3.E6.m1.17.17.17.8.8.8.2.4" xref="S3.E6.m1.17.17.17.8.8.8.2.4.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.2.4.2" xref="S3.E6.m1.17.17.17.8.8.8.2.4.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.17.17.17.8.8.8.2.4.3" xref="S3.E6.m1.17.17.17.8.8.8.2.4.3.cmml">ℳ</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.2.3" xref="S3.E6.m1.17.17.17.8.8.8.2.3.cmml">⁢</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.2.2.1" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.cmml"><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.2" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.cmml">(</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.3" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.3.cmml">z</mi><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.2.cmml">∣</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.2.cmml"><msub id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.cmml"><mrow id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.3.cmml"><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.3" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.3.cmml">(</mo><msub id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.4" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.3" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.5" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.4" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.4.cmml">w</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.2.cmml">,</mo><mi id="S3.E6.m1.17.17.17.8.8.8.1.1" xref="S3.E6.m1.17.17.17.8.8.8.1.1.cmml">x</mi></mrow></mrow><mo id="S3.E6.m1.17.17.17.8.8.8.2.2.1.3" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="S3.E6.m1.17.17.17.8.8.8.4" xref="S3.E6.m1.17.17.17.8.8.8.4.cmml"><msub id="S3.E6.m1.17.17.17.8.8.8.4.4" xref="S3.E6.m1.17.17.17.8.8.8.4.4.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.4.4.2" xref="S3.E6.m1.17.17.17.8.8.8.4.4.2.cmml">P</mi><msub id="S3.E6.m1.17.17.17.8.8.8.4.4.3" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.17.17.17.8.8.8.4.4.3.2" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.2.cmml">ℳ</mi><mtext id="S3.E6.m1.17.17.17.8.8.8.4.4.3.3" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.3a.cmml">ref</mtext></msub></msub><mo id="S3.E6.m1.17.17.17.8.8.8.4.3" xref="S3.E6.m1.17.17.17.8.8.8.4.3.cmml">⁢</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.4.2.1" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.cmml"><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.2" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.cmml">(</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.3" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.3.cmml">z</mi><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.2.cmml">∣</mo><mrow id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.2.cmml"><msub id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.cmml"><mrow id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.3.cmml"><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.3" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.3.cmml">(</mo><msub id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.4" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.cmml"><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.3" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.5" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.4" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.4.cmml">w</mi></msub><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.2" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.2.cmml">,</mo><mi id="S3.E6.m1.17.17.17.8.8.8.3.1" xref="S3.E6.m1.17.17.17.8.8.8.3.1.cmml">x</mi></mrow></mrow><mo id="S3.E6.m1.17.17.17.8.8.8.4.2.1.3" stretchy="false" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S3.E6.m1.18.18.18.9.9.9" xref="S3.E6.m1.18.18.18.9.9.9.cmml">−</mo><msubsup id="S3.E6.m1.22.22.22.13.13.15.1" xref="S3.E6.m1.37.37.1.cmml"><mi id="S3.E6.m1.19.19.19.10.10.10" xref="S3.E6.m1.19.19.19.10.10.10.cmml">s</mi><mtext id="S3.E6.m1.21.21.21.12.12.12.1" xref="S3.E6.m1.21.21.21.12.12.12.1a.cmml">ref</mtext><mi id="S3.E6.m1.20.20.20.11.11.11.1" xref="S3.E6.m1.20.20.20.11.11.11.1.cmml">d</mi></msubsup><mo id="S3.E6.m1.22.22.22.13.13.13" xref="S3.E6.m1.37.37.1.cmml">)</mo></mrow></mrow></mtd></mtr><mtr id="S3.E6.m1.36.36e" xref="S3.E6.m1.37.37.1.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E6.m1.36.36f" xref="S3.E6.m1.37.37.1.cmml"><mrow id="S3.E6.m1.36.36.36.14.14" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.23.23.23.1.1.1" xref="S3.E6.m1.23.23.23.1.1.1.cmml">+</mo><msub id="S3.E6.m1.36.36.36.14.14.15" xref="S3.E6.m1.37.37.1.cmml"><mi id="S3.E6.m1.24.24.24.2.2.2" xref="S3.E6.m1.24.24.24.2.2.2.cmml">λ</mi><mi id="S3.E6.m1.25.25.25.3.3.3.1" xref="S3.E6.m1.25.25.25.3.3.3.1.cmml">l</mi></msub><mi id="S3.E6.m1.26.26.26.4.4.4" xref="S3.E6.m1.26.26.26.4.4.4.cmml">σ</mi><mrow id="S3.E6.m1.36.36.36.14.14.16" xref="S3.E6.m1.37.37.1.cmml"><mo id="S3.E6.m1.27.27.27.5.5.5" xref="S3.E6.m1.37.37.1.cmml">(</mo><msubsup id="S3.E6.m1.36.36.36.14.14.16.1" xref="S3.E6.m1.37.37.1.cmml"><mi id="S3.E6.m1.28.28.28.6.6.6" xref="S3.E6.m1.28.28.28.6.6.6.cmml">s</mi><mtext id="S3.E6.m1.30.30.30.8.8.8.1" xref="S3.E6.m1.30.30.30.8.8.8.1a.cmml">ref</mtext><mi id="S3.E6.m1.29.29.29.7.7.7.1" xref="S3.E6.m1.29.29.29.7.7.7.1.cmml">d</mi></msubsup><mo id="S3.E6.m1.31.31.31.9.9.9" xref="S3.E6.m1.31.31.31.9.9.9.cmml">−</mo><mi id="S3.E6.m1.32.32.32.10.10.10" xref="S3.E6.m1.32.32.32.10.10.10.cmml">β</mi><mi id="S3.E6.m1.33.33.33.11.11.11" xref="S3.E6.m1.33.33.33.11.11.11.cmml">log</mi><mfrac id="S3.E6.m1.34.34.34.12.12.12" xref="S3.E6.m1.34.34.34.12.12.12.cmml"><mrow id="S3.E6.m1.34.34.34.12.12.12.2" xref="S3.E6.m1.34.34.34.12.12.12.2.cmml"><msub id="S3.E6.m1.34.34.34.12.12.12.2.4" xref="S3.E6.m1.34.34.34.12.12.12.2.4.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.2.4.2" xref="S3.E6.m1.34.34.34.12.12.12.2.4.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.34.34.34.12.12.12.2.4.3" xref="S3.E6.m1.34.34.34.12.12.12.2.4.3.cmml">ℳ</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.2.3" xref="S3.E6.m1.34.34.34.12.12.12.2.3.cmml">⁢</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.2.2.1" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.cmml"><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.2" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.cmml">(</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.3" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.3.cmml">z</mi><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.2.cmml">∣</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.2.cmml"><msub id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.cmml"><mrow id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.3.cmml"><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.3" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.3.cmml">(</mo><msub id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.4" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.3" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.5" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.4" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.4.cmml">l</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.2.cmml">,</mo><mi id="S3.E6.m1.34.34.34.12.12.12.1.1" xref="S3.E6.m1.34.34.34.12.12.12.1.1.cmml">x</mi></mrow></mrow><mo id="S3.E6.m1.34.34.34.12.12.12.2.2.1.3" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="S3.E6.m1.34.34.34.12.12.12.4" xref="S3.E6.m1.34.34.34.12.12.12.4.cmml"><msub id="S3.E6.m1.34.34.34.12.12.12.4.4" xref="S3.E6.m1.34.34.34.12.12.12.4.4.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.4.4.2" xref="S3.E6.m1.34.34.34.12.12.12.4.4.2.cmml">P</mi><msub id="S3.E6.m1.34.34.34.12.12.12.4.4.3" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E6.m1.34.34.34.12.12.12.4.4.3.2" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.2.cmml">ℳ</mi><mtext id="S3.E6.m1.34.34.34.12.12.12.4.4.3.3" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.3a.cmml">ref</mtext></msub></msub><mo id="S3.E6.m1.34.34.34.12.12.12.4.3" xref="S3.E6.m1.34.34.34.12.12.12.4.3.cmml">⁢</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.4.2.1" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.cmml"><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.2" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.cmml">(</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.3" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.3.cmml">z</mi><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.2.cmml">∣</mo><mrow id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.2.cmml"><msub id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.cmml"><mrow id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.3.cmml"><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.3" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.3.cmml">(</mo><msub id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.4" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.cmml"><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.3" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.3.cmml">k</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.5" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.3.cmml">)</mo></mrow><mi id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.4" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.4.cmml">l</mi></msub><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.2" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.2.cmml">,</mo><mi id="S3.E6.m1.34.34.34.12.12.12.3.1" xref="S3.E6.m1.34.34.34.12.12.12.3.1.cmml">x</mi></mrow></mrow><mo id="S3.E6.m1.34.34.34.12.12.12.4.2.1.3" stretchy="false" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S3.E6.m1.35.35.35.13.13.13" xref="S3.E6.m1.37.37.1.cmml">)</mo></mrow><mo id="S3.E6.m1.36.36.36.14.14.14" xref="S3.E6.m1.37.37.1.cmml">]</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E6.m1.37b"><apply id="S3.E6.m1.37.37.1.cmml" xref="S3.E6.m1.36.36"><eq id="S3.E6.m1.6.6.6.6.6.6.cmml" xref="S3.E6.m1.6.6.6.6.6.6"></eq><apply id="S3.E6.m1.37.37.1.3.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.3.1.cmml" xref="S3.E6.m1.36.36"></times><apply id="S3.E6.m1.37.37.1.3.2.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.3.2.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1.1">ℒ</ci><ci id="S3.E6.m1.2.2.2.2.2.2.1.cmml" xref="S3.E6.m1.2.2.2.2.2.2.1">𝑑</ci></apply><ci id="S3.E6.m1.4.4.4.4.4.4.cmml" xref="S3.E6.m1.4.4.4.4.4.4">𝜃</ci></apply><apply id="S3.E6.m1.37.37.1.1.cmml" xref="S3.E6.m1.36.36"><minus id="S3.E6.m1.7.7.7.7.7.7.cmml" xref="S3.E6.m1.36.36"></minus><apply id="S3.E6.m1.37.37.1.1.1.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.1.1.2.cmml" xref="S3.E6.m1.36.36"></times><apply id="S3.E6.m1.37.37.1.1.1.3.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.3.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><ci id="S3.E6.m1.8.8.8.8.8.8.cmml" xref="S3.E6.m1.8.8.8.8.8.8">𝔼</ci><apply id="S3.E6.m1.9.9.9.9.9.9.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1"><csymbol cd="latexml" id="S3.E6.m1.9.9.9.9.9.9.1.5.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.5">similar-to</csymbol><vector id="S3.E6.m1.9.9.9.9.9.9.1.4.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2"><apply id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1">subscript</csymbol><interval closure="open" id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2"><apply id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.4.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.3.1.1.4">𝑤</ci></apply><apply id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2">subscript</csymbol><interval closure="open" id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2"><apply id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1">subscript</csymbol><ci id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2">subscript</csymbol><ci id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.3.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.4.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.4.2.2.4">𝑙</ci></apply><ci id="S3.E6.m1.9.9.9.9.9.9.1.1.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.1">𝑥</ci><ci id="S3.E6.m1.9.9.9.9.9.9.1.2.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.2">𝑧</ci></vector><ci id="S3.E6.m1.9.9.9.9.9.9.1.6.cmml" xref="S3.E6.m1.9.9.9.9.9.9.1.6">𝒟</ci></apply></apply><apply id="S3.E6.m1.37.37.1.1.1.1.2.cmml" xref="S3.E6.m1.36.36"><csymbol cd="latexml" id="S3.E6.m1.37.37.1.1.1.1.2.1.cmml" xref="S3.E6.m1.36.36">delimited-[]</csymbol><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.cmml" xref="S3.E6.m1.36.36"><plus id="S3.E6.m1.23.23.23.1.1.1.cmml" xref="S3.E6.m1.23.23.23.1.1.1"></plus><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.36.36"></times><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><ci id="S3.E6.m1.11.11.11.2.2.2.cmml" xref="S3.E6.m1.11.11.11.2.2.2">𝜆</ci><ci id="S3.E6.m1.12.12.12.3.3.3.1.cmml" xref="S3.E6.m1.12.12.12.3.3.3.1">𝑤</ci></apply><ci id="S3.E6.m1.13.13.13.4.4.4.cmml" xref="S3.E6.m1.13.13.13.4.4.4">𝜎</ci><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.36.36"><minus id="S3.E6.m1.18.18.18.9.9.9.cmml" xref="S3.E6.m1.18.18.18.9.9.9"></minus><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E6.m1.36.36"></times><ci id="S3.E6.m1.15.15.15.6.6.6.cmml" xref="S3.E6.m1.15.15.15.6.6.6">𝛽</ci><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.36.36"><log id="S3.E6.m1.16.16.16.7.7.7.cmml" xref="S3.E6.m1.16.16.16.7.7.7"></log><apply id="S3.E6.m1.17.17.17.8.8.8.cmml" xref="S3.E6.m1.17.17.17.8.8.8"><divide id="S3.E6.m1.17.17.17.8.8.8.5.cmml" xref="S3.E6.m1.17.17.17.8.8.8"></divide><apply id="S3.E6.m1.17.17.17.8.8.8.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2"><times id="S3.E6.m1.17.17.17.8.8.8.2.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.3"></times><apply id="S3.E6.m1.17.17.17.8.8.8.2.4.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.4"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.2.4.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.4">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.2.4.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.4.2">𝑃</ci><ci id="S3.E6.m1.17.17.17.8.8.8.2.4.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.4.3">ℳ</ci></apply><apply id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1"><csymbol cd="latexml" id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.2">conditional</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.3">𝑧</ci><list id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1"><apply id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1">subscript</csymbol><interval closure="open" id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2"><apply id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.4.cmml" xref="S3.E6.m1.17.17.17.8.8.8.2.2.1.1.1.1.1.4">𝑤</ci></apply><ci id="S3.E6.m1.17.17.17.8.8.8.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.1.1">𝑥</ci></list></apply></apply><apply id="S3.E6.m1.17.17.17.8.8.8.4.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4"><times id="S3.E6.m1.17.17.17.8.8.8.4.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.3"></times><apply id="S3.E6.m1.17.17.17.8.8.8.4.4.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.4.4.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.4.4.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4.2">𝑃</ci><apply id="S3.E6.m1.17.17.17.8.8.8.4.4.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.4.4.3.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.4.4.3.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.2">ℳ</ci><ci id="S3.E6.m1.17.17.17.8.8.8.4.4.3.3a.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.3"><mtext id="S3.E6.m1.17.17.17.8.8.8.4.4.3.3.cmml" mathsize="50%" xref="S3.E6.m1.17.17.17.8.8.8.4.4.3.3">ref</mtext></ci></apply></apply><apply id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1"><csymbol cd="latexml" id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.2">conditional</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.3">𝑧</ci><list id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1"><apply id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1">subscript</csymbol><interval closure="open" id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2"><apply id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.3.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.4.cmml" xref="S3.E6.m1.17.17.17.8.8.8.4.2.1.1.1.1.1.4">𝑤</ci></apply><ci id="S3.E6.m1.17.17.17.8.8.8.3.1.cmml" xref="S3.E6.m1.17.17.17.8.8.8.3.1">𝑥</ci></list></apply></apply></apply></apply></apply><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E6.m1.36.36">superscript</csymbol><ci id="S3.E6.m1.19.19.19.10.10.10.cmml" xref="S3.E6.m1.19.19.19.10.10.10">𝑠</ci><ci id="S3.E6.m1.20.20.20.11.11.11.1.cmml" xref="S3.E6.m1.20.20.20.11.11.11.1">𝑑</ci></apply><ci id="S3.E6.m1.21.21.21.12.12.12.1a.cmml" xref="S3.E6.m1.21.21.21.12.12.12.1"><mtext id="S3.E6.m1.21.21.21.12.12.12.1.cmml" mathsize="70%" xref="S3.E6.m1.21.21.21.12.12.12.1">ref</mtext></ci></apply></apply></apply><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.1.1.1.1.1.2.2.cmml" xref="S3.E6.m1.36.36"></times><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><ci id="S3.E6.m1.24.24.24.2.2.2.cmml" xref="S3.E6.m1.24.24.24.2.2.2">𝜆</ci><ci id="S3.E6.m1.25.25.25.3.3.3.1.cmml" xref="S3.E6.m1.25.25.25.3.3.3.1">𝑙</ci></apply><ci id="S3.E6.m1.26.26.26.4.4.4.cmml" xref="S3.E6.m1.26.26.26.4.4.4">𝜎</ci><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.cmml" xref="S3.E6.m1.36.36"><minus id="S3.E6.m1.31.31.31.9.9.9.cmml" xref="S3.E6.m1.31.31.31.9.9.9"></minus><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.1.cmml" xref="S3.E6.m1.36.36">subscript</csymbol><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.2.cmml" xref="S3.E6.m1.36.36"><csymbol cd="ambiguous" id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.2.1.cmml" xref="S3.E6.m1.36.36">superscript</csymbol><ci id="S3.E6.m1.28.28.28.6.6.6.cmml" xref="S3.E6.m1.28.28.28.6.6.6">𝑠</ci><ci id="S3.E6.m1.29.29.29.7.7.7.1.cmml" xref="S3.E6.m1.29.29.29.7.7.7.1">𝑑</ci></apply><ci id="S3.E6.m1.30.30.30.8.8.8.1a.cmml" xref="S3.E6.m1.30.30.30.8.8.8.1"><mtext id="S3.E6.m1.30.30.30.8.8.8.1.cmml" mathsize="70%" xref="S3.E6.m1.30.30.30.8.8.8.1">ref</mtext></ci></apply><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.cmml" xref="S3.E6.m1.36.36"><times id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.1.cmml" xref="S3.E6.m1.36.36"></times><ci id="S3.E6.m1.32.32.32.10.10.10.cmml" xref="S3.E6.m1.32.32.32.10.10.10">𝛽</ci><apply id="S3.E6.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.3.cmml" xref="S3.E6.m1.36.36"><log id="S3.E6.m1.33.33.33.11.11.11.cmml" xref="S3.E6.m1.33.33.33.11.11.11"></log><apply id="S3.E6.m1.34.34.34.12.12.12.cmml" xref="S3.E6.m1.34.34.34.12.12.12"><divide id="S3.E6.m1.34.34.34.12.12.12.5.cmml" xref="S3.E6.m1.34.34.34.12.12.12"></divide><apply id="S3.E6.m1.34.34.34.12.12.12.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2"><times id="S3.E6.m1.34.34.34.12.12.12.2.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.3"></times><apply id="S3.E6.m1.34.34.34.12.12.12.2.4.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.4"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.2.4.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.4">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.2.4.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.4.2">𝑃</ci><ci id="S3.E6.m1.34.34.34.12.12.12.2.4.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.4.3">ℳ</ci></apply><apply id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1"><csymbol cd="latexml" id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.2">conditional</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.3">𝑧</ci><list id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1"><apply id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1">subscript</csymbol><interval closure="open" id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2"><apply id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.4.cmml" xref="S3.E6.m1.34.34.34.12.12.12.2.2.1.1.1.1.1.4">𝑙</ci></apply><ci id="S3.E6.m1.34.34.34.12.12.12.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.1.1">𝑥</ci></list></apply></apply><apply id="S3.E6.m1.34.34.34.12.12.12.4.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4"><times id="S3.E6.m1.34.34.34.12.12.12.4.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.3"></times><apply id="S3.E6.m1.34.34.34.12.12.12.4.4.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.4.4.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.4.4.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4.2">𝑃</ci><apply id="S3.E6.m1.34.34.34.12.12.12.4.4.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.4.4.3.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.4.4.3.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.2">ℳ</ci><ci id="S3.E6.m1.34.34.34.12.12.12.4.4.3.3a.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.3"><mtext id="S3.E6.m1.34.34.34.12.12.12.4.4.3.3.cmml" mathsize="50%" xref="S3.E6.m1.34.34.34.12.12.12.4.4.3.3">ref</mtext></ci></apply></apply><apply id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1"><csymbol cd="latexml" id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.2">conditional</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.3">𝑧</ci><list id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1"><apply id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1">subscript</csymbol><interval closure="open" id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2"><apply id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.2.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.3.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.2.2.2.3">𝑘</ci></apply></interval><ci id="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.4.cmml" xref="S3.E6.m1.34.34.34.12.12.12.4.2.1.1.1.1.1.4">𝑙</ci></apply><ci id="S3.E6.m1.34.34.34.12.12.12.3.1.cmml" xref="S3.E6.m1.34.34.34.12.12.12.3.1">𝑥</ci></list></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.37c">\mathcal{L}_{d}(\theta)=-\mathbb{E}_{((x_{k},y_{k})_{w},(x_{k},y_{k})_{l},x,z)%
\sim\mathcal{D}}\\
\left[\lambda_{w}\sigma\left(\beta\log\frac{P_{\mathcal{M}}(z\mid(x_{k},y_{k})%
_{w},x)}{P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k})_{w},x)}-s^{d}_{\text{%
ref}}\right)\right.\\
\left.+\lambda_{l}\sigma\left(s^{d}_{\text{ref}}-\beta\log\frac{P_{\mathcal{M}%
}(z\mid(x_{k},y_{k})_{l},x)}{P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k})_{%
l},x)}\right)\right]</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.37d">start_ROW start_CELL caligraphic_L start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT ( italic_θ ) = - blackboard_E start_POSTSUBSCRIPT ( ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_x , italic_z ) ∼ caligraphic_D end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL [ italic_λ start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT italic_σ ( italic_β roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_x ) end_ARG start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_x ) end_ARG - italic_s start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) end_CELL end_ROW start_ROW start_CELL + italic_λ start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_σ ( italic_s start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT - italic_β roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_x ) end_ARG start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT , italic_x ) end_ARG ) ] end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="s^{d}_{\text{ref}}=\mathbb{E}_{(x,y)\sim\mathcal{D}}\biggl{[}\beta\,\text{KL}%
\bigl{(}P_{\mathcal{M}}(z\mid(x_{k},y_{k}),x)\,\\
\parallel\,P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k}),x)\bigr{)}\biggr{]}" class="ltx_math_unparsed" display="block" id="S3.E7.m1.43"><semantics id="S3.E7.m1.43a"><mtable displaystyle="true" id="S3.E7.m1.43.43" rowspacing="0pt"><mtr id="S3.E7.m1.43.43a"><mtd class="ltx_align_left" columnalign="left" id="S3.E7.m1.43.43b"><mrow id="S3.E7.m1.25.25.25.25.25"><msubsup id="S3.E7.m1.25.25.25.25.25.26"><mi id="S3.E7.m1.1.1.1.1.1.1">s</mi><mtext id="S3.E7.m1.3.3.3.3.3.3.1">ref</mtext><mi id="S3.E7.m1.2.2.2.2.2.2.1">d</mi></msubsup><mo id="S3.E7.m1.4.4.4.4.4.4">=</mo><msub id="S3.E7.m1.25.25.25.25.25.27"><mi id="S3.E7.m1.5.5.5.5.5.5">𝔼</mi><mrow id="S3.E7.m1.6.6.6.6.6.6.1"><mrow id="S3.E7.m1.6.6.6.6.6.6.1.4.2"><mo id="S3.E7.m1.6.6.6.6.6.6.1.4.2.1" stretchy="false">(</mo><mi id="S3.E7.m1.6.6.6.6.6.6.1.1">x</mi><mo id="S3.E7.m1.6.6.6.6.6.6.1.4.2.2">,</mo><mi id="S3.E7.m1.6.6.6.6.6.6.1.2">y</mi><mo id="S3.E7.m1.6.6.6.6.6.6.1.4.2.3" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.6.6.6.6.6.6.1.3">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E7.m1.6.6.6.6.6.6.1.5">𝒟</mi></mrow></msub><mrow id="S3.E7.m1.25.25.25.25.25.28"><mo id="S3.E7.m1.7.7.7.7.7.7" maxsize="210%" minsize="210%">[</mo><mi id="S3.E7.m1.8.8.8.8.8.8">β</mi><mtext id="S3.E7.m1.9.9.9.9.9.9">KL</mtext><mrow id="S3.E7.m1.25.25.25.25.25.28.1"><mo id="S3.E7.m1.10.10.10.10.10.10" maxsize="120%" minsize="120%">(</mo><msub id="S3.E7.m1.25.25.25.25.25.28.1.1"><mi id="S3.E7.m1.11.11.11.11.11.11">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E7.m1.12.12.12.12.12.12.1">ℳ</mi></msub><mrow id="S3.E7.m1.25.25.25.25.25.28.1.2"><mo id="S3.E7.m1.13.13.13.13.13.13" stretchy="false">(</mo><mi id="S3.E7.m1.14.14.14.14.14.14">z</mi><mo id="S3.E7.m1.15.15.15.15.15.15" lspace="0em" rspace="0.167em">∣</mo><mrow id="S3.E7.m1.25.25.25.25.25.28.1.2.1"><mo id="S3.E7.m1.16.16.16.16.16.16" stretchy="false">(</mo><msub id="S3.E7.m1.25.25.25.25.25.28.1.2.1.1"><mi id="S3.E7.m1.17.17.17.17.17.17">x</mi><mi id="S3.E7.m1.18.18.18.18.18.18.1">k</mi></msub><mo id="S3.E7.m1.19.19.19.19.19.19">,</mo><msub id="S3.E7.m1.25.25.25.25.25.28.1.2.1.2"><mi id="S3.E7.m1.20.20.20.20.20.20">y</mi><mi id="S3.E7.m1.21.21.21.21.21.21.1">k</mi></msub><mo id="S3.E7.m1.22.22.22.22.22.22" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.23.23.23.23.23.23">,</mo><mi id="S3.E7.m1.24.24.24.24.24.24">x</mi><mo id="S3.E7.m1.25.25.25.25.25.25" stretchy="false">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E7.m1.43.43c"><mtd class="ltx_align_right" columnalign="right" id="S3.E7.m1.43.43d"><mrow id="S3.E7.m1.43.43.43.18.18"><mrow id="S3.E7.m1.43.43.43.18.18.19"><mo id="S3.E7.m1.26.26.26.1.1.1" rspace="0.337em">∥</mo><msub id="S3.E7.m1.43.43.43.18.18.19.1"><mi id="S3.E7.m1.27.27.27.2.2.2">P</mi><msub id="S3.E7.m1.28.28.28.3.3.3.1"><mi class="ltx_font_mathcaligraphic" id="S3.E7.m1.28.28.28.3.3.3.1.2">ℳ</mi><mtext id="S3.E7.m1.28.28.28.3.3.3.1.3">ref</mtext></msub></msub><mrow id="S3.E7.m1.43.43.43.18.18.19.2"><mo id="S3.E7.m1.29.29.29.4.4.4" stretchy="false">(</mo><mi id="S3.E7.m1.30.30.30.5.5.5">z</mi><mo id="S3.E7.m1.31.31.31.6.6.6" lspace="0em" rspace="0.167em">∣</mo><mrow id="S3.E7.m1.43.43.43.18.18.19.2.1"><mo id="S3.E7.m1.32.32.32.7.7.7" stretchy="false">(</mo><msub id="S3.E7.m1.43.43.43.18.18.19.2.1.1"><mi id="S3.E7.m1.33.33.33.8.8.8">x</mi><mi id="S3.E7.m1.34.34.34.9.9.9.1">k</mi></msub><mo id="S3.E7.m1.35.35.35.10.10.10">,</mo><msub id="S3.E7.m1.43.43.43.18.18.19.2.1.2"><mi id="S3.E7.m1.36.36.36.11.11.11">y</mi><mi id="S3.E7.m1.37.37.37.12.12.12.1">k</mi></msub><mo id="S3.E7.m1.38.38.38.13.13.13" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.39.39.39.14.14.14">,</mo><mi id="S3.E7.m1.40.40.40.15.15.15">x</mi><mo id="S3.E7.m1.41.41.41.16.16.16" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.42.42.42.17.17.17" maxsize="120%" minsize="120%">)</mo></mrow><mo id="S3.E7.m1.43.43.43.18.18.18" maxsize="210%" minsize="210%">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex" id="S3.E7.m1.43b">s^{d}_{\text{ref}}=\mathbb{E}_{(x,y)\sim\mathcal{D}}\biggl{[}\beta\,\text{KL}%
\bigl{(}P_{\mathcal{M}}(z\mid(x_{k},y_{k}),x)\,\\
\parallel\,P_{\mathcal{M}_{\text{ref}}}(z\mid(x_{k},y_{k}),x)\bigr{)}\biggr{]}</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.43c">start_ROW start_CELL italic_s start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT = blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y ) ∼ caligraphic_D end_POSTSUBSCRIPT [ italic_β KL ( italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_x ) end_CELL end_ROW start_ROW start_CELL ∥ italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_x ) ) ] end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p4.9">where <math alttext="\beta" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.6.m1.1"><semantics id="S3.SS3.SSS0.Px1.p4.6.m1.1a"><mi id="S3.SS3.SSS0.Px1.p4.6.m1.1.1" xref="S3.SS3.SSS0.Px1.p4.6.m1.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.6.m1.1b"><ci id="S3.SS3.SSS0.Px1.p4.6.m1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.6.m1.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.6.m1.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.6.m1.1d">italic_β</annotation></semantics></math> is a hyperparameter, <math alttext="\lambda_{w}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.7.m2.1"><semantics id="S3.SS3.SSS0.Px1.p4.7.m2.1a"><msub id="S3.SS3.SSS0.Px1.p4.7.m2.1.1" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.2" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1.2.cmml">λ</mi><mi id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.3" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.7.m2.1b"><apply id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1.2">𝜆</ci><ci id="S3.SS3.SSS0.Px1.p4.7.m2.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p4.7.m2.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.7.m2.1c">\lambda_{w}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.7.m2.1d">italic_λ start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\lambda_{l}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.8.m3.1"><semantics id="S3.SS3.SSS0.Px1.p4.8.m3.1a"><msub id="S3.SS3.SSS0.Px1.p4.8.m3.1.1" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.2" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1.2.cmml">λ</mi><mi id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.3" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.8.m3.1b"><apply id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1.2">𝜆</ci><ci id="S3.SS3.SSS0.Px1.p4.8.m3.1.1.3.cmml" xref="S3.SS3.SSS0.Px1.p4.8.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.8.m3.1c">\lambda_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.8.m3.1d">italic_λ start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math> are hyperparameters for preferred data and non-preferred data respectively. <math alttext="s_{\text{ref}}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p4.9.m4.1"><semantics id="S3.SS3.SSS0.Px1.p4.9.m4.1a"><msub id="S3.SS3.SSS0.Px1.p4.9.m4.1.1" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.cmml"><mi id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.2" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.2.cmml">s</mi><mtext id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p4.9.m4.1b"><apply id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.2.cmml" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.2">𝑠</ci><ci id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3a.cmml" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3"><mtext id="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3.cmml" mathsize="70%" xref="S3.SS3.SSS0.Px1.p4.9.m4.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p4.9.m4.1c">s_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p4.9.m4.1d">italic_s start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> represents the use of KL divergence as a constraint to prevent the model from deviating too much from its original predictive ability, thereby enhancing the stability of the model.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">The Second Stage.</h4>
<div class="ltx_para" id="S3.SS3.SSS0.Px2.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px2.p1.4">We then optimize the model generation part <math alttext="-\log P_{\mathcal{M}}(Y\mid z,X)" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px2.p1.1.m1.3"><semantics id="S3.SS3.SSS0.Px2.p1.1.m1.3a"><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.cmml"><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3a" rspace="0.167em" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.cmml">−</mo><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.cmml"><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.cmml"><mi id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.1.cmml">log</mi><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3a" lspace="0.167em" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.cmml">⁡</mo><msub id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.cmml"><mi id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.3" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.3.cmml">ℳ</mi></msub></mrow><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.2.cmml">⁢</mo><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.cmml"><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.2" stretchy="false" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.cmml"><mi id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.2.cmml">Y</mi><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.1.cmml">∣</mo><mrow id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.1.cmml"><mi id="S3.SS3.SSS0.Px2.p1.1.m1.1.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.1.1.cmml">z</mi><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.2.1" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.1.cmml">,</mo><mi id="S3.SS3.SSS0.Px2.p1.1.m1.2.2" xref="S3.SS3.SSS0.Px2.p1.1.m1.2.2.cmml">X</mi></mrow></mrow><mo id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.3" stretchy="false" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px2.p1.1.m1.3b"><apply id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3"><minus id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3"></minus><apply id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1"><times id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.2"></times><apply id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3"><log id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.1"></log><apply id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.2">𝑃</ci><ci id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.3.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.3.2.3">ℳ</ci></apply></apply><apply id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1"><csymbol cd="latexml" id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.1">conditional</csymbol><ci id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.2">𝑌</ci><list id="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.3.3.1.1.1.1.3.2"><ci id="S3.SS3.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.1.1">𝑧</ci><ci id="S3.SS3.SSS0.Px2.p1.1.m1.2.2.cmml" xref="S3.SS3.SSS0.Px2.p1.1.m1.2.2">𝑋</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px2.p1.1.m1.3c">-\log P_{\mathcal{M}}(Y\mid z,X)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px2.p1.1.m1.3d">- roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X )</annotation></semantics></math> in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E4" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4</span></a>) in a similar manner of preference learning.
For all tasks, we treat the ground truth as the correct answer <math alttext="y_{w}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px2.p1.2.m2.1"><semantics id="S3.SS3.SSS0.Px2.p1.2.m2.1a"><msub id="S3.SS3.SSS0.Px2.p1.2.m2.1.1" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1.cmml"><mi id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.2" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.3" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px2.p1.2.m2.1b"><apply id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1.2">𝑦</ci><ci id="S3.SS3.SSS0.Px2.p1.2.m2.1.1.3.cmml" xref="S3.SS3.SSS0.Px2.p1.2.m2.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px2.p1.2.m2.1c">y_{w}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px2.p1.2.m2.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math>. For classification and multi-choice tasks, we consider the incorrect categories or options as wrong answers <math alttext="y_{l}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px2.p1.3.m3.1"><semantics id="S3.SS3.SSS0.Px2.p1.3.m3.1a"><msub id="S3.SS3.SSS0.Px2.p1.3.m3.1.1" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1.cmml"><mi id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.2" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.3" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px2.p1.3.m3.1b"><apply id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1.2">𝑦</ci><ci id="S3.SS3.SSS0.Px2.p1.3.m3.1.1.3.cmml" xref="S3.SS3.SSS0.Px2.p1.3.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px2.p1.3.m3.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px2.p1.3.m3.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>, and for generation tasks, we randomly sample answers from other samples as <math alttext="y_{l}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px2.p1.4.m4.1"><semantics id="S3.SS3.SSS0.Px2.p1.4.m4.1a"><msub id="S3.SS3.SSS0.Px2.p1.4.m4.1.1" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1.cmml"><mi id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.2" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1.2.cmml">y</mi><mi id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.3" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px2.p1.4.m4.1b"><apply id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.2.cmml" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1.2">𝑦</ci><ci id="S3.SS3.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="S3.SS3.SSS0.Px2.p1.4.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px2.p1.4.m4.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px2.p1.4.m4.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math> for the current sample. The answer-level loss is formulated as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{a}(\theta)=-\mathbb{E}_{(z,x,y_{w},y_{l})\sim\mathcal{D}}\\
\left[\lambda_{w}\sigma\left(\beta\log\frac{P_{\mathcal{M}}(y_{w}\mid z,x)}{P_%
{\mathcal{M}_{\text{ref}}}(y_{w}\mid z,x)}-s^{a}_{\text{ref}}\right)\right.\\
\left.+\lambda_{l}\sigma\left(s^{a}_{\text{ref}}-\beta\log\frac{P_{\mathcal{M}%
}(y_{l}\mid z,x)}{P_{\mathcal{M}_{\text{ref}}}(y_{l}\mid z,x)}\right)\right]" class="ltx_Math" display="block" id="S3.E8.m1.37"><semantics id="S3.E8.m1.37a"><mtable displaystyle="true" id="S3.E8.m1.36.36" rowspacing="0pt" xref="S3.E8.m1.37.37.1.cmml"><mtr id="S3.E8.m1.36.36a" xref="S3.E8.m1.37.37.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S3.E8.m1.36.36b" xref="S3.E8.m1.37.37.1.cmml"><mrow id="S3.E8.m1.9.9.9.9.9" xref="S3.E8.m1.37.37.1.cmml"><mrow id="S3.E8.m1.9.9.9.9.9.10" xref="S3.E8.m1.37.37.1.cmml"><msub id="S3.E8.m1.9.9.9.9.9.10.2" xref="S3.E8.m1.37.37.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.1.cmml">ℒ</mi><mi id="S3.E8.m1.2.2.2.2.2.2.1" xref="S3.E8.m1.2.2.2.2.2.2.1.cmml">a</mi></msub><mo id="S3.E8.m1.9.9.9.9.9.10.1" xref="S3.E8.m1.37.37.1.cmml">⁢</mo><mrow id="S3.E8.m1.9.9.9.9.9.10.3" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.3.3.3.3.3.3" stretchy="false" xref="S3.E8.m1.37.37.1.cmml">(</mo><mi id="S3.E8.m1.4.4.4.4.4.4" xref="S3.E8.m1.4.4.4.4.4.4.cmml">θ</mi><mo id="S3.E8.m1.5.5.5.5.5.5" stretchy="false" xref="S3.E8.m1.37.37.1.cmml">)</mo></mrow></mrow><mo id="S3.E8.m1.6.6.6.6.6.6" xref="S3.E8.m1.6.6.6.6.6.6.cmml">=</mo><mrow id="S3.E8.m1.9.9.9.9.9.11" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.9.9.9.9.9.11a" xref="S3.E8.m1.37.37.1.cmml">−</mo><msub id="S3.E8.m1.9.9.9.9.9.11.1" xref="S3.E8.m1.37.37.1.cmml"><mi id="S3.E8.m1.8.8.8.8.8.8" xref="S3.E8.m1.8.8.8.8.8.8.cmml">𝔼</mi><mrow id="S3.E8.m1.9.9.9.9.9.9.1" xref="S3.E8.m1.9.9.9.9.9.9.1.cmml"><mrow id="S3.E8.m1.9.9.9.9.9.9.1.4.2" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml"><mo id="S3.E8.m1.9.9.9.9.9.9.1.4.2.3" stretchy="false" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml">(</mo><mi id="S3.E8.m1.9.9.9.9.9.9.1.1" xref="S3.E8.m1.9.9.9.9.9.9.1.1.cmml">z</mi><mo id="S3.E8.m1.9.9.9.9.9.9.1.4.2.4" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><mi id="S3.E8.m1.9.9.9.9.9.9.1.2" xref="S3.E8.m1.9.9.9.9.9.9.1.2.cmml">x</mi><mo id="S3.E8.m1.9.9.9.9.9.9.1.4.2.5" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><msub id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.cmml"><mi id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.2" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.2.cmml">y</mi><mi id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.3" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.3.cmml">w</mi></msub><mo id="S3.E8.m1.9.9.9.9.9.9.1.4.2.6" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml">,</mo><msub id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.cmml"><mi id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.2" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.2.cmml">y</mi><mi id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.3" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.3.cmml">l</mi></msub><mo id="S3.E8.m1.9.9.9.9.9.9.1.4.2.7" stretchy="false" xref="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml">)</mo></mrow><mo id="S3.E8.m1.9.9.9.9.9.9.1.5" xref="S3.E8.m1.9.9.9.9.9.9.1.5.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.9.9.9.9.9.9.1.6" xref="S3.E8.m1.9.9.9.9.9.9.1.6.cmml">𝒟</mi></mrow></msub></mrow></mrow></mtd></mtr><mtr id="S3.E8.m1.36.36c" xref="S3.E8.m1.37.37.1.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E8.m1.36.36d" xref="S3.E8.m1.37.37.1.cmml"><mrow id="S3.E8.m1.22.22.22.13.13" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.10.10.10.1.1.1" xref="S3.E8.m1.37.37.1.cmml">[</mo><msub id="S3.E8.m1.22.22.22.13.13.14" xref="S3.E8.m1.37.37.1.cmml"><mi id="S3.E8.m1.11.11.11.2.2.2" xref="S3.E8.m1.11.11.11.2.2.2.cmml">λ</mi><mi id="S3.E8.m1.12.12.12.3.3.3.1" xref="S3.E8.m1.12.12.12.3.3.3.1.cmml">w</mi></msub><mi id="S3.E8.m1.13.13.13.4.4.4" xref="S3.E8.m1.13.13.13.4.4.4.cmml">σ</mi><mrow id="S3.E8.m1.22.22.22.13.13.15" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.14.14.14.5.5.5" xref="S3.E8.m1.37.37.1.cmml">(</mo><mi id="S3.E8.m1.15.15.15.6.6.6" xref="S3.E8.m1.15.15.15.6.6.6.cmml">β</mi><mi id="S3.E8.m1.16.16.16.7.7.7" xref="S3.E8.m1.16.16.16.7.7.7.cmml">log</mi><mfrac id="S3.E8.m1.17.17.17.8.8.8" xref="S3.E8.m1.17.17.17.8.8.8.cmml"><mrow id="S3.E8.m1.17.17.17.8.8.8.3" xref="S3.E8.m1.17.17.17.8.8.8.3.cmml"><msub id="S3.E8.m1.17.17.17.8.8.8.3.5" xref="S3.E8.m1.17.17.17.8.8.8.3.5.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.3.5.2" xref="S3.E8.m1.17.17.17.8.8.8.3.5.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.17.17.17.8.8.8.3.5.3" xref="S3.E8.m1.17.17.17.8.8.8.3.5.3.cmml">ℳ</mi></msub><mo id="S3.E8.m1.17.17.17.8.8.8.3.4" xref="S3.E8.m1.17.17.17.8.8.8.3.4.cmml">⁢</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.3.3.1" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.cmml"><mo id="S3.E8.m1.17.17.17.8.8.8.3.3.1.2" stretchy="false" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.cmml">(</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.cmml"><msub id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.2" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.2.cmml">y</mi><mi id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.3" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.3.cmml">w</mi></msub><mo id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.1" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.1.cmml">∣</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.2" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.1.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.1.1" xref="S3.E8.m1.17.17.17.8.8.8.1.1.cmml">z</mi><mo id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.2.1" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.1.cmml">,</mo><mi id="S3.E8.m1.17.17.17.8.8.8.2.2" xref="S3.E8.m1.17.17.17.8.8.8.2.2.cmml">x</mi></mrow></mrow><mo id="S3.E8.m1.17.17.17.8.8.8.3.3.1.3" stretchy="false" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.cmml">)</mo></mrow></mrow><mrow id="S3.E8.m1.17.17.17.8.8.8.6" xref="S3.E8.m1.17.17.17.8.8.8.6.cmml"><msub id="S3.E8.m1.17.17.17.8.8.8.6.5" xref="S3.E8.m1.17.17.17.8.8.8.6.5.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.6.5.2" xref="S3.E8.m1.17.17.17.8.8.8.6.5.2.cmml">P</mi><msub id="S3.E8.m1.17.17.17.8.8.8.6.5.3" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.17.17.17.8.8.8.6.5.3.2" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.2.cmml">ℳ</mi><mtext id="S3.E8.m1.17.17.17.8.8.8.6.5.3.3" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.3a.cmml">ref</mtext></msub></msub><mo id="S3.E8.m1.17.17.17.8.8.8.6.4" xref="S3.E8.m1.17.17.17.8.8.8.6.4.cmml">⁢</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.6.3.1" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.cmml"><mo id="S3.E8.m1.17.17.17.8.8.8.6.3.1.2" stretchy="false" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.cmml">(</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.cmml"><msub id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.2" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.2.cmml">y</mi><mi id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.3" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.3.cmml">w</mi></msub><mo id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.1" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.1.cmml">∣</mo><mrow id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.2" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.1.cmml"><mi id="S3.E8.m1.17.17.17.8.8.8.4.1" xref="S3.E8.m1.17.17.17.8.8.8.4.1.cmml">z</mi><mo id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.2.1" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.1.cmml">,</mo><mi id="S3.E8.m1.17.17.17.8.8.8.5.2" xref="S3.E8.m1.17.17.17.8.8.8.5.2.cmml">x</mi></mrow></mrow><mo id="S3.E8.m1.17.17.17.8.8.8.6.3.1.3" stretchy="false" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S3.E8.m1.18.18.18.9.9.9" xref="S3.E8.m1.18.18.18.9.9.9.cmml">−</mo><msubsup id="S3.E8.m1.22.22.22.13.13.15.1" xref="S3.E8.m1.37.37.1.cmml"><mi id="S3.E8.m1.19.19.19.10.10.10" xref="S3.E8.m1.19.19.19.10.10.10.cmml">s</mi><mtext id="S3.E8.m1.21.21.21.12.12.12.1" xref="S3.E8.m1.21.21.21.12.12.12.1a.cmml">ref</mtext><mi id="S3.E8.m1.20.20.20.11.11.11.1" xref="S3.E8.m1.20.20.20.11.11.11.1.cmml">a</mi></msubsup><mo id="S3.E8.m1.22.22.22.13.13.13" xref="S3.E8.m1.37.37.1.cmml">)</mo></mrow></mrow></mtd></mtr><mtr id="S3.E8.m1.36.36e" xref="S3.E8.m1.37.37.1.cmml"><mtd class="ltx_align_right" columnalign="right" id="S3.E8.m1.36.36f" xref="S3.E8.m1.37.37.1.cmml"><mrow id="S3.E8.m1.36.36.36.14.14" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.23.23.23.1.1.1" xref="S3.E8.m1.23.23.23.1.1.1.cmml">+</mo><msub id="S3.E8.m1.36.36.36.14.14.15" xref="S3.E8.m1.37.37.1.cmml"><mi id="S3.E8.m1.24.24.24.2.2.2" xref="S3.E8.m1.24.24.24.2.2.2.cmml">λ</mi><mi id="S3.E8.m1.25.25.25.3.3.3.1" xref="S3.E8.m1.25.25.25.3.3.3.1.cmml">l</mi></msub><mi id="S3.E8.m1.26.26.26.4.4.4" xref="S3.E8.m1.26.26.26.4.4.4.cmml">σ</mi><mrow id="S3.E8.m1.36.36.36.14.14.16" xref="S3.E8.m1.37.37.1.cmml"><mo id="S3.E8.m1.27.27.27.5.5.5" xref="S3.E8.m1.37.37.1.cmml">(</mo><msubsup id="S3.E8.m1.36.36.36.14.14.16.1" xref="S3.E8.m1.37.37.1.cmml"><mi id="S3.E8.m1.28.28.28.6.6.6" xref="S3.E8.m1.28.28.28.6.6.6.cmml">s</mi><mtext id="S3.E8.m1.30.30.30.8.8.8.1" xref="S3.E8.m1.30.30.30.8.8.8.1a.cmml">ref</mtext><mi id="S3.E8.m1.29.29.29.7.7.7.1" xref="S3.E8.m1.29.29.29.7.7.7.1.cmml">a</mi></msubsup><mo id="S3.E8.m1.31.31.31.9.9.9" xref="S3.E8.m1.31.31.31.9.9.9.cmml">−</mo><mi id="S3.E8.m1.32.32.32.10.10.10" xref="S3.E8.m1.32.32.32.10.10.10.cmml">β</mi><mi id="S3.E8.m1.33.33.33.11.11.11" xref="S3.E8.m1.33.33.33.11.11.11.cmml">log</mi><mfrac id="S3.E8.m1.34.34.34.12.12.12" xref="S3.E8.m1.34.34.34.12.12.12.cmml"><mrow id="S3.E8.m1.34.34.34.12.12.12.3" xref="S3.E8.m1.34.34.34.12.12.12.3.cmml"><msub id="S3.E8.m1.34.34.34.12.12.12.3.5" xref="S3.E8.m1.34.34.34.12.12.12.3.5.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.3.5.2" xref="S3.E8.m1.34.34.34.12.12.12.3.5.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.34.34.34.12.12.12.3.5.3" xref="S3.E8.m1.34.34.34.12.12.12.3.5.3.cmml">ℳ</mi></msub><mo id="S3.E8.m1.34.34.34.12.12.12.3.4" xref="S3.E8.m1.34.34.34.12.12.12.3.4.cmml">⁢</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.3.3.1" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.cmml"><mo id="S3.E8.m1.34.34.34.12.12.12.3.3.1.2" stretchy="false" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.cmml">(</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.cmml"><msub id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.2" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.2.cmml">y</mi><mi id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.3" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.3.cmml">l</mi></msub><mo id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.1" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.1.cmml">∣</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.2" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.1.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.1.1" xref="S3.E8.m1.34.34.34.12.12.12.1.1.cmml">z</mi><mo id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.2.1" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.1.cmml">,</mo><mi id="S3.E8.m1.34.34.34.12.12.12.2.2" xref="S3.E8.m1.34.34.34.12.12.12.2.2.cmml">x</mi></mrow></mrow><mo id="S3.E8.m1.34.34.34.12.12.12.3.3.1.3" stretchy="false" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.cmml">)</mo></mrow></mrow><mrow id="S3.E8.m1.34.34.34.12.12.12.6" xref="S3.E8.m1.34.34.34.12.12.12.6.cmml"><msub id="S3.E8.m1.34.34.34.12.12.12.6.5" xref="S3.E8.m1.34.34.34.12.12.12.6.5.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.6.5.2" xref="S3.E8.m1.34.34.34.12.12.12.6.5.2.cmml">P</mi><msub id="S3.E8.m1.34.34.34.12.12.12.6.5.3" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E8.m1.34.34.34.12.12.12.6.5.3.2" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.2.cmml">ℳ</mi><mtext id="S3.E8.m1.34.34.34.12.12.12.6.5.3.3" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.3a.cmml">ref</mtext></msub></msub><mo id="S3.E8.m1.34.34.34.12.12.12.6.4" xref="S3.E8.m1.34.34.34.12.12.12.6.4.cmml">⁢</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.6.3.1" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.cmml"><mo id="S3.E8.m1.34.34.34.12.12.12.6.3.1.2" stretchy="false" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.cmml">(</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.cmml"><msub id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.2" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.2.cmml">y</mi><mi id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.3" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.3.cmml">l</mi></msub><mo id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.1" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.1.cmml">∣</mo><mrow id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.2" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.1.cmml"><mi id="S3.E8.m1.34.34.34.12.12.12.4.1" xref="S3.E8.m1.34.34.34.12.12.12.4.1.cmml">z</mi><mo id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.2.1" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.1.cmml">,</mo><mi id="S3.E8.m1.34.34.34.12.12.12.5.2" xref="S3.E8.m1.34.34.34.12.12.12.5.2.cmml">x</mi></mrow></mrow><mo id="S3.E8.m1.34.34.34.12.12.12.6.3.1.3" stretchy="false" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S3.E8.m1.35.35.35.13.13.13" xref="S3.E8.m1.37.37.1.cmml">)</mo></mrow><mo id="S3.E8.m1.36.36.36.14.14.14" xref="S3.E8.m1.37.37.1.cmml">]</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E8.m1.37b"><apply id="S3.E8.m1.37.37.1.cmml" xref="S3.E8.m1.36.36"><eq id="S3.E8.m1.6.6.6.6.6.6.cmml" xref="S3.E8.m1.6.6.6.6.6.6"></eq><apply id="S3.E8.m1.37.37.1.3.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.3.1.cmml" xref="S3.E8.m1.36.36"></times><apply id="S3.E8.m1.37.37.1.3.2.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.3.2.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><ci id="S3.E8.m1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1">ℒ</ci><ci id="S3.E8.m1.2.2.2.2.2.2.1.cmml" xref="S3.E8.m1.2.2.2.2.2.2.1">𝑎</ci></apply><ci id="S3.E8.m1.4.4.4.4.4.4.cmml" xref="S3.E8.m1.4.4.4.4.4.4">𝜃</ci></apply><apply id="S3.E8.m1.37.37.1.1.cmml" xref="S3.E8.m1.36.36"><minus id="S3.E8.m1.7.7.7.7.7.7.cmml" xref="S3.E8.m1.36.36"></minus><apply id="S3.E8.m1.37.37.1.1.1.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.1.1.2.cmml" xref="S3.E8.m1.36.36"></times><apply id="S3.E8.m1.37.37.1.1.1.3.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.3.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><ci id="S3.E8.m1.8.8.8.8.8.8.cmml" xref="S3.E8.m1.8.8.8.8.8.8">𝔼</ci><apply id="S3.E8.m1.9.9.9.9.9.9.1.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1"><csymbol cd="latexml" id="S3.E8.m1.9.9.9.9.9.9.1.5.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.5">similar-to</csymbol><vector id="S3.E8.m1.9.9.9.9.9.9.1.4.3.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2"><ci id="S3.E8.m1.9.9.9.9.9.9.1.1.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.1">𝑧</ci><ci id="S3.E8.m1.9.9.9.9.9.9.1.2.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.2">𝑥</ci><apply id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.1.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1">subscript</csymbol><ci id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.2.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.2">𝑦</ci><ci id="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.3.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.3.1.1.3">𝑤</ci></apply><apply id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2"><csymbol cd="ambiguous" id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.1.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2">subscript</csymbol><ci id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.2.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.2">𝑦</ci><ci id="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.3.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.4.2.2.3">𝑙</ci></apply></vector><ci id="S3.E8.m1.9.9.9.9.9.9.1.6.cmml" xref="S3.E8.m1.9.9.9.9.9.9.1.6">𝒟</ci></apply></apply><apply id="S3.E8.m1.37.37.1.1.1.1.2.cmml" xref="S3.E8.m1.36.36"><csymbol cd="latexml" id="S3.E8.m1.37.37.1.1.1.1.2.1.cmml" xref="S3.E8.m1.36.36">delimited-[]</csymbol><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.cmml" xref="S3.E8.m1.36.36"><plus id="S3.E8.m1.23.23.23.1.1.1.cmml" xref="S3.E8.m1.23.23.23.1.1.1"></plus><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.36.36"></times><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><ci id="S3.E8.m1.11.11.11.2.2.2.cmml" xref="S3.E8.m1.11.11.11.2.2.2">𝜆</ci><ci id="S3.E8.m1.12.12.12.3.3.3.1.cmml" xref="S3.E8.m1.12.12.12.3.3.3.1">𝑤</ci></apply><ci id="S3.E8.m1.13.13.13.4.4.4.cmml" xref="S3.E8.m1.13.13.13.4.4.4">𝜎</ci><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.36.36"><minus id="S3.E8.m1.18.18.18.9.9.9.cmml" xref="S3.E8.m1.18.18.18.9.9.9"></minus><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E8.m1.36.36"></times><ci id="S3.E8.m1.15.15.15.6.6.6.cmml" xref="S3.E8.m1.15.15.15.6.6.6">𝛽</ci><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E8.m1.36.36"><log id="S3.E8.m1.16.16.16.7.7.7.cmml" xref="S3.E8.m1.16.16.16.7.7.7"></log><apply id="S3.E8.m1.17.17.17.8.8.8.cmml" xref="S3.E8.m1.17.17.17.8.8.8"><divide id="S3.E8.m1.17.17.17.8.8.8.7.cmml" xref="S3.E8.m1.17.17.17.8.8.8"></divide><apply id="S3.E8.m1.17.17.17.8.8.8.3.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3"><times id="S3.E8.m1.17.17.17.8.8.8.3.4.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.4"></times><apply id="S3.E8.m1.17.17.17.8.8.8.3.5.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.5"><csymbol cd="ambiguous" id="S3.E8.m1.17.17.17.8.8.8.3.5.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.5">subscript</csymbol><ci id="S3.E8.m1.17.17.17.8.8.8.3.5.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.5.2">𝑃</ci><ci id="S3.E8.m1.17.17.17.8.8.8.3.5.3.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.5.3">ℳ</ci></apply><apply id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1"><csymbol cd="latexml" id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.1">conditional</csymbol><apply id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2">subscript</csymbol><ci id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.2">𝑦</ci><ci id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.3.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.2.3">𝑤</ci></apply><list id="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.3.3.1.1.3.2"><ci id="S3.E8.m1.17.17.17.8.8.8.1.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.1.1">𝑧</ci><ci id="S3.E8.m1.17.17.17.8.8.8.2.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.2.2">𝑥</ci></list></apply></apply><apply id="S3.E8.m1.17.17.17.8.8.8.6.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6"><times id="S3.E8.m1.17.17.17.8.8.8.6.4.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.4"></times><apply id="S3.E8.m1.17.17.17.8.8.8.6.5.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5"><csymbol cd="ambiguous" id="S3.E8.m1.17.17.17.8.8.8.6.5.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5">subscript</csymbol><ci id="S3.E8.m1.17.17.17.8.8.8.6.5.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5.2">𝑃</ci><apply id="S3.E8.m1.17.17.17.8.8.8.6.5.3.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3"><csymbol cd="ambiguous" id="S3.E8.m1.17.17.17.8.8.8.6.5.3.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3">subscript</csymbol><ci id="S3.E8.m1.17.17.17.8.8.8.6.5.3.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.2">ℳ</ci><ci id="S3.E8.m1.17.17.17.8.8.8.6.5.3.3a.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.3"><mtext id="S3.E8.m1.17.17.17.8.8.8.6.5.3.3.cmml" mathsize="50%" xref="S3.E8.m1.17.17.17.8.8.8.6.5.3.3">ref</mtext></ci></apply></apply><apply id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1"><csymbol cd="latexml" id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.1">conditional</csymbol><apply id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2">subscript</csymbol><ci id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.2">𝑦</ci><ci id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.3.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.2.3">𝑤</ci></apply><list id="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.6.3.1.1.3.2"><ci id="S3.E8.m1.17.17.17.8.8.8.4.1.cmml" xref="S3.E8.m1.17.17.17.8.8.8.4.1">𝑧</ci><ci id="S3.E8.m1.17.17.17.8.8.8.5.2.cmml" xref="S3.E8.m1.17.17.17.8.8.8.5.2">𝑥</ci></list></apply></apply></apply></apply></apply><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E8.m1.36.36">superscript</csymbol><ci id="S3.E8.m1.19.19.19.10.10.10.cmml" xref="S3.E8.m1.19.19.19.10.10.10">𝑠</ci><ci id="S3.E8.m1.20.20.20.11.11.11.1.cmml" xref="S3.E8.m1.20.20.20.11.11.11.1">𝑎</ci></apply><ci id="S3.E8.m1.21.21.21.12.12.12.1a.cmml" xref="S3.E8.m1.21.21.21.12.12.12.1"><mtext id="S3.E8.m1.21.21.21.12.12.12.1.cmml" mathsize="70%" xref="S3.E8.m1.21.21.21.12.12.12.1">ref</mtext></ci></apply></apply></apply><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.1.1.1.1.1.2.2.cmml" xref="S3.E8.m1.36.36"></times><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.3.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><ci id="S3.E8.m1.24.24.24.2.2.2.cmml" xref="S3.E8.m1.24.24.24.2.2.2">𝜆</ci><ci id="S3.E8.m1.25.25.25.3.3.3.1.cmml" xref="S3.E8.m1.25.25.25.3.3.3.1">𝑙</ci></apply><ci id="S3.E8.m1.26.26.26.4.4.4.cmml" xref="S3.E8.m1.26.26.26.4.4.4">𝜎</ci><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.cmml" xref="S3.E8.m1.36.36"><minus id="S3.E8.m1.31.31.31.9.9.9.cmml" xref="S3.E8.m1.31.31.31.9.9.9"></minus><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.1.cmml" xref="S3.E8.m1.36.36">subscript</csymbol><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.2.cmml" xref="S3.E8.m1.36.36"><csymbol cd="ambiguous" id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.2.2.1.cmml" xref="S3.E8.m1.36.36">superscript</csymbol><ci id="S3.E8.m1.28.28.28.6.6.6.cmml" xref="S3.E8.m1.28.28.28.6.6.6">𝑠</ci><ci id="S3.E8.m1.29.29.29.7.7.7.1.cmml" xref="S3.E8.m1.29.29.29.7.7.7.1">𝑎</ci></apply><ci id="S3.E8.m1.30.30.30.8.8.8.1a.cmml" xref="S3.E8.m1.30.30.30.8.8.8.1"><mtext id="S3.E8.m1.30.30.30.8.8.8.1.cmml" mathsize="70%" xref="S3.E8.m1.30.30.30.8.8.8.1">ref</mtext></ci></apply><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.cmml" xref="S3.E8.m1.36.36"><times id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.1.cmml" xref="S3.E8.m1.36.36"></times><ci id="S3.E8.m1.32.32.32.10.10.10.cmml" xref="S3.E8.m1.32.32.32.10.10.10">𝛽</ci><apply id="S3.E8.m1.37.37.1.1.1.1.1.1.2.1.1.1.3.3.cmml" xref="S3.E8.m1.36.36"><log id="S3.E8.m1.33.33.33.11.11.11.cmml" xref="S3.E8.m1.33.33.33.11.11.11"></log><apply id="S3.E8.m1.34.34.34.12.12.12.cmml" xref="S3.E8.m1.34.34.34.12.12.12"><divide id="S3.E8.m1.34.34.34.12.12.12.7.cmml" xref="S3.E8.m1.34.34.34.12.12.12"></divide><apply id="S3.E8.m1.34.34.34.12.12.12.3.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3"><times id="S3.E8.m1.34.34.34.12.12.12.3.4.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.4"></times><apply id="S3.E8.m1.34.34.34.12.12.12.3.5.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.5"><csymbol cd="ambiguous" id="S3.E8.m1.34.34.34.12.12.12.3.5.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.5">subscript</csymbol><ci id="S3.E8.m1.34.34.34.12.12.12.3.5.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.5.2">𝑃</ci><ci id="S3.E8.m1.34.34.34.12.12.12.3.5.3.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.5.3">ℳ</ci></apply><apply id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1"><csymbol cd="latexml" id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.1">conditional</csymbol><apply id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2">subscript</csymbol><ci id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.2">𝑦</ci><ci id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.3.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.2.3">𝑙</ci></apply><list id="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.3.3.1.1.3.2"><ci id="S3.E8.m1.34.34.34.12.12.12.1.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.1.1">𝑧</ci><ci id="S3.E8.m1.34.34.34.12.12.12.2.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.2.2">𝑥</ci></list></apply></apply><apply id="S3.E8.m1.34.34.34.12.12.12.6.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6"><times id="S3.E8.m1.34.34.34.12.12.12.6.4.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.4"></times><apply id="S3.E8.m1.34.34.34.12.12.12.6.5.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5"><csymbol cd="ambiguous" id="S3.E8.m1.34.34.34.12.12.12.6.5.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5">subscript</csymbol><ci id="S3.E8.m1.34.34.34.12.12.12.6.5.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5.2">𝑃</ci><apply id="S3.E8.m1.34.34.34.12.12.12.6.5.3.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3"><csymbol cd="ambiguous" id="S3.E8.m1.34.34.34.12.12.12.6.5.3.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3">subscript</csymbol><ci id="S3.E8.m1.34.34.34.12.12.12.6.5.3.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.2">ℳ</ci><ci id="S3.E8.m1.34.34.34.12.12.12.6.5.3.3a.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.3"><mtext id="S3.E8.m1.34.34.34.12.12.12.6.5.3.3.cmml" mathsize="50%" xref="S3.E8.m1.34.34.34.12.12.12.6.5.3.3">ref</mtext></ci></apply></apply><apply id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1"><csymbol cd="latexml" id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.1">conditional</csymbol><apply id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2">subscript</csymbol><ci id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.2">𝑦</ci><ci id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.3.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.2.3">𝑙</ci></apply><list id="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.6.3.1.1.3.2"><ci id="S3.E8.m1.34.34.34.12.12.12.4.1.cmml" xref="S3.E8.m1.34.34.34.12.12.12.4.1">𝑧</ci><ci id="S3.E8.m1.34.34.34.12.12.12.5.2.cmml" xref="S3.E8.m1.34.34.34.12.12.12.5.2">𝑥</ci></list></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E8.m1.37c">\mathcal{L}_{a}(\theta)=-\mathbb{E}_{(z,x,y_{w},y_{l})\sim\mathcal{D}}\\
\left[\lambda_{w}\sigma\left(\beta\log\frac{P_{\mathcal{M}}(y_{w}\mid z,x)}{P_%
{\mathcal{M}_{\text{ref}}}(y_{w}\mid z,x)}-s^{a}_{\text{ref}}\right)\right.\\
\left.+\lambda_{l}\sigma\left(s^{a}_{\text{ref}}-\beta\log\frac{P_{\mathcal{M}%
}(y_{l}\mid z,x)}{P_{\mathcal{M}_{\text{ref}}}(y_{l}\mid z,x)}\right)\right]</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.37d">start_ROW start_CELL caligraphic_L start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT ( italic_θ ) = - blackboard_E start_POSTSUBSCRIPT ( italic_z , italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL [ italic_λ start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT italic_σ ( italic_β roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_z , italic_x ) end_ARG start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_z , italic_x ) end_ARG - italic_s start_POSTSUPERSCRIPT italic_a end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) end_CELL end_ROW start_ROW start_CELL + italic_λ start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_σ ( italic_s start_POSTSUPERSCRIPT italic_a end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT - italic_β roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_z , italic_x ) end_ARG start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_z , italic_x ) end_ARG ) ] end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.SS3.SSS0.Px2.p2">
<table class="ltx_equation ltx_eqn_table" id="S3.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="s^{a}_{\text{ref}}=\mathbb{E}_{(x,y)\sim\mathcal{D}}\biggl{[}\beta\,\text{KL}%
\bigl{(}P_{\mathcal{M}}(y\mid z,x)\,\\
\parallel\,P_{\mathcal{M}_{\text{ref}}}(y\mid z,x)\bigr{)}\biggr{]}" class="ltx_math_unparsed" display="block" id="S3.E9.m1.31"><semantics id="S3.E9.m1.31a"><mtable displaystyle="true" id="S3.E9.m1.31.31" rowspacing="0pt"><mtr id="S3.E9.m1.31.31a"><mtd class="ltx_align_left" columnalign="left" id="S3.E9.m1.31.31b"><mrow id="S3.E9.m1.19.19.19.19.19"><msubsup id="S3.E9.m1.19.19.19.19.19.20"><mi id="S3.E9.m1.1.1.1.1.1.1">s</mi><mtext id="S3.E9.m1.3.3.3.3.3.3.1">ref</mtext><mi id="S3.E9.m1.2.2.2.2.2.2.1">a</mi></msubsup><mo id="S3.E9.m1.4.4.4.4.4.4">=</mo><msub id="S3.E9.m1.19.19.19.19.19.21"><mi id="S3.E9.m1.5.5.5.5.5.5">𝔼</mi><mrow id="S3.E9.m1.6.6.6.6.6.6.1"><mrow id="S3.E9.m1.6.6.6.6.6.6.1.4.2"><mo id="S3.E9.m1.6.6.6.6.6.6.1.4.2.1" stretchy="false">(</mo><mi id="S3.E9.m1.6.6.6.6.6.6.1.1">x</mi><mo id="S3.E9.m1.6.6.6.6.6.6.1.4.2.2">,</mo><mi id="S3.E9.m1.6.6.6.6.6.6.1.2">y</mi><mo id="S3.E9.m1.6.6.6.6.6.6.1.4.2.3" stretchy="false">)</mo></mrow><mo id="S3.E9.m1.6.6.6.6.6.6.1.3">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E9.m1.6.6.6.6.6.6.1.5">𝒟</mi></mrow></msub><mrow id="S3.E9.m1.19.19.19.19.19.22"><mo id="S3.E9.m1.7.7.7.7.7.7" maxsize="210%" minsize="210%">[</mo><mi id="S3.E9.m1.8.8.8.8.8.8">β</mi><mtext id="S3.E9.m1.9.9.9.9.9.9">KL</mtext><mrow id="S3.E9.m1.19.19.19.19.19.22.1"><mo id="S3.E9.m1.10.10.10.10.10.10" maxsize="120%" minsize="120%">(</mo><msub id="S3.E9.m1.19.19.19.19.19.22.1.1"><mi id="S3.E9.m1.11.11.11.11.11.11">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E9.m1.12.12.12.12.12.12.1">ℳ</mi></msub><mrow id="S3.E9.m1.19.19.19.19.19.22.1.2"><mo id="S3.E9.m1.13.13.13.13.13.13" stretchy="false">(</mo><mi id="S3.E9.m1.14.14.14.14.14.14">y</mi><mo id="S3.E9.m1.15.15.15.15.15.15" lspace="0em" rspace="0.167em">∣</mo><mi id="S3.E9.m1.16.16.16.16.16.16">z</mi><mo id="S3.E9.m1.17.17.17.17.17.17">,</mo><mi id="S3.E9.m1.18.18.18.18.18.18">x</mi><mo id="S3.E9.m1.19.19.19.19.19.19" stretchy="false">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E9.m1.31.31c"><mtd class="ltx_align_right" columnalign="right" id="S3.E9.m1.31.31d"><mrow id="S3.E9.m1.31.31.31.12.12"><mrow id="S3.E9.m1.31.31.31.12.12.13"><mo id="S3.E9.m1.20.20.20.1.1.1" rspace="0.337em">∥</mo><msub id="S3.E9.m1.31.31.31.12.12.13.1"><mi id="S3.E9.m1.21.21.21.2.2.2">P</mi><msub id="S3.E9.m1.22.22.22.3.3.3.1"><mi class="ltx_font_mathcaligraphic" id="S3.E9.m1.22.22.22.3.3.3.1.2">ℳ</mi><mtext id="S3.E9.m1.22.22.22.3.3.3.1.3">ref</mtext></msub></msub><mrow id="S3.E9.m1.31.31.31.12.12.13.2"><mo id="S3.E9.m1.23.23.23.4.4.4" stretchy="false">(</mo><mi id="S3.E9.m1.24.24.24.5.5.5">y</mi><mo id="S3.E9.m1.25.25.25.6.6.6" lspace="0em" rspace="0.167em">∣</mo><mi id="S3.E9.m1.26.26.26.7.7.7">z</mi><mo id="S3.E9.m1.27.27.27.8.8.8">,</mo><mi id="S3.E9.m1.28.28.28.9.9.9">x</mi><mo id="S3.E9.m1.29.29.29.10.10.10" stretchy="false">)</mo></mrow><mo id="S3.E9.m1.30.30.30.11.11.11" maxsize="120%" minsize="120%">)</mo></mrow><mo id="S3.E9.m1.31.31.31.12.12.12" maxsize="210%" minsize="210%">]</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex" id="S3.E9.m1.31b">s^{a}_{\text{ref}}=\mathbb{E}_{(x,y)\sim\mathcal{D}}\biggl{[}\beta\,\text{KL}%
\bigl{(}P_{\mathcal{M}}(y\mid z,x)\,\\
\parallel\,P_{\mathcal{M}_{\text{ref}}}(y\mid z,x)\bigr{)}\biggr{]}</annotation><annotation encoding="application/x-llamapun" id="S3.E9.m1.31c">start_ROW start_CELL italic_s start_POSTSUPERSCRIPT italic_a end_POSTSUPERSCRIPT start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT = blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y ) ∼ caligraphic_D end_POSTSUBSCRIPT [ italic_β KL ( italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y ∣ italic_z , italic_x ) end_CELL end_ROW start_ROW start_CELL ∥ italic_P start_POSTSUBSCRIPT caligraphic_M start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_y ∣ italic_z , italic_x ) ) ] end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.SSS0.Px2.p2.1">where the hyperparameters are consistent with those in the first stage.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS0.Px2.p3">
<p class="ltx_p" id="S3.SS3.SSS0.Px2.p3.1">In summary, we alternately optimize the losses of the two stages, and the complete optimization objective is as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)=\mathcal{L}_{a}(\theta)+\mathcal{L}_{d}(\theta)" class="ltx_Math" display="block" id="S3.E10.m1.3"><semantics id="S3.E10.m1.3a"><mrow id="S3.E10.m1.3.4" xref="S3.E10.m1.3.4.cmml"><mrow id="S3.E10.m1.3.4.2" xref="S3.E10.m1.3.4.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E10.m1.3.4.2.2" xref="S3.E10.m1.3.4.2.2.cmml">ℒ</mi><mo id="S3.E10.m1.3.4.2.1" xref="S3.E10.m1.3.4.2.1.cmml">⁢</mo><mrow id="S3.E10.m1.3.4.2.3.2" xref="S3.E10.m1.3.4.2.cmml"><mo id="S3.E10.m1.3.4.2.3.2.1" stretchy="false" xref="S3.E10.m1.3.4.2.cmml">(</mo><mi id="S3.E10.m1.1.1" xref="S3.E10.m1.1.1.cmml">θ</mi><mo id="S3.E10.m1.3.4.2.3.2.2" stretchy="false" xref="S3.E10.m1.3.4.2.cmml">)</mo></mrow></mrow><mo id="S3.E10.m1.3.4.1" xref="S3.E10.m1.3.4.1.cmml">=</mo><mrow id="S3.E10.m1.3.4.3" xref="S3.E10.m1.3.4.3.cmml"><mrow id="S3.E10.m1.3.4.3.2" xref="S3.E10.m1.3.4.3.2.cmml"><msub id="S3.E10.m1.3.4.3.2.2" xref="S3.E10.m1.3.4.3.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E10.m1.3.4.3.2.2.2" xref="S3.E10.m1.3.4.3.2.2.2.cmml">ℒ</mi><mi id="S3.E10.m1.3.4.3.2.2.3" xref="S3.E10.m1.3.4.3.2.2.3.cmml">a</mi></msub><mo id="S3.E10.m1.3.4.3.2.1" xref="S3.E10.m1.3.4.3.2.1.cmml">⁢</mo><mrow id="S3.E10.m1.3.4.3.2.3.2" xref="S3.E10.m1.3.4.3.2.cmml"><mo id="S3.E10.m1.3.4.3.2.3.2.1" stretchy="false" xref="S3.E10.m1.3.4.3.2.cmml">(</mo><mi id="S3.E10.m1.2.2" xref="S3.E10.m1.2.2.cmml">θ</mi><mo id="S3.E10.m1.3.4.3.2.3.2.2" stretchy="false" xref="S3.E10.m1.3.4.3.2.cmml">)</mo></mrow></mrow><mo id="S3.E10.m1.3.4.3.1" xref="S3.E10.m1.3.4.3.1.cmml">+</mo><mrow id="S3.E10.m1.3.4.3.3" xref="S3.E10.m1.3.4.3.3.cmml"><msub id="S3.E10.m1.3.4.3.3.2" xref="S3.E10.m1.3.4.3.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E10.m1.3.4.3.3.2.2" xref="S3.E10.m1.3.4.3.3.2.2.cmml">ℒ</mi><mi id="S3.E10.m1.3.4.3.3.2.3" xref="S3.E10.m1.3.4.3.3.2.3.cmml">d</mi></msub><mo id="S3.E10.m1.3.4.3.3.1" xref="S3.E10.m1.3.4.3.3.1.cmml">⁢</mo><mrow id="S3.E10.m1.3.4.3.3.3.2" xref="S3.E10.m1.3.4.3.3.cmml"><mo id="S3.E10.m1.3.4.3.3.3.2.1" stretchy="false" xref="S3.E10.m1.3.4.3.3.cmml">(</mo><mi id="S3.E10.m1.3.3" xref="S3.E10.m1.3.3.cmml">θ</mi><mo id="S3.E10.m1.3.4.3.3.3.2.2" stretchy="false" xref="S3.E10.m1.3.4.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E10.m1.3b"><apply id="S3.E10.m1.3.4.cmml" xref="S3.E10.m1.3.4"><eq id="S3.E10.m1.3.4.1.cmml" xref="S3.E10.m1.3.4.1"></eq><apply id="S3.E10.m1.3.4.2.cmml" xref="S3.E10.m1.3.4.2"><times id="S3.E10.m1.3.4.2.1.cmml" xref="S3.E10.m1.3.4.2.1"></times><ci id="S3.E10.m1.3.4.2.2.cmml" xref="S3.E10.m1.3.4.2.2">ℒ</ci><ci id="S3.E10.m1.1.1.cmml" xref="S3.E10.m1.1.1">𝜃</ci></apply><apply id="S3.E10.m1.3.4.3.cmml" xref="S3.E10.m1.3.4.3"><plus id="S3.E10.m1.3.4.3.1.cmml" xref="S3.E10.m1.3.4.3.1"></plus><apply id="S3.E10.m1.3.4.3.2.cmml" xref="S3.E10.m1.3.4.3.2"><times id="S3.E10.m1.3.4.3.2.1.cmml" xref="S3.E10.m1.3.4.3.2.1"></times><apply id="S3.E10.m1.3.4.3.2.2.cmml" xref="S3.E10.m1.3.4.3.2.2"><csymbol cd="ambiguous" id="S3.E10.m1.3.4.3.2.2.1.cmml" xref="S3.E10.m1.3.4.3.2.2">subscript</csymbol><ci id="S3.E10.m1.3.4.3.2.2.2.cmml" xref="S3.E10.m1.3.4.3.2.2.2">ℒ</ci><ci id="S3.E10.m1.3.4.3.2.2.3.cmml" xref="S3.E10.m1.3.4.3.2.2.3">𝑎</ci></apply><ci id="S3.E10.m1.2.2.cmml" xref="S3.E10.m1.2.2">𝜃</ci></apply><apply id="S3.E10.m1.3.4.3.3.cmml" xref="S3.E10.m1.3.4.3.3"><times id="S3.E10.m1.3.4.3.3.1.cmml" xref="S3.E10.m1.3.4.3.3.1"></times><apply id="S3.E10.m1.3.4.3.3.2.cmml" xref="S3.E10.m1.3.4.3.3.2"><csymbol cd="ambiguous" id="S3.E10.m1.3.4.3.3.2.1.cmml" xref="S3.E10.m1.3.4.3.3.2">subscript</csymbol><ci id="S3.E10.m1.3.4.3.3.2.2.cmml" xref="S3.E10.m1.3.4.3.3.2.2">ℒ</ci><ci id="S3.E10.m1.3.4.3.3.2.3.cmml" xref="S3.E10.m1.3.4.3.3.2.3">𝑑</ci></apply><ci id="S3.E10.m1.3.3.cmml" xref="S3.E10.m1.3.3">𝜃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E10.m1.3c">\mathcal{L}(\theta)=\mathcal{L}_{a}(\theta)+\mathcal{L}_{d}(\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.E10.m1.3d">caligraphic_L ( italic_θ ) = caligraphic_L start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT ( italic_θ ) + caligraphic_L start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.SSS0.Px2.p3.2">And Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#alg1" title="In The Second Stage. ‣ 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a> summarizes the whole training procedure.</p>
</div>
<figure class="ltx_float ltx_algorithm" id="alg1">
<div class="ltx_listing ltx_lst_numbers_left ltx_listing" id="alg1.2">
<div class="ltx_listingline" id="alg1.2.1">
<span class="ltx_ERROR undefined" id="alg1.2.1.1">{adjustwidth}</span>-1em0pt





















































<div class="ltx_listing ltx_listing" id="alg1.2.1.2">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline">1:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l1.1">Input:</span> Task dataset <math alttext="\mathcal{D}=\{(x,y)_{i}\}_{i=1}^{|\mathcal{D}|}" class="ltx_Math" display="inline" id="alg1.l1.m1.4"><semantics id="alg1.l1.m1.4a"><mrow id="alg1.l1.m1.4.4" xref="alg1.l1.m1.4.4.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l1.m1.4.4.3" xref="alg1.l1.m1.4.4.3.cmml">𝒟</mi><mo id="alg1.l1.m1.4.4.2" xref="alg1.l1.m1.4.4.2.cmml">=</mo><msubsup id="alg1.l1.m1.4.4.1" xref="alg1.l1.m1.4.4.1.cmml"><mrow id="alg1.l1.m1.4.4.1.1.1.1" xref="alg1.l1.m1.4.4.1.1.1.2.cmml"><mo id="alg1.l1.m1.4.4.1.1.1.1.2" stretchy="false" xref="alg1.l1.m1.4.4.1.1.1.2.cmml">{</mo><msub id="alg1.l1.m1.4.4.1.1.1.1.1" xref="alg1.l1.m1.4.4.1.1.1.1.1.cmml"><mrow id="alg1.l1.m1.4.4.1.1.1.1.1.2.2" xref="alg1.l1.m1.4.4.1.1.1.1.1.2.1.cmml"><mo id="alg1.l1.m1.4.4.1.1.1.1.1.2.2.1" stretchy="false" xref="alg1.l1.m1.4.4.1.1.1.1.1.2.1.cmml">(</mo><mi id="alg1.l1.m1.2.2" xref="alg1.l1.m1.2.2.cmml">x</mi><mo id="alg1.l1.m1.4.4.1.1.1.1.1.2.2.2" xref="alg1.l1.m1.4.4.1.1.1.1.1.2.1.cmml">,</mo><mi id="alg1.l1.m1.3.3" xref="alg1.l1.m1.3.3.cmml">y</mi><mo id="alg1.l1.m1.4.4.1.1.1.1.1.2.2.3" stretchy="false" xref="alg1.l1.m1.4.4.1.1.1.1.1.2.1.cmml">)</mo></mrow><mi id="alg1.l1.m1.4.4.1.1.1.1.1.3" xref="alg1.l1.m1.4.4.1.1.1.1.1.3.cmml">i</mi></msub><mo id="alg1.l1.m1.4.4.1.1.1.1.3" stretchy="false" xref="alg1.l1.m1.4.4.1.1.1.2.cmml">}</mo></mrow><mrow id="alg1.l1.m1.4.4.1.1.3" xref="alg1.l1.m1.4.4.1.1.3.cmml"><mi id="alg1.l1.m1.4.4.1.1.3.2" xref="alg1.l1.m1.4.4.1.1.3.2.cmml">i</mi><mo id="alg1.l1.m1.4.4.1.1.3.1" xref="alg1.l1.m1.4.4.1.1.3.1.cmml">=</mo><mn id="alg1.l1.m1.4.4.1.1.3.3" xref="alg1.l1.m1.4.4.1.1.3.3.cmml">1</mn></mrow><mrow id="alg1.l1.m1.1.1.1.3" xref="alg1.l1.m1.1.1.1.2.cmml"><mo id="alg1.l1.m1.1.1.1.3.1" stretchy="false" xref="alg1.l1.m1.1.1.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="alg1.l1.m1.1.1.1.1" xref="alg1.l1.m1.1.1.1.1.cmml">𝒟</mi><mo id="alg1.l1.m1.1.1.1.3.2" stretchy="false" xref="alg1.l1.m1.1.1.1.2.1.cmml">|</mo></mrow></msubsup></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.4b"><apply id="alg1.l1.m1.4.4.cmml" xref="alg1.l1.m1.4.4"><eq id="alg1.l1.m1.4.4.2.cmml" xref="alg1.l1.m1.4.4.2"></eq><ci id="alg1.l1.m1.4.4.3.cmml" xref="alg1.l1.m1.4.4.3">𝒟</ci><apply id="alg1.l1.m1.4.4.1.cmml" xref="alg1.l1.m1.4.4.1"><csymbol cd="ambiguous" id="alg1.l1.m1.4.4.1.2.cmml" xref="alg1.l1.m1.4.4.1">superscript</csymbol><apply id="alg1.l1.m1.4.4.1.1.cmml" xref="alg1.l1.m1.4.4.1"><csymbol cd="ambiguous" id="alg1.l1.m1.4.4.1.1.2.cmml" xref="alg1.l1.m1.4.4.1">subscript</csymbol><set id="alg1.l1.m1.4.4.1.1.1.2.cmml" xref="alg1.l1.m1.4.4.1.1.1.1"><apply id="alg1.l1.m1.4.4.1.1.1.1.1.cmml" xref="alg1.l1.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l1.m1.4.4.1.1.1.1.1.1.cmml" xref="alg1.l1.m1.4.4.1.1.1.1.1">subscript</csymbol><interval closure="open" id="alg1.l1.m1.4.4.1.1.1.1.1.2.1.cmml" xref="alg1.l1.m1.4.4.1.1.1.1.1.2.2"><ci id="alg1.l1.m1.2.2.cmml" xref="alg1.l1.m1.2.2">𝑥</ci><ci id="alg1.l1.m1.3.3.cmml" xref="alg1.l1.m1.3.3">𝑦</ci></interval><ci id="alg1.l1.m1.4.4.1.1.1.1.1.3.cmml" xref="alg1.l1.m1.4.4.1.1.1.1.1.3">𝑖</ci></apply></set><apply id="alg1.l1.m1.4.4.1.1.3.cmml" xref="alg1.l1.m1.4.4.1.1.3"><eq id="alg1.l1.m1.4.4.1.1.3.1.cmml" xref="alg1.l1.m1.4.4.1.1.3.1"></eq><ci id="alg1.l1.m1.4.4.1.1.3.2.cmml" xref="alg1.l1.m1.4.4.1.1.3.2">𝑖</ci><cn id="alg1.l1.m1.4.4.1.1.3.3.cmml" type="integer" xref="alg1.l1.m1.4.4.1.1.3.3">1</cn></apply></apply><apply id="alg1.l1.m1.1.1.1.2.cmml" xref="alg1.l1.m1.1.1.1.3"><abs id="alg1.l1.m1.1.1.1.2.1.cmml" xref="alg1.l1.m1.1.1.1.3.1"></abs><ci id="alg1.l1.m1.1.1.1.1.cmml" xref="alg1.l1.m1.1.1.1.1">𝒟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.4c">\mathcal{D}=\{(x,y)_{i}\}_{i=1}^{|\mathcal{D}|}</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.4d">caligraphic_D = { ( italic_x , italic_y ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT | caligraphic_D | end_POSTSUPERSCRIPT</annotation></semantics></math>, latent variable <math alttext="z" class="ltx_Math" display="inline" id="alg1.l1.m2.1"><semantics id="alg1.l1.m2.1a"><mi id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><ci id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">z</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m2.1d">italic_z</annotation></semantics></math>, demonstration pool <math alttext="\mathcal{P}" class="ltx_Math" display="inline" id="alg1.l1.m3.1"><semantics id="alg1.l1.m3.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.l1.m3.1.1" xref="alg1.l1.m3.1.1.cmml">𝒫</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m3.1b"><ci id="alg1.l1.m3.1.1.cmml" xref="alg1.l1.m3.1.1">𝒫</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m3.1c">\mathcal{P}</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m3.1d">caligraphic_P</annotation></semantics></math>, and learning rates <math alttext="\eta_{1},\eta_{2}" class="ltx_Math" display="inline" id="alg1.l1.m4.2"><semantics id="alg1.l1.m4.2a"><mrow id="alg1.l1.m4.2.2.2" xref="alg1.l1.m4.2.2.3.cmml"><msub id="alg1.l1.m4.1.1.1.1" xref="alg1.l1.m4.1.1.1.1.cmml"><mi id="alg1.l1.m4.1.1.1.1.2" xref="alg1.l1.m4.1.1.1.1.2.cmml">η</mi><mn id="alg1.l1.m4.1.1.1.1.3" xref="alg1.l1.m4.1.1.1.1.3.cmml">1</mn></msub><mo id="alg1.l1.m4.2.2.2.3" xref="alg1.l1.m4.2.2.3.cmml">,</mo><msub id="alg1.l1.m4.2.2.2.2" xref="alg1.l1.m4.2.2.2.2.cmml"><mi id="alg1.l1.m4.2.2.2.2.2" xref="alg1.l1.m4.2.2.2.2.2.cmml">η</mi><mn id="alg1.l1.m4.2.2.2.2.3" xref="alg1.l1.m4.2.2.2.2.3.cmml">2</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="alg1.l1.m4.2b"><list id="alg1.l1.m4.2.2.3.cmml" xref="alg1.l1.m4.2.2.2"><apply id="alg1.l1.m4.1.1.1.1.cmml" xref="alg1.l1.m4.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l1.m4.1.1.1.1.1.cmml" xref="alg1.l1.m4.1.1.1.1">subscript</csymbol><ci id="alg1.l1.m4.1.1.1.1.2.cmml" xref="alg1.l1.m4.1.1.1.1.2">𝜂</ci><cn id="alg1.l1.m4.1.1.1.1.3.cmml" type="integer" xref="alg1.l1.m4.1.1.1.1.3">1</cn></apply><apply id="alg1.l1.m4.2.2.2.2.cmml" xref="alg1.l1.m4.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l1.m4.2.2.2.2.1.cmml" xref="alg1.l1.m4.2.2.2.2">subscript</csymbol><ci id="alg1.l1.m4.2.2.2.2.2.cmml" xref="alg1.l1.m4.2.2.2.2.2">𝜂</ci><cn id="alg1.l1.m4.2.2.2.2.3.cmml" type="integer" xref="alg1.l1.m4.2.2.2.2.3">2</cn></apply></list></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m4.2c">\eta_{1},\eta_{2}</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m4.2d">italic_η start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline">2:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l2.1">Initialization</span>: Parameters <math alttext="\theta" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><mi id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><ci id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_θ</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline">3:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l3.1">for</span> each <math alttext="(x,y)" class="ltx_Math" display="inline" id="alg1.l3.m1.2"><semantics id="alg1.l3.m1.2a"><mrow id="alg1.l3.m1.2.3.2" xref="alg1.l3.m1.2.3.1.cmml"><mo id="alg1.l3.m1.2.3.2.1" stretchy="false" xref="alg1.l3.m1.2.3.1.cmml">(</mo><mi id="alg1.l3.m1.1.1" xref="alg1.l3.m1.1.1.cmml">x</mi><mo id="alg1.l3.m1.2.3.2.2" xref="alg1.l3.m1.2.3.1.cmml">,</mo><mi id="alg1.l3.m1.2.2" xref="alg1.l3.m1.2.2.cmml">y</mi><mo id="alg1.l3.m1.2.3.2.3" stretchy="false" xref="alg1.l3.m1.2.3.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.2b"><interval closure="open" id="alg1.l3.m1.2.3.1.cmml" xref="alg1.l3.m1.2.3.2"><ci id="alg1.l3.m1.1.1.cmml" xref="alg1.l3.m1.1.1">𝑥</ci><ci id="alg1.l3.m1.2.2.cmml" xref="alg1.l3.m1.2.2">𝑦</ci></interval></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.2c">(x,y)</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.2d">( italic_x , italic_y )</annotation></semantics></math> in task <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="alg1.l3.m2.1"><semantics id="alg1.l3.m2.1a"><mi class="ltx_font_mathcaligraphic" id="alg1.l3.m2.1.1" xref="alg1.l3.m2.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="alg1.l3.m2.1b"><ci id="alg1.l3.m2.1.1.cmml" xref="alg1.l3.m2.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m2.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m2.1d">caligraphic_D</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l3.2">do</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline">4:</span>     Calculate demonstration scores by Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E5" title="In The First Stage. ‣ 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">5</span></a>), and identify preferred demonstrations <math alttext="(x_{k},y_{k})_{w}" class="ltx_Math" display="inline" id="alg1.l4.m1.2"><semantics id="alg1.l4.m1.2a"><msub id="alg1.l4.m1.2.2" xref="alg1.l4.m1.2.2.cmml"><mrow id="alg1.l4.m1.2.2.2.2" xref="alg1.l4.m1.2.2.2.3.cmml"><mo id="alg1.l4.m1.2.2.2.2.3" stretchy="false" xref="alg1.l4.m1.2.2.2.3.cmml">(</mo><msub id="alg1.l4.m1.1.1.1.1.1" xref="alg1.l4.m1.1.1.1.1.1.cmml"><mi id="alg1.l4.m1.1.1.1.1.1.2" xref="alg1.l4.m1.1.1.1.1.1.2.cmml">x</mi><mi id="alg1.l4.m1.1.1.1.1.1.3" xref="alg1.l4.m1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="alg1.l4.m1.2.2.2.2.4" xref="alg1.l4.m1.2.2.2.3.cmml">,</mo><msub id="alg1.l4.m1.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.cmml"><mi id="alg1.l4.m1.2.2.2.2.2.2" xref="alg1.l4.m1.2.2.2.2.2.2.cmml">y</mi><mi id="alg1.l4.m1.2.2.2.2.2.3" xref="alg1.l4.m1.2.2.2.2.2.3.cmml">k</mi></msub><mo id="alg1.l4.m1.2.2.2.2.5" stretchy="false" xref="alg1.l4.m1.2.2.2.3.cmml">)</mo></mrow><mi id="alg1.l4.m1.2.2.4" xref="alg1.l4.m1.2.2.4.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.2b"><apply id="alg1.l4.m1.2.2.cmml" xref="alg1.l4.m1.2.2"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.3.cmml" xref="alg1.l4.m1.2.2">subscript</csymbol><interval closure="open" id="alg1.l4.m1.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2"><apply id="alg1.l4.m1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1.1.1">subscript</csymbol><ci id="alg1.l4.m1.1.1.1.1.1.2.cmml" xref="alg1.l4.m1.1.1.1.1.1.2">𝑥</ci><ci id="alg1.l4.m1.1.1.1.1.1.3.cmml" xref="alg1.l4.m1.1.1.1.1.1.3">𝑘</ci></apply><apply id="alg1.l4.m1.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l4.m1.2.2.2.2.2.1.cmml" xref="alg1.l4.m1.2.2.2.2.2">subscript</csymbol><ci id="alg1.l4.m1.2.2.2.2.2.2.cmml" xref="alg1.l4.m1.2.2.2.2.2.2">𝑦</ci><ci id="alg1.l4.m1.2.2.2.2.2.3.cmml" xref="alg1.l4.m1.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="alg1.l4.m1.2.2.4.cmml" xref="alg1.l4.m1.2.2.4">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.2c">(x_{k},y_{k})_{w}</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> and non-preferred ones <math alttext="(x_{k},y_{k})_{l}" class="ltx_Math" display="inline" id="alg1.l4.m2.2"><semantics id="alg1.l4.m2.2a"><msub id="alg1.l4.m2.2.2" xref="alg1.l4.m2.2.2.cmml"><mrow id="alg1.l4.m2.2.2.2.2" xref="alg1.l4.m2.2.2.2.3.cmml"><mo id="alg1.l4.m2.2.2.2.2.3" stretchy="false" xref="alg1.l4.m2.2.2.2.3.cmml">(</mo><msub id="alg1.l4.m2.1.1.1.1.1" xref="alg1.l4.m2.1.1.1.1.1.cmml"><mi id="alg1.l4.m2.1.1.1.1.1.2" xref="alg1.l4.m2.1.1.1.1.1.2.cmml">x</mi><mi id="alg1.l4.m2.1.1.1.1.1.3" xref="alg1.l4.m2.1.1.1.1.1.3.cmml">k</mi></msub><mo id="alg1.l4.m2.2.2.2.2.4" xref="alg1.l4.m2.2.2.2.3.cmml">,</mo><msub id="alg1.l4.m2.2.2.2.2.2" xref="alg1.l4.m2.2.2.2.2.2.cmml"><mi id="alg1.l4.m2.2.2.2.2.2.2" xref="alg1.l4.m2.2.2.2.2.2.2.cmml">y</mi><mi id="alg1.l4.m2.2.2.2.2.2.3" xref="alg1.l4.m2.2.2.2.2.2.3.cmml">k</mi></msub><mo id="alg1.l4.m2.2.2.2.2.5" stretchy="false" xref="alg1.l4.m2.2.2.2.3.cmml">)</mo></mrow><mi id="alg1.l4.m2.2.2.4" xref="alg1.l4.m2.2.2.4.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l4.m2.2b"><apply id="alg1.l4.m2.2.2.cmml" xref="alg1.l4.m2.2.2"><csymbol cd="ambiguous" id="alg1.l4.m2.2.2.3.cmml" xref="alg1.l4.m2.2.2">subscript</csymbol><interval closure="open" id="alg1.l4.m2.2.2.2.3.cmml" xref="alg1.l4.m2.2.2.2.2"><apply id="alg1.l4.m2.1.1.1.1.1.cmml" xref="alg1.l4.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l4.m2.1.1.1.1.1.1.cmml" xref="alg1.l4.m2.1.1.1.1.1">subscript</csymbol><ci id="alg1.l4.m2.1.1.1.1.1.2.cmml" xref="alg1.l4.m2.1.1.1.1.1.2">𝑥</ci><ci id="alg1.l4.m2.1.1.1.1.1.3.cmml" xref="alg1.l4.m2.1.1.1.1.1.3">𝑘</ci></apply><apply id="alg1.l4.m2.2.2.2.2.2.cmml" xref="alg1.l4.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l4.m2.2.2.2.2.2.1.cmml" xref="alg1.l4.m2.2.2.2.2.2">subscript</csymbol><ci id="alg1.l4.m2.2.2.2.2.2.2.cmml" xref="alg1.l4.m2.2.2.2.2.2.2">𝑦</ci><ci id="alg1.l4.m2.2.2.2.2.2.3.cmml" xref="alg1.l4.m2.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="alg1.l4.m2.2.2.4.cmml" xref="alg1.l4.m2.2.2.4">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m2.2c">(x_{k},y_{k})_{l}</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m2.2d">( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline">5:</span>     Compute demonstration-level loss <math alttext="\mathcal{L}_{d}(\theta)" class="ltx_Math" display="inline" id="alg1.l5.m1.1"><semantics id="alg1.l5.m1.1a"><mrow id="alg1.l5.m1.1.2" xref="alg1.l5.m1.1.2.cmml"><msub id="alg1.l5.m1.1.2.2" xref="alg1.l5.m1.1.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l5.m1.1.2.2.2" xref="alg1.l5.m1.1.2.2.2.cmml">ℒ</mi><mi id="alg1.l5.m1.1.2.2.3" xref="alg1.l5.m1.1.2.2.3.cmml">d</mi></msub><mo id="alg1.l5.m1.1.2.1" xref="alg1.l5.m1.1.2.1.cmml">⁢</mo><mrow id="alg1.l5.m1.1.2.3.2" xref="alg1.l5.m1.1.2.cmml"><mo id="alg1.l5.m1.1.2.3.2.1" stretchy="false" xref="alg1.l5.m1.1.2.cmml">(</mo><mi id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml">θ</mi><mo id="alg1.l5.m1.1.2.3.2.2" stretchy="false" xref="alg1.l5.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.1b"><apply id="alg1.l5.m1.1.2.cmml" xref="alg1.l5.m1.1.2"><times id="alg1.l5.m1.1.2.1.cmml" xref="alg1.l5.m1.1.2.1"></times><apply id="alg1.l5.m1.1.2.2.cmml" xref="alg1.l5.m1.1.2.2"><csymbol cd="ambiguous" id="alg1.l5.m1.1.2.2.1.cmml" xref="alg1.l5.m1.1.2.2">subscript</csymbol><ci id="alg1.l5.m1.1.2.2.2.cmml" xref="alg1.l5.m1.1.2.2.2">ℒ</ci><ci id="alg1.l5.m1.1.2.2.3.cmml" xref="alg1.l5.m1.1.2.2.3">𝑑</ci></apply><ci id="alg1.l5.m1.1.1.cmml" xref="alg1.l5.m1.1.1">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.1c">\mathcal{L}_{d}(\theta)</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.1d">caligraphic_L start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math> by Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E6" title="In The First Stage. ‣ 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">6</span></a>) 
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline">6:</span>     Update <math alttext="\theta\leftarrow\theta-\eta_{1}\nabla_{\theta}\mathcal{L}_{d}(\theta)" class="ltx_Math" display="inline" id="alg1.l6.m1.1"><semantics id="alg1.l6.m1.1a"><mrow id="alg1.l6.m1.1.2" xref="alg1.l6.m1.1.2.cmml"><mi id="alg1.l6.m1.1.2.2" xref="alg1.l6.m1.1.2.2.cmml">θ</mi><mo id="alg1.l6.m1.1.2.1" stretchy="false" xref="alg1.l6.m1.1.2.1.cmml">←</mo><mrow id="alg1.l6.m1.1.2.3" xref="alg1.l6.m1.1.2.3.cmml"><mi id="alg1.l6.m1.1.2.3.2" xref="alg1.l6.m1.1.2.3.2.cmml">θ</mi><mo id="alg1.l6.m1.1.2.3.1" xref="alg1.l6.m1.1.2.3.1.cmml">−</mo><mrow id="alg1.l6.m1.1.2.3.3" xref="alg1.l6.m1.1.2.3.3.cmml"><msub id="alg1.l6.m1.1.2.3.3.2" xref="alg1.l6.m1.1.2.3.3.2.cmml"><mi id="alg1.l6.m1.1.2.3.3.2.2" xref="alg1.l6.m1.1.2.3.3.2.2.cmml">η</mi><mn id="alg1.l6.m1.1.2.3.3.2.3" xref="alg1.l6.m1.1.2.3.3.2.3.cmml">1</mn></msub><mo id="alg1.l6.m1.1.2.3.3.1" lspace="0.167em" xref="alg1.l6.m1.1.2.3.3.1.cmml">⁢</mo><mrow id="alg1.l6.m1.1.2.3.3.3" xref="alg1.l6.m1.1.2.3.3.3.cmml"><msub id="alg1.l6.m1.1.2.3.3.3.1" xref="alg1.l6.m1.1.2.3.3.3.1.cmml"><mo id="alg1.l6.m1.1.2.3.3.3.1.2" rspace="0.167em" xref="alg1.l6.m1.1.2.3.3.3.1.2.cmml">∇</mo><mi id="alg1.l6.m1.1.2.3.3.3.1.3" xref="alg1.l6.m1.1.2.3.3.3.1.3.cmml">θ</mi></msub><msub id="alg1.l6.m1.1.2.3.3.3.2" xref="alg1.l6.m1.1.2.3.3.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l6.m1.1.2.3.3.3.2.2" xref="alg1.l6.m1.1.2.3.3.3.2.2.cmml">ℒ</mi><mi id="alg1.l6.m1.1.2.3.3.3.2.3" xref="alg1.l6.m1.1.2.3.3.3.2.3.cmml">d</mi></msub></mrow><mo id="alg1.l6.m1.1.2.3.3.1a" xref="alg1.l6.m1.1.2.3.3.1.cmml">⁢</mo><mrow id="alg1.l6.m1.1.2.3.3.4.2" xref="alg1.l6.m1.1.2.3.3.cmml"><mo id="alg1.l6.m1.1.2.3.3.4.2.1" stretchy="false" xref="alg1.l6.m1.1.2.3.3.cmml">(</mo><mi id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml">θ</mi><mo id="alg1.l6.m1.1.2.3.3.4.2.2" stretchy="false" xref="alg1.l6.m1.1.2.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.1b"><apply id="alg1.l6.m1.1.2.cmml" xref="alg1.l6.m1.1.2"><ci id="alg1.l6.m1.1.2.1.cmml" xref="alg1.l6.m1.1.2.1">←</ci><ci id="alg1.l6.m1.1.2.2.cmml" xref="alg1.l6.m1.1.2.2">𝜃</ci><apply id="alg1.l6.m1.1.2.3.cmml" xref="alg1.l6.m1.1.2.3"><minus id="alg1.l6.m1.1.2.3.1.cmml" xref="alg1.l6.m1.1.2.3.1"></minus><ci id="alg1.l6.m1.1.2.3.2.cmml" xref="alg1.l6.m1.1.2.3.2">𝜃</ci><apply id="alg1.l6.m1.1.2.3.3.cmml" xref="alg1.l6.m1.1.2.3.3"><times id="alg1.l6.m1.1.2.3.3.1.cmml" xref="alg1.l6.m1.1.2.3.3.1"></times><apply id="alg1.l6.m1.1.2.3.3.2.cmml" xref="alg1.l6.m1.1.2.3.3.2"><csymbol cd="ambiguous" id="alg1.l6.m1.1.2.3.3.2.1.cmml" xref="alg1.l6.m1.1.2.3.3.2">subscript</csymbol><ci id="alg1.l6.m1.1.2.3.3.2.2.cmml" xref="alg1.l6.m1.1.2.3.3.2.2">𝜂</ci><cn id="alg1.l6.m1.1.2.3.3.2.3.cmml" type="integer" xref="alg1.l6.m1.1.2.3.3.2.3">1</cn></apply><apply id="alg1.l6.m1.1.2.3.3.3.cmml" xref="alg1.l6.m1.1.2.3.3.3"><apply id="alg1.l6.m1.1.2.3.3.3.1.cmml" xref="alg1.l6.m1.1.2.3.3.3.1"><csymbol cd="ambiguous" id="alg1.l6.m1.1.2.3.3.3.1.1.cmml" xref="alg1.l6.m1.1.2.3.3.3.1">subscript</csymbol><ci id="alg1.l6.m1.1.2.3.3.3.1.2.cmml" xref="alg1.l6.m1.1.2.3.3.3.1.2">∇</ci><ci id="alg1.l6.m1.1.2.3.3.3.1.3.cmml" xref="alg1.l6.m1.1.2.3.3.3.1.3">𝜃</ci></apply><apply id="alg1.l6.m1.1.2.3.3.3.2.cmml" xref="alg1.l6.m1.1.2.3.3.3.2"><csymbol cd="ambiguous" id="alg1.l6.m1.1.2.3.3.3.2.1.cmml" xref="alg1.l6.m1.1.2.3.3.3.2">subscript</csymbol><ci id="alg1.l6.m1.1.2.3.3.3.2.2.cmml" xref="alg1.l6.m1.1.2.3.3.3.2.2">ℒ</ci><ci id="alg1.l6.m1.1.2.3.3.3.2.3.cmml" xref="alg1.l6.m1.1.2.3.3.3.2.3">𝑑</ci></apply></apply><ci id="alg1.l6.m1.1.1.cmml" xref="alg1.l6.m1.1.1">𝜃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.1c">\theta\leftarrow\theta-\eta_{1}\nabla_{\theta}\mathcal{L}_{d}(\theta)</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.1d">italic_θ ← italic_θ - italic_η start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT italic_d end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline">7:</span>     Set the correct answer as <math alttext="y_{w}=y" class="ltx_Math" display="inline" id="alg1.l7.m1.1"><semantics id="alg1.l7.m1.1a"><mrow id="alg1.l7.m1.1.1" xref="alg1.l7.m1.1.1.cmml"><msub id="alg1.l7.m1.1.1.2" xref="alg1.l7.m1.1.1.2.cmml"><mi id="alg1.l7.m1.1.1.2.2" xref="alg1.l7.m1.1.1.2.2.cmml">y</mi><mi id="alg1.l7.m1.1.1.2.3" xref="alg1.l7.m1.1.1.2.3.cmml">w</mi></msub><mo id="alg1.l7.m1.1.1.1" xref="alg1.l7.m1.1.1.1.cmml">=</mo><mi id="alg1.l7.m1.1.1.3" xref="alg1.l7.m1.1.1.3.cmml">y</mi></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.1b"><apply id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1"><eq id="alg1.l7.m1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1"></eq><apply id="alg1.l7.m1.1.1.2.cmml" xref="alg1.l7.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l7.m1.1.1.2.1.cmml" xref="alg1.l7.m1.1.1.2">subscript</csymbol><ci id="alg1.l7.m1.1.1.2.2.cmml" xref="alg1.l7.m1.1.1.2.2">𝑦</ci><ci id="alg1.l7.m1.1.1.2.3.cmml" xref="alg1.l7.m1.1.1.2.3">𝑤</ci></apply><ci id="alg1.l7.m1.1.1.3.cmml" xref="alg1.l7.m1.1.1.3">𝑦</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.1c">y_{w}=y</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m1.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT = italic_y</annotation></semantics></math>, and select an incorrect answer <math alttext="y_{l}" class="ltx_Math" display="inline" id="alg1.l7.m2.1"><semantics id="alg1.l7.m2.1a"><msub id="alg1.l7.m2.1.1" xref="alg1.l7.m2.1.1.cmml"><mi id="alg1.l7.m2.1.1.2" xref="alg1.l7.m2.1.1.2.cmml">y</mi><mi id="alg1.l7.m2.1.1.3" xref="alg1.l7.m2.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="alg1.l7.m2.1b"><apply id="alg1.l7.m2.1.1.cmml" xref="alg1.l7.m2.1.1"><csymbol cd="ambiguous" id="alg1.l7.m2.1.1.1.cmml" xref="alg1.l7.m2.1.1">subscript</csymbol><ci id="alg1.l7.m2.1.1.2.cmml" xref="alg1.l7.m2.1.1.2">𝑦</ci><ci id="alg1.l7.m2.1.1.3.cmml" xref="alg1.l7.m2.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m2.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m2.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline">8:</span>     Compute answer-level loss <math alttext="\mathcal{L}_{a}(\theta)" class="ltx_Math" display="inline" id="alg1.l8.m1.1"><semantics id="alg1.l8.m1.1a"><mrow id="alg1.l8.m1.1.2" xref="alg1.l8.m1.1.2.cmml"><msub id="alg1.l8.m1.1.2.2" xref="alg1.l8.m1.1.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l8.m1.1.2.2.2" xref="alg1.l8.m1.1.2.2.2.cmml">ℒ</mi><mi id="alg1.l8.m1.1.2.2.3" xref="alg1.l8.m1.1.2.2.3.cmml">a</mi></msub><mo id="alg1.l8.m1.1.2.1" xref="alg1.l8.m1.1.2.1.cmml">⁢</mo><mrow id="alg1.l8.m1.1.2.3.2" xref="alg1.l8.m1.1.2.cmml"><mo id="alg1.l8.m1.1.2.3.2.1" stretchy="false" xref="alg1.l8.m1.1.2.cmml">(</mo><mi id="alg1.l8.m1.1.1" xref="alg1.l8.m1.1.1.cmml">θ</mi><mo id="alg1.l8.m1.1.2.3.2.2" stretchy="false" xref="alg1.l8.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.1b"><apply id="alg1.l8.m1.1.2.cmml" xref="alg1.l8.m1.1.2"><times id="alg1.l8.m1.1.2.1.cmml" xref="alg1.l8.m1.1.2.1"></times><apply id="alg1.l8.m1.1.2.2.cmml" xref="alg1.l8.m1.1.2.2"><csymbol cd="ambiguous" id="alg1.l8.m1.1.2.2.1.cmml" xref="alg1.l8.m1.1.2.2">subscript</csymbol><ci id="alg1.l8.m1.1.2.2.2.cmml" xref="alg1.l8.m1.1.2.2.2">ℒ</ci><ci id="alg1.l8.m1.1.2.2.3.cmml" xref="alg1.l8.m1.1.2.2.3">𝑎</ci></apply><ci id="alg1.l8.m1.1.1.cmml" xref="alg1.l8.m1.1.1">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.1c">\mathcal{L}_{a}(\theta)</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.m1.1d">caligraphic_L start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math> by Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E8" title="In The Second Stage. ‣ 3.3 Demonstration Preference Learning ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">8</span></a>) 
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline">9:</span>     Update <math alttext="\theta\leftarrow\theta-\eta_{2}\nabla_{\theta}\mathcal{L}_{a}(\theta)" class="ltx_Math" display="inline" id="alg1.l9.m1.1"><semantics id="alg1.l9.m1.1a"><mrow id="alg1.l9.m1.1.2" xref="alg1.l9.m1.1.2.cmml"><mi id="alg1.l9.m1.1.2.2" xref="alg1.l9.m1.1.2.2.cmml">θ</mi><mo id="alg1.l9.m1.1.2.1" stretchy="false" xref="alg1.l9.m1.1.2.1.cmml">←</mo><mrow id="alg1.l9.m1.1.2.3" xref="alg1.l9.m1.1.2.3.cmml"><mi id="alg1.l9.m1.1.2.3.2" xref="alg1.l9.m1.1.2.3.2.cmml">θ</mi><mo id="alg1.l9.m1.1.2.3.1" xref="alg1.l9.m1.1.2.3.1.cmml">−</mo><mrow id="alg1.l9.m1.1.2.3.3" xref="alg1.l9.m1.1.2.3.3.cmml"><msub id="alg1.l9.m1.1.2.3.3.2" xref="alg1.l9.m1.1.2.3.3.2.cmml"><mi id="alg1.l9.m1.1.2.3.3.2.2" xref="alg1.l9.m1.1.2.3.3.2.2.cmml">η</mi><mn id="alg1.l9.m1.1.2.3.3.2.3" xref="alg1.l9.m1.1.2.3.3.2.3.cmml">2</mn></msub><mo id="alg1.l9.m1.1.2.3.3.1" lspace="0.167em" xref="alg1.l9.m1.1.2.3.3.1.cmml">⁢</mo><mrow id="alg1.l9.m1.1.2.3.3.3" xref="alg1.l9.m1.1.2.3.3.3.cmml"><msub id="alg1.l9.m1.1.2.3.3.3.1" xref="alg1.l9.m1.1.2.3.3.3.1.cmml"><mo id="alg1.l9.m1.1.2.3.3.3.1.2" rspace="0.167em" xref="alg1.l9.m1.1.2.3.3.3.1.2.cmml">∇</mo><mi id="alg1.l9.m1.1.2.3.3.3.1.3" xref="alg1.l9.m1.1.2.3.3.3.1.3.cmml">θ</mi></msub><msub id="alg1.l9.m1.1.2.3.3.3.2" xref="alg1.l9.m1.1.2.3.3.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="alg1.l9.m1.1.2.3.3.3.2.2" xref="alg1.l9.m1.1.2.3.3.3.2.2.cmml">ℒ</mi><mi id="alg1.l9.m1.1.2.3.3.3.2.3" xref="alg1.l9.m1.1.2.3.3.3.2.3.cmml">a</mi></msub></mrow><mo id="alg1.l9.m1.1.2.3.3.1a" xref="alg1.l9.m1.1.2.3.3.1.cmml">⁢</mo><mrow id="alg1.l9.m1.1.2.3.3.4.2" xref="alg1.l9.m1.1.2.3.3.cmml"><mo id="alg1.l9.m1.1.2.3.3.4.2.1" stretchy="false" xref="alg1.l9.m1.1.2.3.3.cmml">(</mo><mi id="alg1.l9.m1.1.1" xref="alg1.l9.m1.1.1.cmml">θ</mi><mo id="alg1.l9.m1.1.2.3.3.4.2.2" stretchy="false" xref="alg1.l9.m1.1.2.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l9.m1.1b"><apply id="alg1.l9.m1.1.2.cmml" xref="alg1.l9.m1.1.2"><ci id="alg1.l9.m1.1.2.1.cmml" xref="alg1.l9.m1.1.2.1">←</ci><ci id="alg1.l9.m1.1.2.2.cmml" xref="alg1.l9.m1.1.2.2">𝜃</ci><apply id="alg1.l9.m1.1.2.3.cmml" xref="alg1.l9.m1.1.2.3"><minus id="alg1.l9.m1.1.2.3.1.cmml" xref="alg1.l9.m1.1.2.3.1"></minus><ci id="alg1.l9.m1.1.2.3.2.cmml" xref="alg1.l9.m1.1.2.3.2">𝜃</ci><apply id="alg1.l9.m1.1.2.3.3.cmml" xref="alg1.l9.m1.1.2.3.3"><times id="alg1.l9.m1.1.2.3.3.1.cmml" xref="alg1.l9.m1.1.2.3.3.1"></times><apply id="alg1.l9.m1.1.2.3.3.2.cmml" xref="alg1.l9.m1.1.2.3.3.2"><csymbol cd="ambiguous" id="alg1.l9.m1.1.2.3.3.2.1.cmml" xref="alg1.l9.m1.1.2.3.3.2">subscript</csymbol><ci id="alg1.l9.m1.1.2.3.3.2.2.cmml" xref="alg1.l9.m1.1.2.3.3.2.2">𝜂</ci><cn id="alg1.l9.m1.1.2.3.3.2.3.cmml" type="integer" xref="alg1.l9.m1.1.2.3.3.2.3">2</cn></apply><apply id="alg1.l9.m1.1.2.3.3.3.cmml" xref="alg1.l9.m1.1.2.3.3.3"><apply id="alg1.l9.m1.1.2.3.3.3.1.cmml" xref="alg1.l9.m1.1.2.3.3.3.1"><csymbol cd="ambiguous" id="alg1.l9.m1.1.2.3.3.3.1.1.cmml" xref="alg1.l9.m1.1.2.3.3.3.1">subscript</csymbol><ci id="alg1.l9.m1.1.2.3.3.3.1.2.cmml" xref="alg1.l9.m1.1.2.3.3.3.1.2">∇</ci><ci id="alg1.l9.m1.1.2.3.3.3.1.3.cmml" xref="alg1.l9.m1.1.2.3.3.3.1.3">𝜃</ci></apply><apply id="alg1.l9.m1.1.2.3.3.3.2.cmml" xref="alg1.l9.m1.1.2.3.3.3.2"><csymbol cd="ambiguous" id="alg1.l9.m1.1.2.3.3.3.2.1.cmml" xref="alg1.l9.m1.1.2.3.3.3.2">subscript</csymbol><ci id="alg1.l9.m1.1.2.3.3.3.2.2.cmml" xref="alg1.l9.m1.1.2.3.3.3.2.2">ℒ</ci><ci id="alg1.l9.m1.1.2.3.3.3.2.3.cmml" xref="alg1.l9.m1.1.2.3.3.3.2.3">𝑎</ci></apply></apply><ci id="alg1.l9.m1.1.1.cmml" xref="alg1.l9.m1.1.1">𝜃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l9.m1.1c">\theta\leftarrow\theta-\eta_{2}\nabla_{\theta}\mathcal{L}_{a}(\theta)</annotation><annotation encoding="application/x-llamapun" id="alg1.l9.m1.1d">italic_θ ← italic_θ - italic_η start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT italic_a end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l10">
<span class="ltx_tag ltx_tag_listingline">10:</span>  <span class="ltx_text ltx_font_bold" id="alg1.l10.1">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l10.2">for</span>
</div>
</div>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.3.1.1">Algorithm 1</span> </span>Demonstration Preference Learning</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>Demonstration Selection in Inference</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.7">In the training stage, we optimize the parameters <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS4.p1.1.m1.1"><semantics id="S3.SS4.p1.1.m1.1a"><mi id="S3.SS4.p1.1.m1.1.1" xref="S3.SS4.p1.1.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.1.m1.1b"><ci id="S3.SS4.p1.1.m1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.1.m1.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.1.m1.1d">italic_θ</annotation></semantics></math> to obtain the variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS4.p1.2.m2.1"><semantics id="S3.SS4.p1.2.m2.1a"><mi id="S3.SS4.p1.2.m2.1.1" xref="S3.SS4.p1.2.m2.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.2.m2.1b"><ci id="S3.SS4.p1.2.m2.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.2.m2.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.2.m2.1d">italic_z</annotation></semantics></math> of the demonstration preference of the LLM.
In the inference stage, we first use E5<sub class="ltx_sub" id="S3.SS4.p1.7.1">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite> to reduce the search space and time cost of demonstration selection.
Then we leverage the LLM with the latent variable <math alttext="z" class="ltx_Math" display="inline" id="S3.SS4.p1.3.m3.1"><semantics id="S3.SS4.p1.3.m3.1a"><mi id="S3.SS4.p1.3.m3.1.1" xref="S3.SS4.p1.3.m3.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.3.m3.1b"><ci id="S3.SS4.p1.3.m3.1.1.cmml" xref="S3.SS4.p1.3.m3.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.3.m3.1c">z</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.3.m3.1d">italic_z</annotation></semantics></math> to select demonstrations for an input query <math alttext="x_{\text{test}}" class="ltx_Math" display="inline" id="S3.SS4.p1.4.m4.1"><semantics id="S3.SS4.p1.4.m4.1a"><msub id="S3.SS4.p1.4.m4.1.1" xref="S3.SS4.p1.4.m4.1.1.cmml"><mi id="S3.SS4.p1.4.m4.1.1.2" xref="S3.SS4.p1.4.m4.1.1.2.cmml">x</mi><mtext id="S3.SS4.p1.4.m4.1.1.3" xref="S3.SS4.p1.4.m4.1.1.3a.cmml">test</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.4.m4.1b"><apply id="S3.SS4.p1.4.m4.1.1.cmml" xref="S3.SS4.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.4.m4.1.1.1.cmml" xref="S3.SS4.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS4.p1.4.m4.1.1.2.cmml" xref="S3.SS4.p1.4.m4.1.1.2">𝑥</ci><ci id="S3.SS4.p1.4.m4.1.1.3a.cmml" xref="S3.SS4.p1.4.m4.1.1.3"><mtext id="S3.SS4.p1.4.m4.1.1.3.cmml" mathsize="70%" xref="S3.SS4.p1.4.m4.1.1.3">test</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.4.m4.1c">x_{\text{test}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.4.m4.1d">italic_x start_POSTSUBSCRIPT test end_POSTSUBSCRIPT</annotation></semantics></math>. In Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E2" title="In 3.2 Optimization Objective ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">2</span></a>), for the same <math alttext="x" class="ltx_Math" display="inline" id="S3.SS4.p1.5.m5.1"><semantics id="S3.SS4.p1.5.m5.1a"><mi id="S3.SS4.p1.5.m5.1.1" xref="S3.SS4.p1.5.m5.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.5.m5.1b"><ci id="S3.SS4.p1.5.m5.1.1.cmml" xref="S3.SS4.p1.5.m5.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.5.m5.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.5.m5.1d">italic_x</annotation></semantics></math>, all demonstrations have the same <math alttext="P_{\mathcal{M}}(y\mid z,x)" class="ltx_Math" display="inline" id="S3.SS4.p1.6.m6.3"><semantics id="S3.SS4.p1.6.m6.3a"><mrow id="S3.SS4.p1.6.m6.3.3" xref="S3.SS4.p1.6.m6.3.3.cmml"><msub id="S3.SS4.p1.6.m6.3.3.3" xref="S3.SS4.p1.6.m6.3.3.3.cmml"><mi id="S3.SS4.p1.6.m6.3.3.3.2" xref="S3.SS4.p1.6.m6.3.3.3.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p1.6.m6.3.3.3.3" xref="S3.SS4.p1.6.m6.3.3.3.3.cmml">ℳ</mi></msub><mo id="S3.SS4.p1.6.m6.3.3.2" xref="S3.SS4.p1.6.m6.3.3.2.cmml">⁢</mo><mrow id="S3.SS4.p1.6.m6.3.3.1.1" xref="S3.SS4.p1.6.m6.3.3.1.1.1.cmml"><mo id="S3.SS4.p1.6.m6.3.3.1.1.2" stretchy="false" xref="S3.SS4.p1.6.m6.3.3.1.1.1.cmml">(</mo><mrow id="S3.SS4.p1.6.m6.3.3.1.1.1" xref="S3.SS4.p1.6.m6.3.3.1.1.1.cmml"><mi id="S3.SS4.p1.6.m6.3.3.1.1.1.2" xref="S3.SS4.p1.6.m6.3.3.1.1.1.2.cmml">y</mi><mo id="S3.SS4.p1.6.m6.3.3.1.1.1.1" xref="S3.SS4.p1.6.m6.3.3.1.1.1.1.cmml">∣</mo><mrow id="S3.SS4.p1.6.m6.3.3.1.1.1.3.2" xref="S3.SS4.p1.6.m6.3.3.1.1.1.3.1.cmml"><mi id="S3.SS4.p1.6.m6.1.1" xref="S3.SS4.p1.6.m6.1.1.cmml">z</mi><mo id="S3.SS4.p1.6.m6.3.3.1.1.1.3.2.1" xref="S3.SS4.p1.6.m6.3.3.1.1.1.3.1.cmml">,</mo><mi id="S3.SS4.p1.6.m6.2.2" xref="S3.SS4.p1.6.m6.2.2.cmml">x</mi></mrow></mrow><mo id="S3.SS4.p1.6.m6.3.3.1.1.3" stretchy="false" xref="S3.SS4.p1.6.m6.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.6.m6.3b"><apply id="S3.SS4.p1.6.m6.3.3.cmml" xref="S3.SS4.p1.6.m6.3.3"><times id="S3.SS4.p1.6.m6.3.3.2.cmml" xref="S3.SS4.p1.6.m6.3.3.2"></times><apply id="S3.SS4.p1.6.m6.3.3.3.cmml" xref="S3.SS4.p1.6.m6.3.3.3"><csymbol cd="ambiguous" id="S3.SS4.p1.6.m6.3.3.3.1.cmml" xref="S3.SS4.p1.6.m6.3.3.3">subscript</csymbol><ci id="S3.SS4.p1.6.m6.3.3.3.2.cmml" xref="S3.SS4.p1.6.m6.3.3.3.2">𝑃</ci><ci id="S3.SS4.p1.6.m6.3.3.3.3.cmml" xref="S3.SS4.p1.6.m6.3.3.3.3">ℳ</ci></apply><apply id="S3.SS4.p1.6.m6.3.3.1.1.1.cmml" xref="S3.SS4.p1.6.m6.3.3.1.1"><csymbol cd="latexml" id="S3.SS4.p1.6.m6.3.3.1.1.1.1.cmml" xref="S3.SS4.p1.6.m6.3.3.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p1.6.m6.3.3.1.1.1.2.cmml" xref="S3.SS4.p1.6.m6.3.3.1.1.1.2">𝑦</ci><list id="S3.SS4.p1.6.m6.3.3.1.1.1.3.1.cmml" xref="S3.SS4.p1.6.m6.3.3.1.1.1.3.2"><ci id="S3.SS4.p1.6.m6.1.1.cmml" xref="S3.SS4.p1.6.m6.1.1">𝑧</ci><ci id="S3.SS4.p1.6.m6.2.2.cmml" xref="S3.SS4.p1.6.m6.2.2">𝑥</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.6.m6.3c">P_{\mathcal{M}}(y\mid z,x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.6.m6.3d">italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y ∣ italic_z , italic_x )</annotation></semantics></math>.
Therefore, we select the top-<math alttext="K" class="ltx_Math" display="inline" id="S3.SS4.p1.7.m7.1"><semantics id="S3.SS4.p1.7.m7.1a"><mi id="S3.SS4.p1.7.m7.1.1" xref="S3.SS4.p1.7.m7.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.7.m7.1b"><ci id="S3.SS4.p1.7.m7.1.1.cmml" xref="S3.SS4.p1.7.m7.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.7.m7.1c">K</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.7.m7.1d">italic_K</annotation></semantics></math> demonstrations based on the probability of generating the latent variable, as shown below:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P_{\mathcal{M}}(z\mid(x_{k},y_{k}),x_{\text{test}})" class="ltx_Math" display="block" id="S3.E11.m1.1"><semantics id="S3.E11.m1.1a"><mrow id="S3.E11.m1.1.1" xref="S3.E11.m1.1.1.cmml"><msub id="S3.E11.m1.1.1.3" xref="S3.E11.m1.1.1.3.cmml"><mi id="S3.E11.m1.1.1.3.2" xref="S3.E11.m1.1.1.3.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="S3.E11.m1.1.1.3.3" xref="S3.E11.m1.1.1.3.3.cmml">ℳ</mi></msub><mo id="S3.E11.m1.1.1.2" xref="S3.E11.m1.1.1.2.cmml">⁢</mo><mrow id="S3.E11.m1.1.1.1.1" xref="S3.E11.m1.1.1.1.1.1.cmml"><mo id="S3.E11.m1.1.1.1.1.2" stretchy="false" xref="S3.E11.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E11.m1.1.1.1.1.1" xref="S3.E11.m1.1.1.1.1.1.cmml"><mi id="S3.E11.m1.1.1.1.1.1.4" xref="S3.E11.m1.1.1.1.1.1.4.cmml">z</mi><mo id="S3.E11.m1.1.1.1.1.1.3" xref="S3.E11.m1.1.1.1.1.1.3.cmml">∣</mo><mrow id="S3.E11.m1.1.1.1.1.1.2.2" xref="S3.E11.m1.1.1.1.1.1.2.3.cmml"><mrow id="S3.E11.m1.1.1.1.1.1.1.1.1.2" xref="S3.E11.m1.1.1.1.1.1.1.1.1.3.cmml"><mo id="S3.E11.m1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.E11.m1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.E11.m1.1.1.1.1.1.1.1.1.2.4" xref="S3.E11.m1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.2" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.3" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.E11.m1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.E11.m1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.E11.m1.1.1.1.1.1.2.2.3" xref="S3.E11.m1.1.1.1.1.1.2.3.cmml">,</mo><msub id="S3.E11.m1.1.1.1.1.1.2.2.2" xref="S3.E11.m1.1.1.1.1.1.2.2.2.cmml"><mi id="S3.E11.m1.1.1.1.1.1.2.2.2.2" xref="S3.E11.m1.1.1.1.1.1.2.2.2.2.cmml">x</mi><mtext id="S3.E11.m1.1.1.1.1.1.2.2.2.3" xref="S3.E11.m1.1.1.1.1.1.2.2.2.3a.cmml">test</mtext></msub></mrow></mrow><mo id="S3.E11.m1.1.1.1.1.3" stretchy="false" xref="S3.E11.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E11.m1.1b"><apply id="S3.E11.m1.1.1.cmml" xref="S3.E11.m1.1.1"><times id="S3.E11.m1.1.1.2.cmml" xref="S3.E11.m1.1.1.2"></times><apply id="S3.E11.m1.1.1.3.cmml" xref="S3.E11.m1.1.1.3"><csymbol cd="ambiguous" id="S3.E11.m1.1.1.3.1.cmml" xref="S3.E11.m1.1.1.3">subscript</csymbol><ci id="S3.E11.m1.1.1.3.2.cmml" xref="S3.E11.m1.1.1.3.2">𝑃</ci><ci id="S3.E11.m1.1.1.3.3.cmml" xref="S3.E11.m1.1.1.3.3">ℳ</ci></apply><apply id="S3.E11.m1.1.1.1.1.1.cmml" xref="S3.E11.m1.1.1.1.1"><csymbol cd="latexml" id="S3.E11.m1.1.1.1.1.1.3.cmml" xref="S3.E11.m1.1.1.1.1.1.3">conditional</csymbol><ci id="S3.E11.m1.1.1.1.1.1.4.cmml" xref="S3.E11.m1.1.1.1.1.1.4">𝑧</ci><list id="S3.E11.m1.1.1.1.1.1.2.3.cmml" xref="S3.E11.m1.1.1.1.1.1.2.2"><interval closure="open" id="S3.E11.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2"><apply id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.2">𝑦</ci><ci id="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E11.m1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval><apply id="S3.E11.m1.1.1.1.1.1.2.2.2.cmml" xref="S3.E11.m1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.E11.m1.1.1.1.1.1.2.2.2.1.cmml" xref="S3.E11.m1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S3.E11.m1.1.1.1.1.1.2.2.2.2.cmml" xref="S3.E11.m1.1.1.1.1.1.2.2.2.2">𝑥</ci><ci id="S3.E11.m1.1.1.1.1.1.2.2.2.3a.cmml" xref="S3.E11.m1.1.1.1.1.1.2.2.2.3"><mtext id="S3.E11.m1.1.1.1.1.1.2.2.2.3.cmml" mathsize="70%" xref="S3.E11.m1.1.1.1.1.1.2.2.2.3">test</mtext></ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E11.m1.1c">P_{\mathcal{M}}(z\mid(x_{k},y_{k}),x_{\text{test}})</annotation><annotation encoding="application/x-llamapun" id="S3.E11.m1.1d">italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_x start_POSTSUBSCRIPT test end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p1.8">After obtaining a set of demonstrations <math alttext="\{(X_{k},Y_{k})\}_{k=1}^{K}" class="ltx_Math" display="inline" id="S3.SS4.p1.8.m1.1"><semantics id="S3.SS4.p1.8.m1.1a"><msubsup id="S3.SS4.p1.8.m1.1.1" xref="S3.SS4.p1.8.m1.1.1.cmml"><mrow id="S3.SS4.p1.8.m1.1.1.1.1.1" xref="S3.SS4.p1.8.m1.1.1.1.1.2.cmml"><mo id="S3.SS4.p1.8.m1.1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p1.8.m1.1.1.1.1.2.cmml">{</mo><mrow id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.3.cmml"><mo id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.3" stretchy="false" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.3.cmml">(</mo><msub id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.2" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.3" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.4" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.3.cmml">,</mo><msub id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.cmml"><mi id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.2" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.3" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.5" stretchy="false" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="S3.SS4.p1.8.m1.1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p1.8.m1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S3.SS4.p1.8.m1.1.1.1.3" xref="S3.SS4.p1.8.m1.1.1.1.3.cmml"><mi id="S3.SS4.p1.8.m1.1.1.1.3.2" xref="S3.SS4.p1.8.m1.1.1.1.3.2.cmml">k</mi><mo id="S3.SS4.p1.8.m1.1.1.1.3.1" xref="S3.SS4.p1.8.m1.1.1.1.3.1.cmml">=</mo><mn id="S3.SS4.p1.8.m1.1.1.1.3.3" xref="S3.SS4.p1.8.m1.1.1.1.3.3.cmml">1</mn></mrow><mi id="S3.SS4.p1.8.m1.1.1.3" xref="S3.SS4.p1.8.m1.1.1.3.cmml">K</mi></msubsup><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.8.m1.1b"><apply id="S3.SS4.p1.8.m1.1.1.cmml" xref="S3.SS4.p1.8.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.8.m1.1.1.2.cmml" xref="S3.SS4.p1.8.m1.1.1">superscript</csymbol><apply id="S3.SS4.p1.8.m1.1.1.1.cmml" xref="S3.SS4.p1.8.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.8.m1.1.1.1.2.cmml" xref="S3.SS4.p1.8.m1.1.1">subscript</csymbol><set id="S3.SS4.p1.8.m1.1.1.1.1.2.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1"><interval closure="open" id="S3.SS4.p1.8.m1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2"><apply id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.SS4.p1.8.m1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="S3.SS4.p1.8.m1.1.1.1.3.cmml" xref="S3.SS4.p1.8.m1.1.1.1.3"><eq id="S3.SS4.p1.8.m1.1.1.1.3.1.cmml" xref="S3.SS4.p1.8.m1.1.1.1.3.1"></eq><ci id="S3.SS4.p1.8.m1.1.1.1.3.2.cmml" xref="S3.SS4.p1.8.m1.1.1.1.3.2">𝑘</ci><cn id="S3.SS4.p1.8.m1.1.1.1.3.3.cmml" type="integer" xref="S3.SS4.p1.8.m1.1.1.1.3.3">1</cn></apply></apply><ci id="S3.SS4.p1.8.m1.1.1.3.cmml" xref="S3.SS4.p1.8.m1.1.1.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.8.m1.1c">\{(X_{k},Y_{k})\}_{k=1}^{K}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.8.m1.1d">{ ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT</annotation></semantics></math>, we use the frozen LLM to perform in-context learning.
The entire training and inference pipeline is shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S2.F2" title="Figure 2 ‣ 2.2 Preference Learning ‣ 2 Related work ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Evaluations Setup</h3>
<section class="ltx_paragraph" id="S4.SS1.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Datasets.</h4>
<div class="ltx_para" id="S4.SS1.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS1.SSS0.Px1.p1.1">We validate the effectiveness of <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS0.Px1.p1.1.1">GenICL</span> across a range of language processing tasks including classification, multi-choice, and text generation.
The classification tasks include <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.2">Natural Language Inference</span> (RTE <cite class="ltx_cite ltx_citemacro_citep">(Wang, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib43" title="">2018</a>)</cite>, SNLI <cite class="ltx_cite ltx_citemacro_citep">(Bowman et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib2" title="">2015</a>)</cite>), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.3">Paraphrase</span> (PAWS <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib54" title="">2019</a>)</cite>, QQP <cite class="ltx_cite ltx_citemacro_citep">(Wang, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib43" title="">2018</a>)</cite>), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.4">Reading Comprehension</span> (MultiRC <cite class="ltx_cite ltx_citemacro_citep">(Khashabi et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib15" title="">2018</a>)</cite>, BoolQ <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib8" title="">2019</a>)</cite>)), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.5">Sentiment Classification</span>: (SST2 <cite class="ltx_cite ltx_citemacro_citep">(Socher et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib41" title="">2013</a>)</cite>, Sentiment140 <cite class="ltx_cite ltx_citemacro_citep">(Go et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib11" title="">2009</a>)</cite>), and <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.6">Topic Classification</span> (AGNews <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib53" title="">2015</a>)</cite>).
The multi-choice tasks cover <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.7">Commonsense Reasoning</span> (COPA <cite class="ltx_cite ltx_citemacro_citep">(Roemmele et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib37" title="">2011</a>)</cite>, HellaSwag <cite class="ltx_cite ltx_citemacro_citep">(Zellers et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib51" title="">2019</a>)</cite>, OpenBookQA <cite class="ltx_cite ltx_citemacro_citep">(Mihaylov et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib27" title="">2018</a>)</cite>), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.8">Coreference</span> (Winogrande <cite class="ltx_cite ltx_citemacro_citep">(Sakaguchi et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib39" title="">2021</a>)</cite>).
The text generation tasks contain <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.9">Close QA</span> (NaturalQuestions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib17" title="">2019</a>)</cite>, SQuAD v1 <cite class="ltx_cite ltx_citemacro_citep">(Rajpurkar, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib34" title="">2016</a>)</cite>), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.10">Commonsense Generation</span> (CommonGen <cite class="ltx_cite ltx_citemacro_citep">(Lin et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib21" title="">2019</a>)</cite>), <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.11">Data-to-Text</span> (E2E NLG <cite class="ltx_cite ltx_citemacro_citep">(Dušek et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib9" title="">2019</a>)</cite>, DART <cite class="ltx_cite ltx_citemacro_citep">(Nan et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib30" title="">2020</a>)</cite>), and <span class="ltx_text ltx_font_bold" id="S4.SS1.SSS0.Px1.p1.1.12">Summarization</span> (AESLC <cite class="ltx_cite ltx_citemacro_citep">(Zhang and Tetreault, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib52" title="">2019</a>)</cite>, Gigaword <cite class="ltx_cite ltx_citemacro_citep">(Napoles et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib31" title="">2012</a>)</cite>).</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS1.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Baseline.</h4>
<div class="ltx_para" id="S4.SS1.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS1.SSS0.Px2.p1.1">Our evaluation compares <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS0.Px2.p1.1.1">GenICL</span> against several established baseline approaches that leverage the ICL capabilities of LLMs. These baselines include zero-shot (which executes tasks without demonstrations), random (which selects demonstrations arbitrarily from the available pool), and off-the-shelf retrieval models such as BM25 <cite class="ltx_cite ltx_citemacro_citep">(Robertson et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib36" title="">2009</a>)</cite>, SBERT <cite class="ltx_cite ltx_citemacro_citep">(Reimers, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib35" title="">2019</a>)</cite>, and E5<sub class="ltx_sub" id="S4.SS1.SSS0.Px2.p1.1.2">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite>. Furthermore, we conduct comparative analyses against the following more advanced approaches.</p>
<ul class="ltx_itemize" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.1">EPR <cite class="ltx_cite ltx_citemacro_citep">(Rubin et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib38" title="">2021</a>)</cite> is a prominent method using LLM feedback to label candidate examples as positive or negative, to train the retriever.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1">LLM-R <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite> trains the retriever using a reward model and knowledge distillation, which is one of the state-of-the-art retriever-based methods.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i3.p1">
<p class="ltx_p" id="S4.I1.i3.p1.1">CBDS (concept-based-demonstration-selection) <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib47" title="">2024b</a>)</cite> first learns the latent variable and then selects demonstrations with the highest probability of predicting the corresponding latent variable.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS1.SSS0.Px3">
<h4 class="ltx_title ltx_title_paragraph">Implementation Details.</h4>
<div class="ltx_para" id="S4.SS1.SSS0.Px3.p1">
<p class="ltx_p" id="S4.SS1.SSS0.Px3.p1.1">To ensure a fair comparison with the baselines, we use the same template and evaluation metrics. For detailed information, please refer to the Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A5" title="Appendix E Dataset Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">E</span></a>. Our approach demonstrates enhanced efficiency through a reduced number of training parameters relative to retriever-based methodologies such as LLM-R <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite> and E5<sub class="ltx_sub" id="S4.SS1.SSS0.Px3.p1.1.1">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite>.
For model implementation, we utilize Llama-7B <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib42" title="">2023</a>)</cite> as our primary LLM for most experiments. We also evaluate the impact and generalizability of our <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS0.Px3.p1.1.2">GenICL</span> in Section <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.SS4" title="4.4 Generalizability and Scalability ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4.4</span></a> using GPT-Neo 2.7B <cite class="ltx_cite ltx_citemacro_citep">(Black et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib1" title="">2021</a>)</cite>, Vicuna-13B <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib55" title="">2023</a>)</cite>, LLaMA-3.2-3B <cite class="ltx_cite ltx_citemacro_citep">(Grattafiori et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib12" title="">2024</a>)</cite>, and Qwen2.5-3B <cite class="ltx_cite ltx_citemacro_citep">(Yang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib49" title="">2024</a>)</cite>.
Our inference protocol incorporates a set of 8 demonstrations within the context, with complete implementation details provided in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1" title="Appendix A Implementation Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">A</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Main Results</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.T1" title="Table 1 ‣ 4.2 Main Results ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a> presents the performance comparison of the proposed <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.1">GenICL</span> and various baselines for classification, multi-choice, and text generation tasks. The results demonstrate that <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.2">GenICL</span> significantly outperforms all the baselines on most tasks.
Zero-shot and Random consistently yield the worst performance across most tasks, highlighting the importance of using high-quality demonstrations in ICL.
Retriever methods trained based on LLM feedback provide only limited improvements over off-the-shelf retrievers. Specifically, EPR performs worse than E5<sub class="ltx_sub" id="S4.SS2.p1.1.3">base</sub> on tasks such as MultiRC, RTE, and Sentiment140.
This indicates that these discriminative methods, which use proxy optimization objectives, often fail to select truly useful demonstrations. Our generative Bayesian method <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.4">GenICL</span>, in contrast, significantly outperforms EPR and LLM-R, proving its effectiveness.
Although <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.5">GenICL</span> uses E5<sub class="ltx_sub" id="S4.SS2.p1.1.6">base</sub> to narrow the search space, compared to directly using E5<sub class="ltx_sub" id="S4.SS2.p1.1.7">base</sub>, we achieve significant improvements, especially on tasks such as PAWS, BoolQ, and SNLI, where our <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.8">GenICL</span> improves by more than 5 points.
This indicates that directly using E5<sub class="ltx_sub" id="S4.SS2.p1.1.9">base</sub> struggles to identify demonstrations preferred by the LLM, whereas our method effectively addresses this issue.
While CBDS employs a comparable latent concept variable methodology for demonstration selection, its performance is constrained due to adopting a misaligned optimization objective (details in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1" title="Appendix A Implementation Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">A</span></a>). Through the implementation of a more refined optimization objective, <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p1.1.10">GenICL</span> demonstrates superior performance.</p>
</div>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.1">For text generation tasks, the improvements of EPR and LLM-R over off-the-shelf retrievers are all relatively limited. This may be because metrics like ROUGE and EM typically exhibit a narrower range of variation compared to classification accuracy, which is consistent with the findings of <cite class="ltx_cite ltx_citemacro_citet">Wang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite>. Even so, <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p2.1.1">GenICL</span> still achieves significant improvements over LLM-R and off-the-shelf retrievers, particularly on the CommonGen and SQuAD v1 tasks. This indicates that <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.p2.1.2">GenICL</span> is also highly effective for text generation tasks.
We also provide a case study analysis in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A6" title="Appendix F Case Study of Our GenICL Method ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">F</span></a> to offer further insights.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_1">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="S4.T1.1" style="width:433.6pt;height:228.7pt;vertical-align:-1.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-11.2pt,5.9pt) scale(0.950919800946679,0.950919800946679) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T1.1.1">
<tr class="ltx_tr" id="S4.T1.1.1.1">
<td class="ltx_td ltx_border_tt" id="S4.T1.1.1.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="9" id="S4.T1.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.2.1">Classification Tasks</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.2">
<td class="ltx_td" id="S4.T1.1.1.2.1"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.2.2"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.2.2.1">Topic</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.2.3"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.2.3.1">Reading Comprehension</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.2.4"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.2.4.1">Paraphrase</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.2.5"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.2.5.1">NLI</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.1.1.2.6"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.2.6.1">Sentiment</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.3">
<td class="ltx_td" id="S4.T1.1.1.3.1"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.2">AGNews</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.3">BoolQ</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.4">MultiRC</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.5">PAWS</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.6">QQP</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.7">RTE</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.8">SNLI</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.9">
<span class="ltx_text" id="S4.T1.1.1.3.9.1"></span> <span class="ltx_text" id="S4.T1.1.1.3.9.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.1.1.3.9.2.1">
<span class="ltx_tr" id="S4.T1.1.1.3.9.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.1.1.3.9.2.1.1.1">Sentim</span></span>
<span class="ltx_tr" id="S4.T1.1.1.3.9.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.1.1.3.9.2.1.2.1">ent140</span></span>
</span></span><span class="ltx_text" id="S4.T1.1.1.3.9.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.3.10">SST2</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.1.1.4.1">Zero-shot</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.2">31.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.3">64.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.4">57.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.5">53.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.6">57.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.7">59.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.8">39.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.9">49.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.1.1.4.10">54.2</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.5">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.5.1">Random</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.2">65.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.3">69.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.4"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.5.4.1">60.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.5">49.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.6">54.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.7">65.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.8">40.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.9">78.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.5.10">64.1</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.6">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.6.1">BM25</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.2">90.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.3">74.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.4">58.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.5">56.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.6">80.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.7">59.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.8">47.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.9">88.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.6.10">84.7</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.7">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.7.1">SBERT</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.2">89.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.3">73.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.4">53.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.5"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.7.5.1">58.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.6"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.7.6.1">81.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.7">60.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.8">56.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.9"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.7.9.1">94.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.7.10">87.8</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.8">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.8.1">E5<sub class="ltx_sub" id="S4.T1.1.1.8.1.1">base</sub>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.2">90.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.3">71.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.4">54.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.5">55.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.6">77.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.7"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.8.7.1">68.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.8">53.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.9">93.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.8.10">92.4</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.9">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.9.1">CBDS</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.2">67.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.3"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.9.3.1">77.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.4">49.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.5">57.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.6">64.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.7">56.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.8">43.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.9">92.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.9.10">69.2</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.10">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.10.1">EPR</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.2">91.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.3">74.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.4">50.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.5">57.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.6"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.10.6.1">81.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.7">66.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.8">68.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.9">91.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.10.10">88.7</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.11">
<td class="ltx_td ltx_align_left" id="S4.T1.1.1.11.1">LLM-R</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.2"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.11.2.1">92.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.3">74.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.4">50.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.5">57.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.6">80.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.7">61.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.8"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.11.8.1">80.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.9">91.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.1.1.11.10"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.11.10.1">93.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.12">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T1.1.1.12.1">
<span class="ltx_text ltx_font_smallcaps" id="S4.T1.1.1.12.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.2"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.2.1">92.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.3"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.3.1">78.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.4"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.1.1.12.4.1">56.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.5"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.5.1">63.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.6"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.6.1">82.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.7"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.7.1">72.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.8"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.8.1">84.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.9"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.9.1">94.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.1.1.12.10"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.12.10.1">95.0</span></td>
</tr>
</table>
</span></div>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<div class="ltx_inline-block ltx_figure_panel ltx_align_center ltx_transformed_outer" id="S4.T1.2" style="width:433.6pt;height:196.4pt;vertical-align:-0.7pt;"><span class="ltx_transformed_inner" style="transform:translate(-74.3pt,33.5pt) scale(0.744801942532216,0.744801942532216) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T1.2.1">
<tr class="ltx_tr" id="S4.T1.2.1.1">
<td class="ltx_td ltx_border_tt" id="S4.T1.2.1.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="4" id="S4.T1.2.1.1.2"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.1.2.1">Multi-Choice Tasks</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="6" id="S4.T1.2.1.1.3"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.1.3.1">Text Generation Tasks</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.2">
<td class="ltx_td" id="S4.T1.2.1.2.1"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.2.2">
<span class="ltx_text" id="S4.T1.2.1.2.2.1"></span><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.2.2"> <span class="ltx_text" id="S4.T1.2.1.2.2.2.1">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.2.2.2.1.1">
<span class="ltx_tr" id="S4.T1.2.1.2.2.2.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.2.2.1.1.1.1">Corefe</span></span>
<span class="ltx_tr" id="S4.T1.2.1.2.2.2.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.2.2.1.1.2.1">rence</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.2.2.2.2"></span></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="3" id="S4.T1.2.1.2.3">
<span class="ltx_text" id="S4.T1.2.1.2.3.1"></span><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.3.2"> <span class="ltx_text" id="S4.T1.2.1.2.3.2.1">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.2.3.2.1.1">
<span class="ltx_tr" id="S4.T1.2.1.2.3.2.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.3.2.1.1.1.1">Commonsense</span></span>
<span class="ltx_tr" id="S4.T1.2.1.2.3.2.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.3.2.1.1.2.1">Reasoning</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.2.3.2.2"></span></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.2.1.2.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.4.1">Summarize</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.2.5">
<span class="ltx_text" id="S4.T1.2.1.2.5.1"></span><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.5.2"> <span class="ltx_text" id="S4.T1.2.1.2.5.2.1">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.2.5.2.1.1">
<span class="ltx_tr" id="S4.T1.2.1.2.5.2.1.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.5.2.1.1.1.1">Comm</span></span>
<span class="ltx_tr" id="S4.T1.2.1.2.5.2.1.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.2.5.2.1.1.2.1">onGen</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.2.5.2.2"></span></span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T1.2.1.2.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.6.1">Data-to-text</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.2.7"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.7.1">CloseQA</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.3">
<td class="ltx_td" id="S4.T1.2.1.3.1"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.2">
<span class="ltx_text" id="S4.T1.2.1.3.2.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.2.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.2.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.2.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.2.2.1.1.1">Winog</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.2.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.2.2.1.2.1">rande</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.2.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.3">COPA</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.4">
<span class="ltx_text" id="S4.T1.2.1.3.4.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.4.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.4.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.4.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.4.2.1.1.1">Hella</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.4.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.4.2.1.2.1">Swag</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.4.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.5">
<span class="ltx_text" id="S4.T1.2.1.3.5.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.5.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.5.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.5.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.5.2.1.1.1">Open</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.5.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.5.2.1.2.1">BookQA</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.5.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.6">
<span class="ltx_text" id="S4.T1.2.1.3.6.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.6.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.6.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.6.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.6.2.1.1.1">AE</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.6.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.6.2.1.2.1">SLC</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.6.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.7">
<span class="ltx_text" id="S4.T1.2.1.3.7.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.7.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.7.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.7.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.7.2.1.1.1">Giga</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.7.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.7.2.1.2.1">word</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.7.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.8">
<span class="ltx_text" id="S4.T1.2.1.3.8.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.8.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.8.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.8.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.8.2.1.1.1">Comm</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.8.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.8.2.1.2.1">onGen</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.8.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.9">DART</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.10">
<span class="ltx_text" id="S4.T1.2.1.3.10.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.10.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.10.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.10.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.10.2.1.1.1">E2E</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.10.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.10.2.1.2.1">NLG</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.10.3"></span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.3.11">
<span class="ltx_text" id="S4.T1.2.1.3.11.1"></span> <span class="ltx_text" id="S4.T1.2.1.3.11.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T1.2.1.3.11.2.1">
<span class="ltx_tr" id="S4.T1.2.1.3.11.2.1.1">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.11.2.1.1.1">SQuAD</span></span>
<span class="ltx_tr" id="S4.T1.2.1.3.11.2.1.2">
<span class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T1.2.1.3.11.2.1.2.1">v1</span></span>
</span></span><span class="ltx_text" id="S4.T1.2.1.3.11.3"></span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.2.1.4.1">Zero-shot</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.2">61.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.3">66.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.4">71.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.5">41.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.6">5.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.7">15.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.8">19.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.9">22.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.10">34.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.1.4.11">2.2</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.5">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.5.1">Random</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.2">62.1</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.3">74.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.4">72.1</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.5">43.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.6">6.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.7">27.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.8">36.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.9">34.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.10">51.1</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.5.11">47.3</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.6">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.6.1">BM25</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.2">66.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.3">77.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.4">74.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.5">47.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.6">23.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.7"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.6.7.1">32.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.8">38.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.9">55.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.10">53.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.6.11">53.7</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.7">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.7.1">SBERT</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.2"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.7.2.1">66.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.3">81.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.7.4.1">75.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.5">49.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.6">22.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.7">31.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.8">37.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.9">54.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.10">50.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.7.11">62.5</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.8">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.8.1">E5<sub class="ltx_sub" id="S4.T1.2.1.8.1.1">base</sub>
</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.2">66.7</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.3">84.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.4">75.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.5"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.8.5.1">51.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.6">23.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.7">31.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.8">37.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.9">54.9</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.10">52.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.8.11">61.9</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.9">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.9.1">CBDS</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.2">66.3</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.3">83.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.4">73.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.5">47.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.6">20.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.7">29.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.8">34.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.9">52.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.10">50.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.9.11">59.8</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.10">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.10.1">EPR</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.2">66.5</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.3">82.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.10.4.1">75.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.5">49.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.10.6.1">26.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.7">32.4</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.8"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.10.8.1">39.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.9"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.10.9.1">56.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.10">53.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.10.11"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.10.11.1">64.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.11">
<td class="ltx_td ltx_align_left" id="S4.T1.2.1.11.1">LLM-R</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.2"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.11.2.1">66.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.3"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.11.3.1">85.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.4">74.6</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.5">50.8</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.11.6.1">26.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.7"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.11.7.1">32.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.8">37.2</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.9">56.0</td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.10"><span class="ltx_text ltx_framed ltx_framed_underline" id="S4.T1.2.1.11.10.1">54.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.1.11.11">61.8</td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.1.12">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T1.2.1.12.1">
<span class="ltx_text ltx_font_smallcaps" id="S4.T1.2.1.12.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.2"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.2.1">68.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.3"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.3.1">86.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.4">74.6</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.5"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.5.1">51.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.6">24.4</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.7"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.7.1">33.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.8"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.8.1">41.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.9"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.9.1">56.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.10"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.10.1">55.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.1.12.11"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.12.11.1">65.7</span></td>
</tr>
</table>
</span></div>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Main results on classification, multi-choice, and text generation tasks.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Ablation Study</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1">To validate the effectiveness of the key design in <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.p1.1.1">GenICL</span>, we conduct ablation studies on the CommonGen, BoolQ, and SQuAD v1 tasks, with results presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.T2" title="Table 2 ‣ 4.3 Ablation Study ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">2</span></a>.
When non-preferred data is removed during training, the performance of <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.p1.1.2">GenICL</span> drops significantly, indicating that using only useful demonstrations without considering relative preference relations makes it difficult to learn the distribution of LLM demonstration preference. This proves the necessity of optimization based on preference learning.
Our complete optimization objective consists of two parts: answer-level loss and demonstration-level loss. Removing either leads to a performance drop, demonstrating the correctness of our proposed optimization framework and the importance of considering both the ground truth and the quality of demonstrations during optimization.</p>
</div>
<figure class="ltx_table" id="S4.T2">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T2.1">
<tr class="ltx_tr" id="S4.T2.1.1">
<td class="ltx_td ltx_nopad_r ltx_border_tt" id="S4.T2.1.1.1"></td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_tt" id="S4.T2.1.1.2">CommonGen</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.1.1.3">BoolQ</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.1.1.4">SQuAD v1</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T2.1.2.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T2.1.2.1.1">GenICL</span></td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_t" id="S4.T2.1.2.2">41.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.2.3">78.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T2.1.2.4">65.7</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.3">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T2.1.3.1">- w/o non-preferred data</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T2.1.3.2">38.7</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.3.3">71.2</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.3.4">62.5</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.4">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T2.1.4.1">- w/o answer-level loss</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T2.1.4.2">34.9</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.4.3">72.7</td>
<td class="ltx_td ltx_align_center" id="S4.T2.1.4.4">62.0</td>
</tr>
<tr class="ltx_tr" id="S4.T2.1.5">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb" id="S4.T2.1.5.1">- w/o demo-level loss</td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_bb" id="S4.T2.1.5.2">37.9</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.1.5.3">65.8</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.1.5.4">61.7</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>Ablation study.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4 </span>Generalizability and Scalability</h3>
<section class="ltx_paragraph" id="S4.SS4.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Validation on More LLMs.</h4>
<div class="ltx_para" id="S4.SS4.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS4.SSS0.Px1.p1.1">The previous experimental results were obtained using the LLaMA-7B model. To comprehensively assess the effectiveness and generalizability of <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.1">GenICL</span>, we expanded our evaluation to encompass various LLMs of different scales, specifically GPT-Neo 2.7B, Vicuna-13B, LLaMA-3.2-3B, and Qwen2.5-3B. The comparison results are presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.T3" title="Table 3 ‣ Validation on More LLMs. ‣ 4.4 Generalizability and Scalability ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">3</span></a>. For each model, we report the performance of <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.2">GenICL</span> alongside zero-shot setting and a strong baseline, LLM-R <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite>. Across all models and tasks, <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.3">GenICL</span> consistently achieves the best results, suggesting that its benefits are not limited to high-capacity LLMs. For example, with the relatively smaller GPT-Neo 2.7B, <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.4">GenICL</span> still leads with 60.5 on PAWS and 92.7 on SST2 task. This indicates that <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.5">GenICL</span> can compensate for limited model capacity by better utilizing demonstration. These results provide compelling evidence that <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px1.p1.1.6">GenICL</span> is a model-agnostic and scalable method.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T3.1">
<tr class="ltx_tr" id="S4.T3.1.1">
<td class="ltx_td ltx_nopad_r ltx_border_tt" id="S4.T3.1.1.1"></td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_tt" id="S4.T3.1.1.2">CommonGen</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.1.1.3">E2E NLG</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.1.1.4">PAWS</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.1.1.5">SST2</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T3.1.2.1">GPT-Neo 2.7B</td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.2.2"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.2.3"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.2.4"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.2.5"></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.3">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.3.1">- Zero-shot</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.3.2">14.2</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.3.3">7.71</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.3.4">52.6</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.3.5">53.7</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.4">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.4.1">- LLM-R</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.4.2">34.5</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.3">49.2</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.4">55.5</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.5">92.6</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.5">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.5.1">- <span class="ltx_text ltx_font_smallcaps" id="S4.T3.1.5.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.5.2">35.3</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.5.3">50.1</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.5.4">60.5</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.5.5">92.7</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.6">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T3.1.6.1">Vicuna-13B</td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.6.2"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.6.3"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.6.4"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.6.5"></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.7">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.7.1">- Zero-shot</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.7.2">17.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.7.3">1.71</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.7.4">57.2</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.7.5">49.0</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.8">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.8.1">- LLM-R</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.8.2">39.7</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.3">55.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.4">64.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.5">93.8</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.9">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.9.1">- <span class="ltx_text ltx_font_smallcaps" id="S4.T3.1.9.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.9.2">39.7</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.9.3">56.3</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.9.4">71.7</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.9.5">94.0</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.10">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T3.1.10.1">Qwen2.5-3B</td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.10.2"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.10.3"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.10.4"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.10.5"></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.11">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.11.1">- Zero-shot</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.11.2">23.6</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.11.3">43.6</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.11.4">58.8</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.11.5">51.0</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.12">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.12.1">- LLM-R</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.12.2">35.6</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.12.3">37.0</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.12.4">70.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.12.5">94.3</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.13">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.13.1">- <span class="ltx_text ltx_font_smallcaps" id="S4.T3.1.13.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.13.2">37.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.13.3">37.9</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.13.4">81.8</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.13.5">94.6</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.14">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T3.1.14.1">LLaMA-3.2-3B</td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.14.2"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.14.3"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.14.4"></td>
<td class="ltx_td ltx_border_t" id="S4.T3.1.14.5"></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.15">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.15.1">- Zero-shot</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.15.2">16.2</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.15.3">33.5</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.15.4">54.1</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.15.5">52.4</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.16">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T3.1.16.1">- LLM-R</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T3.1.16.2">39.1</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.16.3">56.4</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.16.4">56.0</td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.16.5">93.0</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.17">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb" id="S4.T3.1.17.1">- <span class="ltx_text ltx_font_smallcaps" id="S4.T3.1.17.1.1">GenICL</span> (ours)</td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_bb" id="S4.T3.1.17.2">39.8</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.17.3">57.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.17.4">66.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.17.5">94.5</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>Performance on more LLMs.</figcaption>
</figure>
</section>
<section class="ltx_paragraph" id="S4.SS4.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Generalizability of Selected Demonstrations.</h4>
<div class="ltx_para" id="S4.SS4.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS4.SSS0.Px2.p1.1">In Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.T4" title="Table 4 ‣ Generalizability of Selected Demonstrations. ‣ 4.4 Generalizability and Scalability ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4</span></a>, we conduct experiments to evaluate th generalizability of demonstrations selected by our <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px2.p1.1.1">GenICL</span>. Specifically, we examine whether demonstrations selected using a smaller model, GPT-Neo 2.7B, can be effectively reused by larger models such as LLaMA-7B and LLaMA-3.2-3B. The results indicate that demonstrations chosen by the smaller model can significantly improve the ICL performance of larger models, without the need for retraining or further adaptation. This highlights the potential of our <span class="ltx_text ltx_font_smallcaps" id="S4.SS4.SSS0.Px2.p1.1.2">GenICL</span> to serve as a lightweight and model-agnostic demonstration selector.</p>
</div>
<figure class="ltx_table" id="S4.T4">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T4.1">
<tr class="ltx_tr" id="S4.T4.1.1">
<td class="ltx_td ltx_nopad_r ltx_border_tt" id="S4.T4.1.1.1"></td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_tt" id="S4.T4.1.1.2">CommonGen</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.1.1.3">E2E NLG</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.1.1.4">PAWS</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.1.1.5">SST2</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.2">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S4.T4.1.2.1">GPT-Neo 2.7B</td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_t" id="S4.T4.1.2.2">35.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.2.3">50.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.2.4">60.5</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.2.5">92.7</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.3">
<td class="ltx_td ltx_nopad_r ltx_align_left" id="S4.T4.1.3.1">LLaMA-7B</td>
<td class="ltx_td ltx_nopad_l ltx_align_right" id="S4.T4.1.3.2">40.8</td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.3.3">55.3</td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.3.4">59.3</td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.3.5">94.0</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.4">
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb" id="S4.T4.1.4.1">LLaMA-3.2-3B</td>
<td class="ltx_td ltx_nopad_l ltx_align_right ltx_border_bb" id="S4.T4.1.4.2">39.4</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.4.3">57.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.4.4">59.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.4.5">93.4</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>Generalizability of Selected Demonstrations. All demonstrations are selected by GPT-Neo 2.7B and used as in-context demonstrations for all three models.</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S4.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.5 </span>The Superiority of Our Optimization Objective</h3>
<div class="ltx_para" id="S4.SS5.p1">
<p class="ltx_p" id="S4.SS5.p1.1">Our optimization objective is directly derived from the ICL paradigm, making it more aligned with ICL compared to retriever-based methods.
We compare the probability of predicting the ground truth using demonstrations selected by different methods, as described in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E1" title="In 3.1 Problem Setting ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a>).
The results, shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.F3" title="Figure 3 ‣ 4.5 The Superiority of Our Optimization Objective ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">3</span></a>, indicate that compared to retriever-based methods such as LLM-R and SBERT, <span class="ltx_text ltx_font_smallcaps" id="S4.SS5.p1.1.1">GenICL</span> achieves higher predicted probabilities for the ground truth, with a more concentrated probability distribution.
This demonstrates that our optimization objective better enhances ICL performance, further validating our previous conclusions.</p>
</div>
<figure class="ltx_figure" id="S4.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="147" id="S4.F3.g1" src="extracted/6480001/figures/box_plot.png" width="299"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>The predicted probability of the ground truth using demonstrations selected by different methods.</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS6">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.6 </span>The Impact of the Number and Order of Demonstrations</h3>
<div class="ltx_para" id="S4.SS6.p1">
<p class="ltx_p" id="S4.SS6.p1.1">In Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.F4" title="Figure 4 ‣ 4.6 The Impact of the Number and Order of Demonstrations ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">4</span></a>, we examine how the performance of <span class="ltx_text ltx_font_smallcaps" id="S4.SS6.p1.1.1">GenICL</span> changes as the number of demonstrations varies on the following four datasets: RTE, SST2, CommonGen, and Gigaword.
The results show that increasing the number of demonstrations does not always lead to better performance. For SST2 and CommonGen, a significant drop in performance is observed when the number of demonstrations is too large, while Gigaword experiences a slight decrease.</p>
</div>
<figure class="ltx_figure" id="S4.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="180" id="S4.F4.g1" src="extracted/6480001/figures/num_demos.png" width="299"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>The effect of demonstration number <math alttext="K" class="ltx_Math" display="inline" id="S4.F4.2.m1.1"><semantics id="S4.F4.2.m1.1b"><mi id="S4.F4.2.m1.1.1" xref="S4.F4.2.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S4.F4.2.m1.1c"><ci id="S4.F4.2.m1.1.1.cmml" xref="S4.F4.2.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.2.m1.1d">K</annotation><annotation encoding="application/x-llamapun" id="S4.F4.2.m1.1e">italic_K</annotation></semantics></math>.</figcaption>
</figure>
<div class="ltx_para" id="S4.SS6.p2">
<p class="ltx_p" id="S4.SS6.p2.1">To investigate the impact of the order of demonstrations on downstream task performance, we compare three different order settings:</p>
<ul class="ltx_itemize" id="S4.I2">
<li class="ltx_item" id="S4.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i1.p1">
<p class="ltx_p" id="S4.I2.i1.p1.1">Shuffle: the top-<math alttext="K" class="ltx_Math" display="inline" id="S4.I2.i1.p1.1.m1.1"><semantics id="S4.I2.i1.p1.1.m1.1a"><mi id="S4.I2.i1.p1.1.m1.1.1" xref="S4.I2.i1.p1.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S4.I2.i1.p1.1.m1.1b"><ci id="S4.I2.i1.p1.1.m1.1.1.cmml" xref="S4.I2.i1.p1.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i1.p1.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i1.p1.1.m1.1d">italic_K</annotation></semantics></math> selected demonstrations are randomly shuffled.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i2.p1">
<p class="ltx_p" id="S4.I2.i2.p1.1">Descending: the top-<math alttext="K" class="ltx_Math" display="inline" id="S4.I2.i2.p1.1.m1.1"><semantics id="S4.I2.i2.p1.1.m1.1a"><mi id="S4.I2.i2.p1.1.m1.1.1" xref="S4.I2.i2.p1.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S4.I2.i2.p1.1.m1.1b"><ci id="S4.I2.i2.p1.1.m1.1.1.cmml" xref="S4.I2.i2.p1.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i2.p1.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i2.p1.1.m1.1d">italic_K</annotation></semantics></math> selected demonstrations are ordered in descending order of Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E11" title="In 3.4 Demonstration Selection in Inference ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">11</span></a>).</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i3.p1">
<p class="ltx_p" id="S4.I2.i3.p1.1">Ascending: the top-<math alttext="K" class="ltx_Math" display="inline" id="S4.I2.i3.p1.1.m1.1"><semantics id="S4.I2.i3.p1.1.m1.1a"><mi id="S4.I2.i3.p1.1.m1.1.1" xref="S4.I2.i3.p1.1.m1.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S4.I2.i3.p1.1.m1.1b"><ci id="S4.I2.i3.p1.1.m1.1.1.cmml" xref="S4.I2.i3.p1.1.m1.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i3.p1.1.m1.1c">K</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i3.p1.1.m1.1d">italic_K</annotation></semantics></math> selected demonstrations are ordered in ascending order of Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S3.E11" title="In 3.4 Demonstration Selection in Inference ‣ 3 Methodology ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">11</span></a>).</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S4.SS6.p3">
<p class="ltx_p" id="S4.SS6.p3.1">The results are shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S4.T5" title="Table 5 ‣ 4.6 The Impact of the Number and Order of Demonstrations ‣ 4 Experiments ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">5</span></a>.
<cite class="ltx_cite ltx_citemacro_citet">Lu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib24" title="">2021</a>)</cite> have revealed that ICL is sensitive to the order of demonstrations when using random examples.
However, we found that the order of the demonstrations selected by our method has little impact on the final in-context learning performance.
This supports the conclusion that high-quality demonstrations are less sensitive to the ordering <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib19" title="">2023</a>; Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib4" title="">2022</a>; Li and Qiu, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib20" title="">2023</a>)</cite>.
This further illustrates that the demonstrations selected by our method, based on preference learning, are of high quality.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T5.1">
<tr class="ltx_tr" id="S4.T5.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T5.1.1.1">Demo. order</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.2">Agnews</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.3">QQP</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.4">Gigaword</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.5">E2E NLG</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.1.2.1">Shuffle</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.2">92.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.3">81.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.4">32.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.2.5">55.2</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.3">
<td class="ltx_td ltx_align_left" id="S4.T5.1.3.1">Descending</td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.3.2">92.6</td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.3.3">82.0</td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.3.4">33.0</td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.3.5">55.1</td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.4">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.1.4.1">Ascending</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.4.2">92.8</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.4.3">82.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.4.4">32.6</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.4.5">54.9</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 5: </span>Comparison of different demonstration orders.</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Conclusion</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this paper, we introduced <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.1">GenICL</span>, a novel generative preference learning framework for optimizing demonstration selection in in-context learning (ICL).
By reformulating ICL as a generative Bayesian optimization problem, <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.2">GenICL</span> bridges demonstration selection and LLM inference through a latent demonstration variable, aligning the intrinsic goal of ICL.
<span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.3">GenICL</span> also leverages preference learning on relatively effective and ineffective demonstrations from LLM feedback, achieving fine-grained demonstration selection.
A wide range of experiments have illustrated the superiority of our proposed method <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.4">GenICL</span>.
We believe that our findings contribute to advancing the field of ICL and hope that <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.5">GenICL</span> serves as a foundation for future research in directly optimizing demonstration selection for LLMs.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Limitations</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">During the optimization phase, we treat each demonstration independently, ignoring the interactions between demonstrations (such as order and combination). In the inference phase, we select a set of demonstrations based on their scores, but the combination of individually optimal demonstrations does not necessarily result in the overall best combination.</p>
</div>
<div class="ltx_para" id="Sx1.p2">
<p class="ltx_p" id="Sx1.p2.1">Our method requires scoring each candidate in the demonstration pool during the demonstration selection stage. However, the search space and computational cost of this process are prohibitive. To address this, we employ E5<sub class="ltx_sub" id="Sx1.p2.1.1">base</sub> to reduce the search space by obtaining a subset of the demonstration pool as a new, smaller pool. However, this approach may filter out some valuable demonstrations. Additionally, improving the efficiency of demonstration scoring remains a promising direction for further exploration.</p>
</div>
</section>
<section class="ltx_section" id="Sx2">
<h2 class="ltx_title ltx_title_section">Acknowledgments</h2>
<div class="ltx_para" id="Sx2.p1">
<p class="ltx_p" id="Sx2.p1.1">The research received partial support from National Natural Science Foundation of China (Grant No. 62406193).
The authors also gratefully acknowledge further assistance provided by Shanghai Frontiers Science Center of Human-centered Artificial Intelligence, MoE Key Lab
of Intelligent Perception and Human-Machine Collaboration, and HPC Platform of ShanghaiTech University.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Black et al. (2021)</span>
<span class="ltx_bibblock">
Sid Black, Leo Gao, Phil Wang, Connor Leahy, and Stella Biderman. 2021.

</span>
<span class="ltx_bibblock">Gpt-neo: Large scale autoregressive language modeling with mesh-tensorflow.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">If you use this software, please cite it using these metadata</em>, 58(2).

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bowman et al. (2015)</span>
<span class="ltx_bibblock">
Samuel R Bowman, Gabor Angeli, Christopher Potts, and Christopher D Manning. 2015.

</span>
<span class="ltx_bibblock">A large annotated corpus for learning natural language inference.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">arXiv preprint arXiv:1508.05326</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et al. (2020)</span>
<span class="ltx_bibblock">
Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. 2020.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Advances in neural information processing systems</em>, 33:1877–1901.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2022)</span>
<span class="ltx_bibblock">
Yanda Chen, Chen Zhao, Zhou Yu, Kathleen McKeown, and He He. 2022.

</span>
<span class="ltx_bibblock">On the relation between sensitivity and accuracy in in-context learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">arXiv preprint arXiv:2209.07661</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2024)</span>
<span class="ltx_bibblock">
Yunmo Chen, Tongfei Chen, Harsh Jhamtani, Patrick Xia, Richard Shin, Jason Eisner, and Benjamin Van Durme. 2024.

</span>
<span class="ltx_bibblock">Learning to retrieve iteratively for in-context learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Proceedings of the 2024 Conference on Empirical Methods in Natural Language Processing</em>, pages 7156–7168.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cheng et al. (2023)</span>
<span class="ltx_bibblock">
Daixuan Cheng, Shaohan Huang, Junyu Bi, Yuefeng Zhan, Jianfeng Liu, Yujing Wang, Hao Sun, Furu Wei, Denvy Deng, and Qi Zhang. 2023.

</span>
<span class="ltx_bibblock">Uprise: Universal prompt retrieval for improving zero-shot evaluation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">arXiv preprint arXiv:2303.08518</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Christiano et al. (2017)</span>
<span class="ltx_bibblock">
Paul F Christiano, Jan Leike, Tom Brown, Miljan Martic, Shane Legg, and Dario Amodei. 2017.

</span>
<span class="ltx_bibblock">Deep reinforcement learning from human preferences.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Advances in neural information processing systems</em>, 30.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2019)</span>
<span class="ltx_bibblock">
Christopher Clark, Kenton Lee, Ming-Wei Chang, Tom Kwiatkowski, Michael Collins, and Kristina Toutanova. 2019.

</span>
<span class="ltx_bibblock">Boolq: Exploring the surprising difficulty of natural yes/no questions.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">arXiv preprint arXiv:1905.10044</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dušek et al. (2019)</span>
<span class="ltx_bibblock">
Ondřej Dušek, David M Howcroft, and Verena Rieser. 2019.

</span>
<span class="ltx_bibblock">Semantic noise matters for neural natural language generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:1911.03905</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ethayarajh et al. (2024)</span>
<span class="ltx_bibblock">
Kawin Ethayarajh, Winnie Xu, Niklas Muennighoff, Dan Jurafsky, and Douwe Kiela. 2024.

</span>
<span class="ltx_bibblock">Kto: Model alignment as prospect theoretic optimization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">arXiv preprint arXiv:2402.01306</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Go et al. (2009)</span>
<span class="ltx_bibblock">
Alec Go, Richa Bhayani, and Lei Huang. 2009.

</span>
<span class="ltx_bibblock">Twitter sentiment classification using distant supervision.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">CS224N project report, Stanford</em>, 1(12):2009.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grattafiori et al. (2024)</span>
<span class="ltx_bibblock">
Aaron Grattafiori, Abhimanyu Dubey, Abhinav Jauhri, Abhinav Pandey, Abhishek Kadian, Ahmad Al-Dahle, Aiesha Letman, Akhil Mathur, Alan Schelten, Alex Vaughan, et al. 2024.

</span>
<span class="ltx_bibblock">The llama 3 herd of models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">arXiv preprint arXiv:2407.21783</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Havrilla et al. (2024)</span>
<span class="ltx_bibblock">
Alex Havrilla, Yuqing Du, Sharath Chandra Raparthy, Christoforos Nalmpantis, Jane Dwivedi-Yu, Maksym Zhuravinskyi, Eric Hambro, Sainbayar Sukhbaatar, and Roberta Raileanu. 2024.

</span>
<span class="ltx_bibblock">Teaching large language models to reason with reinforcement learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">arXiv preprint arXiv:2403.04642</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al. (2021)</span>
<span class="ltx_bibblock">
Edward J Hu, Yelong Shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean Wang, Lu Wang, and Weizhu Chen. 2021.

</span>
<span class="ltx_bibblock">Lora: Low-rank adaptation of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2106.09685</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Khashabi et al. (2018)</span>
<span class="ltx_bibblock">
Daniel Khashabi, Snigdha Chaturvedi, Michael Roth, Shyam Upadhyay, and Dan Roth. 2018.

</span>
<span class="ltx_bibblock">Looking beyond the surface: A challenge set for reading comprehension over multiple sentences.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Proceedings of the 2018 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, Volume 1 (Long Papers)</em>, pages 252–262.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma (2013)</span>
<span class="ltx_bibblock">
Diederik P Kingma. 2013.

</span>
<span class="ltx_bibblock">Auto-encoding variational bayes.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">arXiv preprint arXiv:1312.6114</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et al. (2019)</span>
<span class="ltx_bibblock">
Tom Kwiatkowski, Jennimaria Palomaki, Olivia Redfield, Michael Collins, Ankur Parikh, Chris Alberti, Danielle Epstein, Illia Polosukhin, Jacob Devlin, Kenton Lee, et al. 2019.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question answering research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Transactions of the Association for Computational Linguistics</em>, 7:453–466.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2024)</span>
<span class="ltx_bibblock">
Jialian Li, Yipin Zhang, Wei Shen, Yuzi Yan, Jian Xie, and Dong Yan. 2024.

</span>
<span class="ltx_bibblock">Boosting deductive reasoning with step signals in rlhf.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">arXiv preprint arXiv:2410.09528</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2023)</span>
<span class="ltx_bibblock">
Xiaonan Li, Kai Lv, Hang Yan, Tianyang Lin, Wei Zhu, Yuan Ni, Guotong Xie, Xiaoling Wang, and Xipeng Qiu. 2023.

</span>
<span class="ltx_bibblock">Unified demonstration retriever for in-context learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">arXiv preprint arXiv:2305.04320</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li and Qiu (2023)</span>
<span class="ltx_bibblock">
Xiaonan Li and Xipeng Qiu. 2023.

</span>
<span class="ltx_bibblock">Mot: Pre-thinking and recalling enable chatgpt to self-improve with memory-of-thoughts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:2305.05181</em>, 16.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin et al. (2019)</span>
<span class="ltx_bibblock">
Bill Yuchen Lin, Wangchunshu Zhou, Ming Shen, Pei Zhou, Chandra Bhagavatula, Yejin Choi, and Xiang Ren. 2019.

</span>
<span class="ltx_bibblock">Commongen: A constrained text generation challenge for generative commonsense reasoning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">arXiv preprint arXiv:1911.03705</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2021)</span>
<span class="ltx_bibblock">
Jiachang Liu, Dinghan Shen, Yizhe Zhang, Bill Dolan, Lawrence Carin, and Weizhu Chen. 2021.

</span>
<span class="ltx_bibblock">What makes good in-context examples for gpt-<math alttext="3" class="ltx_Math" display="inline" id="bib.bib22.1.m1.1"><semantics id="bib.bib22.1.m1.1a"><mn id="bib.bib22.1.m1.1.1" xref="bib.bib22.1.m1.1.1.cmml">3</mn><annotation-xml encoding="MathML-Content" id="bib.bib22.1.m1.1b"><cn id="bib.bib22.1.m1.1.1.cmml" type="integer" xref="bib.bib22.1.m1.1.1">3</cn></annotation-xml><annotation encoding="application/x-tex" id="bib.bib22.1.m1.1c">3</annotation><annotation encoding="application/x-llamapun" id="bib.bib22.1.m1.1d">3</annotation></semantics></math>?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.2.1">arXiv preprint arXiv:2101.06804</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2024)</span>
<span class="ltx_bibblock">
Wenhan Liu, Yutao Zhu, and Zhicheng Dou. 2024.

</span>
<span class="ltx_bibblock">Demorank: Selecting effective demonstrations for large language models in ranking task.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint arXiv:2406.16332</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lu et al. (2021)</span>
<span class="ltx_bibblock">
Yao Lu, Max Bartolo, Alastair Moore, Sebastian Riedel, and Pontus Stenetorp. 2021.

</span>
<span class="ltx_bibblock">Fantastically ordered prompts and where to find them: Overcoming few-shot prompt order sensitivity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">arXiv preprint arXiv:2104.08786</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luo et al. (2023)</span>
<span class="ltx_bibblock">
Man Luo, Xin Xu, Zhuyun Dai, Panupong Pasupat, Mehran Kazemi, Chitta Baral, Vaiva Imbrasaite, and Vincent Y Zhao. 2023.

</span>
<span class="ltx_bibblock">Dr. icl: Demonstration-retrieved in-context learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">arXiv preprint arXiv:2305.14128</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luo et al. (2024)</span>
<span class="ltx_bibblock">
Man Luo, Xin Xu, Yue Liu, Panupong Pasupat, and Mehran Kazemi. 2024.

</span>
<span class="ltx_bibblock">In-context learning with retrieved demonstrations for language models: A survey.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">arXiv preprint arXiv:2401.11624</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mihaylov et al. (2018)</span>
<span class="ltx_bibblock">
Todor Mihaylov, Peter Clark, Tushar Khot, and Ashish Sabharwal. 2018.

</span>
<span class="ltx_bibblock">Can a suit of armor conduct electricity? a new dataset for open book question answering.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">arXiv preprint arXiv:1809.02789</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Min et al. (2022a)</span>
<span class="ltx_bibblock">
Sewon Min, Mike Lewis, Luke Zettlemoyer, and Hannaneh Hajishirzi. 2022a.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_href" href="https://doi.org/10.18653/v1/2022.naacl-main.201" title="">MetaICL: Learning to learn in context</a>.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proceedings of the 2022 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies</em>, pages 2791–2809, Seattle, United States. Association for Computational Linguistics.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Min et al. (2022b)</span>
<span class="ltx_bibblock">
Sewon Min, Xinxi Lyu, Ari Holtzman, Mikel Artetxe, Mike Lewis, Hannaneh Hajishirzi, and Luke Zettlemoyer. 2022b.

</span>
<span class="ltx_bibblock">Rethinking the role of demonstrations: What makes in-context learning work?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">arXiv preprint arXiv:2202.12837</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nan et al. (2020)</span>
<span class="ltx_bibblock">
Linyong Nan, Dragomir Radev, Rui Zhang, Amrit Rau, Abhinand Sivaprasad, Chiachun Hsieh, Xiangru Tang, Aadit Vyas, Neha Verma, Pranav Krishna, et al. 2020.

</span>
<span class="ltx_bibblock">Dart: Open-domain structured data record to text generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">arXiv preprint arXiv:2007.02871</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Napoles et al. (2012)</span>
<span class="ltx_bibblock">
Courtney Napoles, Matthew R Gormley, and Benjamin Van Durme. 2012.

</span>
<span class="ltx_bibblock">Annotated gigaword.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">Proceedings of the joint workshop on automatic knowledge base construction and web-scale knowledge extraction (AKBC-WEKEX)</em>, pages 95–100.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ouyang et al. (2022)</span>
<span class="ltx_bibblock">
Long Ouyang, Jeffrey Wu, Xu Jiang, Diogo Almeida, Carroll Wainwright, Pamela Mishkin, Chong Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, et al. 2022.

</span>
<span class="ltx_bibblock">Training language models to follow instructions with human feedback.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">Advances in neural information processing systems</em>, 35:27730–27744.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rafailov et al. (2024)</span>
<span class="ltx_bibblock">
Rafael Rafailov, Archit Sharma, Eric Mitchell, Christopher D Manning, Stefano Ermon, and Chelsea Finn. 2024.

</span>
<span class="ltx_bibblock">Direct preference optimization: Your language model is secretly a reward model.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">Advances in Neural Information Processing Systems</em>, 36.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rajpurkar (2016)</span>
<span class="ltx_bibblock">
P Rajpurkar. 2016.

</span>
<span class="ltx_bibblock">Squad: 100,000+ questions for machine comprehension of text.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:1606.05250</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Reimers (2019)</span>
<span class="ltx_bibblock">
N Reimers. 2019.

</span>
<span class="ltx_bibblock">Sentence-bert: Sentence embeddings using siamese bert-networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">arXiv preprint arXiv:1908.10084</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Robertson et al. (2009)</span>
<span class="ltx_bibblock">
Stephen Robertson, Hugo Zaragoza, et al. 2009.

</span>
<span class="ltx_bibblock">The probabilistic relevance framework: Bm25 and beyond.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">Foundations and Trends® in Information Retrieval</em>, 3(4):333–389.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Roemmele et al. (2011)</span>
<span class="ltx_bibblock">
Melissa Roemmele, Cosmin Adrian Bejan, and Andrew S Gordon. 2011.

</span>
<span class="ltx_bibblock">Choice of plausible alternatives: An evaluation of commonsense causal reasoning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">2011 AAAI spring symposium series</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rubin et al. (2021)</span>
<span class="ltx_bibblock">
Ohad Rubin, Jonathan Herzig, and Jonathan Berant. 2021.

</span>
<span class="ltx_bibblock">Learning to retrieve prompts for in-context learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">arXiv preprint arXiv:2112.08633</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sakaguchi et al. (2021)</span>
<span class="ltx_bibblock">
Keisuke Sakaguchi, Ronan Le Bras, Chandra Bhagavatula, and Yejin Choi. 2021.

</span>
<span class="ltx_bibblock">Winogrande: An adversarial winograd schema challenge at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">Communications of the ACM</em>, 64(9):99–106.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Schulman et al. (2017)</span>
<span class="ltx_bibblock">
John Schulman, Filip Wolski, Prafulla Dhariwal, Alec Radford, and Oleg Klimov. 2017.

</span>
<span class="ltx_bibblock">Proximal policy optimization algorithms.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">arXiv preprint arXiv:1707.06347</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Socher et al. (2013)</span>
<span class="ltx_bibblock">
Richard Socher, Alex Perelygin, Jean Wu, Jason Chuang, Christopher D Manning, Andrew Y Ng, and Christopher Potts. 2013.

</span>
<span class="ltx_bibblock">Recursive deep models for semantic compositionality over a sentiment treebank.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">Proceedings of the 2013 conference on empirical methods in natural language processing</em>, pages 1631–1642.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al. (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timothée Lacroix, Baptiste Rozière, Naman Goyal, Eric Hambro, Faisal Azhar, et al. 2023.

</span>
<span class="ltx_bibblock">Llama: Open and efficient foundation language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">arXiv preprint arXiv:2302.13971</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang (2018)</span>
<span class="ltx_bibblock">
Alex Wang. 2018.

</span>
<span class="ltx_bibblock">Glue: A multi-task benchmark and analysis platform for natural language understanding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib43.1.1">arXiv preprint arXiv:1804.07461</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2022)</span>
<span class="ltx_bibblock">
Liang Wang, Nan Yang, Xiaolong Huang, Binxing Jiao, Linjun Yang, Daxin Jiang, Rangan Majumder, and Furu Wei. 2022.

</span>
<span class="ltx_bibblock">Text embeddings by weakly-supervised contrastive pre-training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:2212.03533</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2023)</span>
<span class="ltx_bibblock">
Liang Wang, Nan Yang, and Furu Wei. 2023.

</span>
<span class="ltx_bibblock">Learning to retrieve in-context examples for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">arXiv preprint arXiv:2307.07164</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024a)</span>
<span class="ltx_bibblock">
Peng Wang, Xiaobin Wang, Chao Lou, Shengyu Mao, Pengjun Xie, and Yong Jiang. 2024a.

</span>
<span class="ltx_bibblock">Effective demonstration annotation for in-context learning via language model-based determinantal point process.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">arXiv preprint arXiv:2408.02103</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024b)</span>
<span class="ltx_bibblock">
Xinyi Wang, Wanrong Zhu, Michael Saxon, Mark Steyvers, and William Yang Wang. 2024b.

</span>
<span class="ltx_bibblock">Large language models are latent variable models: Explaining and finding good demonstrations for in-context learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">Advances in Neural Information Processing Systems</em>, 36.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al. (2021)</span>
<span class="ltx_bibblock">
Sang Michael Xie, Aditi Raghunathan, Percy Liang, and Tengyu Ma. 2021.

</span>
<span class="ltx_bibblock">An explanation of in-context learning as implicit bayesian inference.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">arXiv preprint arXiv:2111.02080</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al. (2024)</span>
<span class="ltx_bibblock">
An Yang, Baosong Yang, Beichen Zhang, Binyuan Hui, Bo Zheng, Bowen Yu, Chengyuan Li, Dayiheng Liu, Fei Huang, Haoran Wei, et al. 2024.

</span>
<span class="ltx_bibblock">Qwen2. 5 technical report.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib49.1.1">arXiv preprint arXiv:2412.15115</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ye et al. (2023)</span>
<span class="ltx_bibblock">
Jiacheng Ye, Zhiyong Wu, Jiangtao Feng, Tao Yu, and Lingpeng Kong. 2023.

</span>
<span class="ltx_bibblock">Compositional exemplars for in-context learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib50.1.1">International Conference on Machine Learning</em>, pages 39818–39833. PMLR.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zellers et al. (2019)</span>
<span class="ltx_bibblock">
Rowan Zellers, Ari Holtzman, Yonatan Bisk, Ali Farhadi, and Yejin Choi. 2019.

</span>
<span class="ltx_bibblock">Hellaswag: Can a machine really finish your sentence?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib51.1.1">arXiv preprint arXiv:1905.07830</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang and Tetreault (2019)</span>
<span class="ltx_bibblock">
Rui Zhang and Joel Tetreault. 2019.

</span>
<span class="ltx_bibblock">This email could save your life: Introducing the task of email subject line generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib52.1.1">arXiv preprint arXiv:1906.03497</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2015)</span>
<span class="ltx_bibblock">
Xiang Zhang, Junbo Zhao, and Yann LeCun. 2015.

</span>
<span class="ltx_bibblock">Character-level convolutional networks for text classification.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib53.1.1">Advances in neural information processing systems</em>, 28.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2019)</span>
<span class="ltx_bibblock">
Yuan Zhang, Jason Baldridge, and Luheng He. 2019.

</span>
<span class="ltx_bibblock">Paws: Paraphrase adversaries from word scrambling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib54.1.1">arXiv preprint arXiv:1904.01130</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al. (2023)</span>
<span class="ltx_bibblock">
Lianmin Zheng, Wei-Lin Chiang, Ying Sheng, Siyuan Zhuang, Zhanghao Wu, Yonghao Zhuang, Zi Lin, Zhuohan Li, Dacheng Li, Eric Xing, et al. 2023.

</span>
<span class="ltx_bibblock">Judging llm-as-a-judge with mt-bench and chatbot arena.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib55.1.1">Advances in Neural Information Processing Systems</em>, 36:46595–46623.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ziegler et al. (2019)</span>
<span class="ltx_bibblock">
Daniel M Ziegler, Nisan Stiennon, Jeffrey Wu, Tom B Brown, Alec Radford, Dario Amodei, Paul Christiano, and Geoffrey Irving. 2019.

</span>
<span class="ltx_bibblock">Fine-tuning language models from human preferences.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib56.1.1">arXiv preprint arXiv:1909.08593</em>.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Implementation Details</h2>
<div class="ltx_para" id="A1.p1">
<p class="ltx_p" id="A1.p1.1">We use LoRA <cite class="ltx_cite ltx_citemacro_citep">(Hu et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib14" title="">2021</a>)</cite> to train the parameters corresponding to the latent variable, and the total number of trainable parameters is approximately 79M.
The hyperparameters of <span class="ltx_text ltx_font_smallcaps" id="A1.p1.1.1">GenICL</span> are summarized in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A1.T6" title="Table 6 ‣ Appendix A Implementation Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">6</span></a>.
For a fair comparison, our method and all baselines use the same template, as shown in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#A5" title="Appendix E Dataset Details ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">E</span></a>.</p>
</div>
<figure class="ltx_table" id="A1.T6">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A1.T6.4">
<tr class="ltx_tr" id="A1.T6.4.5">
<td class="ltx_td ltx_align_top ltx_border_tt" id="A1.T6.4.5.1" style="padding-top:1pt;padding-bottom:1pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A1.T6.4.5.2" style="padding-top:1pt;padding-bottom:1pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A1.T6.4.5.2.1">GenICL</span></td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.6">
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_t" id="A1.T6.4.6.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.6.1.1">
<span class="ltx_p" id="A1.T6.4.6.1.1.1" style="width:113.8pt;">Optimizer</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T6.4.6.2" style="padding-top:1pt;padding-bottom:1pt;">AdamW</td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.7">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.4.7.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.7.1.1">
<span class="ltx_p" id="A1.T6.4.7.1.1.1" style="width:113.8pt;">Warmup steps</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.4.7.2" style="padding-top:1pt;padding-bottom:1pt;">3000</td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.8">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.4.8.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.8.1.1">
<span class="ltx_p" id="A1.T6.4.8.1.1.1" style="width:113.8pt;">Training steps</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.4.8.2" style="padding-top:1pt;padding-bottom:1pt;">20000</td>
</tr>
<tr class="ltx_tr" id="A1.T6.1.1">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.1.1.2" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.1.1.2.1">
<span class="ltx_p" id="A1.T6.1.1.2.1.1" style="width:113.8pt;">Learning rate</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.1.1.1" style="padding-top:1pt;padding-bottom:1pt;"><math alttext="5\text{e-}6" class="ltx_Math" display="inline" id="A1.T6.1.1.1.m1.1"><semantics id="A1.T6.1.1.1.m1.1a"><mrow id="A1.T6.1.1.1.m1.1.1" xref="A1.T6.1.1.1.m1.1.1.cmml"><mn id="A1.T6.1.1.1.m1.1.1.2" xref="A1.T6.1.1.1.m1.1.1.2.cmml">5</mn><mo id="A1.T6.1.1.1.m1.1.1.1" xref="A1.T6.1.1.1.m1.1.1.1.cmml">⁢</mo><mtext id="A1.T6.1.1.1.m1.1.1.3" xref="A1.T6.1.1.1.m1.1.1.3a.cmml">e-</mtext><mo id="A1.T6.1.1.1.m1.1.1.1a" xref="A1.T6.1.1.1.m1.1.1.1.cmml">⁢</mo><mn id="A1.T6.1.1.1.m1.1.1.4" xref="A1.T6.1.1.1.m1.1.1.4.cmml">6</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.T6.1.1.1.m1.1b"><apply id="A1.T6.1.1.1.m1.1.1.cmml" xref="A1.T6.1.1.1.m1.1.1"><times id="A1.T6.1.1.1.m1.1.1.1.cmml" xref="A1.T6.1.1.1.m1.1.1.1"></times><cn id="A1.T6.1.1.1.m1.1.1.2.cmml" type="integer" xref="A1.T6.1.1.1.m1.1.1.2">5</cn><ci id="A1.T6.1.1.1.m1.1.1.3a.cmml" xref="A1.T6.1.1.1.m1.1.1.3"><mtext id="A1.T6.1.1.1.m1.1.1.3.cmml" xref="A1.T6.1.1.1.m1.1.1.3">e-</mtext></ci><cn id="A1.T6.1.1.1.m1.1.1.4.cmml" type="integer" xref="A1.T6.1.1.1.m1.1.1.4">6</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T6.1.1.1.m1.1c">5\text{e-}6</annotation><annotation encoding="application/x-llamapun" id="A1.T6.1.1.1.m1.1d">5 e- 6</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.9">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.4.9.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.9.1.1">
<span class="ltx_p" id="A1.T6.4.9.1.1.1" style="width:113.8pt;">Batch size</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.4.9.2" style="padding-top:1pt;padding-bottom:1pt;">32</td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.10">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.4.10.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.10.1.1">
<span class="ltx_p" id="A1.T6.4.10.1.1.1" style="width:113.8pt;">Maximum input length</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.4.10.2" style="padding-top:1pt;padding-bottom:1pt;">1024</td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.11">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.4.11.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.11.1.1">
<span class="ltx_p" id="A1.T6.4.11.1.1.1" style="width:113.8pt;">Maximum output length</span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.4.11.2" style="padding-top:1pt;padding-bottom:1pt;">64</td>
</tr>
<tr class="ltx_tr" id="A1.T6.2.2">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.2.2.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.2.2.1.1">
<span class="ltx_p" id="A1.T6.2.2.1.1.1" style="width:113.8pt;"><math alttext="\beta" class="ltx_Math" display="inline" id="A1.T6.2.2.1.1.1.m1.1"><semantics id="A1.T6.2.2.1.1.1.m1.1a"><mi id="A1.T6.2.2.1.1.1.m1.1.1" xref="A1.T6.2.2.1.1.1.m1.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="A1.T6.2.2.1.1.1.m1.1b"><ci id="A1.T6.2.2.1.1.1.m1.1.1.cmml" xref="A1.T6.2.2.1.1.1.m1.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.T6.2.2.1.1.1.m1.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="A1.T6.2.2.1.1.1.m1.1d">italic_β</annotation></semantics></math></span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.2.2.2" style="padding-top:1pt;padding-bottom:1pt;">0.1</td>
</tr>
<tr class="ltx_tr" id="A1.T6.3.3">
<td class="ltx_td ltx_align_justify ltx_align_top" id="A1.T6.3.3.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.3.3.1.1">
<span class="ltx_p" id="A1.T6.3.3.1.1.1" style="width:113.8pt;"><math alttext="\lambda_{w}" class="ltx_Math" display="inline" id="A1.T6.3.3.1.1.1.m1.1"><semantics id="A1.T6.3.3.1.1.1.m1.1a"><msub id="A1.T6.3.3.1.1.1.m1.1.1" xref="A1.T6.3.3.1.1.1.m1.1.1.cmml"><mi id="A1.T6.3.3.1.1.1.m1.1.1.2" xref="A1.T6.3.3.1.1.1.m1.1.1.2.cmml">λ</mi><mi id="A1.T6.3.3.1.1.1.m1.1.1.3" xref="A1.T6.3.3.1.1.1.m1.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="A1.T6.3.3.1.1.1.m1.1b"><apply id="A1.T6.3.3.1.1.1.m1.1.1.cmml" xref="A1.T6.3.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T6.3.3.1.1.1.m1.1.1.1.cmml" xref="A1.T6.3.3.1.1.1.m1.1.1">subscript</csymbol><ci id="A1.T6.3.3.1.1.1.m1.1.1.2.cmml" xref="A1.T6.3.3.1.1.1.m1.1.1.2">𝜆</ci><ci id="A1.T6.3.3.1.1.1.m1.1.1.3.cmml" xref="A1.T6.3.3.1.1.1.m1.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T6.3.3.1.1.1.m1.1c">\lambda_{w}</annotation><annotation encoding="application/x-llamapun" id="A1.T6.3.3.1.1.1.m1.1d">italic_λ start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math></span>
</span>
</td>
<td class="ltx_td ltx_align_center" id="A1.T6.3.3.2" style="padding-top:1pt;padding-bottom:1pt;">1.0</td>
</tr>
<tr class="ltx_tr" id="A1.T6.4.4">
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb" id="A1.T6.4.4.1" style="padding-top:1pt;padding-bottom:1pt;">
<span class="ltx_inline-block ltx_align_top" id="A1.T6.4.4.1.1">
<span class="ltx_p" id="A1.T6.4.4.1.1.1" style="width:113.8pt;"><math alttext="\lambda_{l}" class="ltx_Math" display="inline" id="A1.T6.4.4.1.1.1.m1.1"><semantics id="A1.T6.4.4.1.1.1.m1.1a"><msub id="A1.T6.4.4.1.1.1.m1.1.1" xref="A1.T6.4.4.1.1.1.m1.1.1.cmml"><mi id="A1.T6.4.4.1.1.1.m1.1.1.2" xref="A1.T6.4.4.1.1.1.m1.1.1.2.cmml">λ</mi><mi id="A1.T6.4.4.1.1.1.m1.1.1.3" xref="A1.T6.4.4.1.1.1.m1.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="A1.T6.4.4.1.1.1.m1.1b"><apply id="A1.T6.4.4.1.1.1.m1.1.1.cmml" xref="A1.T6.4.4.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A1.T6.4.4.1.1.1.m1.1.1.1.cmml" xref="A1.T6.4.4.1.1.1.m1.1.1">subscript</csymbol><ci id="A1.T6.4.4.1.1.1.m1.1.1.2.cmml" xref="A1.T6.4.4.1.1.1.m1.1.1.2">𝜆</ci><ci id="A1.T6.4.4.1.1.1.m1.1.1.3.cmml" xref="A1.T6.4.4.1.1.1.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T6.4.4.1.1.1.m1.1c">\lambda_{l}</annotation><annotation encoding="application/x-llamapun" id="A1.T6.4.4.1.1.1.m1.1d">italic_λ start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math></span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="A1.T6.4.4.2" style="padding-top:1pt;padding-bottom:1pt;">1.0</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 6: </span>Hyper-parameters.</figcaption>
</figure>
<section class="ltx_paragraph" id="A1.SS0.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Implementation Details of CBDS <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib47" title="">2024b</a>)</cite>.</h4>
<div class="ltx_para" id="A1.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="A1.SS0.SSS0.Px1.p1.4">For the <a class="ltx_ref ltx_href" href="https://github.com/WANGXinyiLinda/concept-based-demonstration-selection" title="">CBDS</a> baseline, we used the authors’ publicly available code and followed the training methodology described in the original paper.
The original CBDS setup involves concurrent training across multiple tasks, with each task optimizing its own set of concept tokens <math alttext="\theta" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.1.m1.1"><semantics id="A1.SS0.SSS0.Px1.p1.1.m1.1a"><mi id="A1.SS0.SSS0.Px1.p1.1.m1.1.1" xref="A1.SS0.SSS0.Px1.p1.1.m1.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.1.m1.1b"><ci id="A1.SS0.SSS0.Px1.p1.1.m1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.1.m1.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.1.m1.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.1.m1.1d">italic_θ</annotation></semantics></math>.
Specifically, the optimization objective during training is to minimize <math alttext="-\log P(Y|\theta,X)" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.2.m2.3"><semantics id="A1.SS0.SSS0.Px1.p1.2.m2.3a"><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.cmml"><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3a" rspace="0.167em" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.cmml">−</mo><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.cmml"><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.1.cmml">log</mi><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3a" lspace="0.167em" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.cmml">⁡</mo><mi id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.2.cmml">P</mi></mrow><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.2.cmml">⁢</mo><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.cmml"><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.2" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.2.cmml">Y</mi><mo fence="false" id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.1.cmml">|</mo><mrow id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.2.m2.1.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.1.1.cmml">θ</mi><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.2.1" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.1.cmml">,</mo><mi id="A1.SS0.SSS0.Px1.p1.2.m2.2.2" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2.cmml">X</mi></mrow></mrow><mo id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.3" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.2.m2.3b"><apply id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3"><minus id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3"></minus><apply id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1"><times id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.2"></times><apply id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3"><log id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.1"></log><ci id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.3.2">𝑃</ci></apply><apply id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1"><csymbol cd="latexml" id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.1">conditional</csymbol><ci id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.2">𝑌</ci><list id="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.3.3.1.1.1.1.3.2"><ci id="A1.SS0.SSS0.Px1.p1.2.m2.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.1.1">𝜃</ci><ci id="A1.SS0.SSS0.Px1.p1.2.m2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.2.m2.2.2">𝑋</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.2.m2.3c">-\log P(Y|\theta,X)</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.2.m2.3d">- roman_log italic_P ( italic_Y | italic_θ , italic_X )</annotation></semantics></math>. During testing, demonstrations <math alttext="(X_{k},Y_{k})" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.3.m3.2"><semantics id="A1.SS0.SSS0.Px1.p1.3.m3.2a"><mrow id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.3.cmml"><mo id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.3" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.3.cmml">(</mo><msub id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.2.cmml">X</mi><mi id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.3" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.3.cmml">k</mi></msub><mo id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.4" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.3.cmml">,</mo><msub id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.cmml"><mi id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.2" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.2.cmml">Y</mi><mi id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.3" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.3.cmml">k</mi></msub><mo id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.5" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.3.m3.2b"><interval closure="open" id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.3.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2"><apply id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.2">𝑋</ci><ci id="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.1.1.1.1.3">𝑘</ci></apply><apply id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.1.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.2">𝑌</ci><ci id="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.3.cmml" xref="A1.SS0.SSS0.Px1.p1.3.m3.2.2.2.2.3">𝑘</ci></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.3.m3.2c">(X_{k},Y_{k})</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.3.m3.2d">( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> are selected based on <math alttext="P(\theta|X_{k},Y_{k})" class="ltx_Math" display="inline" id="A1.SS0.SSS0.Px1.p1.4.m4.1"><semantics id="A1.SS0.SSS0.Px1.p1.4.m4.1a"><mrow id="A1.SS0.SSS0.Px1.p1.4.m4.1.1" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml">P</mi><mo id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml">⁢</mo><mrow id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml"><mo id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.2" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.4" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.4.cmml">θ</mi><mo fence="false" id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.cmml">|</mo><mrow id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3.cmml"><msub id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.cmml"><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3.cmml">,</mo><msub id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.cmml"><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.2" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.2.cmml">Y</mi><mi id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.3" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.3.cmml">k</mi></msub></mrow></mrow><mo id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.3" stretchy="false" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS0.SSS0.Px1.p1.4.m4.1b"><apply id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1"><times id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.2"></times><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.3">𝑃</ci><apply id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1"><csymbol cd="latexml" id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.3">conditional</csymbol><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.4.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.4">𝜃</ci><list id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2"><apply id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.2.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.1.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.2.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.2">𝑌</ci><ci id="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.3.cmml" xref="A1.SS0.SSS0.Px1.p1.4.m4.1.1.1.1.1.2.2.2.3">𝑘</ci></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS0.SSS0.Px1.p1.4.m4.1c">P(\theta|X_{k},Y_{k})</annotation><annotation encoding="application/x-llamapun" id="A1.SS0.SSS0.Px1.p1.4.m4.1d">italic_P ( italic_θ | italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math>.
Training consisted of 10,000 steps with a learning rate of 1e-2 and a batch size of 16.
A crucial difference between CBDS and both our method and other retriever-based approaches is that CBDS uses a shared set of demonstrations for all queries within a specific task.
This design, while computationally efficient, often leads to performance inferior to that of retriever-based methods, which dynamically select demonstrations for each query.
This performance difference was also observed in our reproduction experiments.</p>
</div>
</section>
<section class="ltx_paragraph" id="A1.SS0.SSS0.Px2">
<h4 class="ltx_title ltx_title_paragraph">Implementation Details of LLM-R <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite>.</h4>
<div class="ltx_para" id="A1.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="A1.SS0.SSS0.Px2.p1.1">Following the <a class="ltx_ref ltx_href" href="https://huggingface.co/intfloat/llm-retriever-base/tree/main" title="">LLM-R</a> baseline procedure, we first trained a reward model and then used it for distillation to train the LLM-R model, which uses the pretrained E5<sub class="ltx_sub" id="A1.SS0.SSS0.Px2.p1.1.1">base</sub> model as the initialization model.
We utilized the code provided by the authors, retraining both the reward model and the LLM-R model while maintaining the hyperparameters from the original publication.
For EPR <cite class="ltx_cite ltx_citemacro_citep">(Rubin et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib38" title="">2021</a>)</cite>, we directly adopt the results presented in the LLM-R paper <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib45" title="">2023</a>)</cite>.</p>
</div>
</section>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Details about useful samples statistics</h2>
<div class="ltx_para" id="A2.p1">
<p class="ltx_p" id="A2.p1.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Learning to Select In-Context Demonstration Preferred by Large Language Model"><span class="ltx_text ltx_ref_tag">1</span></a> illustrates the distribution of the ratio of useful examples within demonstration pools across the AGNews, HellaSwag, and OpenBookQA datasets. We first identified "hard queries" defined as those queries that remained answered incorrectly by the LLM even when provided with the top-8 demonstrations initially retrieved by the E5<sub class="ltx_sub" id="A2.p1.1.1">base</sub> <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib44" title="">2022</a>)</cite>. Subsequently, for each identified hard query, a set of 100 demonstrations was randomly sampled without replacement from the respective dataset’s full demonstration pool.</p>
</div>
<div class="ltx_para" id="A2.p2">
<p class="ltx_p" id="A2.p2.3">Each sampled demonstration was then individually assessed for its usefulness. A demonstration was considered "useful" if its concatenation with the hard query resulted in the LLM producing the correct answer. The <span class="ltx_text ltx_font_italic" id="A2.p2.3.1">Ratio of Useful Examples</span> was calculated for each query as <math alttext="(\text{Number of Useful Demonstrations}/100)\times 100\%" class="ltx_Math" display="inline" id="A2.p2.1.m1.1"><semantics id="A2.p2.1.m1.1a"><mrow id="A2.p2.1.m1.1.1" xref="A2.p2.1.m1.1.1.cmml"><mrow id="A2.p2.1.m1.1.1.1.1" xref="A2.p2.1.m1.1.1.1.1.1.cmml"><mo id="A2.p2.1.m1.1.1.1.1.2" stretchy="false" xref="A2.p2.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="A2.p2.1.m1.1.1.1.1.1" xref="A2.p2.1.m1.1.1.1.1.1.cmml"><mtext id="A2.p2.1.m1.1.1.1.1.1.2" xref="A2.p2.1.m1.1.1.1.1.1.2a.cmml">Number of Useful Demonstrations</mtext><mo id="A2.p2.1.m1.1.1.1.1.1.1" xref="A2.p2.1.m1.1.1.1.1.1.1.cmml">/</mo><mn id="A2.p2.1.m1.1.1.1.1.1.3" xref="A2.p2.1.m1.1.1.1.1.1.3.cmml">100</mn></mrow><mo id="A2.p2.1.m1.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="A2.p2.1.m1.1.1.1.1.1.cmml">)</mo></mrow><mo id="A2.p2.1.m1.1.1.2" rspace="0.222em" xref="A2.p2.1.m1.1.1.2.cmml">×</mo><mrow id="A2.p2.1.m1.1.1.3" xref="A2.p2.1.m1.1.1.3.cmml"><mn id="A2.p2.1.m1.1.1.3.2" xref="A2.p2.1.m1.1.1.3.2.cmml">100</mn><mo id="A2.p2.1.m1.1.1.3.1" xref="A2.p2.1.m1.1.1.3.1.cmml">%</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A2.p2.1.m1.1b"><apply id="A2.p2.1.m1.1.1.cmml" xref="A2.p2.1.m1.1.1"><times id="A2.p2.1.m1.1.1.2.cmml" xref="A2.p2.1.m1.1.1.2"></times><apply id="A2.p2.1.m1.1.1.1.1.1.cmml" xref="A2.p2.1.m1.1.1.1.1"><divide id="A2.p2.1.m1.1.1.1.1.1.1.cmml" xref="A2.p2.1.m1.1.1.1.1.1.1"></divide><ci id="A2.p2.1.m1.1.1.1.1.1.2a.cmml" xref="A2.p2.1.m1.1.1.1.1.1.2"><mtext id="A2.p2.1.m1.1.1.1.1.1.2.cmml" xref="A2.p2.1.m1.1.1.1.1.1.2">Number of Useful Demonstrations</mtext></ci><cn id="A2.p2.1.m1.1.1.1.1.1.3.cmml" type="integer" xref="A2.p2.1.m1.1.1.1.1.1.3">100</cn></apply><apply id="A2.p2.1.m1.1.1.3.cmml" xref="A2.p2.1.m1.1.1.3"><csymbol cd="latexml" id="A2.p2.1.m1.1.1.3.1.cmml" xref="A2.p2.1.m1.1.1.3.1">percent</csymbol><cn id="A2.p2.1.m1.1.1.3.2.cmml" type="integer" xref="A2.p2.1.m1.1.1.3.2">100</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.p2.1.m1.1c">(\text{Number of Useful Demonstrations}/100)\times 100\%</annotation><annotation encoding="application/x-llamapun" id="A2.p2.1.m1.1d">( Number of Useful Demonstrations / 100 ) × 100 %</annotation></semantics></math>. To visualize the distribution, these ratios were binned, and the <span class="ltx_text ltx_font_italic" id="A2.p2.3.2">Percentage of Queries</span> falling within each bin was calculated as (Number of Queries in Bin <math alttext="/" class="ltx_Math" display="inline" id="A2.p2.2.m2.1"><semantics id="A2.p2.2.m2.1a"><mo id="A2.p2.2.m2.1.1" xref="A2.p2.2.m2.1.1.cmml">/</mo><annotation-xml encoding="MathML-Content" id="A2.p2.2.m2.1b"><divide id="A2.p2.2.m2.1.1.cmml" xref="A2.p2.2.m2.1.1"></divide></annotation-xml><annotation encoding="application/x-tex" id="A2.p2.2.m2.1c">/</annotation><annotation encoding="application/x-llamapun" id="A2.p2.2.m2.1d">/</annotation></semantics></math> Total Number of Hard Queries) <math alttext="\times" class="ltx_Math" display="inline" id="A2.p2.3.m3.1"><semantics id="A2.p2.3.m3.1a"><mo id="A2.p2.3.m3.1.1" xref="A2.p2.3.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="A2.p2.3.m3.1b"><times id="A2.p2.3.m3.1.1.cmml" xref="A2.p2.3.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="A2.p2.3.m3.1c">\times</annotation><annotation encoding="application/x-llamapun" id="A2.p2.3.m3.1d">×</annotation></semantics></math> 100%, where "Number of Queries in Bin" is the count of hard queries with a ratio within that bin’s range, and "Total Number of Hard Queries" represents the total number of hard queries for that dataset.</p>
</div>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>The Limitations of Contrastive Learning</h2>
<div class="ltx_para" id="A3.p1">
<p class="ltx_p" id="A3.p1.1">In in-context learning, it is necessary to find demonstrations that are truly useful for the LLM to predict the ground truth. The goal of in-context learning is as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="A3.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\underset{(x_{k},y_{k})\in\mathcal{P}}{\arg\max}P_{\mathcal{M}}(y\mid\left\{(x%
_{k},y_{k})\right\}_{k=1}^{K},x)" class="ltx_Math" display="block" id="A3.Ex1.m1.4"><semantics id="A3.Ex1.m1.4a"><mrow id="A3.Ex1.m1.4.4" xref="A3.Ex1.m1.4.4.cmml"><munder accentunder="true" id="A3.Ex1.m1.2.2" xref="A3.Ex1.m1.2.2.cmml"><mrow id="A3.Ex1.m1.2.2.3" xref="A3.Ex1.m1.2.2.3.cmml"><mi id="A3.Ex1.m1.2.2.3.1" xref="A3.Ex1.m1.2.2.3.1.cmml">arg</mi><mo id="A3.Ex1.m1.2.2.3a" lspace="0.167em" xref="A3.Ex1.m1.2.2.3.cmml">⁡</mo><mi id="A3.Ex1.m1.2.2.3.2" xref="A3.Ex1.m1.2.2.3.2.cmml">max</mi></mrow><mrow id="A3.Ex1.m1.2.2.2" xref="A3.Ex1.m1.2.2.2.cmml"><mrow id="A3.Ex1.m1.2.2.2.2.2" xref="A3.Ex1.m1.2.2.2.2.3.cmml"><mo id="A3.Ex1.m1.2.2.2.2.2.3" stretchy="false" xref="A3.Ex1.m1.2.2.2.2.3.cmml">(</mo><msub id="A3.Ex1.m1.1.1.1.1.1.1" xref="A3.Ex1.m1.1.1.1.1.1.1.cmml"><mi id="A3.Ex1.m1.1.1.1.1.1.1.2" xref="A3.Ex1.m1.1.1.1.1.1.1.2.cmml">x</mi><mi id="A3.Ex1.m1.1.1.1.1.1.1.3" xref="A3.Ex1.m1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A3.Ex1.m1.2.2.2.2.2.4" xref="A3.Ex1.m1.2.2.2.2.3.cmml">,</mo><msub id="A3.Ex1.m1.2.2.2.2.2.2" xref="A3.Ex1.m1.2.2.2.2.2.2.cmml"><mi id="A3.Ex1.m1.2.2.2.2.2.2.2" xref="A3.Ex1.m1.2.2.2.2.2.2.2.cmml">y</mi><mi id="A3.Ex1.m1.2.2.2.2.2.2.3" xref="A3.Ex1.m1.2.2.2.2.2.2.3.cmml">k</mi></msub><mo id="A3.Ex1.m1.2.2.2.2.2.5" stretchy="false" xref="A3.Ex1.m1.2.2.2.2.3.cmml">)</mo></mrow><mo id="A3.Ex1.m1.2.2.2.3" xref="A3.Ex1.m1.2.2.2.3.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="A3.Ex1.m1.2.2.2.4" xref="A3.Ex1.m1.2.2.2.4.cmml">𝒫</mi></mrow></munder><mo id="A3.Ex1.m1.4.4.2" xref="A3.Ex1.m1.4.4.2.cmml">⁢</mo><msub id="A3.Ex1.m1.4.4.3" xref="A3.Ex1.m1.4.4.3.cmml"><mi id="A3.Ex1.m1.4.4.3.2" xref="A3.Ex1.m1.4.4.3.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A3.Ex1.m1.4.4.3.3" xref="A3.Ex1.m1.4.4.3.3.cmml">ℳ</mi></msub><mo id="A3.Ex1.m1.4.4.2a" xref="A3.Ex1.m1.4.4.2.cmml">⁢</mo><mrow id="A3.Ex1.m1.4.4.1.1" xref="A3.Ex1.m1.4.4.1.1.1.cmml"><mo id="A3.Ex1.m1.4.4.1.1.2" stretchy="false" xref="A3.Ex1.m1.4.4.1.1.1.cmml">(</mo><mrow id="A3.Ex1.m1.4.4.1.1.1" xref="A3.Ex1.m1.4.4.1.1.1.cmml"><mi id="A3.Ex1.m1.4.4.1.1.1.3" xref="A3.Ex1.m1.4.4.1.1.1.3.cmml">y</mi><mo id="A3.Ex1.m1.4.4.1.1.1.2" xref="A3.Ex1.m1.4.4.1.1.1.2.cmml">∣</mo><mrow id="A3.Ex1.m1.4.4.1.1.1.1.1" xref="A3.Ex1.m1.4.4.1.1.1.1.2.cmml"><msubsup id="A3.Ex1.m1.4.4.1.1.1.1.1.1" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.cmml"><mrow id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml"><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.4" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">y</mi><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.cmml"><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.2" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.1" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A3.Ex1.m1.4.4.1.1.1.1.1.1.3" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A3.Ex1.m1.4.4.1.1.1.1.1.2" xref="A3.Ex1.m1.4.4.1.1.1.1.2.cmml">,</mo><mi id="A3.Ex1.m1.3.3" xref="A3.Ex1.m1.3.3.cmml">x</mi></mrow></mrow><mo id="A3.Ex1.m1.4.4.1.1.3" stretchy="false" xref="A3.Ex1.m1.4.4.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A3.Ex1.m1.4b"><apply id="A3.Ex1.m1.4.4.cmml" xref="A3.Ex1.m1.4.4"><times id="A3.Ex1.m1.4.4.2.cmml" xref="A3.Ex1.m1.4.4.2"></times><apply id="A3.Ex1.m1.2.2.cmml" xref="A3.Ex1.m1.2.2"><apply id="A3.Ex1.m1.2.2.2.cmml" xref="A3.Ex1.m1.2.2.2"><in id="A3.Ex1.m1.2.2.2.3.cmml" xref="A3.Ex1.m1.2.2.2.3"></in><interval closure="open" id="A3.Ex1.m1.2.2.2.2.3.cmml" xref="A3.Ex1.m1.2.2.2.2.2"><apply id="A3.Ex1.m1.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex1.m1.1.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.1.1.1.1.1.1">subscript</csymbol><ci id="A3.Ex1.m1.1.1.1.1.1.1.2.cmml" xref="A3.Ex1.m1.1.1.1.1.1.1.2">𝑥</ci><ci id="A3.Ex1.m1.1.1.1.1.1.1.3.cmml" xref="A3.Ex1.m1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A3.Ex1.m1.2.2.2.2.2.2.cmml" xref="A3.Ex1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="A3.Ex1.m1.2.2.2.2.2.2.1.cmml" xref="A3.Ex1.m1.2.2.2.2.2.2">subscript</csymbol><ci id="A3.Ex1.m1.2.2.2.2.2.2.2.cmml" xref="A3.Ex1.m1.2.2.2.2.2.2.2">𝑦</ci><ci id="A3.Ex1.m1.2.2.2.2.2.2.3.cmml" xref="A3.Ex1.m1.2.2.2.2.2.2.3">𝑘</ci></apply></interval><ci id="A3.Ex1.m1.2.2.2.4.cmml" xref="A3.Ex1.m1.2.2.2.4">𝒫</ci></apply><apply id="A3.Ex1.m1.2.2.3.cmml" xref="A3.Ex1.m1.2.2.3"><arg id="A3.Ex1.m1.2.2.3.1.cmml" xref="A3.Ex1.m1.2.2.3.1"></arg><max id="A3.Ex1.m1.2.2.3.2.cmml" xref="A3.Ex1.m1.2.2.3.2"></max></apply></apply><apply id="A3.Ex1.m1.4.4.3.cmml" xref="A3.Ex1.m1.4.4.3"><csymbol cd="ambiguous" id="A3.Ex1.m1.4.4.3.1.cmml" xref="A3.Ex1.m1.4.4.3">subscript</csymbol><ci id="A3.Ex1.m1.4.4.3.2.cmml" xref="A3.Ex1.m1.4.4.3.2">𝑃</ci><ci id="A3.Ex1.m1.4.4.3.3.cmml" xref="A3.Ex1.m1.4.4.3.3">ℳ</ci></apply><apply id="A3.Ex1.m1.4.4.1.1.1.cmml" xref="A3.Ex1.m1.4.4.1.1"><csymbol cd="latexml" id="A3.Ex1.m1.4.4.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.2">conditional</csymbol><ci id="A3.Ex1.m1.4.4.1.1.1.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.3">𝑦</ci><list id="A3.Ex1.m1.4.4.1.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1"><apply id="A3.Ex1.m1.4.4.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex1.m1.4.4.1.1.1.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1">superscript</csymbol><apply id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1">subscript</csymbol><set id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1"><interval closure="open" id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2"><apply id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.2">𝑦</ci><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3"><eq id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.1.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.1"></eq><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.2.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A3.Ex1.m1.4.4.1.1.1.1.1.1.3.cmml" xref="A3.Ex1.m1.4.4.1.1.1.1.1.1.3">𝐾</ci></apply><ci id="A3.Ex1.m1.3.3.cmml" xref="A3.Ex1.m1.3.3">𝑥</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.Ex1.m1.4c">\underset{(x_{k},y_{k})\in\mathcal{P}}{\arg\max}P_{\mathcal{M}}(y\mid\left\{(x%
_{k},y_{k})\right\}_{k=1}^{K},x)</annotation><annotation encoding="application/x-llamapun" id="A3.Ex1.m1.4d">start_UNDERACCENT ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∈ caligraphic_P end_UNDERACCENT start_ARG roman_arg roman_max end_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_y ∣ { ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A3.p1.2">However, the objective of contrastive learning is to minimize the following loss.</p>
<table class="ltx_equation ltx_eqn_table" id="A3.Ex2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}=-\log\left(\frac{e^{s(x,x^{+},y^{+})}}{e^{s(x,(x^{+},y^{+}))}+\sum%
_{i=1}^{N_{\text{neg}}}e^{s(x,(x_{i}^{-},y_{i}^{-}))}}\right)" class="ltx_Math" display="block" id="A3.Ex2.m1.8"><semantics id="A3.Ex2.m1.8a"><mrow id="A3.Ex2.m1.8.9" xref="A3.Ex2.m1.8.9.cmml"><mi class="ltx_font_mathcaligraphic" id="A3.Ex2.m1.8.9.2" xref="A3.Ex2.m1.8.9.2.cmml">ℒ</mi><mo id="A3.Ex2.m1.8.9.1" xref="A3.Ex2.m1.8.9.1.cmml">=</mo><mrow id="A3.Ex2.m1.8.9.3" xref="A3.Ex2.m1.8.9.3.cmml"><mo id="A3.Ex2.m1.8.9.3a" rspace="0.167em" xref="A3.Ex2.m1.8.9.3.cmml">−</mo><mrow id="A3.Ex2.m1.8.9.3.2.2" xref="A3.Ex2.m1.8.9.3.2.1.cmml"><mi id="A3.Ex2.m1.8.8" xref="A3.Ex2.m1.8.8.cmml">log</mi><mo id="A3.Ex2.m1.8.9.3.2.2a" xref="A3.Ex2.m1.8.9.3.2.1.cmml">⁡</mo><mrow id="A3.Ex2.m1.8.9.3.2.2.1" xref="A3.Ex2.m1.8.9.3.2.1.cmml"><mo id="A3.Ex2.m1.8.9.3.2.2.1.1" xref="A3.Ex2.m1.8.9.3.2.1.cmml">(</mo><mfrac id="A3.Ex2.m1.7.7" xref="A3.Ex2.m1.7.7.cmml"><msup id="A3.Ex2.m1.3.3.3" xref="A3.Ex2.m1.3.3.3.cmml"><mi id="A3.Ex2.m1.3.3.3.5" xref="A3.Ex2.m1.3.3.3.5.cmml">e</mi><mrow id="A3.Ex2.m1.3.3.3.3.3" xref="A3.Ex2.m1.3.3.3.3.3.cmml"><mi id="A3.Ex2.m1.3.3.3.3.3.5" xref="A3.Ex2.m1.3.3.3.3.3.5.cmml">s</mi><mo id="A3.Ex2.m1.3.3.3.3.3.4" xref="A3.Ex2.m1.3.3.3.3.3.4.cmml">⁢</mo><mrow id="A3.Ex2.m1.3.3.3.3.3.3.2" xref="A3.Ex2.m1.3.3.3.3.3.3.3.cmml"><mo id="A3.Ex2.m1.3.3.3.3.3.3.2.3" stretchy="false" xref="A3.Ex2.m1.3.3.3.3.3.3.3.cmml">(</mo><mi id="A3.Ex2.m1.1.1.1.1.1.1" xref="A3.Ex2.m1.1.1.1.1.1.1.cmml">x</mi><mo id="A3.Ex2.m1.3.3.3.3.3.3.2.4" xref="A3.Ex2.m1.3.3.3.3.3.3.3.cmml">,</mo><msup id="A3.Ex2.m1.2.2.2.2.2.2.1.1" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1.cmml"><mi id="A3.Ex2.m1.2.2.2.2.2.2.1.1.2" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1.2.cmml">x</mi><mo id="A3.Ex2.m1.2.2.2.2.2.2.1.1.3" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1.3.cmml">+</mo></msup><mo id="A3.Ex2.m1.3.3.3.3.3.3.2.5" xref="A3.Ex2.m1.3.3.3.3.3.3.3.cmml">,</mo><msup id="A3.Ex2.m1.3.3.3.3.3.3.2.2" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2.cmml"><mi id="A3.Ex2.m1.3.3.3.3.3.3.2.2.2" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2.2.cmml">y</mi><mo id="A3.Ex2.m1.3.3.3.3.3.3.2.2.3" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2.3.cmml">+</mo></msup><mo id="A3.Ex2.m1.3.3.3.3.3.3.2.6" stretchy="false" xref="A3.Ex2.m1.3.3.3.3.3.3.3.cmml">)</mo></mrow></mrow></msup><mrow id="A3.Ex2.m1.7.7.7" xref="A3.Ex2.m1.7.7.7.cmml"><msup id="A3.Ex2.m1.7.7.7.6" xref="A3.Ex2.m1.7.7.7.6.cmml"><mi id="A3.Ex2.m1.7.7.7.6.2" xref="A3.Ex2.m1.7.7.7.6.2.cmml">e</mi><mrow id="A3.Ex2.m1.5.5.5.2.2" xref="A3.Ex2.m1.5.5.5.2.2.cmml"><mi id="A3.Ex2.m1.5.5.5.2.2.4" xref="A3.Ex2.m1.5.5.5.2.2.4.cmml">s</mi><mo id="A3.Ex2.m1.5.5.5.2.2.3" xref="A3.Ex2.m1.5.5.5.2.2.3.cmml">⁢</mo><mrow id="A3.Ex2.m1.5.5.5.2.2.2.1" xref="A3.Ex2.m1.5.5.5.2.2.2.2.cmml"><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.2" stretchy="false" xref="A3.Ex2.m1.5.5.5.2.2.2.2.cmml">(</mo><mi id="A3.Ex2.m1.4.4.4.1.1.1" xref="A3.Ex2.m1.4.4.4.1.1.1.cmml">x</mi><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.3" xref="A3.Ex2.m1.5.5.5.2.2.2.2.cmml">,</mo><mrow id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.3.cmml"><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.3" stretchy="false" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.3.cmml">(</mo><msup id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.cmml"><mi id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.2" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.2.cmml">x</mi><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.3" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.3.cmml">+</mo></msup><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.4" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.3.cmml">,</mo><msup id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.cmml"><mi id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.2" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.2.cmml">y</mi><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.3" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.3.cmml">+</mo></msup><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.5" stretchy="false" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.3.cmml">)</mo></mrow><mo id="A3.Ex2.m1.5.5.5.2.2.2.1.4" stretchy="false" xref="A3.Ex2.m1.5.5.5.2.2.2.2.cmml">)</mo></mrow></mrow></msup><mo id="A3.Ex2.m1.7.7.7.5" rspace="0.055em" xref="A3.Ex2.m1.7.7.7.5.cmml">+</mo><mrow id="A3.Ex2.m1.7.7.7.7" xref="A3.Ex2.m1.7.7.7.7.cmml"><msubsup id="A3.Ex2.m1.7.7.7.7.1" xref="A3.Ex2.m1.7.7.7.7.1.cmml"><mo id="A3.Ex2.m1.7.7.7.7.1.2.2" xref="A3.Ex2.m1.7.7.7.7.1.2.2.cmml">∑</mo><mrow id="A3.Ex2.m1.7.7.7.7.1.2.3" xref="A3.Ex2.m1.7.7.7.7.1.2.3.cmml"><mi id="A3.Ex2.m1.7.7.7.7.1.2.3.2" xref="A3.Ex2.m1.7.7.7.7.1.2.3.2.cmml">i</mi><mo id="A3.Ex2.m1.7.7.7.7.1.2.3.1" xref="A3.Ex2.m1.7.7.7.7.1.2.3.1.cmml">=</mo><mn id="A3.Ex2.m1.7.7.7.7.1.2.3.3" xref="A3.Ex2.m1.7.7.7.7.1.2.3.3.cmml">1</mn></mrow><msub id="A3.Ex2.m1.7.7.7.7.1.3" xref="A3.Ex2.m1.7.7.7.7.1.3.cmml"><mi id="A3.Ex2.m1.7.7.7.7.1.3.2" xref="A3.Ex2.m1.7.7.7.7.1.3.2.cmml">N</mi><mtext id="A3.Ex2.m1.7.7.7.7.1.3.3" xref="A3.Ex2.m1.7.7.7.7.1.3.3a.cmml">neg</mtext></msub></msubsup><msup id="A3.Ex2.m1.7.7.7.7.2" xref="A3.Ex2.m1.7.7.7.7.2.cmml"><mi id="A3.Ex2.m1.7.7.7.7.2.2" xref="A3.Ex2.m1.7.7.7.7.2.2.cmml">e</mi><mrow id="A3.Ex2.m1.7.7.7.4.2" xref="A3.Ex2.m1.7.7.7.4.2.cmml"><mi id="A3.Ex2.m1.7.7.7.4.2.4" xref="A3.Ex2.m1.7.7.7.4.2.4.cmml">s</mi><mo id="A3.Ex2.m1.7.7.7.4.2.3" xref="A3.Ex2.m1.7.7.7.4.2.3.cmml">⁢</mo><mrow id="A3.Ex2.m1.7.7.7.4.2.2.1" xref="A3.Ex2.m1.7.7.7.4.2.2.2.cmml"><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.2" stretchy="false" xref="A3.Ex2.m1.7.7.7.4.2.2.2.cmml">(</mo><mi id="A3.Ex2.m1.6.6.6.3.1.1" xref="A3.Ex2.m1.6.6.6.3.1.1.cmml">x</mi><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.3" xref="A3.Ex2.m1.7.7.7.4.2.2.2.cmml">,</mo><mrow id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.3.cmml"><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.3" stretchy="false" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.3.cmml">(</mo><msubsup id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.cmml"><mi id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.2" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.2.cmml">x</mi><mi id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.3" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.3.cmml">i</mi><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.3" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.3.cmml">−</mo></msubsup><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.4" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.3.cmml">,</mo><msubsup id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.cmml"><mi id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.2" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.2.cmml">y</mi><mi id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.3" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.3.cmml">i</mi><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.3" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.3.cmml">−</mo></msubsup><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.5" stretchy="false" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.3.cmml">)</mo></mrow><mo id="A3.Ex2.m1.7.7.7.4.2.2.1.4" stretchy="false" xref="A3.Ex2.m1.7.7.7.4.2.2.2.cmml">)</mo></mrow></mrow></msup></mrow></mrow></mfrac><mo id="A3.Ex2.m1.8.9.3.2.2.1.2" xref="A3.Ex2.m1.8.9.3.2.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A3.Ex2.m1.8b"><apply id="A3.Ex2.m1.8.9.cmml" xref="A3.Ex2.m1.8.9"><eq id="A3.Ex2.m1.8.9.1.cmml" xref="A3.Ex2.m1.8.9.1"></eq><ci id="A3.Ex2.m1.8.9.2.cmml" xref="A3.Ex2.m1.8.9.2">ℒ</ci><apply id="A3.Ex2.m1.8.9.3.cmml" xref="A3.Ex2.m1.8.9.3"><minus id="A3.Ex2.m1.8.9.3.1.cmml" xref="A3.Ex2.m1.8.9.3"></minus><apply id="A3.Ex2.m1.8.9.3.2.1.cmml" xref="A3.Ex2.m1.8.9.3.2.2"><log id="A3.Ex2.m1.8.8.cmml" xref="A3.Ex2.m1.8.8"></log><apply id="A3.Ex2.m1.7.7.cmml" xref="A3.Ex2.m1.7.7"><divide id="A3.Ex2.m1.7.7.8.cmml" xref="A3.Ex2.m1.7.7"></divide><apply id="A3.Ex2.m1.3.3.3.cmml" xref="A3.Ex2.m1.3.3.3"><csymbol cd="ambiguous" id="A3.Ex2.m1.3.3.3.4.cmml" xref="A3.Ex2.m1.3.3.3">superscript</csymbol><ci id="A3.Ex2.m1.3.3.3.5.cmml" xref="A3.Ex2.m1.3.3.3.5">𝑒</ci><apply id="A3.Ex2.m1.3.3.3.3.3.cmml" xref="A3.Ex2.m1.3.3.3.3.3"><times id="A3.Ex2.m1.3.3.3.3.3.4.cmml" xref="A3.Ex2.m1.3.3.3.3.3.4"></times><ci id="A3.Ex2.m1.3.3.3.3.3.5.cmml" xref="A3.Ex2.m1.3.3.3.3.3.5">𝑠</ci><vector id="A3.Ex2.m1.3.3.3.3.3.3.3.cmml" xref="A3.Ex2.m1.3.3.3.3.3.3.2"><ci id="A3.Ex2.m1.1.1.1.1.1.1.cmml" xref="A3.Ex2.m1.1.1.1.1.1.1">𝑥</ci><apply id="A3.Ex2.m1.2.2.2.2.2.2.1.1.cmml" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.2.2.2.2.2.2.1.1.1.cmml" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1">superscript</csymbol><ci id="A3.Ex2.m1.2.2.2.2.2.2.1.1.2.cmml" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1.2">𝑥</ci><plus id="A3.Ex2.m1.2.2.2.2.2.2.1.1.3.cmml" xref="A3.Ex2.m1.2.2.2.2.2.2.1.1.3"></plus></apply><apply id="A3.Ex2.m1.3.3.3.3.3.3.2.2.cmml" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2"><csymbol cd="ambiguous" id="A3.Ex2.m1.3.3.3.3.3.3.2.2.1.cmml" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2">superscript</csymbol><ci id="A3.Ex2.m1.3.3.3.3.3.3.2.2.2.cmml" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2.2">𝑦</ci><plus id="A3.Ex2.m1.3.3.3.3.3.3.2.2.3.cmml" xref="A3.Ex2.m1.3.3.3.3.3.3.2.2.3"></plus></apply></vector></apply></apply><apply id="A3.Ex2.m1.7.7.7.cmml" xref="A3.Ex2.m1.7.7.7"><plus id="A3.Ex2.m1.7.7.7.5.cmml" xref="A3.Ex2.m1.7.7.7.5"></plus><apply id="A3.Ex2.m1.7.7.7.6.cmml" xref="A3.Ex2.m1.7.7.7.6"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.6.1.cmml" xref="A3.Ex2.m1.7.7.7.6">superscript</csymbol><ci id="A3.Ex2.m1.7.7.7.6.2.cmml" xref="A3.Ex2.m1.7.7.7.6.2">𝑒</ci><apply id="A3.Ex2.m1.5.5.5.2.2.cmml" xref="A3.Ex2.m1.5.5.5.2.2"><times id="A3.Ex2.m1.5.5.5.2.2.3.cmml" xref="A3.Ex2.m1.5.5.5.2.2.3"></times><ci id="A3.Ex2.m1.5.5.5.2.2.4.cmml" xref="A3.Ex2.m1.5.5.5.2.2.4">𝑠</ci><interval closure="open" id="A3.Ex2.m1.5.5.5.2.2.2.2.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1"><ci id="A3.Ex2.m1.4.4.4.1.1.1.cmml" xref="A3.Ex2.m1.4.4.4.1.1.1">𝑥</ci><interval closure="open" id="A3.Ex2.m1.5.5.5.2.2.2.1.1.3.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2"><apply id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.1.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1">superscript</csymbol><ci id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.2.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.2">𝑥</ci><plus id="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.3.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.1.1.3"></plus></apply><apply id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2"><csymbol cd="ambiguous" id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.1.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2">superscript</csymbol><ci id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.2.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.2">𝑦</ci><plus id="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.3.cmml" xref="A3.Ex2.m1.5.5.5.2.2.2.1.1.2.2.3"></plus></apply></interval></interval></apply></apply><apply id="A3.Ex2.m1.7.7.7.7.cmml" xref="A3.Ex2.m1.7.7.7.7"><apply id="A3.Ex2.m1.7.7.7.7.1.cmml" xref="A3.Ex2.m1.7.7.7.7.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.7.1.1.cmml" xref="A3.Ex2.m1.7.7.7.7.1">superscript</csymbol><apply id="A3.Ex2.m1.7.7.7.7.1.2.cmml" xref="A3.Ex2.m1.7.7.7.7.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.7.1.2.1.cmml" xref="A3.Ex2.m1.7.7.7.7.1">subscript</csymbol><sum id="A3.Ex2.m1.7.7.7.7.1.2.2.cmml" xref="A3.Ex2.m1.7.7.7.7.1.2.2"></sum><apply id="A3.Ex2.m1.7.7.7.7.1.2.3.cmml" xref="A3.Ex2.m1.7.7.7.7.1.2.3"><eq id="A3.Ex2.m1.7.7.7.7.1.2.3.1.cmml" xref="A3.Ex2.m1.7.7.7.7.1.2.3.1"></eq><ci id="A3.Ex2.m1.7.7.7.7.1.2.3.2.cmml" xref="A3.Ex2.m1.7.7.7.7.1.2.3.2">𝑖</ci><cn id="A3.Ex2.m1.7.7.7.7.1.2.3.3.cmml" type="integer" xref="A3.Ex2.m1.7.7.7.7.1.2.3.3">1</cn></apply></apply><apply id="A3.Ex2.m1.7.7.7.7.1.3.cmml" xref="A3.Ex2.m1.7.7.7.7.1.3"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.7.1.3.1.cmml" xref="A3.Ex2.m1.7.7.7.7.1.3">subscript</csymbol><ci id="A3.Ex2.m1.7.7.7.7.1.3.2.cmml" xref="A3.Ex2.m1.7.7.7.7.1.3.2">𝑁</ci><ci id="A3.Ex2.m1.7.7.7.7.1.3.3a.cmml" xref="A3.Ex2.m1.7.7.7.7.1.3.3"><mtext id="A3.Ex2.m1.7.7.7.7.1.3.3.cmml" mathsize="50%" xref="A3.Ex2.m1.7.7.7.7.1.3.3">neg</mtext></ci></apply></apply><apply id="A3.Ex2.m1.7.7.7.7.2.cmml" xref="A3.Ex2.m1.7.7.7.7.2"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.7.2.1.cmml" xref="A3.Ex2.m1.7.7.7.7.2">superscript</csymbol><ci id="A3.Ex2.m1.7.7.7.7.2.2.cmml" xref="A3.Ex2.m1.7.7.7.7.2.2">𝑒</ci><apply id="A3.Ex2.m1.7.7.7.4.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2"><times id="A3.Ex2.m1.7.7.7.4.2.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.3"></times><ci id="A3.Ex2.m1.7.7.7.4.2.4.cmml" xref="A3.Ex2.m1.7.7.7.4.2.4">𝑠</ci><interval closure="open" id="A3.Ex2.m1.7.7.7.4.2.2.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1"><ci id="A3.Ex2.m1.6.6.6.3.1.1.cmml" xref="A3.Ex2.m1.6.6.6.3.1.1">𝑥</ci><interval closure="open" id="A3.Ex2.m1.7.7.7.4.2.2.1.1.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2"><apply id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.1.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1">superscript</csymbol><apply id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.1.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1">subscript</csymbol><ci id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.2">𝑥</ci><ci id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.2.3">𝑖</ci></apply><minus id="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.1.1.3"></minus></apply><apply id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.1.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2">superscript</csymbol><apply id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2"><csymbol cd="ambiguous" id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.1.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2">subscript</csymbol><ci id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.2.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.2">𝑦</ci><ci id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.2.3">𝑖</ci></apply><minus id="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.3.cmml" xref="A3.Ex2.m1.7.7.7.4.2.2.1.1.2.2.3"></minus></apply></interval></interval></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.Ex2.m1.8c">\mathcal{L}=-\log\left(\frac{e^{s(x,x^{+},y^{+})}}{e^{s(x,(x^{+},y^{+}))}+\sum%
_{i=1}^{N_{\text{neg}}}e^{s(x,(x_{i}^{-},y_{i}^{-}))}}\right)</annotation><annotation encoding="application/x-llamapun" id="A3.Ex2.m1.8d">caligraphic_L = - roman_log ( divide start_ARG italic_e start_POSTSUPERSCRIPT italic_s ( italic_x , italic_x start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) end_POSTSUPERSCRIPT end_ARG start_ARG italic_e start_POSTSUPERSCRIPT italic_s ( italic_x , ( italic_x start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT ) ) end_POSTSUPERSCRIPT + ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT neg end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_e start_POSTSUPERSCRIPT italic_s ( italic_x , ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT ) ) end_POSTSUPERSCRIPT end_ARG )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A3.p2">
<p class="ltx_p" id="A3.p2.2">In the optimization process of contrastive learning, the objective shifts to optimizing the retriever by comparing the similarity between different samples. Specifically, the model is trained to distinguish between positive samples <math alttext="(x^{+},y^{+})" class="ltx_Math" display="inline" id="A3.p2.1.m1.2"><semantics id="A3.p2.1.m1.2a"><mrow id="A3.p2.1.m1.2.2.2" xref="A3.p2.1.m1.2.2.3.cmml"><mo id="A3.p2.1.m1.2.2.2.3" stretchy="false" xref="A3.p2.1.m1.2.2.3.cmml">(</mo><msup id="A3.p2.1.m1.1.1.1.1" xref="A3.p2.1.m1.1.1.1.1.cmml"><mi id="A3.p2.1.m1.1.1.1.1.2" xref="A3.p2.1.m1.1.1.1.1.2.cmml">x</mi><mo id="A3.p2.1.m1.1.1.1.1.3" xref="A3.p2.1.m1.1.1.1.1.3.cmml">+</mo></msup><mo id="A3.p2.1.m1.2.2.2.4" xref="A3.p2.1.m1.2.2.3.cmml">,</mo><msup id="A3.p2.1.m1.2.2.2.2" xref="A3.p2.1.m1.2.2.2.2.cmml"><mi id="A3.p2.1.m1.2.2.2.2.2" xref="A3.p2.1.m1.2.2.2.2.2.cmml">y</mi><mo id="A3.p2.1.m1.2.2.2.2.3" xref="A3.p2.1.m1.2.2.2.2.3.cmml">+</mo></msup><mo id="A3.p2.1.m1.2.2.2.5" stretchy="false" xref="A3.p2.1.m1.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A3.p2.1.m1.2b"><interval closure="open" id="A3.p2.1.m1.2.2.3.cmml" xref="A3.p2.1.m1.2.2.2"><apply id="A3.p2.1.m1.1.1.1.1.cmml" xref="A3.p2.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="A3.p2.1.m1.1.1.1.1.1.cmml" xref="A3.p2.1.m1.1.1.1.1">superscript</csymbol><ci id="A3.p2.1.m1.1.1.1.1.2.cmml" xref="A3.p2.1.m1.1.1.1.1.2">𝑥</ci><plus id="A3.p2.1.m1.1.1.1.1.3.cmml" xref="A3.p2.1.m1.1.1.1.1.3"></plus></apply><apply id="A3.p2.1.m1.2.2.2.2.cmml" xref="A3.p2.1.m1.2.2.2.2"><csymbol cd="ambiguous" id="A3.p2.1.m1.2.2.2.2.1.cmml" xref="A3.p2.1.m1.2.2.2.2">superscript</csymbol><ci id="A3.p2.1.m1.2.2.2.2.2.cmml" xref="A3.p2.1.m1.2.2.2.2.2">𝑦</ci><plus id="A3.p2.1.m1.2.2.2.2.3.cmml" xref="A3.p2.1.m1.2.2.2.2.3"></plus></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.1.m1.2c">(x^{+},y^{+})</annotation><annotation encoding="application/x-llamapun" id="A3.p2.1.m1.2d">( italic_x start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT + end_POSTSUPERSCRIPT )</annotation></semantics></math> and negative samples <math alttext="(x^{-},y^{-})" class="ltx_Math" display="inline" id="A3.p2.2.m2.2"><semantics id="A3.p2.2.m2.2a"><mrow id="A3.p2.2.m2.2.2.2" xref="A3.p2.2.m2.2.2.3.cmml"><mo id="A3.p2.2.m2.2.2.2.3" stretchy="false" xref="A3.p2.2.m2.2.2.3.cmml">(</mo><msup id="A3.p2.2.m2.1.1.1.1" xref="A3.p2.2.m2.1.1.1.1.cmml"><mi id="A3.p2.2.m2.1.1.1.1.2" xref="A3.p2.2.m2.1.1.1.1.2.cmml">x</mi><mo id="A3.p2.2.m2.1.1.1.1.3" xref="A3.p2.2.m2.1.1.1.1.3.cmml">−</mo></msup><mo id="A3.p2.2.m2.2.2.2.4" xref="A3.p2.2.m2.2.2.3.cmml">,</mo><msup id="A3.p2.2.m2.2.2.2.2" xref="A3.p2.2.m2.2.2.2.2.cmml"><mi id="A3.p2.2.m2.2.2.2.2.2" xref="A3.p2.2.m2.2.2.2.2.2.cmml">y</mi><mo id="A3.p2.2.m2.2.2.2.2.3" xref="A3.p2.2.m2.2.2.2.2.3.cmml">−</mo></msup><mo id="A3.p2.2.m2.2.2.2.5" stretchy="false" xref="A3.p2.2.m2.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A3.p2.2.m2.2b"><interval closure="open" id="A3.p2.2.m2.2.2.3.cmml" xref="A3.p2.2.m2.2.2.2"><apply id="A3.p2.2.m2.1.1.1.1.cmml" xref="A3.p2.2.m2.1.1.1.1"><csymbol cd="ambiguous" id="A3.p2.2.m2.1.1.1.1.1.cmml" xref="A3.p2.2.m2.1.1.1.1">superscript</csymbol><ci id="A3.p2.2.m2.1.1.1.1.2.cmml" xref="A3.p2.2.m2.1.1.1.1.2">𝑥</ci><minus id="A3.p2.2.m2.1.1.1.1.3.cmml" xref="A3.p2.2.m2.1.1.1.1.3"></minus></apply><apply id="A3.p2.2.m2.2.2.2.2.cmml" xref="A3.p2.2.m2.2.2.2.2"><csymbol cd="ambiguous" id="A3.p2.2.m2.2.2.2.2.1.cmml" xref="A3.p2.2.m2.2.2.2.2">superscript</csymbol><ci id="A3.p2.2.m2.2.2.2.2.2.cmml" xref="A3.p2.2.m2.2.2.2.2.2">𝑦</ci><minus id="A3.p2.2.m2.2.2.2.2.3.cmml" xref="A3.p2.2.m2.2.2.2.2.3"></minus></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.2.m2.2c">(x^{-},y^{-})</annotation><annotation encoding="application/x-llamapun" id="A3.p2.2.m2.2d">( italic_x start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT , italic_y start_POSTSUPERSCRIPT - end_POSTSUPERSCRIPT )</annotation></semantics></math>, optimizing the model by maximizing the separation between positive and negative samples. This method enlarges the distance between positive and negative samples in the embedding space, which is not aligned with in-context learning. Furthermore, it completely ignores the information about the ground truth during optimization, leading to demonstrations selected by this method that do not improve the LLM’s ability to predict the ground truth.</p>
</div>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>Derivation of the Optimization Objective</h2>
<div class="ltx_para" id="A4.p1">
<p class="ltx_p" id="A4.p1.4">Starting from the marginal likelihood,</p>
<table class="ltx_equation ltx_eqn_table" id="A4.p1.1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\log P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)=\\
\log\int_{z}P_{\mathcal{M}}(Y\mid z,X)\,\times\\
P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)\,dz" class="ltx_Math" display="block" id="A4.p1.1.m1.60"><semantics id="A4.p1.1.m1.60a"><mtable displaystyle="true" id="A4.p1.1.m1.60.60.5" rowspacing="0pt" xref="A4.p1.1.m1.58.58.3.cmml"><mtr id="A4.p1.1.m1.60.60.5a" xref="A4.p1.1.m1.58.58.3.cmml"><mtd class="ltx_align_left" columnalign="left" id="A4.p1.1.m1.60.60.5b" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.59.59.4.56.22.22" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.3" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.1.1.1.1.1.1" xref="A4.p1.1.m1.1.1.1.1.1.1.cmml">log</mi><mo id="A4.p1.1.m1.59.59.4.56.22.22.22.3a" lspace="0.167em" xref="A4.p1.1.m1.58.58.3.cmml">⁡</mo><msub id="A4.p1.1.m1.59.59.4.56.22.22.22.3.1" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.2.2.2.2.2.2" xref="A4.p1.1.m1.2.2.2.2.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p1.1.m1.3.3.3.3.3.3.1" xref="A4.p1.1.m1.3.3.3.3.3.3.1.cmml">ℳ</mi></msub></mrow><mo id="A4.p1.1.m1.59.59.4.56.22.22.22.2" xref="A4.p1.1.m1.58.58.3.cmml">⁢</mo><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.4.4.4.4.4.4" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">(</mo><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.5.5.5.5.5.5" xref="A4.p1.1.m1.5.5.5.5.5.5.cmml">Y</mi><mo id="A4.p1.1.m1.6.6.6.6.6.6" xref="A4.p1.1.m1.6.6.6.6.6.6.cmml">∣</mo><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><msubsup id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.7.7.7.7.7.7" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">{</mo><mrow id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.8.8.8.8.8.8" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">(</mo><msub id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.9.9.9.9.9.9" xref="A4.p1.1.m1.9.9.9.9.9.9.cmml">X</mi><mi id="A4.p1.1.m1.10.10.10.10.10.10.1" xref="A4.p1.1.m1.10.10.10.10.10.10.1.cmml">k</mi></msub><mo id="A4.p1.1.m1.11.11.11.11.11.11" xref="A4.p1.1.m1.58.58.3.cmml">,</mo><msub id="A4.p1.1.m1.59.59.4.56.22.22.22.1.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.12.12.12.12.12.12" xref="A4.p1.1.m1.12.12.12.12.12.12.cmml">Y</mi><mi id="A4.p1.1.m1.13.13.13.13.13.13.1" xref="A4.p1.1.m1.13.13.13.13.13.13.1.cmml">k</mi></msub><mo id="A4.p1.1.m1.14.14.14.14.14.14" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">)</mo></mrow><mo id="A4.p1.1.m1.15.15.15.15.15.15" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">}</mo></mrow><mrow id="A4.p1.1.m1.16.16.16.16.16.16.1" xref="A4.p1.1.m1.16.16.16.16.16.16.1.cmml"><mi id="A4.p1.1.m1.16.16.16.16.16.16.1.2" xref="A4.p1.1.m1.16.16.16.16.16.16.1.2.cmml">k</mi><mo id="A4.p1.1.m1.16.16.16.16.16.16.1.1" xref="A4.p1.1.m1.16.16.16.16.16.16.1.1.cmml">=</mo><mn id="A4.p1.1.m1.16.16.16.16.16.16.1.3" xref="A4.p1.1.m1.16.16.16.16.16.16.1.3.cmml">1</mn></mrow><mi id="A4.p1.1.m1.17.17.17.17.17.17.1" xref="A4.p1.1.m1.17.17.17.17.17.17.1.cmml">K</mi></msubsup><mo id="A4.p1.1.m1.18.18.18.18.18.18" xref="A4.p1.1.m1.58.58.3.cmml">,</mo><mi id="A4.p1.1.m1.19.19.19.19.19.19" xref="A4.p1.1.m1.19.19.19.19.19.19.cmml">X</mi></mrow></mrow><mo id="A4.p1.1.m1.20.20.20.20.20.20" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">)</mo></mrow></mrow><mo id="A4.p1.1.m1.21.21.21.21.21.21" xref="A4.p1.1.m1.21.21.21.21.21.21.cmml">=</mo><mi id="A4.p1.1.m1.59.59.4.56.22.22.23" xref="A4.p1.1.m1.58.58.3.cmml"></mi></mrow></mtd></mtr><mtr id="A4.p1.1.m1.60.60.5c" xref="A4.p1.1.m1.58.58.3.cmml"><mtd class="ltx_align_right" columnalign="right" id="A4.p1.1.m1.60.60.5d" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.34.34.34.13.13" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.22.22.22.1.1.1" xref="A4.p1.1.m1.22.22.22.1.1.1.cmml">log</mi><msub id="A4.p1.1.m1.34.34.34.13.13.14" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.23.23.23.2.2.2" xref="A4.p1.1.m1.23.23.23.2.2.2.cmml">∫</mo><mi id="A4.p1.1.m1.24.24.24.3.3.3.1" xref="A4.p1.1.m1.24.24.24.3.3.3.1.cmml">z</mi></msub><msub id="A4.p1.1.m1.34.34.34.13.13.15" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.25.25.25.4.4.4" xref="A4.p1.1.m1.25.25.25.4.4.4.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p1.1.m1.26.26.26.5.5.5.1" xref="A4.p1.1.m1.26.26.26.5.5.5.1.cmml">ℳ</mi></msub><mrow id="A4.p1.1.m1.34.34.34.13.13.16" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.27.27.27.6.6.6" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">(</mo><mi id="A4.p1.1.m1.28.28.28.7.7.7" xref="A4.p1.1.m1.28.28.28.7.7.7.cmml">Y</mi><mo id="A4.p1.1.m1.29.29.29.8.8.8" lspace="0em" rspace="0.167em" xref="A4.p1.1.m1.29.29.29.8.8.8.cmml">∣</mo><mi id="A4.p1.1.m1.30.30.30.9.9.9" xref="A4.p1.1.m1.30.30.30.9.9.9.cmml">z</mi><mo id="A4.p1.1.m1.31.31.31.10.10.10" xref="A4.p1.1.m1.58.58.3.cmml">,</mo><mi id="A4.p1.1.m1.32.32.32.11.11.11" xref="A4.p1.1.m1.32.32.32.11.11.11.cmml">X</mi><mo id="A4.p1.1.m1.33.33.33.12.12.12" rspace="0.225em" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">)</mo></mrow><mo id="A4.p1.1.m1.34.34.34.13.13.13" xref="A4.p1.1.m1.34.34.34.13.13.13.cmml">×</mo></mrow></mtd></mtr><mtr id="A4.p1.1.m1.60.60.5e" xref="A4.p1.1.m1.58.58.3.cmml"><mtd class="ltx_align_right" columnalign="right" id="A4.p1.1.m1.60.60.5f" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.60.60.5.57.22.22" xref="A4.p1.1.m1.58.58.3.cmml"><msub id="A4.p1.1.m1.60.60.5.57.22.22.24" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.35.35.35.1.1.1" xref="A4.p1.1.m1.35.35.35.1.1.1.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p1.1.m1.36.36.36.2.2.2.1" xref="A4.p1.1.m1.36.36.36.2.2.2.1.cmml">ℳ</mi></msub><mo id="A4.p1.1.m1.60.60.5.57.22.22.23" xref="A4.p1.1.m1.58.58.3.cmml">⁢</mo><mrow id="A4.p1.1.m1.60.60.5.57.22.22.22.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.37.37.37.3.3.3" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">(</mo><mrow id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.38.38.38.4.4.4" xref="A4.p1.1.m1.38.38.38.4.4.4.cmml">z</mi><mo id="A4.p1.1.m1.39.39.39.5.5.5" xref="A4.p1.1.m1.39.39.39.5.5.5.cmml">∣</mo><mrow id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><msubsup id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mrow id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.40.40.40.6.6.6" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">{</mo><mrow id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mo id="A4.p1.1.m1.41.41.41.7.7.7" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">(</mo><msub id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.42.42.42.8.8.8" xref="A4.p1.1.m1.42.42.42.8.8.8.cmml">X</mi><mi id="A4.p1.1.m1.43.43.43.9.9.9.1" xref="A4.p1.1.m1.43.43.43.9.9.9.1.cmml">k</mi></msub><mo id="A4.p1.1.m1.44.44.44.10.10.10" xref="A4.p1.1.m1.58.58.3.cmml">,</mo><msub id="A4.p1.1.m1.60.60.5.57.22.22.22.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p1.1.m1.58.58.3.cmml"><mi id="A4.p1.1.m1.45.45.45.11.11.11" xref="A4.p1.1.m1.45.45.45.11.11.11.cmml">Y</mi><mi id="A4.p1.1.m1.46.46.46.12.12.12.1" xref="A4.p1.1.m1.46.46.46.12.12.12.1.cmml">k</mi></msub><mo id="A4.p1.1.m1.47.47.47.13.13.13" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">)</mo></mrow><mo id="A4.p1.1.m1.48.48.48.14.14.14" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">}</mo></mrow><mrow id="A4.p1.1.m1.49.49.49.15.15.15.1" xref="A4.p1.1.m1.49.49.49.15.15.15.1.cmml"><mi id="A4.p1.1.m1.49.49.49.15.15.15.1.2" xref="A4.p1.1.m1.49.49.49.15.15.15.1.2.cmml">k</mi><mo id="A4.p1.1.m1.49.49.49.15.15.15.1.1" xref="A4.p1.1.m1.49.49.49.15.15.15.1.1.cmml">=</mo><mn id="A4.p1.1.m1.49.49.49.15.15.15.1.3" xref="A4.p1.1.m1.49.49.49.15.15.15.1.3.cmml">1</mn></mrow><mi id="A4.p1.1.m1.50.50.50.16.16.16.1" xref="A4.p1.1.m1.50.50.50.16.16.16.1.cmml">K</mi></msubsup><mo id="A4.p1.1.m1.51.51.51.17.17.17" xref="A4.p1.1.m1.58.58.3.cmml">,</mo><mi id="A4.p1.1.m1.52.52.52.18.18.18" xref="A4.p1.1.m1.52.52.52.18.18.18.cmml">X</mi></mrow></mrow><mo id="A4.p1.1.m1.53.53.53.19.19.19" stretchy="false" xref="A4.p1.1.m1.58.58.3.cmml">)</mo></mrow><mo id="A4.p1.1.m1.60.60.5.57.22.22.23a" lspace="0.170em" xref="A4.p1.1.m1.58.58.3.cmml">⁢</mo><mi id="A4.p1.1.m1.54.54.54.20.20.20" xref="A4.p1.1.m1.54.54.54.20.20.20.cmml">d</mi><mo id="A4.p1.1.m1.60.60.5.57.22.22.23b" xref="A4.p1.1.m1.58.58.3.cmml">⁢</mo><mi id="A4.p1.1.m1.55.55.55.21.21.21" xref="A4.p1.1.m1.55.55.55.21.21.21.cmml">z</mi></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="A4.p1.1.m1.60b"><apply id="A4.p1.1.m1.58.58.3.cmml" xref="A4.p1.1.m1.60.60.5"><eq id="A4.p1.1.m1.21.21.21.21.21.21.cmml" xref="A4.p1.1.m1.21.21.21.21.21.21"></eq><apply id="A4.p1.1.m1.56.56.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><times id="A4.p1.1.m1.56.56.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"></times><apply id="A4.p1.1.m1.56.56.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><log id="A4.p1.1.m1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.1.1.1.1.1.1"></log><apply id="A4.p1.1.m1.56.56.1.1.3.2.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.56.56.1.1.3.2.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.2.2.2.2.2.2.cmml" xref="A4.p1.1.m1.2.2.2.2.2.2">𝑃</ci><ci id="A4.p1.1.m1.3.3.3.3.3.3.1.cmml" xref="A4.p1.1.m1.3.3.3.3.3.3.1">ℳ</ci></apply></apply><apply id="A4.p1.1.m1.56.56.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="latexml" id="A4.p1.1.m1.6.6.6.6.6.6.cmml" xref="A4.p1.1.m1.6.6.6.6.6.6">conditional</csymbol><ci id="A4.p1.1.m1.5.5.5.5.5.5.cmml" xref="A4.p1.1.m1.5.5.5.5.5.5">𝑌</ci><list id="A4.p1.1.m1.56.56.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"><apply id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5">superscript</csymbol><apply id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><set id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"><interval closure="open" id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><apply id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.9.9.9.9.9.9.cmml" xref="A4.p1.1.m1.9.9.9.9.9.9">𝑋</ci><ci id="A4.p1.1.m1.10.10.10.10.10.10.1.cmml" xref="A4.p1.1.m1.10.10.10.10.10.10.1">𝑘</ci></apply><apply id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.56.56.1.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.12.12.12.12.12.12.cmml" xref="A4.p1.1.m1.12.12.12.12.12.12">𝑌</ci><ci id="A4.p1.1.m1.13.13.13.13.13.13.1.cmml" xref="A4.p1.1.m1.13.13.13.13.13.13.1">𝑘</ci></apply></interval></set><apply id="A4.p1.1.m1.16.16.16.16.16.16.1.cmml" xref="A4.p1.1.m1.16.16.16.16.16.16.1"><eq id="A4.p1.1.m1.16.16.16.16.16.16.1.1.cmml" xref="A4.p1.1.m1.16.16.16.16.16.16.1.1"></eq><ci id="A4.p1.1.m1.16.16.16.16.16.16.1.2.cmml" xref="A4.p1.1.m1.16.16.16.16.16.16.1.2">𝑘</ci><cn id="A4.p1.1.m1.16.16.16.16.16.16.1.3.cmml" type="integer" xref="A4.p1.1.m1.16.16.16.16.16.16.1.3">1</cn></apply></apply><ci id="A4.p1.1.m1.17.17.17.17.17.17.1.cmml" xref="A4.p1.1.m1.17.17.17.17.17.17.1">𝐾</ci></apply><ci id="A4.p1.1.m1.19.19.19.19.19.19.cmml" xref="A4.p1.1.m1.19.19.19.19.19.19">𝑋</ci></list></apply></apply><apply id="A4.p1.1.m1.58.58.3.3.cmml" xref="A4.p1.1.m1.60.60.5"><times id="A4.p1.1.m1.58.58.3.3.3.cmml" xref="A4.p1.1.m1.60.60.5"></times><log id="A4.p1.1.m1.22.22.22.1.1.1.cmml" xref="A4.p1.1.m1.22.22.22.1.1.1"></log><apply id="A4.p1.1.m1.58.58.3.3.2.cmml" xref="A4.p1.1.m1.60.60.5"><apply id="A4.p1.1.m1.58.58.3.3.2.3.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.58.58.3.3.2.3.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><int id="A4.p1.1.m1.23.23.23.2.2.2.cmml" xref="A4.p1.1.m1.23.23.23.2.2.2"></int><ci id="A4.p1.1.m1.24.24.24.3.3.3.1.cmml" xref="A4.p1.1.m1.24.24.24.3.3.3.1">𝑧</ci></apply><apply id="A4.p1.1.m1.58.58.3.3.2.2.cmml" xref="A4.p1.1.m1.60.60.5"><times id="A4.p1.1.m1.58.58.3.3.2.2.3.cmml" xref="A4.p1.1.m1.60.60.5"></times><apply id="A4.p1.1.m1.57.57.2.2.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><times id="A4.p1.1.m1.34.34.34.13.13.13.cmml" xref="A4.p1.1.m1.34.34.34.13.13.13"></times><apply id="A4.p1.1.m1.57.57.2.2.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><times id="A4.p1.1.m1.57.57.2.2.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"></times><apply id="A4.p1.1.m1.57.57.2.2.1.1.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.57.57.2.2.1.1.1.1.3.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.25.25.25.4.4.4.cmml" xref="A4.p1.1.m1.25.25.25.4.4.4">𝑃</ci><ci id="A4.p1.1.m1.26.26.26.5.5.5.1.cmml" xref="A4.p1.1.m1.26.26.26.5.5.5.1">ℳ</ci></apply><apply id="A4.p1.1.m1.57.57.2.2.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><ci id="A4.p1.1.m1.29.29.29.8.8.8.cmml" xref="A4.p1.1.m1.29.29.29.8.8.8">∣</ci><ci id="A4.p1.1.m1.28.28.28.7.7.7.cmml" xref="A4.p1.1.m1.28.28.28.7.7.7">𝑌</ci><list id="A4.p1.1.m1.57.57.2.2.1.1.1.1.1.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><ci id="A4.p1.1.m1.30.30.30.9.9.9.cmml" xref="A4.p1.1.m1.30.30.30.9.9.9">𝑧</ci><ci id="A4.p1.1.m1.32.32.32.11.11.11.cmml" xref="A4.p1.1.m1.32.32.32.11.11.11">𝑋</ci></list></apply></apply><apply id="A4.p1.1.m1.57.57.2.2.1.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.57.57.2.2.1.1.1.3.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.35.35.35.1.1.1.cmml" xref="A4.p1.1.m1.35.35.35.1.1.1">𝑃</ci><ci id="A4.p1.1.m1.36.36.36.2.2.2.1.cmml" xref="A4.p1.1.m1.36.36.36.2.2.2.1">ℳ</ci></apply></apply><apply id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="latexml" id="A4.p1.1.m1.39.39.39.5.5.5.cmml" xref="A4.p1.1.m1.39.39.39.5.5.5">conditional</csymbol><ci id="A4.p1.1.m1.38.38.38.4.4.4.cmml" xref="A4.p1.1.m1.38.38.38.4.4.4">𝑧</ci><list id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"><apply id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5">superscript</csymbol><apply id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><set id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="A4.p1.1.m1.60.60.5"><interval closure="open" id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p1.1.m1.60.60.5"><apply id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.42.42.42.8.8.8.cmml" xref="A4.p1.1.m1.42.42.42.8.8.8">𝑋</ci><ci id="A4.p1.1.m1.43.43.43.9.9.9.1.cmml" xref="A4.p1.1.m1.43.43.43.9.9.9.1">𝑘</ci></apply><apply id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p1.1.m1.60.60.5"><csymbol cd="ambiguous" id="A4.p1.1.m1.58.58.3.3.2.2.2.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p1.1.m1.60.60.5">subscript</csymbol><ci id="A4.p1.1.m1.45.45.45.11.11.11.cmml" xref="A4.p1.1.m1.45.45.45.11.11.11">𝑌</ci><ci id="A4.p1.1.m1.46.46.46.12.12.12.1.cmml" xref="A4.p1.1.m1.46.46.46.12.12.12.1">𝑘</ci></apply></interval></set><apply id="A4.p1.1.m1.49.49.49.15.15.15.1.cmml" xref="A4.p1.1.m1.49.49.49.15.15.15.1"><eq id="A4.p1.1.m1.49.49.49.15.15.15.1.1.cmml" xref="A4.p1.1.m1.49.49.49.15.15.15.1.1"></eq><ci id="A4.p1.1.m1.49.49.49.15.15.15.1.2.cmml" xref="A4.p1.1.m1.49.49.49.15.15.15.1.2">𝑘</ci><cn id="A4.p1.1.m1.49.49.49.15.15.15.1.3.cmml" type="integer" xref="A4.p1.1.m1.49.49.49.15.15.15.1.3">1</cn></apply></apply><ci id="A4.p1.1.m1.50.50.50.16.16.16.1.cmml" xref="A4.p1.1.m1.50.50.50.16.16.16.1">𝐾</ci></apply><ci id="A4.p1.1.m1.52.52.52.18.18.18.cmml" xref="A4.p1.1.m1.52.52.52.18.18.18">𝑋</ci></list></apply><apply id="A4.p1.1.m1.58.58.3.3.2.2.4.cmml" xref="A4.p1.1.m1.60.60.5"><ci id="A4.p1.1.m1.54.54.54.20.20.20.cmml" xref="A4.p1.1.m1.54.54.54.20.20.20">𝑑</ci><ci id="A4.p1.1.m1.55.55.55.21.21.21.cmml" xref="A4.p1.1.m1.55.55.55.21.21.21">𝑧</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.1.m1.60c">\log P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)=\\
\log\int_{z}P_{\mathcal{M}}(Y\mid z,X)\,\times\\
P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)\,dz</annotation><annotation encoding="application/x-llamapun" id="A4.p1.1.m1.60d">start_ROW start_CELL roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) = end_CELL end_ROW start_ROW start_CELL roman_log ∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) × end_CELL end_ROW start_ROW start_CELL italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) italic_d italic_z end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A4.p1.3">we introduce an arbitrary auxiliary distribution <math alttext="q(z)" class="ltx_Math" display="inline" id="A4.p1.2.m1.1"><semantics id="A4.p1.2.m1.1a"><mrow id="A4.p1.2.m1.1.2" xref="A4.p1.2.m1.1.2.cmml"><mi id="A4.p1.2.m1.1.2.2" xref="A4.p1.2.m1.1.2.2.cmml">q</mi><mo id="A4.p1.2.m1.1.2.1" xref="A4.p1.2.m1.1.2.1.cmml">⁢</mo><mrow id="A4.p1.2.m1.1.2.3.2" xref="A4.p1.2.m1.1.2.cmml"><mo id="A4.p1.2.m1.1.2.3.2.1" stretchy="false" xref="A4.p1.2.m1.1.2.cmml">(</mo><mi id="A4.p1.2.m1.1.1" xref="A4.p1.2.m1.1.1.cmml">z</mi><mo id="A4.p1.2.m1.1.2.3.2.2" stretchy="false" xref="A4.p1.2.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p1.2.m1.1b"><apply id="A4.p1.2.m1.1.2.cmml" xref="A4.p1.2.m1.1.2"><times id="A4.p1.2.m1.1.2.1.cmml" xref="A4.p1.2.m1.1.2.1"></times><ci id="A4.p1.2.m1.1.2.2.cmml" xref="A4.p1.2.m1.1.2.2">𝑞</ci><ci id="A4.p1.2.m1.1.1.cmml" xref="A4.p1.2.m1.1.1">𝑧</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.2.m1.1c">q(z)</annotation><annotation encoding="application/x-llamapun" id="A4.p1.2.m1.1d">italic_q ( italic_z )</annotation></semantics></math> (with <math alttext="\int q(z)\,dz=1" class="ltx_Math" display="inline" id="A4.p1.3.m2.1"><semantics id="A4.p1.3.m2.1a"><mrow id="A4.p1.3.m2.1.2" xref="A4.p1.3.m2.1.2.cmml"><mrow id="A4.p1.3.m2.1.2.2" xref="A4.p1.3.m2.1.2.2.cmml"><mo id="A4.p1.3.m2.1.2.2.1" xref="A4.p1.3.m2.1.2.2.1.cmml">∫</mo><mrow id="A4.p1.3.m2.1.2.2.2" xref="A4.p1.3.m2.1.2.2.2.cmml"><mi id="A4.p1.3.m2.1.2.2.2.2" xref="A4.p1.3.m2.1.2.2.2.2.cmml">q</mi><mo id="A4.p1.3.m2.1.2.2.2.1" xref="A4.p1.3.m2.1.2.2.2.1.cmml">⁢</mo><mrow id="A4.p1.3.m2.1.2.2.2.3.2" xref="A4.p1.3.m2.1.2.2.2.cmml"><mo id="A4.p1.3.m2.1.2.2.2.3.2.1" stretchy="false" xref="A4.p1.3.m2.1.2.2.2.cmml">(</mo><mi id="A4.p1.3.m2.1.1" xref="A4.p1.3.m2.1.1.cmml">z</mi><mo id="A4.p1.3.m2.1.2.2.2.3.2.2" stretchy="false" xref="A4.p1.3.m2.1.2.2.2.cmml">)</mo></mrow><mo id="A4.p1.3.m2.1.2.2.2.1a" lspace="0.170em" xref="A4.p1.3.m2.1.2.2.2.1.cmml">⁢</mo><mrow id="A4.p1.3.m2.1.2.2.2.4" xref="A4.p1.3.m2.1.2.2.2.4.cmml"><mo id="A4.p1.3.m2.1.2.2.2.4.1" rspace="0em" xref="A4.p1.3.m2.1.2.2.2.4.1.cmml">𝑑</mo><mi id="A4.p1.3.m2.1.2.2.2.4.2" xref="A4.p1.3.m2.1.2.2.2.4.2.cmml">z</mi></mrow></mrow></mrow><mo id="A4.p1.3.m2.1.2.1" xref="A4.p1.3.m2.1.2.1.cmml">=</mo><mn id="A4.p1.3.m2.1.2.3" xref="A4.p1.3.m2.1.2.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="A4.p1.3.m2.1b"><apply id="A4.p1.3.m2.1.2.cmml" xref="A4.p1.3.m2.1.2"><eq id="A4.p1.3.m2.1.2.1.cmml" xref="A4.p1.3.m2.1.2.1"></eq><apply id="A4.p1.3.m2.1.2.2.cmml" xref="A4.p1.3.m2.1.2.2"><int id="A4.p1.3.m2.1.2.2.1.cmml" xref="A4.p1.3.m2.1.2.2.1"></int><apply id="A4.p1.3.m2.1.2.2.2.cmml" xref="A4.p1.3.m2.1.2.2.2"><times id="A4.p1.3.m2.1.2.2.2.1.cmml" xref="A4.p1.3.m2.1.2.2.2.1"></times><ci id="A4.p1.3.m2.1.2.2.2.2.cmml" xref="A4.p1.3.m2.1.2.2.2.2">𝑞</ci><ci id="A4.p1.3.m2.1.1.cmml" xref="A4.p1.3.m2.1.1">𝑧</ci><apply id="A4.p1.3.m2.1.2.2.2.4.cmml" xref="A4.p1.3.m2.1.2.2.2.4"><csymbol cd="latexml" id="A4.p1.3.m2.1.2.2.2.4.1.cmml" xref="A4.p1.3.m2.1.2.2.2.4.1">differential-d</csymbol><ci id="A4.p1.3.m2.1.2.2.2.4.2.cmml" xref="A4.p1.3.m2.1.2.2.2.4.2">𝑧</ci></apply></apply></apply><cn id="A4.p1.3.m2.1.2.3.cmml" type="integer" xref="A4.p1.3.m2.1.2.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.3.m2.1c">\int q(z)\,dz=1</annotation><annotation encoding="application/x-llamapun" id="A4.p1.3.m2.1d">∫ italic_q ( italic_z ) italic_d italic_z = 1</annotation></semantics></math>) and apply Jensen’s inequality:</p>
</div>
<div class="ltx_para" id="A4.p2">
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A6.EGx1">
<tbody id="A4.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\log P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)" class="ltx_Math" display="inline" id="A4.Ex3.m1.2"><semantics id="A4.Ex3.m1.2a"><mrow id="A4.Ex3.m1.2.2" xref="A4.Ex3.m1.2.2.cmml"><mrow id="A4.Ex3.m1.2.2.3" xref="A4.Ex3.m1.2.2.3.cmml"><mi id="A4.Ex3.m1.2.2.3.1" xref="A4.Ex3.m1.2.2.3.1.cmml">log</mi><mo id="A4.Ex3.m1.2.2.3a" lspace="0.167em" xref="A4.Ex3.m1.2.2.3.cmml">⁡</mo><msub id="A4.Ex3.m1.2.2.3.2" xref="A4.Ex3.m1.2.2.3.2.cmml"><mi id="A4.Ex3.m1.2.2.3.2.2" xref="A4.Ex3.m1.2.2.3.2.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.Ex3.m1.2.2.3.2.3" xref="A4.Ex3.m1.2.2.3.2.3.cmml">ℳ</mi></msub></mrow><mo id="A4.Ex3.m1.2.2.2" xref="A4.Ex3.m1.2.2.2.cmml">⁢</mo><mrow id="A4.Ex3.m1.2.2.1.1" xref="A4.Ex3.m1.2.2.1.1.1.cmml"><mo id="A4.Ex3.m1.2.2.1.1.2" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.cmml">(</mo><mrow id="A4.Ex3.m1.2.2.1.1.1" xref="A4.Ex3.m1.2.2.1.1.1.cmml"><mi id="A4.Ex3.m1.2.2.1.1.1.3" xref="A4.Ex3.m1.2.2.1.1.1.3.cmml">Y</mi><mo id="A4.Ex3.m1.2.2.1.1.1.2" xref="A4.Ex3.m1.2.2.1.1.1.2.cmml">∣</mo><mrow id="A4.Ex3.m1.2.2.1.1.1.1.1" xref="A4.Ex3.m1.2.2.1.1.1.1.2.cmml"><msubsup id="A4.Ex3.m1.2.2.1.1.1.1.1.1" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.cmml"><mrow id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.2.cmml"><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.4" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.2" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.1" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.3" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.Ex3.m1.2.2.1.1.1.1.1.1.3" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.Ex3.m1.2.2.1.1.1.1.1.2" xref="A4.Ex3.m1.2.2.1.1.1.1.2.cmml">,</mo><mi id="A4.Ex3.m1.1.1" xref="A4.Ex3.m1.1.1.cmml">X</mi></mrow></mrow><mo id="A4.Ex3.m1.2.2.1.1.3" stretchy="false" xref="A4.Ex3.m1.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.Ex3.m1.2b"><apply id="A4.Ex3.m1.2.2.cmml" xref="A4.Ex3.m1.2.2"><times id="A4.Ex3.m1.2.2.2.cmml" xref="A4.Ex3.m1.2.2.2"></times><apply id="A4.Ex3.m1.2.2.3.cmml" xref="A4.Ex3.m1.2.2.3"><log id="A4.Ex3.m1.2.2.3.1.cmml" xref="A4.Ex3.m1.2.2.3.1"></log><apply id="A4.Ex3.m1.2.2.3.2.cmml" xref="A4.Ex3.m1.2.2.3.2"><csymbol cd="ambiguous" id="A4.Ex3.m1.2.2.3.2.1.cmml" xref="A4.Ex3.m1.2.2.3.2">subscript</csymbol><ci id="A4.Ex3.m1.2.2.3.2.2.cmml" xref="A4.Ex3.m1.2.2.3.2.2">𝑃</ci><ci id="A4.Ex3.m1.2.2.3.2.3.cmml" xref="A4.Ex3.m1.2.2.3.2.3">ℳ</ci></apply></apply><apply id="A4.Ex3.m1.2.2.1.1.1.cmml" xref="A4.Ex3.m1.2.2.1.1"><csymbol cd="latexml" id="A4.Ex3.m1.2.2.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.2">conditional</csymbol><ci id="A4.Ex3.m1.2.2.1.1.1.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.3">𝑌</ci><list id="A4.Ex3.m1.2.2.1.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1"><apply id="A4.Ex3.m1.2.2.1.1.1.1.1.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex3.m1.2.2.1.1.1.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1">subscript</csymbol><set id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2"><apply id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3"><eq id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.1"></eq><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.Ex3.m1.2.2.1.1.1.1.1.1.3.cmml" xref="A4.Ex3.m1.2.2.1.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.Ex3.m1.1.1.cmml" xref="A4.Ex3.m1.1.1">𝑋</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.Ex3.m1.2c">\displaystyle\log P_{\mathcal{M}}(Y\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)</annotation><annotation encoding="application/x-llamapun" id="A4.Ex3.m1.2d">roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A4.Ex4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\log\int_{z}q(z)\times" class="ltx_math_unparsed" display="inline" id="A4.Ex4.m1.1"><semantics id="A4.Ex4.m1.1a"><mrow id="A4.Ex4.m1.1b"><mo id="A4.Ex4.m1.1.2">=</mo><mi id="A4.Ex4.m1.1.3">log</mi><mstyle displaystyle="true" id="A4.Ex4.m1.1.4"><msub id="A4.Ex4.m1.1.4a"><mo id="A4.Ex4.m1.1.4.2">∫</mo><mi id="A4.Ex4.m1.1.4.3">z</mi></msub></mstyle><mi id="A4.Ex4.m1.1.5">q</mi><mrow id="A4.Ex4.m1.1.6"><mo id="A4.Ex4.m1.1.6.1" stretchy="false">(</mo><mi id="A4.Ex4.m1.1.1">z</mi><mo id="A4.Ex4.m1.1.6.2" rspace="0.055em" stretchy="false">)</mo></mrow><mo id="A4.Ex4.m1.1.7">×</mo></mrow><annotation encoding="application/x-tex" id="A4.Ex4.m1.1c">\displaystyle=\log\int_{z}q(z)\times</annotation><annotation encoding="application/x-llamapun" id="A4.Ex4.m1.1d">= roman_log ∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_q ( italic_z ) ×</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A4.Ex5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y%
_{k})\}_{k=1}^{K},X)}{q(z)}\,dz" class="ltx_Math" display="inline" id="A4.Ex5.m1.6"><semantics id="A4.Ex5.m1.6a"><mrow id="A4.Ex5.m1.6.7" xref="A4.Ex5.m1.6.7.cmml"><mstyle displaystyle="true" id="A4.Ex5.m1.6.6" xref="A4.Ex5.m1.6.6.cmml"><mfrac id="A4.Ex5.m1.6.6a" xref="A4.Ex5.m1.6.6.cmml"><mrow id="A4.Ex5.m1.5.5.5" xref="A4.Ex5.m1.5.5.5.cmml"><msub id="A4.Ex5.m1.5.5.5.7" xref="A4.Ex5.m1.5.5.5.7.cmml"><mi id="A4.Ex5.m1.5.5.5.7.2" xref="A4.Ex5.m1.5.5.5.7.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.Ex5.m1.5.5.5.7.3" xref="A4.Ex5.m1.5.5.5.7.3.cmml">ℳ</mi></msub><mo id="A4.Ex5.m1.5.5.5.6" xref="A4.Ex5.m1.5.5.5.6.cmml">⁢</mo><mrow id="A4.Ex5.m1.4.4.4.4.1" xref="A4.Ex5.m1.4.4.4.4.1.1.cmml"><mo id="A4.Ex5.m1.4.4.4.4.1.2" stretchy="false" xref="A4.Ex5.m1.4.4.4.4.1.1.cmml">(</mo><mrow id="A4.Ex5.m1.4.4.4.4.1.1" xref="A4.Ex5.m1.4.4.4.4.1.1.cmml"><mi id="A4.Ex5.m1.4.4.4.4.1.1.2" xref="A4.Ex5.m1.4.4.4.4.1.1.2.cmml">Y</mi><mo id="A4.Ex5.m1.4.4.4.4.1.1.1" xref="A4.Ex5.m1.4.4.4.4.1.1.1.cmml">∣</mo><mrow id="A4.Ex5.m1.4.4.4.4.1.1.3.2" xref="A4.Ex5.m1.4.4.4.4.1.1.3.1.cmml"><mi id="A4.Ex5.m1.1.1.1.1" xref="A4.Ex5.m1.1.1.1.1.cmml">z</mi><mo id="A4.Ex5.m1.4.4.4.4.1.1.3.2.1" xref="A4.Ex5.m1.4.4.4.4.1.1.3.1.cmml">,</mo><mi id="A4.Ex5.m1.2.2.2.2" xref="A4.Ex5.m1.2.2.2.2.cmml">X</mi></mrow></mrow><mo id="A4.Ex5.m1.4.4.4.4.1.3" stretchy="false" xref="A4.Ex5.m1.4.4.4.4.1.1.cmml">)</mo></mrow><mo id="A4.Ex5.m1.5.5.5.6a" lspace="0.170em" xref="A4.Ex5.m1.5.5.5.6.cmml">⁢</mo><msub id="A4.Ex5.m1.5.5.5.8" xref="A4.Ex5.m1.5.5.5.8.cmml"><mi id="A4.Ex5.m1.5.5.5.8.2" xref="A4.Ex5.m1.5.5.5.8.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.Ex5.m1.5.5.5.8.3" xref="A4.Ex5.m1.5.5.5.8.3.cmml">ℳ</mi></msub><mo id="A4.Ex5.m1.5.5.5.6b" xref="A4.Ex5.m1.5.5.5.6.cmml">⁢</mo><mrow id="A4.Ex5.m1.5.5.5.5.1" xref="A4.Ex5.m1.5.5.5.5.1.1.cmml"><mo id="A4.Ex5.m1.5.5.5.5.1.2" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.cmml">(</mo><mrow id="A4.Ex5.m1.5.5.5.5.1.1" xref="A4.Ex5.m1.5.5.5.5.1.1.cmml"><mi id="A4.Ex5.m1.5.5.5.5.1.1.3" xref="A4.Ex5.m1.5.5.5.5.1.1.3.cmml">z</mi><mo id="A4.Ex5.m1.5.5.5.5.1.1.2" xref="A4.Ex5.m1.5.5.5.5.1.1.2.cmml">∣</mo><mrow id="A4.Ex5.m1.5.5.5.5.1.1.1.1" xref="A4.Ex5.m1.5.5.5.5.1.1.1.2.cmml"><msubsup id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.cmml"><mrow id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml"><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.4" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.cmml"><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.1" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.3" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.3" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.Ex5.m1.5.5.5.5.1.1.1.1.2" xref="A4.Ex5.m1.5.5.5.5.1.1.1.2.cmml">,</mo><mi id="A4.Ex5.m1.3.3.3.3" xref="A4.Ex5.m1.3.3.3.3.cmml">X</mi></mrow></mrow><mo id="A4.Ex5.m1.5.5.5.5.1.3" stretchy="false" xref="A4.Ex5.m1.5.5.5.5.1.1.cmml">)</mo></mrow></mrow><mrow id="A4.Ex5.m1.6.6.6" xref="A4.Ex5.m1.6.6.6.cmml"><mi id="A4.Ex5.m1.6.6.6.3" xref="A4.Ex5.m1.6.6.6.3.cmml">q</mi><mo id="A4.Ex5.m1.6.6.6.2" xref="A4.Ex5.m1.6.6.6.2.cmml">⁢</mo><mrow id="A4.Ex5.m1.6.6.6.4.2" xref="A4.Ex5.m1.6.6.6.cmml"><mo id="A4.Ex5.m1.6.6.6.4.2.1" stretchy="false" xref="A4.Ex5.m1.6.6.6.cmml">(</mo><mi id="A4.Ex5.m1.6.6.6.1" xref="A4.Ex5.m1.6.6.6.1.cmml">z</mi><mo id="A4.Ex5.m1.6.6.6.4.2.2" stretchy="false" xref="A4.Ex5.m1.6.6.6.cmml">)</mo></mrow></mrow></mfrac></mstyle><mo id="A4.Ex5.m1.6.7.1" lspace="0.170em" xref="A4.Ex5.m1.6.7.1.cmml">⁢</mo><mi id="A4.Ex5.m1.6.7.2" xref="A4.Ex5.m1.6.7.2.cmml">d</mi><mo id="A4.Ex5.m1.6.7.1a" xref="A4.Ex5.m1.6.7.1.cmml">⁢</mo><mi id="A4.Ex5.m1.6.7.3" xref="A4.Ex5.m1.6.7.3.cmml">z</mi></mrow><annotation-xml encoding="MathML-Content" id="A4.Ex5.m1.6b"><apply id="A4.Ex5.m1.6.7.cmml" xref="A4.Ex5.m1.6.7"><times id="A4.Ex5.m1.6.7.1.cmml" xref="A4.Ex5.m1.6.7.1"></times><apply id="A4.Ex5.m1.6.6.cmml" xref="A4.Ex5.m1.6.6"><divide id="A4.Ex5.m1.6.6.7.cmml" xref="A4.Ex5.m1.6.6"></divide><apply id="A4.Ex5.m1.5.5.5.cmml" xref="A4.Ex5.m1.5.5.5"><times id="A4.Ex5.m1.5.5.5.6.cmml" xref="A4.Ex5.m1.5.5.5.6"></times><apply id="A4.Ex5.m1.5.5.5.7.cmml" xref="A4.Ex5.m1.5.5.5.7"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.7.1.cmml" xref="A4.Ex5.m1.5.5.5.7">subscript</csymbol><ci id="A4.Ex5.m1.5.5.5.7.2.cmml" xref="A4.Ex5.m1.5.5.5.7.2">𝑃</ci><ci id="A4.Ex5.m1.5.5.5.7.3.cmml" xref="A4.Ex5.m1.5.5.5.7.3">ℳ</ci></apply><apply id="A4.Ex5.m1.4.4.4.4.1.1.cmml" xref="A4.Ex5.m1.4.4.4.4.1"><csymbol cd="latexml" id="A4.Ex5.m1.4.4.4.4.1.1.1.cmml" xref="A4.Ex5.m1.4.4.4.4.1.1.1">conditional</csymbol><ci id="A4.Ex5.m1.4.4.4.4.1.1.2.cmml" xref="A4.Ex5.m1.4.4.4.4.1.1.2">𝑌</ci><list id="A4.Ex5.m1.4.4.4.4.1.1.3.1.cmml" xref="A4.Ex5.m1.4.4.4.4.1.1.3.2"><ci id="A4.Ex5.m1.1.1.1.1.cmml" xref="A4.Ex5.m1.1.1.1.1">𝑧</ci><ci id="A4.Ex5.m1.2.2.2.2.cmml" xref="A4.Ex5.m1.2.2.2.2">𝑋</ci></list></apply><apply id="A4.Ex5.m1.5.5.5.8.cmml" xref="A4.Ex5.m1.5.5.5.8"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.8.1.cmml" xref="A4.Ex5.m1.5.5.5.8">subscript</csymbol><ci id="A4.Ex5.m1.5.5.5.8.2.cmml" xref="A4.Ex5.m1.5.5.5.8.2">𝑃</ci><ci id="A4.Ex5.m1.5.5.5.8.3.cmml" xref="A4.Ex5.m1.5.5.5.8.3">ℳ</ci></apply><apply id="A4.Ex5.m1.5.5.5.5.1.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1"><csymbol cd="latexml" id="A4.Ex5.m1.5.5.5.5.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.2">conditional</csymbol><ci id="A4.Ex5.m1.5.5.5.5.1.1.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.3">𝑧</ci><list id="A4.Ex5.m1.5.5.5.5.1.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1"><apply id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1">superscript</csymbol><apply id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1">subscript</csymbol><set id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2"><apply id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3"><eq id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.1.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.1"></eq><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.2.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.3.cmml" xref="A4.Ex5.m1.5.5.5.5.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.Ex5.m1.3.3.3.3.cmml" xref="A4.Ex5.m1.3.3.3.3">𝑋</ci></list></apply></apply><apply id="A4.Ex5.m1.6.6.6.cmml" xref="A4.Ex5.m1.6.6.6"><times id="A4.Ex5.m1.6.6.6.2.cmml" xref="A4.Ex5.m1.6.6.6.2"></times><ci id="A4.Ex5.m1.6.6.6.3.cmml" xref="A4.Ex5.m1.6.6.6.3">𝑞</ci><ci id="A4.Ex5.m1.6.6.6.1.cmml" xref="A4.Ex5.m1.6.6.6.1">𝑧</ci></apply></apply><ci id="A4.Ex5.m1.6.7.2.cmml" xref="A4.Ex5.m1.6.7.2">𝑑</ci><ci id="A4.Ex5.m1.6.7.3.cmml" xref="A4.Ex5.m1.6.7.3">𝑧</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.Ex5.m1.6c">\displaystyle\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y%
_{k})\}_{k=1}^{K},X)}{q(z)}\,dz</annotation><annotation encoding="application/x-llamapun" id="A4.Ex5.m1.6d">divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_ARG start_ARG italic_q ( italic_z ) end_ARG italic_d italic_z</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A4.Ex6"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\geq\int_{z}q(z)\times" class="ltx_math_unparsed" display="inline" id="A4.Ex6.m1.1"><semantics id="A4.Ex6.m1.1a"><mrow id="A4.Ex6.m1.1b"><mo id="A4.Ex6.m1.1.2">≥</mo><mstyle displaystyle="true" id="A4.Ex6.m1.1.3"><msub id="A4.Ex6.m1.1.3a"><mo id="A4.Ex6.m1.1.3.2">∫</mo><mi id="A4.Ex6.m1.1.3.3">z</mi></msub></mstyle><mi id="A4.Ex6.m1.1.4">q</mi><mrow id="A4.Ex6.m1.1.5"><mo id="A4.Ex6.m1.1.5.1" stretchy="false">(</mo><mi id="A4.Ex6.m1.1.1">z</mi><mo id="A4.Ex6.m1.1.5.2" rspace="0.055em" stretchy="false">)</mo></mrow><mo id="A4.Ex6.m1.1.6">×</mo></mrow><annotation encoding="application/x-tex" id="A4.Ex6.m1.1c">\displaystyle\geq\int_{z}q(z)\times</annotation><annotation encoding="application/x-llamapun" id="A4.Ex6.m1.1d">≥ ∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_q ( italic_z ) ×</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A4.Ex7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\log\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{%
k},Y_{k})\}_{k=1}^{K},X)}{q(z)}\,dz" class="ltx_Math" display="inline" id="A4.Ex7.m1.6"><semantics id="A4.Ex7.m1.6a"><mrow id="A4.Ex7.m1.6.7" xref="A4.Ex7.m1.6.7.cmml"><mi id="A4.Ex7.m1.6.7.1" xref="A4.Ex7.m1.6.7.1.cmml">log</mi><mo id="A4.Ex7.m1.6.7a" lspace="0.167em" xref="A4.Ex7.m1.6.7.cmml">⁡</mo><mrow id="A4.Ex7.m1.6.7.2" xref="A4.Ex7.m1.6.7.2.cmml"><mstyle displaystyle="true" id="A4.Ex7.m1.6.6" xref="A4.Ex7.m1.6.6.cmml"><mfrac id="A4.Ex7.m1.6.6a" xref="A4.Ex7.m1.6.6.cmml"><mrow id="A4.Ex7.m1.5.5.5" xref="A4.Ex7.m1.5.5.5.cmml"><msub id="A4.Ex7.m1.5.5.5.7" xref="A4.Ex7.m1.5.5.5.7.cmml"><mi id="A4.Ex7.m1.5.5.5.7.2" xref="A4.Ex7.m1.5.5.5.7.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.Ex7.m1.5.5.5.7.3" xref="A4.Ex7.m1.5.5.5.7.3.cmml">ℳ</mi></msub><mo id="A4.Ex7.m1.5.5.5.6" xref="A4.Ex7.m1.5.5.5.6.cmml">⁢</mo><mrow id="A4.Ex7.m1.4.4.4.4.1" xref="A4.Ex7.m1.4.4.4.4.1.1.cmml"><mo id="A4.Ex7.m1.4.4.4.4.1.2" stretchy="false" xref="A4.Ex7.m1.4.4.4.4.1.1.cmml">(</mo><mrow id="A4.Ex7.m1.4.4.4.4.1.1" xref="A4.Ex7.m1.4.4.4.4.1.1.cmml"><mi id="A4.Ex7.m1.4.4.4.4.1.1.2" xref="A4.Ex7.m1.4.4.4.4.1.1.2.cmml">Y</mi><mo id="A4.Ex7.m1.4.4.4.4.1.1.1" xref="A4.Ex7.m1.4.4.4.4.1.1.1.cmml">∣</mo><mrow id="A4.Ex7.m1.4.4.4.4.1.1.3.2" xref="A4.Ex7.m1.4.4.4.4.1.1.3.1.cmml"><mi id="A4.Ex7.m1.1.1.1.1" xref="A4.Ex7.m1.1.1.1.1.cmml">z</mi><mo id="A4.Ex7.m1.4.4.4.4.1.1.3.2.1" xref="A4.Ex7.m1.4.4.4.4.1.1.3.1.cmml">,</mo><mi id="A4.Ex7.m1.2.2.2.2" xref="A4.Ex7.m1.2.2.2.2.cmml">X</mi></mrow></mrow><mo id="A4.Ex7.m1.4.4.4.4.1.3" stretchy="false" xref="A4.Ex7.m1.4.4.4.4.1.1.cmml">)</mo></mrow><mo id="A4.Ex7.m1.5.5.5.6a" lspace="0.170em" xref="A4.Ex7.m1.5.5.5.6.cmml">⁢</mo><msub id="A4.Ex7.m1.5.5.5.8" xref="A4.Ex7.m1.5.5.5.8.cmml"><mi id="A4.Ex7.m1.5.5.5.8.2" xref="A4.Ex7.m1.5.5.5.8.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.Ex7.m1.5.5.5.8.3" xref="A4.Ex7.m1.5.5.5.8.3.cmml">ℳ</mi></msub><mo id="A4.Ex7.m1.5.5.5.6b" xref="A4.Ex7.m1.5.5.5.6.cmml">⁢</mo><mrow id="A4.Ex7.m1.5.5.5.5.1" xref="A4.Ex7.m1.5.5.5.5.1.1.cmml"><mo id="A4.Ex7.m1.5.5.5.5.1.2" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.cmml">(</mo><mrow id="A4.Ex7.m1.5.5.5.5.1.1" xref="A4.Ex7.m1.5.5.5.5.1.1.cmml"><mi id="A4.Ex7.m1.5.5.5.5.1.1.3" xref="A4.Ex7.m1.5.5.5.5.1.1.3.cmml">z</mi><mo id="A4.Ex7.m1.5.5.5.5.1.1.2" xref="A4.Ex7.m1.5.5.5.5.1.1.2.cmml">∣</mo><mrow id="A4.Ex7.m1.5.5.5.5.1.1.1.1" xref="A4.Ex7.m1.5.5.5.5.1.1.1.2.cmml"><msubsup id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.cmml"><mrow id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml"><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.4" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.cmml"><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.1" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.3" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.3" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.Ex7.m1.5.5.5.5.1.1.1.1.2" xref="A4.Ex7.m1.5.5.5.5.1.1.1.2.cmml">,</mo><mi id="A4.Ex7.m1.3.3.3.3" xref="A4.Ex7.m1.3.3.3.3.cmml">X</mi></mrow></mrow><mo id="A4.Ex7.m1.5.5.5.5.1.3" stretchy="false" xref="A4.Ex7.m1.5.5.5.5.1.1.cmml">)</mo></mrow></mrow><mrow id="A4.Ex7.m1.6.6.6" xref="A4.Ex7.m1.6.6.6.cmml"><mi id="A4.Ex7.m1.6.6.6.3" xref="A4.Ex7.m1.6.6.6.3.cmml">q</mi><mo id="A4.Ex7.m1.6.6.6.2" xref="A4.Ex7.m1.6.6.6.2.cmml">⁢</mo><mrow id="A4.Ex7.m1.6.6.6.4.2" xref="A4.Ex7.m1.6.6.6.cmml"><mo id="A4.Ex7.m1.6.6.6.4.2.1" stretchy="false" xref="A4.Ex7.m1.6.6.6.cmml">(</mo><mi id="A4.Ex7.m1.6.6.6.1" xref="A4.Ex7.m1.6.6.6.1.cmml">z</mi><mo id="A4.Ex7.m1.6.6.6.4.2.2" stretchy="false" xref="A4.Ex7.m1.6.6.6.cmml">)</mo></mrow></mrow></mfrac></mstyle><mo id="A4.Ex7.m1.6.7.2.1" lspace="0.170em" xref="A4.Ex7.m1.6.7.2.1.cmml">⁢</mo><mi id="A4.Ex7.m1.6.7.2.2" xref="A4.Ex7.m1.6.7.2.2.cmml">d</mi><mo id="A4.Ex7.m1.6.7.2.1a" xref="A4.Ex7.m1.6.7.2.1.cmml">⁢</mo><mi id="A4.Ex7.m1.6.7.2.3" xref="A4.Ex7.m1.6.7.2.3.cmml">z</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.Ex7.m1.6b"><apply id="A4.Ex7.m1.6.7.cmml" xref="A4.Ex7.m1.6.7"><log id="A4.Ex7.m1.6.7.1.cmml" xref="A4.Ex7.m1.6.7.1"></log><apply id="A4.Ex7.m1.6.7.2.cmml" xref="A4.Ex7.m1.6.7.2"><times id="A4.Ex7.m1.6.7.2.1.cmml" xref="A4.Ex7.m1.6.7.2.1"></times><apply id="A4.Ex7.m1.6.6.cmml" xref="A4.Ex7.m1.6.6"><divide id="A4.Ex7.m1.6.6.7.cmml" xref="A4.Ex7.m1.6.6"></divide><apply id="A4.Ex7.m1.5.5.5.cmml" xref="A4.Ex7.m1.5.5.5"><times id="A4.Ex7.m1.5.5.5.6.cmml" xref="A4.Ex7.m1.5.5.5.6"></times><apply id="A4.Ex7.m1.5.5.5.7.cmml" xref="A4.Ex7.m1.5.5.5.7"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.7.1.cmml" xref="A4.Ex7.m1.5.5.5.7">subscript</csymbol><ci id="A4.Ex7.m1.5.5.5.7.2.cmml" xref="A4.Ex7.m1.5.5.5.7.2">𝑃</ci><ci id="A4.Ex7.m1.5.5.5.7.3.cmml" xref="A4.Ex7.m1.5.5.5.7.3">ℳ</ci></apply><apply id="A4.Ex7.m1.4.4.4.4.1.1.cmml" xref="A4.Ex7.m1.4.4.4.4.1"><csymbol cd="latexml" id="A4.Ex7.m1.4.4.4.4.1.1.1.cmml" xref="A4.Ex7.m1.4.4.4.4.1.1.1">conditional</csymbol><ci id="A4.Ex7.m1.4.4.4.4.1.1.2.cmml" xref="A4.Ex7.m1.4.4.4.4.1.1.2">𝑌</ci><list id="A4.Ex7.m1.4.4.4.4.1.1.3.1.cmml" xref="A4.Ex7.m1.4.4.4.4.1.1.3.2"><ci id="A4.Ex7.m1.1.1.1.1.cmml" xref="A4.Ex7.m1.1.1.1.1">𝑧</ci><ci id="A4.Ex7.m1.2.2.2.2.cmml" xref="A4.Ex7.m1.2.2.2.2">𝑋</ci></list></apply><apply id="A4.Ex7.m1.5.5.5.8.cmml" xref="A4.Ex7.m1.5.5.5.8"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.8.1.cmml" xref="A4.Ex7.m1.5.5.5.8">subscript</csymbol><ci id="A4.Ex7.m1.5.5.5.8.2.cmml" xref="A4.Ex7.m1.5.5.5.8.2">𝑃</ci><ci id="A4.Ex7.m1.5.5.5.8.3.cmml" xref="A4.Ex7.m1.5.5.5.8.3">ℳ</ci></apply><apply id="A4.Ex7.m1.5.5.5.5.1.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1"><csymbol cd="latexml" id="A4.Ex7.m1.5.5.5.5.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.2">conditional</csymbol><ci id="A4.Ex7.m1.5.5.5.5.1.1.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.3">𝑧</ci><list id="A4.Ex7.m1.5.5.5.5.1.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1"><apply id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1">superscript</csymbol><apply id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1">subscript</csymbol><set id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2"><apply id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3"><eq id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.1.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.1"></eq><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.2.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.3.cmml" xref="A4.Ex7.m1.5.5.5.5.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.Ex7.m1.3.3.3.3.cmml" xref="A4.Ex7.m1.3.3.3.3">𝑋</ci></list></apply></apply><apply id="A4.Ex7.m1.6.6.6.cmml" xref="A4.Ex7.m1.6.6.6"><times id="A4.Ex7.m1.6.6.6.2.cmml" xref="A4.Ex7.m1.6.6.6.2"></times><ci id="A4.Ex7.m1.6.6.6.3.cmml" xref="A4.Ex7.m1.6.6.6.3">𝑞</ci><ci id="A4.Ex7.m1.6.6.6.1.cmml" xref="A4.Ex7.m1.6.6.6.1">𝑧</ci></apply></apply><ci id="A4.Ex7.m1.6.7.2.2.cmml" xref="A4.Ex7.m1.6.7.2.2">𝑑</ci><ci id="A4.Ex7.m1.6.7.2.3.cmml" xref="A4.Ex7.m1.6.7.2.3">𝑧</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.Ex7.m1.6c">\displaystyle\log\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{%
k},Y_{k})\}_{k=1}^{K},X)}{q(z)}\,dz</annotation><annotation encoding="application/x-llamapun" id="A4.Ex7.m1.6d">roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_ARG start_ARG italic_q ( italic_z ) end_ARG italic_d italic_z</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A4.Ex8"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\triangleq\mathcal{L}(q)." class="ltx_Math" display="inline" id="A4.Ex8.m1.2"><semantics id="A4.Ex8.m1.2a"><mrow id="A4.Ex8.m1.2.2.1" xref="A4.Ex8.m1.2.2.1.1.cmml"><mrow id="A4.Ex8.m1.2.2.1.1" xref="A4.Ex8.m1.2.2.1.1.cmml"><mi id="A4.Ex8.m1.2.2.1.1.2" xref="A4.Ex8.m1.2.2.1.1.2.cmml"></mi><mo id="A4.Ex8.m1.2.2.1.1.1" xref="A4.Ex8.m1.2.2.1.1.1.cmml">≜</mo><mrow id="A4.Ex8.m1.2.2.1.1.3" xref="A4.Ex8.m1.2.2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="A4.Ex8.m1.2.2.1.1.3.2" xref="A4.Ex8.m1.2.2.1.1.3.2.cmml">ℒ</mi><mo id="A4.Ex8.m1.2.2.1.1.3.1" xref="A4.Ex8.m1.2.2.1.1.3.1.cmml">⁢</mo><mrow id="A4.Ex8.m1.2.2.1.1.3.3.2" xref="A4.Ex8.m1.2.2.1.1.3.cmml"><mo id="A4.Ex8.m1.2.2.1.1.3.3.2.1" stretchy="false" xref="A4.Ex8.m1.2.2.1.1.3.cmml">(</mo><mi id="A4.Ex8.m1.1.1" xref="A4.Ex8.m1.1.1.cmml">q</mi><mo id="A4.Ex8.m1.2.2.1.1.3.3.2.2" stretchy="false" xref="A4.Ex8.m1.2.2.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A4.Ex8.m1.2.2.1.2" lspace="0em" xref="A4.Ex8.m1.2.2.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="A4.Ex8.m1.2b"><apply id="A4.Ex8.m1.2.2.1.1.cmml" xref="A4.Ex8.m1.2.2.1"><ci id="A4.Ex8.m1.2.2.1.1.1.cmml" xref="A4.Ex8.m1.2.2.1.1.1">≜</ci><csymbol cd="latexml" id="A4.Ex8.m1.2.2.1.1.2.cmml" xref="A4.Ex8.m1.2.2.1.1.2">absent</csymbol><apply id="A4.Ex8.m1.2.2.1.1.3.cmml" xref="A4.Ex8.m1.2.2.1.1.3"><times id="A4.Ex8.m1.2.2.1.1.3.1.cmml" xref="A4.Ex8.m1.2.2.1.1.3.1"></times><ci id="A4.Ex8.m1.2.2.1.1.3.2.cmml" xref="A4.Ex8.m1.2.2.1.1.3.2">ℒ</ci><ci id="A4.Ex8.m1.1.1.cmml" xref="A4.Ex8.m1.1.1">𝑞</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.Ex8.m1.2c">\displaystyle\triangleq\mathcal{L}(q).</annotation><annotation encoding="application/x-llamapun" id="A4.Ex8.m1.2d">≜ caligraphic_L ( italic_q ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A4.p3">
<p class="ltx_p" id="A4.p3.7">The quantity <math alttext="\mathcal{L}(q)" class="ltx_Math" display="inline" id="A4.p3.1.m1.1"><semantics id="A4.p3.1.m1.1a"><mrow id="A4.p3.1.m1.1.2" xref="A4.p3.1.m1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="A4.p3.1.m1.1.2.2" xref="A4.p3.1.m1.1.2.2.cmml">ℒ</mi><mo id="A4.p3.1.m1.1.2.1" xref="A4.p3.1.m1.1.2.1.cmml">⁢</mo><mrow id="A4.p3.1.m1.1.2.3.2" xref="A4.p3.1.m1.1.2.cmml"><mo id="A4.p3.1.m1.1.2.3.2.1" stretchy="false" xref="A4.p3.1.m1.1.2.cmml">(</mo><mi id="A4.p3.1.m1.1.1" xref="A4.p3.1.m1.1.1.cmml">q</mi><mo id="A4.p3.1.m1.1.2.3.2.2" stretchy="false" xref="A4.p3.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p3.1.m1.1b"><apply id="A4.p3.1.m1.1.2.cmml" xref="A4.p3.1.m1.1.2"><times id="A4.p3.1.m1.1.2.1.cmml" xref="A4.p3.1.m1.1.2.1"></times><ci id="A4.p3.1.m1.1.2.2.cmml" xref="A4.p3.1.m1.1.2.2">ℒ</ci><ci id="A4.p3.1.m1.1.1.cmml" xref="A4.p3.1.m1.1.1">𝑞</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.1.m1.1c">\mathcal{L}(q)</annotation><annotation encoding="application/x-llamapun" id="A4.p3.1.m1.1d">caligraphic_L ( italic_q )</annotation></semantics></math> is the evidence lower bound (ELBO) <cite class="ltx_cite ltx_citemacro_citep">(Kingma, <a class="ltx_ref" href="https://arxiv.org/html/2505.19966v1#bib.bib16" title="">2013</a>)</cite>. We approximate <math alttext="q(z)" class="ltx_Math" display="inline" id="A4.p3.2.m2.1"><semantics id="A4.p3.2.m2.1a"><mrow id="A4.p3.2.m2.1.2" xref="A4.p3.2.m2.1.2.cmml"><mi id="A4.p3.2.m2.1.2.2" xref="A4.p3.2.m2.1.2.2.cmml">q</mi><mo id="A4.p3.2.m2.1.2.1" xref="A4.p3.2.m2.1.2.1.cmml">⁢</mo><mrow id="A4.p3.2.m2.1.2.3.2" xref="A4.p3.2.m2.1.2.cmml"><mo id="A4.p3.2.m2.1.2.3.2.1" stretchy="false" xref="A4.p3.2.m2.1.2.cmml">(</mo><mi id="A4.p3.2.m2.1.1" xref="A4.p3.2.m2.1.1.cmml">z</mi><mo id="A4.p3.2.m2.1.2.3.2.2" stretchy="false" xref="A4.p3.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p3.2.m2.1b"><apply id="A4.p3.2.m2.1.2.cmml" xref="A4.p3.2.m2.1.2"><times id="A4.p3.2.m2.1.2.1.cmml" xref="A4.p3.2.m2.1.2.1"></times><ci id="A4.p3.2.m2.1.2.2.cmml" xref="A4.p3.2.m2.1.2.2">𝑞</ci><ci id="A4.p3.2.m2.1.1.cmml" xref="A4.p3.2.m2.1.1">𝑧</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.2.m2.1c">q(z)</annotation><annotation encoding="application/x-llamapun" id="A4.p3.2.m2.1d">italic_q ( italic_z )</annotation></semantics></math> by a Dirac <math alttext="\delta" class="ltx_Math" display="inline" id="A4.p3.3.m3.1"><semantics id="A4.p3.3.m3.1a"><mi id="A4.p3.3.m3.1.1" xref="A4.p3.3.m3.1.1.cmml">δ</mi><annotation-xml encoding="MathML-Content" id="A4.p3.3.m3.1b"><ci id="A4.p3.3.m3.1.1.cmml" xref="A4.p3.3.m3.1.1">𝛿</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.3.m3.1c">\delta</annotation><annotation encoding="application/x-llamapun" id="A4.p3.3.m3.1d">italic_δ</annotation></semantics></math> distribution: <math alttext="q(z)=\delta(z-z^{*})" class="ltx_Math" display="inline" id="A4.p3.4.m4.2"><semantics id="A4.p3.4.m4.2a"><mrow id="A4.p3.4.m4.2.2" xref="A4.p3.4.m4.2.2.cmml"><mrow id="A4.p3.4.m4.2.2.3" xref="A4.p3.4.m4.2.2.3.cmml"><mi id="A4.p3.4.m4.2.2.3.2" xref="A4.p3.4.m4.2.2.3.2.cmml">q</mi><mo id="A4.p3.4.m4.2.2.3.1" xref="A4.p3.4.m4.2.2.3.1.cmml">⁢</mo><mrow id="A4.p3.4.m4.2.2.3.3.2" xref="A4.p3.4.m4.2.2.3.cmml"><mo id="A4.p3.4.m4.2.2.3.3.2.1" stretchy="false" xref="A4.p3.4.m4.2.2.3.cmml">(</mo><mi id="A4.p3.4.m4.1.1" xref="A4.p3.4.m4.1.1.cmml">z</mi><mo id="A4.p3.4.m4.2.2.3.3.2.2" stretchy="false" xref="A4.p3.4.m4.2.2.3.cmml">)</mo></mrow></mrow><mo id="A4.p3.4.m4.2.2.2" xref="A4.p3.4.m4.2.2.2.cmml">=</mo><mrow id="A4.p3.4.m4.2.2.1" xref="A4.p3.4.m4.2.2.1.cmml"><mi id="A4.p3.4.m4.2.2.1.3" xref="A4.p3.4.m4.2.2.1.3.cmml">δ</mi><mo id="A4.p3.4.m4.2.2.1.2" xref="A4.p3.4.m4.2.2.1.2.cmml">⁢</mo><mrow id="A4.p3.4.m4.2.2.1.1.1" xref="A4.p3.4.m4.2.2.1.1.1.1.cmml"><mo id="A4.p3.4.m4.2.2.1.1.1.2" stretchy="false" xref="A4.p3.4.m4.2.2.1.1.1.1.cmml">(</mo><mrow id="A4.p3.4.m4.2.2.1.1.1.1" xref="A4.p3.4.m4.2.2.1.1.1.1.cmml"><mi id="A4.p3.4.m4.2.2.1.1.1.1.2" xref="A4.p3.4.m4.2.2.1.1.1.1.2.cmml">z</mi><mo id="A4.p3.4.m4.2.2.1.1.1.1.1" xref="A4.p3.4.m4.2.2.1.1.1.1.1.cmml">−</mo><msup id="A4.p3.4.m4.2.2.1.1.1.1.3" xref="A4.p3.4.m4.2.2.1.1.1.1.3.cmml"><mi id="A4.p3.4.m4.2.2.1.1.1.1.3.2" xref="A4.p3.4.m4.2.2.1.1.1.1.3.2.cmml">z</mi><mo id="A4.p3.4.m4.2.2.1.1.1.1.3.3" xref="A4.p3.4.m4.2.2.1.1.1.1.3.3.cmml">∗</mo></msup></mrow><mo id="A4.p3.4.m4.2.2.1.1.1.3" stretchy="false" xref="A4.p3.4.m4.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p3.4.m4.2b"><apply id="A4.p3.4.m4.2.2.cmml" xref="A4.p3.4.m4.2.2"><eq id="A4.p3.4.m4.2.2.2.cmml" xref="A4.p3.4.m4.2.2.2"></eq><apply id="A4.p3.4.m4.2.2.3.cmml" xref="A4.p3.4.m4.2.2.3"><times id="A4.p3.4.m4.2.2.3.1.cmml" xref="A4.p3.4.m4.2.2.3.1"></times><ci id="A4.p3.4.m4.2.2.3.2.cmml" xref="A4.p3.4.m4.2.2.3.2">𝑞</ci><ci id="A4.p3.4.m4.1.1.cmml" xref="A4.p3.4.m4.1.1">𝑧</ci></apply><apply id="A4.p3.4.m4.2.2.1.cmml" xref="A4.p3.4.m4.2.2.1"><times id="A4.p3.4.m4.2.2.1.2.cmml" xref="A4.p3.4.m4.2.2.1.2"></times><ci id="A4.p3.4.m4.2.2.1.3.cmml" xref="A4.p3.4.m4.2.2.1.3">𝛿</ci><apply id="A4.p3.4.m4.2.2.1.1.1.1.cmml" xref="A4.p3.4.m4.2.2.1.1.1"><minus id="A4.p3.4.m4.2.2.1.1.1.1.1.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.1"></minus><ci id="A4.p3.4.m4.2.2.1.1.1.1.2.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.2">𝑧</ci><apply id="A4.p3.4.m4.2.2.1.1.1.1.3.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="A4.p3.4.m4.2.2.1.1.1.1.3.1.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.3">superscript</csymbol><ci id="A4.p3.4.m4.2.2.1.1.1.1.3.2.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.3.2">𝑧</ci><times id="A4.p3.4.m4.2.2.1.1.1.1.3.3.cmml" xref="A4.p3.4.m4.2.2.1.1.1.1.3.3"></times></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.4.m4.2c">q(z)=\delta(z-z^{*})</annotation><annotation encoding="application/x-llamapun" id="A4.p3.4.m4.2d">italic_q ( italic_z ) = italic_δ ( italic_z - italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT )</annotation></semantics></math> which essentially assumes that the posterior <math alttext="P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)" class="ltx_Math" display="inline" id="A4.p3.5.m5.2"><semantics id="A4.p3.5.m5.2a"><mrow id="A4.p3.5.m5.2.2" xref="A4.p3.5.m5.2.2.cmml"><msub id="A4.p3.5.m5.2.2.3" xref="A4.p3.5.m5.2.2.3.cmml"><mi id="A4.p3.5.m5.2.2.3.2" xref="A4.p3.5.m5.2.2.3.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p3.5.m5.2.2.3.3" xref="A4.p3.5.m5.2.2.3.3.cmml">ℳ</mi></msub><mo id="A4.p3.5.m5.2.2.2" xref="A4.p3.5.m5.2.2.2.cmml">⁢</mo><mrow id="A4.p3.5.m5.2.2.1.1" xref="A4.p3.5.m5.2.2.1.1.1.cmml"><mo id="A4.p3.5.m5.2.2.1.1.2" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.cmml">(</mo><mrow id="A4.p3.5.m5.2.2.1.1.1" xref="A4.p3.5.m5.2.2.1.1.1.cmml"><mi id="A4.p3.5.m5.2.2.1.1.1.3" xref="A4.p3.5.m5.2.2.1.1.1.3.cmml">z</mi><mo id="A4.p3.5.m5.2.2.1.1.1.2" xref="A4.p3.5.m5.2.2.1.1.1.2.cmml">∣</mo><mrow id="A4.p3.5.m5.2.2.1.1.1.1.1" xref="A4.p3.5.m5.2.2.1.1.1.1.2.cmml"><msubsup id="A4.p3.5.m5.2.2.1.1.1.1.1.1" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.cmml"><mrow id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.2.cmml"><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.4" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.2" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.1" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.3" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.p3.5.m5.2.2.1.1.1.1.1.1.3" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.p3.5.m5.2.2.1.1.1.1.1.2" xref="A4.p3.5.m5.2.2.1.1.1.1.2.cmml">,</mo><mi id="A4.p3.5.m5.1.1" xref="A4.p3.5.m5.1.1.cmml">X</mi></mrow></mrow><mo id="A4.p3.5.m5.2.2.1.1.3" stretchy="false" xref="A4.p3.5.m5.2.2.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p3.5.m5.2b"><apply id="A4.p3.5.m5.2.2.cmml" xref="A4.p3.5.m5.2.2"><times id="A4.p3.5.m5.2.2.2.cmml" xref="A4.p3.5.m5.2.2.2"></times><apply id="A4.p3.5.m5.2.2.3.cmml" xref="A4.p3.5.m5.2.2.3"><csymbol cd="ambiguous" id="A4.p3.5.m5.2.2.3.1.cmml" xref="A4.p3.5.m5.2.2.3">subscript</csymbol><ci id="A4.p3.5.m5.2.2.3.2.cmml" xref="A4.p3.5.m5.2.2.3.2">𝑃</ci><ci id="A4.p3.5.m5.2.2.3.3.cmml" xref="A4.p3.5.m5.2.2.3.3">ℳ</ci></apply><apply id="A4.p3.5.m5.2.2.1.1.1.cmml" xref="A4.p3.5.m5.2.2.1.1"><csymbol cd="latexml" id="A4.p3.5.m5.2.2.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.2">conditional</csymbol><ci id="A4.p3.5.m5.2.2.1.1.1.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.3">𝑧</ci><list id="A4.p3.5.m5.2.2.1.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1"><apply id="A4.p3.5.m5.2.2.1.1.1.1.1.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p3.5.m5.2.2.1.1.1.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1">subscript</csymbol><set id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2"><apply id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3"><eq id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.1"></eq><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.p3.5.m5.2.2.1.1.1.1.1.1.3.cmml" xref="A4.p3.5.m5.2.2.1.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.p3.5.m5.1.1.cmml" xref="A4.p3.5.m5.1.1">𝑋</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.5.m5.2c">P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)</annotation><annotation encoding="application/x-llamapun" id="A4.p3.5.m5.2d">italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X )</annotation></semantics></math> is highly concentrated at the optimal latent variable <math alttext="z^{*}" class="ltx_Math" display="inline" id="A4.p3.6.m6.1"><semantics id="A4.p3.6.m6.1a"><msup id="A4.p3.6.m6.1.1" xref="A4.p3.6.m6.1.1.cmml"><mi id="A4.p3.6.m6.1.1.2" xref="A4.p3.6.m6.1.1.2.cmml">z</mi><mo id="A4.p3.6.m6.1.1.3" xref="A4.p3.6.m6.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="A4.p3.6.m6.1b"><apply id="A4.p3.6.m6.1.1.cmml" xref="A4.p3.6.m6.1.1"><csymbol cd="ambiguous" id="A4.p3.6.m6.1.1.1.cmml" xref="A4.p3.6.m6.1.1">superscript</csymbol><ci id="A4.p3.6.m6.1.1.2.cmml" xref="A4.p3.6.m6.1.1.2">𝑧</ci><times id="A4.p3.6.m6.1.1.3.cmml" xref="A4.p3.6.m6.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.6.m6.1c">z^{*}</annotation><annotation encoding="application/x-llamapun" id="A4.p3.6.m6.1d">italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math>. By the sifting property of the Dirac <math alttext="\delta" class="ltx_Math" display="inline" id="A4.p3.7.m7.1"><semantics id="A4.p3.7.m7.1a"><mi id="A4.p3.7.m7.1.1" xref="A4.p3.7.m7.1.1.cmml">δ</mi><annotation-xml encoding="MathML-Content" id="A4.p3.7.m7.1b"><ci id="A4.p3.7.m7.1.1.cmml" xref="A4.p3.7.m7.1.1">𝛿</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.7.m7.1c">\delta</annotation><annotation encoding="application/x-llamapun" id="A4.p3.7.m7.1d">italic_δ</annotation></semantics></math>,</p>
<table class="ltx_equation ltx_eqn_table" id="A4.Ex9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\int_{z}\delta(z-z^{*})f(z)\,dz=f(z^{*})," class="ltx_Math" display="block" id="A4.Ex9.m1.2"><semantics id="A4.Ex9.m1.2a"><mrow id="A4.Ex9.m1.2.2.1" xref="A4.Ex9.m1.2.2.1.1.cmml"><mrow id="A4.Ex9.m1.2.2.1.1" xref="A4.Ex9.m1.2.2.1.1.cmml"><mrow id="A4.Ex9.m1.2.2.1.1.1" xref="A4.Ex9.m1.2.2.1.1.1.cmml"><msub id="A4.Ex9.m1.2.2.1.1.1.2" xref="A4.Ex9.m1.2.2.1.1.1.2.cmml"><mo id="A4.Ex9.m1.2.2.1.1.1.2.2" xref="A4.Ex9.m1.2.2.1.1.1.2.2.cmml">∫</mo><mi id="A4.Ex9.m1.2.2.1.1.1.2.3" xref="A4.Ex9.m1.2.2.1.1.1.2.3.cmml">z</mi></msub><mrow id="A4.Ex9.m1.2.2.1.1.1.1" xref="A4.Ex9.m1.2.2.1.1.1.1.cmml"><mi id="A4.Ex9.m1.2.2.1.1.1.1.3" xref="A4.Ex9.m1.2.2.1.1.1.1.3.cmml">δ</mi><mo id="A4.Ex9.m1.2.2.1.1.1.1.2" xref="A4.Ex9.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="A4.Ex9.m1.2.2.1.1.1.1.1.1" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.cmml"><mo id="A4.Ex9.m1.2.2.1.1.1.1.1.1.2" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.cmml"><mi id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.2" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.2.cmml">z</mi><mo id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.1" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.1.cmml">−</mo><msup id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.cmml"><mi id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.2" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.2.cmml">z</mi><mo id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.3" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.3.cmml">∗</mo></msup></mrow><mo id="A4.Ex9.m1.2.2.1.1.1.1.1.1.3" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="A4.Ex9.m1.2.2.1.1.1.1.2a" xref="A4.Ex9.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mi id="A4.Ex9.m1.2.2.1.1.1.1.4" xref="A4.Ex9.m1.2.2.1.1.1.1.4.cmml">f</mi><mo id="A4.Ex9.m1.2.2.1.1.1.1.2b" xref="A4.Ex9.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="A4.Ex9.m1.2.2.1.1.1.1.5.2" xref="A4.Ex9.m1.2.2.1.1.1.1.cmml"><mo id="A4.Ex9.m1.2.2.1.1.1.1.5.2.1" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.1.1.cmml">(</mo><mi id="A4.Ex9.m1.1.1" xref="A4.Ex9.m1.1.1.cmml">z</mi><mo id="A4.Ex9.m1.2.2.1.1.1.1.5.2.2" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.1.1.cmml">)</mo></mrow><mo id="A4.Ex9.m1.2.2.1.1.1.1.2c" lspace="0.170em" xref="A4.Ex9.m1.2.2.1.1.1.1.2.cmml">⁢</mo><mrow id="A4.Ex9.m1.2.2.1.1.1.1.6" xref="A4.Ex9.m1.2.2.1.1.1.1.6.cmml"><mo id="A4.Ex9.m1.2.2.1.1.1.1.6.1" rspace="0em" xref="A4.Ex9.m1.2.2.1.1.1.1.6.1.cmml">𝑑</mo><mi id="A4.Ex9.m1.2.2.1.1.1.1.6.2" xref="A4.Ex9.m1.2.2.1.1.1.1.6.2.cmml">z</mi></mrow></mrow></mrow><mo id="A4.Ex9.m1.2.2.1.1.3" xref="A4.Ex9.m1.2.2.1.1.3.cmml">=</mo><mrow id="A4.Ex9.m1.2.2.1.1.2" xref="A4.Ex9.m1.2.2.1.1.2.cmml"><mi id="A4.Ex9.m1.2.2.1.1.2.3" xref="A4.Ex9.m1.2.2.1.1.2.3.cmml">f</mi><mo id="A4.Ex9.m1.2.2.1.1.2.2" xref="A4.Ex9.m1.2.2.1.1.2.2.cmml">⁢</mo><mrow id="A4.Ex9.m1.2.2.1.1.2.1.1" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.cmml"><mo id="A4.Ex9.m1.2.2.1.1.2.1.1.2" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.cmml">(</mo><msup id="A4.Ex9.m1.2.2.1.1.2.1.1.1" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.cmml"><mi id="A4.Ex9.m1.2.2.1.1.2.1.1.1.2" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.2.cmml">z</mi><mo id="A4.Ex9.m1.2.2.1.1.2.1.1.1.3" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.3.cmml">∗</mo></msup><mo id="A4.Ex9.m1.2.2.1.1.2.1.1.3" stretchy="false" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A4.Ex9.m1.2.2.1.2" xref="A4.Ex9.m1.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A4.Ex9.m1.2b"><apply id="A4.Ex9.m1.2.2.1.1.cmml" xref="A4.Ex9.m1.2.2.1"><eq id="A4.Ex9.m1.2.2.1.1.3.cmml" xref="A4.Ex9.m1.2.2.1.1.3"></eq><apply id="A4.Ex9.m1.2.2.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1"><apply id="A4.Ex9.m1.2.2.1.1.1.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A4.Ex9.m1.2.2.1.1.1.2.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.2">subscript</csymbol><int id="A4.Ex9.m1.2.2.1.1.1.2.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.2.2"></int><ci id="A4.Ex9.m1.2.2.1.1.1.2.3.cmml" xref="A4.Ex9.m1.2.2.1.1.1.2.3">𝑧</ci></apply><apply id="A4.Ex9.m1.2.2.1.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1"><times id="A4.Ex9.m1.2.2.1.1.1.1.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.2"></times><ci id="A4.Ex9.m1.2.2.1.1.1.1.3.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.3">𝛿</ci><apply id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1"><minus id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.1"></minus><ci id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.2">𝑧</ci><apply id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3">superscript</csymbol><ci id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.2">𝑧</ci><times id="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.3.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.1.1.1.3.3"></times></apply></apply><ci id="A4.Ex9.m1.2.2.1.1.1.1.4.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.4">𝑓</ci><ci id="A4.Ex9.m1.1.1.cmml" xref="A4.Ex9.m1.1.1">𝑧</ci><apply id="A4.Ex9.m1.2.2.1.1.1.1.6.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.6"><csymbol cd="latexml" id="A4.Ex9.m1.2.2.1.1.1.1.6.1.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.6.1">differential-d</csymbol><ci id="A4.Ex9.m1.2.2.1.1.1.1.6.2.cmml" xref="A4.Ex9.m1.2.2.1.1.1.1.6.2">𝑧</ci></apply></apply></apply><apply id="A4.Ex9.m1.2.2.1.1.2.cmml" xref="A4.Ex9.m1.2.2.1.1.2"><times id="A4.Ex9.m1.2.2.1.1.2.2.cmml" xref="A4.Ex9.m1.2.2.1.1.2.2"></times><ci id="A4.Ex9.m1.2.2.1.1.2.3.cmml" xref="A4.Ex9.m1.2.2.1.1.2.3">𝑓</ci><apply id="A4.Ex9.m1.2.2.1.1.2.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.2.1.1"><csymbol cd="ambiguous" id="A4.Ex9.m1.2.2.1.1.2.1.1.1.1.cmml" xref="A4.Ex9.m1.2.2.1.1.2.1.1">superscript</csymbol><ci id="A4.Ex9.m1.2.2.1.1.2.1.1.1.2.cmml" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.2">𝑧</ci><times id="A4.Ex9.m1.2.2.1.1.2.1.1.1.3.cmml" xref="A4.Ex9.m1.2.2.1.1.2.1.1.1.3"></times></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.Ex9.m1.2c">\int_{z}\delta(z-z^{*})f(z)\,dz=f(z^{*}),</annotation><annotation encoding="application/x-llamapun" id="A4.Ex9.m1.2d">∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_δ ( italic_z - italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ) italic_f ( italic_z ) italic_d italic_z = italic_f ( italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A4.p3.8">for any well-behaved function <math alttext="f(z)" class="ltx_Math" display="inline" id="A4.p3.8.m1.1"><semantics id="A4.p3.8.m1.1a"><mrow id="A4.p3.8.m1.1.2" xref="A4.p3.8.m1.1.2.cmml"><mi id="A4.p3.8.m1.1.2.2" xref="A4.p3.8.m1.1.2.2.cmml">f</mi><mo id="A4.p3.8.m1.1.2.1" xref="A4.p3.8.m1.1.2.1.cmml">⁢</mo><mrow id="A4.p3.8.m1.1.2.3.2" xref="A4.p3.8.m1.1.2.cmml"><mo id="A4.p3.8.m1.1.2.3.2.1" stretchy="false" xref="A4.p3.8.m1.1.2.cmml">(</mo><mi id="A4.p3.8.m1.1.1" xref="A4.p3.8.m1.1.1.cmml">z</mi><mo id="A4.p3.8.m1.1.2.3.2.2" stretchy="false" xref="A4.p3.8.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p3.8.m1.1b"><apply id="A4.p3.8.m1.1.2.cmml" xref="A4.p3.8.m1.1.2"><times id="A4.p3.8.m1.1.2.1.cmml" xref="A4.p3.8.m1.1.2.1"></times><ci id="A4.p3.8.m1.1.2.2.cmml" xref="A4.p3.8.m1.1.2.2">𝑓</ci><ci id="A4.p3.8.m1.1.1.cmml" xref="A4.p3.8.m1.1.1">𝑧</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.8.m1.1c">f(z)</annotation><annotation encoding="application/x-llamapun" id="A4.p3.8.m1.1d">italic_f ( italic_z )</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="A4.p4">
<p class="ltx_p" id="A4.p4.1">Substituting this into the ELBO yields</p>
</div>
<div class="ltx_para" id="A4.p5">
<table class="ltx_equation ltx_eqn_table" id="A4.p5.1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(q)=\int_{z}\delta(z-z^{*})\times\\
\log\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{%
k=1}^{K},X)}{\delta(z-z^{*})}\,dz\\[2.84526pt]
=\log\frac{P_{\mathcal{M}}(Y\mid z^{*},X)\,P_{\mathcal{M}}(z^{*}\mid\{(X_{k},Y%
_{k})\}_{k=1}^{K},X)}{\delta(0)}." class="ltx_Math" display="block" id="A4.p5.1.m1.25"><semantics id="A4.p5.1.m1.25a"><mtable displaystyle="true" id="A4.p5.1.m1.25.25.2" rowspacing="0pt"><mtr id="A4.p5.1.m1.25.25.2a"><mtd class="ltx_align_left" columnalign="left" id="A4.p5.1.m1.25.25.2b"><mrow id="A4.p5.1.m1.15.15.15.15.15"><mi class="ltx_font_mathcaligraphic" id="A4.p5.1.m1.1.1.1.1.1.1" xref="A4.p5.1.m1.1.1.1.1.1.1.cmml">ℒ</mi><mrow id="A4.p5.1.m1.15.15.15.15.15.16"><mo id="A4.p5.1.m1.2.2.2.2.2.2" stretchy="false" xref="A4.p5.1.m1.24.24.1.1.1.cmml">(</mo><mi id="A4.p5.1.m1.3.3.3.3.3.3" xref="A4.p5.1.m1.3.3.3.3.3.3.cmml">q</mi><mo id="A4.p5.1.m1.4.4.4.4.4.4" stretchy="false" xref="A4.p5.1.m1.24.24.1.1.1.cmml">)</mo></mrow><mo id="A4.p5.1.m1.5.5.5.5.5.5" rspace="0.111em" xref="A4.p5.1.m1.5.5.5.5.5.5.cmml">=</mo><msub id="A4.p5.1.m1.15.15.15.15.15.17"><mo id="A4.p5.1.m1.6.6.6.6.6.6" xref="A4.p5.1.m1.6.6.6.6.6.6.cmml">∫</mo><mi id="A4.p5.1.m1.7.7.7.7.7.7.1" xref="A4.p5.1.m1.7.7.7.7.7.7.1.cmml">z</mi></msub><mi id="A4.p5.1.m1.8.8.8.8.8.8" xref="A4.p5.1.m1.8.8.8.8.8.8.cmml">δ</mi><mrow id="A4.p5.1.m1.15.15.15.15.15.18"><mo id="A4.p5.1.m1.9.9.9.9.9.9" stretchy="false" xref="A4.p5.1.m1.24.24.1.1.1.cmml">(</mo><mi id="A4.p5.1.m1.10.10.10.10.10.10" xref="A4.p5.1.m1.10.10.10.10.10.10.cmml">z</mi><mo id="A4.p5.1.m1.11.11.11.11.11.11" xref="A4.p5.1.m1.11.11.11.11.11.11.cmml">−</mo><msup id="A4.p5.1.m1.15.15.15.15.15.18.1"><mi id="A4.p5.1.m1.12.12.12.12.12.12" xref="A4.p5.1.m1.12.12.12.12.12.12.cmml">z</mi><mo id="A4.p5.1.m1.13.13.13.13.13.13.1" xref="A4.p5.1.m1.13.13.13.13.13.13.1.cmml">∗</mo></msup><mo id="A4.p5.1.m1.14.14.14.14.14.14" rspace="0.055em" stretchy="false" xref="A4.p5.1.m1.24.24.1.1.1.cmml">)</mo></mrow><mo id="A4.p5.1.m1.15.15.15.15.15.15" xref="A4.p5.1.m1.15.15.15.15.15.15.cmml">×</mo></mrow></mtd></mtr><mtr id="A4.p5.1.m1.25.25.2c"><mtd class="ltx_align_right" columnalign="right" id="A4.p5.1.m1.25.25.2d"><mrow id="A4.p5.1.m1.19.19.19.4.4"><mi id="A4.p5.1.m1.16.16.16.1.1.1" xref="A4.p5.1.m1.16.16.16.1.1.1.cmml">log</mi><mo id="A4.p5.1.m1.19.19.19.4.4a" lspace="0.167em" xref="A4.p5.1.m1.24.24.1.1.1.cmml">⁡</mo><mrow id="A4.p5.1.m1.19.19.19.4.4.5"><mfrac id="A4.p5.1.m1.17.17.17.2.2.2" xref="A4.p5.1.m1.17.17.17.2.2.2.cmml"><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5" xref="A4.p5.1.m1.17.17.17.2.2.2.5.cmml"><msub id="A4.p5.1.m1.17.17.17.2.2.2.5.7" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.7.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p5.1.m1.17.17.17.2.2.2.5.7.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7.3.cmml">ℳ</mi></msub><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.6" xref="A4.p5.1.m1.17.17.17.2.2.2.5.6.cmml">⁢</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.cmml"><mo id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.2" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.cmml">(</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.2.cmml">Y</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.1.cmml">∣</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.2" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.1.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.1.1.cmml">z</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.2.1" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.1.cmml">,</mo><mi id="A4.p5.1.m1.17.17.17.2.2.2.2.2" xref="A4.p5.1.m1.17.17.17.2.2.2.2.2.cmml">X</mi></mrow></mrow><mo id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.3" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.cmml">)</mo></mrow><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.6a" lspace="0.170em" xref="A4.p5.1.m1.17.17.17.2.2.2.5.6.cmml">⁢</mo><msub id="A4.p5.1.m1.17.17.17.2.2.2.5.8" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.8.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p5.1.m1.17.17.17.2.2.2.5.8.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8.3.cmml">ℳ</mi></msub><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.6b" xref="A4.p5.1.m1.17.17.17.2.2.2.5.6.cmml">⁢</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.cmml"><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.2" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.cmml">(</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.3.cmml">z</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.2.cmml">∣</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.2.cmml"><msubsup id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.cmml"><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.2.cmml"><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.4" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.1" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.3" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.2.cmml">,</mo><mi id="A4.p5.1.m1.17.17.17.2.2.2.3.3" xref="A4.p5.1.m1.17.17.17.2.2.2.3.3.cmml">X</mi></mrow></mrow><mo id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.3" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.cmml">)</mo></mrow></mrow><mrow id="A4.p5.1.m1.17.17.17.2.2.2.6" xref="A4.p5.1.m1.17.17.17.2.2.2.6.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.6.3" xref="A4.p5.1.m1.17.17.17.2.2.2.6.3.cmml">δ</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.6.2" xref="A4.p5.1.m1.17.17.17.2.2.2.6.2.cmml">⁢</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.cmml"><mo id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.2" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.cmml">(</mo><mrow id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.2" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.2.cmml">z</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.1" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.1.cmml">−</mo><msup id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.cmml"><mi id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.2" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.2.cmml">z</mi><mo id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.3" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.3.cmml">∗</mo></msup></mrow><mo id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.3" stretchy="false" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="A4.p5.1.m1.19.19.19.4.4.5.1" lspace="0.170em" xref="A4.p5.1.m1.24.24.1.1.1.cmml">⁢</mo><mi id="A4.p5.1.m1.18.18.18.3.3.3" xref="A4.p5.1.m1.18.18.18.3.3.3.cmml">d</mi><mo id="A4.p5.1.m1.19.19.19.4.4.5.1a" xref="A4.p5.1.m1.24.24.1.1.1.cmml">⁢</mo><mi id="A4.p5.1.m1.19.19.19.4.4.4" xref="A4.p5.1.m1.19.19.19.4.4.4.cmml">z</mi></mrow></mrow></mtd></mtr><mtr id="A4.p5.1.m1.25.25.2e"><mtd class="ltx_align_right" columnalign="right" id="A4.p5.1.m1.25.25.2f"><mrow id="A4.p5.1.m1.25.25.2.24.5.5.5"><mrow id="A4.p5.1.m1.25.25.2.24.5.5.5.1"><mi id="A4.p5.1.m1.25.25.2.24.5.5.5.1.1" xref="A4.p5.1.m1.24.24.1.1.1.cmml"></mi><mo id="A4.p5.1.m1.20.20.20.1.1.1" xref="A4.p5.1.m1.20.20.20.1.1.1.cmml">=</mo><mrow id="A4.p5.1.m1.25.25.2.24.5.5.5.1.2"><mi id="A4.p5.1.m1.21.21.21.2.2.2" xref="A4.p5.1.m1.21.21.21.2.2.2.cmml">log</mi><mo id="A4.p5.1.m1.25.25.2.24.5.5.5.1.2a" lspace="0.167em" xref="A4.p5.1.m1.24.24.1.1.1.cmml">⁡</mo><mfrac id="A4.p5.1.m1.22.22.22.3.3.3" xref="A4.p5.1.m1.22.22.22.3.3.3.cmml"><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4" xref="A4.p5.1.m1.22.22.22.3.3.3.4.cmml"><msub id="A4.p5.1.m1.22.22.22.3.3.3.4.6" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.6.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p5.1.m1.22.22.22.3.3.3.4.6.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6.3.cmml">ℳ</mi></msub><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.5" xref="A4.p5.1.m1.22.22.22.3.3.3.4.5.cmml">⁢</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.cmml"><mo id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.2" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.cmml">(</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.3.cmml">Y</mi><mo id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.2.cmml">∣</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.2.cmml"><msup id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.2.cmml">z</mi><mo id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.3.cmml">∗</mo></msup><mo id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.2.cmml">,</mo><mi id="A4.p5.1.m1.22.22.22.3.3.3.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.1.1.cmml">X</mi></mrow></mrow><mo id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.3" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.cmml">)</mo></mrow><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.5a" lspace="0.170em" xref="A4.p5.1.m1.22.22.22.3.3.3.4.5.cmml">⁢</mo><msub id="A4.p5.1.m1.22.22.22.3.3.3.4.7" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.7.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7.2.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p5.1.m1.22.22.22.3.3.3.4.7.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7.3.cmml">ℳ</mi></msub><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.5b" xref="A4.p5.1.m1.22.22.22.3.3.3.4.5.cmml">⁢</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.cmml"><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.2" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.cmml">(</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.cmml"><msup id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.2.cmml">z</mi><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.3.cmml">∗</mo></msup><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.2.cmml">∣</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.2.cmml"><msubsup id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.cmml"><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.2.cmml"><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.2.cmml">{</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.3.cmml"><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.3.cmml">(</mo><msub id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.2.cmml">X</mi><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.3.cmml">k</mi></msub><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.4" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.3.cmml">,</mo><msub id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.2.cmml">Y</mi><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi></msub><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.3.cmml">)</mo></mrow><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.3" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.1" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.1.cmml">=</mo><mn id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.3" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.3.cmml">K</mi></msubsup><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.2" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.2.cmml">,</mo><mi id="A4.p5.1.m1.22.22.22.3.3.3.2.2" xref="A4.p5.1.m1.22.22.22.3.3.3.2.2.cmml">X</mi></mrow></mrow><mo id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.3" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.cmml">)</mo></mrow></mrow><mrow id="A4.p5.1.m1.22.22.22.3.3.3.5" xref="A4.p5.1.m1.22.22.22.3.3.3.5.cmml"><mi id="A4.p5.1.m1.22.22.22.3.3.3.5.3" xref="A4.p5.1.m1.22.22.22.3.3.3.5.3.cmml">δ</mi><mo id="A4.p5.1.m1.22.22.22.3.3.3.5.2" xref="A4.p5.1.m1.22.22.22.3.3.3.5.2.cmml">⁢</mo><mrow id="A4.p5.1.m1.22.22.22.3.3.3.5.4.2" xref="A4.p5.1.m1.22.22.22.3.3.3.5.cmml"><mo id="A4.p5.1.m1.22.22.22.3.3.3.5.4.2.1" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.5.cmml">(</mo><mn id="A4.p5.1.m1.22.22.22.3.3.3.5.1" xref="A4.p5.1.m1.22.22.22.3.3.3.5.1.cmml">0</mn><mo id="A4.p5.1.m1.22.22.22.3.3.3.5.4.2.2" stretchy="false" xref="A4.p5.1.m1.22.22.22.3.3.3.5.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A4.p5.1.m1.23.23.23.4.4.4" lspace="0em" xref="A4.p5.1.m1.24.24.1.1.1.cmml">.</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="A4.p5.1.m1.25b"><apply id="A4.p5.1.m1.24.24.1.1.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><and id="A4.p5.1.m1.24.24.1.1.1a.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"></and><apply id="A4.p5.1.m1.24.24.1.1.1b.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><eq id="A4.p5.1.m1.5.5.5.5.5.5.cmml" xref="A4.p5.1.m1.5.5.5.5.5.5"></eq><apply id="A4.p5.1.m1.24.24.1.1.1.3.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><times id="A4.p5.1.m1.24.24.1.1.1.3.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"></times><ci id="A4.p5.1.m1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.1.1.1.1.1.1">ℒ</ci><ci id="A4.p5.1.m1.3.3.3.3.3.3.cmml" xref="A4.p5.1.m1.3.3.3.3.3.3">𝑞</ci></apply><apply id="A4.p5.1.m1.24.24.1.1.1.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><apply id="A4.p5.1.m1.24.24.1.1.1.1.2.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="A4.p5.1.m1.24.24.1.1.1.1.2.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2">subscript</csymbol><int id="A4.p5.1.m1.6.6.6.6.6.6.cmml" xref="A4.p5.1.m1.6.6.6.6.6.6"></int><ci id="A4.p5.1.m1.7.7.7.7.7.7.1.cmml" xref="A4.p5.1.m1.7.7.7.7.7.7.1">𝑧</ci></apply><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><times id="A4.p5.1.m1.15.15.15.15.15.15.cmml" xref="A4.p5.1.m1.15.15.15.15.15.15"></times><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><times id="A4.p5.1.m1.24.24.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"></times><ci id="A4.p5.1.m1.8.8.8.8.8.8.cmml" xref="A4.p5.1.m1.8.8.8.8.8.8">𝛿</ci><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><minus id="A4.p5.1.m1.11.11.11.11.11.11.cmml" xref="A4.p5.1.m1.11.11.11.11.11.11"></minus><ci id="A4.p5.1.m1.10.10.10.10.10.10.cmml" xref="A4.p5.1.m1.10.10.10.10.10.10">𝑧</ci><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="A4.p5.1.m1.24.24.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2">superscript</csymbol><ci id="A4.p5.1.m1.12.12.12.12.12.12.cmml" xref="A4.p5.1.m1.12.12.12.12.12.12">𝑧</ci><times id="A4.p5.1.m1.13.13.13.13.13.13.1.cmml" xref="A4.p5.1.m1.13.13.13.13.13.13.1"></times></apply></apply></apply><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><log id="A4.p5.1.m1.16.16.16.1.1.1.cmml" xref="A4.p5.1.m1.16.16.16.1.1.1"></log><apply id="A4.p5.1.m1.24.24.1.1.1.1.1.3.2.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><times id="A4.p5.1.m1.24.24.1.1.1.1.1.3.2.1.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"></times><apply id="A4.p5.1.m1.17.17.17.2.2.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2"><divide id="A4.p5.1.m1.17.17.17.2.2.2.7.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2"></divide><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5"><times id="A4.p5.1.m1.17.17.17.2.2.2.5.6.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.6"></times><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.7.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.7.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7">subscript</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.7.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7.2">𝑃</ci><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.7.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.7.3">ℳ</ci></apply><apply id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1"><csymbol cd="latexml" id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.1">conditional</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.2">𝑌</ci><list id="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.4.4.1.1.3.2"><ci id="A4.p5.1.m1.17.17.17.2.2.2.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.1.1">𝑧</ci><ci id="A4.p5.1.m1.17.17.17.2.2.2.2.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.2.2">𝑋</ci></list></apply><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.8.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.8.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8">subscript</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.8.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8.2">𝑃</ci><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.8.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.8.3">ℳ</ci></apply><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1"><csymbol cd="latexml" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.2">conditional</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.3">𝑧</ci><list id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1"><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1">superscript</csymbol><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1">subscript</csymbol><set id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2"><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3"><eq id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.1"></eq><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.5.5.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.p5.1.m1.17.17.17.2.2.2.3.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.3.3">𝑋</ci></list></apply></apply><apply id="A4.p5.1.m1.17.17.17.2.2.2.6.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6"><times id="A4.p5.1.m1.17.17.17.2.2.2.6.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.2"></times><ci id="A4.p5.1.m1.17.17.17.2.2.2.6.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.3">𝛿</ci><apply id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1"><minus id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.1"></minus><ci id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.2">𝑧</ci><apply id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3"><csymbol cd="ambiguous" id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.1.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3">superscript</csymbol><ci id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.2.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.2">𝑧</ci><times id="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.3.cmml" xref="A4.p5.1.m1.17.17.17.2.2.2.6.1.1.1.3.3"></times></apply></apply></apply></apply><ci id="A4.p5.1.m1.18.18.18.3.3.3.cmml" xref="A4.p5.1.m1.18.18.18.3.3.3">𝑑</ci><ci id="A4.p5.1.m1.19.19.19.4.4.4.cmml" xref="A4.p5.1.m1.19.19.19.4.4.4">𝑧</ci></apply></apply></apply></apply></apply><apply id="A4.p5.1.m1.24.24.1.1.1c.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><eq id="A4.p5.1.m1.20.20.20.1.1.1.cmml" xref="A4.p5.1.m1.20.20.20.1.1.1"></eq><share href="https://arxiv.org/html/2505.19966v1#A4.p5.1.m1.24.24.1.1.1.1.cmml" id="A4.p5.1.m1.24.24.1.1.1d.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"></share><apply id="A4.p5.1.m1.24.24.1.1.1.6.cmml" xref="A4.p5.1.m1.2.2.2.2.2.2"><log id="A4.p5.1.m1.21.21.21.2.2.2.cmml" xref="A4.p5.1.m1.21.21.21.2.2.2"></log><apply id="A4.p5.1.m1.22.22.22.3.3.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3"><divide id="A4.p5.1.m1.22.22.22.3.3.3.6.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3"></divide><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4"><times id="A4.p5.1.m1.22.22.22.3.3.3.4.5.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.5"></times><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.6.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.6.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6">subscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.6.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6.2">𝑃</ci><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.6.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.6.3">ℳ</ci></apply><apply id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1"><csymbol cd="latexml" id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.2">conditional</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.3">𝑌</ci><list id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1"><apply id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1">superscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.2">𝑧</ci><times id="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.3.3.1.1.1.1.1.3"></times></apply><ci id="A4.p5.1.m1.22.22.22.3.3.3.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.1.1">𝑋</ci></list></apply><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.7.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.7.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7">subscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.7.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7.2">𝑃</ci><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.7.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.7.3">ℳ</ci></apply><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1"><csymbol cd="latexml" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.2">conditional</csymbol><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3">superscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.2">𝑧</ci><times id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.3.3"></times></apply><list id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1"><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1">superscript</csymbol><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1">subscript</csymbol><set id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1"><interval closure="open" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2"><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.2">𝑋</ci><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2"><csymbol cd="ambiguous" id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2">subscript</csymbol><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.2">𝑌</ci><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply></interval></set><apply id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3"><eq id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.1.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.1"></eq><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.2">𝑘</ci><cn id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.3.cmml" type="integer" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.1.3.3">1</cn></apply></apply><ci id="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.4.4.1.1.1.1.1.3">𝐾</ci></apply><ci id="A4.p5.1.m1.22.22.22.3.3.3.2.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.2.2">𝑋</ci></list></apply></apply><apply id="A4.p5.1.m1.22.22.22.3.3.3.5.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.5"><times id="A4.p5.1.m1.22.22.22.3.3.3.5.2.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.5.2"></times><ci id="A4.p5.1.m1.22.22.22.3.3.3.5.3.cmml" xref="A4.p5.1.m1.22.22.22.3.3.3.5.3">𝛿</ci><cn id="A4.p5.1.m1.22.22.22.3.3.3.5.1.cmml" type="integer" xref="A4.p5.1.m1.22.22.22.3.3.3.5.1">0</cn></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p5.1.m1.25c">\mathcal{L}(q)=\int_{z}\delta(z-z^{*})\times\\
\log\frac{P_{\mathcal{M}}(Y\mid z,X)\,P_{\mathcal{M}}(z\mid\{(X_{k},Y_{k})\}_{%
k=1}^{K},X)}{\delta(z-z^{*})}\,dz\\[2.84526pt]
=\log\frac{P_{\mathcal{M}}(Y\mid z^{*},X)\,P_{\mathcal{M}}(z^{*}\mid\{(X_{k},Y%
_{k})\}_{k=1}^{K},X)}{\delta(0)}.</annotation><annotation encoding="application/x-llamapun" id="A4.p5.1.m1.25d">start_ROW start_CELL caligraphic_L ( italic_q ) = ∫ start_POSTSUBSCRIPT italic_z end_POSTSUBSCRIPT italic_δ ( italic_z - italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ) × end_CELL end_ROW start_ROW start_CELL roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z , italic_X ) italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_ARG start_ARG italic_δ ( italic_z - italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ) end_ARG italic_d italic_z end_CELL end_ROW start_ROW start_CELL = roman_log divide start_ARG italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT , italic_X ) italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_ARG start_ARG italic_δ ( 0 ) end_ARG . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A4.p6">
<p class="ltx_p" id="A4.p6.2">Although <math alttext="\delta(0)" class="ltx_Math" display="inline" id="A4.p6.1.m1.1"><semantics id="A4.p6.1.m1.1a"><mrow id="A4.p6.1.m1.1.2" xref="A4.p6.1.m1.1.2.cmml"><mi id="A4.p6.1.m1.1.2.2" xref="A4.p6.1.m1.1.2.2.cmml">δ</mi><mo id="A4.p6.1.m1.1.2.1" xref="A4.p6.1.m1.1.2.1.cmml">⁢</mo><mrow id="A4.p6.1.m1.1.2.3.2" xref="A4.p6.1.m1.1.2.cmml"><mo id="A4.p6.1.m1.1.2.3.2.1" stretchy="false" xref="A4.p6.1.m1.1.2.cmml">(</mo><mn id="A4.p6.1.m1.1.1" xref="A4.p6.1.m1.1.1.cmml">0</mn><mo id="A4.p6.1.m1.1.2.3.2.2" stretchy="false" xref="A4.p6.1.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p6.1.m1.1b"><apply id="A4.p6.1.m1.1.2.cmml" xref="A4.p6.1.m1.1.2"><times id="A4.p6.1.m1.1.2.1.cmml" xref="A4.p6.1.m1.1.2.1"></times><ci id="A4.p6.1.m1.1.2.2.cmml" xref="A4.p6.1.m1.1.2.2">𝛿</ci><cn id="A4.p6.1.m1.1.1.cmml" type="integer" xref="A4.p6.1.m1.1.1">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p6.1.m1.1c">\delta(0)</annotation><annotation encoding="application/x-llamapun" id="A4.p6.1.m1.1d">italic_δ ( 0 )</annotation></semantics></math> is formally an infinite constant, it does not depend on <math alttext="z^{*}" class="ltx_Math" display="inline" id="A4.p6.2.m2.1"><semantics id="A4.p6.2.m2.1a"><msup id="A4.p6.2.m2.1.1" xref="A4.p6.2.m2.1.1.cmml"><mi id="A4.p6.2.m2.1.1.2" xref="A4.p6.2.m2.1.1.2.cmml">z</mi><mo id="A4.p6.2.m2.1.1.3" xref="A4.p6.2.m2.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="A4.p6.2.m2.1b"><apply id="A4.p6.2.m2.1.1.cmml" xref="A4.p6.2.m2.1.1"><csymbol cd="ambiguous" id="A4.p6.2.m2.1.1.1.cmml" xref="A4.p6.2.m2.1.1">superscript</csymbol><ci id="A4.p6.2.m2.1.1.2.cmml" xref="A4.p6.2.m2.1.1.2">𝑧</ci><times id="A4.p6.2.m2.1.1.3.cmml" xref="A4.p6.2.m2.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p6.2.m2.1c">z^{*}</annotation><annotation encoding="application/x-llamapun" id="A4.p6.2.m2.1d">italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> and can therefore be ignored during optimization. Maximizing the ELBO then amounts to optimizing</p>
<table class="ltx_equation ltx_eqn_table" id="A4.p6.3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z^{*},X)\\
-\log P_{\mathcal{M}}(z^{*}\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)" class="ltx_Math" display="block" id="A4.p6.3.m1.43"><semantics id="A4.p6.3.m1.43a"><mtable displaystyle="true" id="A4.p6.3.m1.43.43.4" rowspacing="0pt" xref="A4.p6.3.m1.41.41.2.cmml"><mtr id="A4.p6.3.m1.43.43.4a" xref="A4.p6.3.m1.41.41.2.cmml"><mtd class="ltx_align_left" columnalign="left" id="A4.p6.3.m1.43.43.4b" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.42.42.3.40.18.18" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.42.42.3.40.18.18.19" xref="A4.p6.3.m1.41.41.2.cmml"><mi class="ltx_font_mathcaligraphic" id="A4.p6.3.m1.1.1.1.1.1.1" xref="A4.p6.3.m1.1.1.1.1.1.1.cmml">ℒ</mi><mo id="A4.p6.3.m1.42.42.3.40.18.18.19.1" xref="A4.p6.3.m1.41.41.2.cmml">⁢</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.19.2" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.2.2.2.2.2.2" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">(</mo><mi id="A4.p6.3.m1.3.3.3.3.3.3" xref="A4.p6.3.m1.3.3.3.3.3.3.cmml">z</mi><mo id="A4.p6.3.m1.4.4.4.4.4.4" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">)</mo></mrow></mrow><mo id="A4.p6.3.m1.5.5.5.5.5.5" xref="A4.p6.3.m1.5.5.5.5.5.5.cmml">=</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.42.42.3.40.18.18.18a" rspace="0.167em" xref="A4.p6.3.m1.41.41.2.cmml">−</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18.1" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18.1.3" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.7.7.7.7.7.7" xref="A4.p6.3.m1.7.7.7.7.7.7.cmml">log</mi><mo id="A4.p6.3.m1.42.42.3.40.18.18.18.1.3a" lspace="0.167em" xref="A4.p6.3.m1.41.41.2.cmml">⁡</mo><msub id="A4.p6.3.m1.42.42.3.40.18.18.18.1.3.1" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.8.8.8.8.8.8" xref="A4.p6.3.m1.8.8.8.8.8.8.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p6.3.m1.9.9.9.9.9.9.1" xref="A4.p6.3.m1.9.9.9.9.9.9.1.cmml">ℳ</mi></msub></mrow><mo id="A4.p6.3.m1.42.42.3.40.18.18.18.1.2" xref="A4.p6.3.m1.41.41.2.cmml">⁢</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.10.10.10.10.10.10" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">(</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.11.11.11.11.11.11" xref="A4.p6.3.m1.11.11.11.11.11.11.cmml">Y</mi><mo id="A4.p6.3.m1.12.12.12.12.12.12" xref="A4.p6.3.m1.12.12.12.12.12.12.cmml">∣</mo><mrow id="A4.p6.3.m1.42.42.3.40.18.18.18.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><msup id="A4.p6.3.m1.42.42.3.40.18.18.18.1.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.13.13.13.13.13.13" xref="A4.p6.3.m1.13.13.13.13.13.13.cmml">z</mi><mo id="A4.p6.3.m1.14.14.14.14.14.14.1" xref="A4.p6.3.m1.14.14.14.14.14.14.1.cmml">∗</mo></msup><mo id="A4.p6.3.m1.15.15.15.15.15.15" xref="A4.p6.3.m1.41.41.2.cmml">,</mo><mi id="A4.p6.3.m1.16.16.16.16.16.16" xref="A4.p6.3.m1.16.16.16.16.16.16.cmml">X</mi></mrow></mrow><mo id="A4.p6.3.m1.17.17.17.17.17.17" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="A4.p6.3.m1.43.43.4c" xref="A4.p6.3.m1.41.41.2.cmml"><mtd class="ltx_align_right" columnalign="right" id="A4.p6.3.m1.43.43.4d" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.43.43.4.41.23.23" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.43.43.4.41.23.23a" rspace="0.167em" xref="A4.p6.3.m1.41.41.2.cmml">−</mo><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.3" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.19.19.19.2.2.2" xref="A4.p6.3.m1.19.19.19.2.2.2.cmml">log</mi><mo id="A4.p6.3.m1.43.43.4.41.23.23.23.3a" lspace="0.167em" xref="A4.p6.3.m1.41.41.2.cmml">⁡</mo><msub id="A4.p6.3.m1.43.43.4.41.23.23.23.3.1" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.20.20.20.3.3.3" xref="A4.p6.3.m1.20.20.20.3.3.3.cmml">P</mi><mi class="ltx_font_mathcaligraphic" id="A4.p6.3.m1.21.21.21.4.4.4.1" xref="A4.p6.3.m1.21.21.21.4.4.4.1.cmml">ℳ</mi></msub></mrow><mo id="A4.p6.3.m1.43.43.4.41.23.23.23.2" xref="A4.p6.3.m1.41.41.2.cmml">⁢</mo><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.22.22.22.5.5.5" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">(</mo><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><msup id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.2" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.23.23.23.6.6.6" xref="A4.p6.3.m1.23.23.23.6.6.6.cmml">z</mi><mo id="A4.p6.3.m1.24.24.24.7.7.7.1" xref="A4.p6.3.m1.24.24.24.7.7.7.1.cmml">∗</mo></msup><mo id="A4.p6.3.m1.25.25.25.8.8.8" xref="A4.p6.3.m1.25.25.25.8.8.8.cmml">∣</mo><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><msubsup id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.26.26.26.9.9.9" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">{</mo><mrow id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mo id="A4.p6.3.m1.27.27.27.10.10.10" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">(</mo><msub id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1.1.1.1.1.1.1.1" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.28.28.28.11.11.11" xref="A4.p6.3.m1.28.28.28.11.11.11.cmml">X</mi><mi id="A4.p6.3.m1.29.29.29.12.12.12.1" xref="A4.p6.3.m1.29.29.29.12.12.12.1.cmml">k</mi></msub><mo id="A4.p6.3.m1.30.30.30.13.13.13" xref="A4.p6.3.m1.41.41.2.cmml">,</mo><msub id="A4.p6.3.m1.43.43.4.41.23.23.23.1.1.1.1.1.1.1.1.1.1.2.2" xref="A4.p6.3.m1.41.41.2.cmml"><mi id="A4.p6.3.m1.31.31.31.14.14.14" xref="A4.p6.3.m1.31.31.31.14.14.14.cmml">Y</mi><mi id="A4.p6.3.m1.32.32.32.15.15.15.1" xref="A4.p6.3.m1.32.32.32.15.15.15.1.cmml">k</mi></msub><mo id="A4.p6.3.m1.33.33.33.16.16.16" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">)</mo></mrow><mo id="A4.p6.3.m1.34.34.34.17.17.17" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">}</mo></mrow><mrow id="A4.p6.3.m1.35.35.35.18.18.18.1" xref="A4.p6.3.m1.35.35.35.18.18.18.1.cmml"><mi id="A4.p6.3.m1.35.35.35.18.18.18.1.2" xref="A4.p6.3.m1.35.35.35.18.18.18.1.2.cmml">k</mi><mo id="A4.p6.3.m1.35.35.35.18.18.18.1.1" xref="A4.p6.3.m1.35.35.35.18.18.18.1.1.cmml">=</mo><mn id="A4.p6.3.m1.35.35.35.18.18.18.1.3" xref="A4.p6.3.m1.35.35.35.18.18.18.1.3.cmml">1</mn></mrow><mi id="A4.p6.3.m1.36.36.36.19.19.19.1" xref="A4.p6.3.m1.36.36.36.19.19.19.1.cmml">K</mi></msubsup><mo id="A4.p6.3.m1.37.37.37.20.20.20" xref="A4.p6.3.m1.41.41.2.cmml">,</mo><mi id="A4.p6.3.m1.38.38.38.21.21.21" xref="A4.p6.3.m1.38.38.38.21.21.21.cmml">X</mi></mrow></mrow><mo id="A4.p6.3.m1.39.39.39.22.22.22" stretchy="false" xref="A4.p6.3.m1.41.41.2.cmml">)</mo></mrow></mrow></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="A4.p6.3.m1.43b"><apply id="A4.p6.3.m1.41.41.2.cmml" xref="A4.p6.3.m1.43.43.4"><eq id="A4.p6.3.m1.5.5.5.5.5.5.cmml" xref="A4.p6.3.m1.5.5.5.5.5.5"></eq><apply id="A4.p6.3.m1.41.41.2.4.cmml" xref="A4.p6.3.m1.43.43.4"><times id="A4.p6.3.m1.41.41.2.4.1.cmml" xref="A4.p6.3.m1.43.43.4"></times><ci id="A4.p6.3.m1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.1.1.1.1.1.1">ℒ</ci><ci id="A4.p6.3.m1.3.3.3.3.3.3.cmml" xref="A4.p6.3.m1.3.3.3.3.3.3">𝑧</ci></apply><apply id="A4.p6.3.m1.41.41.2.2.cmml" xref="A4.p6.3.m1.43.43.4"><minus id="A4.p6.3.m1.18.18.18.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"></minus><apply id="A4.p6.3.m1.40.40.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><minus id="A4.p6.3.m1.6.6.6.6.6.6.cmml" xref="A4.p6.3.m1.43.43.4"></minus><apply id="A4.p6.3.m1.40.40.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><times id="A4.p6.3.m1.40.40.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4"></times><apply id="A4.p6.3.m1.40.40.1.1.1.1.3.cmml" xref="A4.p6.3.m1.43.43.4"><log id="A4.p6.3.m1.7.7.7.7.7.7.cmml" xref="A4.p6.3.m1.7.7.7.7.7.7"></log><apply id="A4.p6.3.m1.40.40.1.1.1.1.3.2.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.40.40.1.1.1.1.3.2.1.cmml" xref="A4.p6.3.m1.43.43.4">subscript</csymbol><ci id="A4.p6.3.m1.8.8.8.8.8.8.cmml" xref="A4.p6.3.m1.8.8.8.8.8.8">𝑃</ci><ci id="A4.p6.3.m1.9.9.9.9.9.9.1.cmml" xref="A4.p6.3.m1.9.9.9.9.9.9.1">ℳ</ci></apply></apply><apply id="A4.p6.3.m1.40.40.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="latexml" id="A4.p6.3.m1.12.12.12.12.12.12.cmml" xref="A4.p6.3.m1.12.12.12.12.12.12">conditional</csymbol><ci id="A4.p6.3.m1.11.11.11.11.11.11.cmml" xref="A4.p6.3.m1.11.11.11.11.11.11">𝑌</ci><list id="A4.p6.3.m1.40.40.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4"><apply id="A4.p6.3.m1.40.40.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.40.40.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4">superscript</csymbol><ci id="A4.p6.3.m1.13.13.13.13.13.13.cmml" xref="A4.p6.3.m1.13.13.13.13.13.13">𝑧</ci><times id="A4.p6.3.m1.14.14.14.14.14.14.1.cmml" xref="A4.p6.3.m1.14.14.14.14.14.14.1"></times></apply><ci id="A4.p6.3.m1.16.16.16.16.16.16.cmml" xref="A4.p6.3.m1.16.16.16.16.16.16">𝑋</ci></list></apply></apply></apply><apply id="A4.p6.3.m1.41.41.2.2.2.cmml" xref="A4.p6.3.m1.43.43.4"><times id="A4.p6.3.m1.41.41.2.2.2.2.cmml" xref="A4.p6.3.m1.43.43.4"></times><apply id="A4.p6.3.m1.41.41.2.2.2.3.cmml" xref="A4.p6.3.m1.43.43.4"><log id="A4.p6.3.m1.19.19.19.2.2.2.cmml" xref="A4.p6.3.m1.19.19.19.2.2.2"></log><apply id="A4.p6.3.m1.41.41.2.2.2.3.2.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.3.2.1.cmml" xref="A4.p6.3.m1.43.43.4">subscript</csymbol><ci id="A4.p6.3.m1.20.20.20.3.3.3.cmml" xref="A4.p6.3.m1.20.20.20.3.3.3">𝑃</ci><ci id="A4.p6.3.m1.21.21.21.4.4.4.1.cmml" xref="A4.p6.3.m1.21.21.21.4.4.4.1">ℳ</ci></apply></apply><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="latexml" id="A4.p6.3.m1.25.25.25.8.8.8.cmml" xref="A4.p6.3.m1.25.25.25.8.8.8">conditional</csymbol><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.3.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.3.1.cmml" xref="A4.p6.3.m1.43.43.4">superscript</csymbol><ci id="A4.p6.3.m1.23.23.23.6.6.6.cmml" xref="A4.p6.3.m1.23.23.23.6.6.6">𝑧</ci><times id="A4.p6.3.m1.24.24.24.7.7.7.1.cmml" xref="A4.p6.3.m1.24.24.24.7.7.7.1"></times></apply><list id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4"><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4">superscript</csymbol><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4">subscript</csymbol><set id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="A4.p6.3.m1.43.43.4"><interval closure="open" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="A4.p6.3.m1.43.43.4"><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A4.p6.3.m1.43.43.4">subscript</csymbol><ci id="A4.p6.3.m1.28.28.28.11.11.11.cmml" xref="A4.p6.3.m1.28.28.28.11.11.11">𝑋</ci><ci id="A4.p6.3.m1.29.29.29.12.12.12.1.cmml" xref="A4.p6.3.m1.29.29.29.12.12.12.1">𝑘</ci></apply><apply id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A4.p6.3.m1.43.43.4"><csymbol cd="ambiguous" id="A4.p6.3.m1.41.41.2.2.2.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="A4.p6.3.m1.43.43.4">subscript</csymbol><ci id="A4.p6.3.m1.31.31.31.14.14.14.cmml" xref="A4.p6.3.m1.31.31.31.14.14.14">𝑌</ci><ci id="A4.p6.3.m1.32.32.32.15.15.15.1.cmml" xref="A4.p6.3.m1.32.32.32.15.15.15.1">𝑘</ci></apply></interval></set><apply id="A4.p6.3.m1.35.35.35.18.18.18.1.cmml" xref="A4.p6.3.m1.35.35.35.18.18.18.1"><eq id="A4.p6.3.m1.35.35.35.18.18.18.1.1.cmml" xref="A4.p6.3.m1.35.35.35.18.18.18.1.1"></eq><ci id="A4.p6.3.m1.35.35.35.18.18.18.1.2.cmml" xref="A4.p6.3.m1.35.35.35.18.18.18.1.2">𝑘</ci><cn id="A4.p6.3.m1.35.35.35.18.18.18.1.3.cmml" type="integer" xref="A4.p6.3.m1.35.35.35.18.18.18.1.3">1</cn></apply></apply><ci id="A4.p6.3.m1.36.36.36.19.19.19.1.cmml" xref="A4.p6.3.m1.36.36.36.19.19.19.1">𝐾</ci></apply><ci id="A4.p6.3.m1.38.38.38.21.21.21.cmml" xref="A4.p6.3.m1.38.38.38.21.21.21">𝑋</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p6.3.m1.43c">\mathcal{L}(z)=-\log P_{\mathcal{M}}(Y\mid z^{*},X)\\
-\log P_{\mathcal{M}}(z^{*}\mid\{(X_{k},Y_{k})\}_{k=1}^{K},X)</annotation><annotation encoding="application/x-llamapun" id="A4.p6.3.m1.43d">start_ROW start_CELL caligraphic_L ( italic_z ) = - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_Y ∣ italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT , italic_X ) end_CELL end_ROW start_ROW start_CELL - roman_log italic_P start_POSTSUBSCRIPT caligraphic_M end_POSTSUBSCRIPT ( italic_z start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∣ { ( italic_X start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_Y start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) } start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT , italic_X ) end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_appendix" id="A5">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix E </span>Dataset Details</h2>
<figure class="ltx_table" id="A5.T7">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A5.T7.1">
<tr class="ltx_tr" id="A5.T7.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A5.T7.1.1.1"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.1.1">Dataset Name</span></td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_tt" id="A5.T7.1.1.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.1.2.1">
<span class="ltx_p" id="A5.T7.1.1.2.1.1" style="width:170.7pt;"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.2.1.1.1">Template</span></span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_tt" id="A5.T7.1.1.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.1.3.1">
<span class="ltx_p" id="A5.T7.1.1.3.1.1" style="width:48.4pt;"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.3.1.1.1">Answer</span></span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T7.1.1.4"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.4.1">Train</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T7.1.1.5"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.5.1">Test</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A5.T7.1.1.6"><span class="ltx_text ltx_font_bold" id="A5.T7.1.1.6.1">Metric</span></td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.2">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.2.1">AGNews</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.2.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.2.2.1">
<span class="ltx_p" id="A5.T7.1.2.2.1.1" style="width:170.7pt;">""{Sentence}" What is this text about? World, Sports, Business, or Technology?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.2.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.2.3.1">
<span class="ltx_p" id="A5.T7.1.2.3.1.1" style="width:48.4pt;">’World’, ’Sports’, ’Business’, ’Technology’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.2.4">120,000</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.2.5">7,600</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.2.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.3">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.3.1">BoolQ</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.3.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.3.2.1">
<span class="ltx_p" id="A5.T7.1.3.2.1.1" style="width:170.7pt;">"{Sentence1} Can we conclude that {Sentence2}?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.3.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.3.3.1">
<span class="ltx_p" id="A5.T7.1.3.3.1.1" style="width:48.4pt;">’No’, ’Yes’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.3.4">9,427</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.3.5">3,270</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.3.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.4.1">MultiRC</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.4.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.4.2.1">
<span class="ltx_p" id="A5.T7.1.4.2.1.1" style="width:170.7pt;">"{Sentence1} Question: "{Sentence2}" Response: "{Sentence3}" Does the response correctly answer the question?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.4.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.4.3.1">
<span class="ltx_p" id="A5.T7.1.4.3.1.1" style="width:48.4pt;">’No’, ’Yes’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.4.4">27,243</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.4.5">4,848</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.4.6">F1</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.5">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.5.1">RTE</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.5.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.5.2.1">
<span class="ltx_p" id="A5.T7.1.5.2.1.1" style="width:170.7pt;">"{Sentence1} Based on the paragraph above can we conclude that "{Sentence2}"? Yes or No?","Answer"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.5.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.5.3.1">
<span class="ltx_p" id="A5.T7.1.5.3.1.1" style="width:48.4pt;">’Yes’, ’No’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.5.4">2,490</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.5.5">277</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.5.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.6">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.6.1">SNLI</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.6.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.6.2.1">
<span class="ltx_p" id="A5.T7.1.6.2.1.1" style="width:170.7pt;">"If "{Sentence1}", does this mean that "{Sentence2}"? Yes, No, or Maybe?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.6.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.6.3.1">
<span class="ltx_p" id="A5.T7.1.6.3.1.1" style="width:48.4pt;">’Yes’, ’Maybe’, ’No’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.6.4">549,367</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.6.5">9,824</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.6.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.7">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.7.1">PAWS</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.7.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.7.2.1">
<span class="ltx_p" id="A5.T7.1.7.2.1.1" style="width:170.7pt;">"{Sentence1} {Sentence2} Do these sentences mean the same thing?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.7.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.7.3.1">
<span class="ltx_p" id="A5.T7.1.7.3.1.1" style="width:48.4pt;">’No’, ’Yes’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.7.4">49,401</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.7.5">8,000</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.7.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.8">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.8.1">QQP</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.8.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.8.2.1">
<span class="ltx_p" id="A5.T7.1.8.2.1.1" style="width:170.7pt;">""{Sentence1}" "{Sentence2}" Would you say that these questions are the same?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.8.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.8.3.1">
<span class="ltx_p" id="A5.T7.1.8.3.1.1" style="width:48.4pt;">’No’, ’Yes’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.8.4">363,846</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.8.5">40,430</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.8.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.9">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T7.1.9.1">Sentiment140</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.9.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.9.2.1">
<span class="ltx_p" id="A5.T7.1.9.2.1.1" style="width:170.7pt;">"{Sentence} What is the sentiment of this tweet?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T7.1.9.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.9.3.1">
<span class="ltx_p" id="A5.T7.1.9.3.1.1" style="width:48.4pt;">’Negative’, ’Positive’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.9.4">1,600,000</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T7.1.9.5">359</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T7.1.9.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T7.1.10">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r ltx_border_t" id="A5.T7.1.10.1">SST2</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb ltx_border_r ltx_border_t" id="A5.T7.1.10.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.10.2.1">
<span class="ltx_p" id="A5.T7.1.10.2.1.1" style="width:170.7pt;">"Review: "{Sentence}" Is this movie review sentence negative or positive?", "answer"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb ltx_border_r ltx_border_t" id="A5.T7.1.10.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T7.1.10.3.1">
<span class="ltx_p" id="A5.T7.1.10.3.1.1" style="width:48.4pt;">’Negative’, ’Positive’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T7.1.10.4">67,349</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T7.1.10.5">872</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="A5.T7.1.10.6">Accuracy</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>Classification Task Dataset Details.</figcaption>
</figure>
<figure class="ltx_table" id="A5.T8">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A5.T8.1">
<tr class="ltx_tr" id="A5.T8.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A5.T8.1.1.1"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.1.1">Dataset Name</span></td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_tt" id="A5.T8.1.1.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.1.2.1">
<span class="ltx_p" id="A5.T8.1.1.2.1.1" style="width:170.7pt;"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.2.1.1.1">Template</span></span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_tt" id="A5.T8.1.1.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.1.3.1">
<span class="ltx_p" id="A5.T8.1.1.3.1.1" style="width:48.4pt;"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.3.1.1.1">Answer</span></span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T8.1.1.4"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.4.1">Train</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T8.1.1.5"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.5.1">Test</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A5.T8.1.1.6"><span class="ltx_text ltx_font_bold" id="A5.T8.1.1.6.1">Metric</span></td>
</tr>
<tr class="ltx_tr" id="A5.T8.1.2">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T8.1.2.1">Winogrande</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.2.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.2.2.1">
<span class="ltx_p" id="A5.T8.1.2.2.1.1" style="width:170.7pt;">"How does the sentence end? {Sentence}", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.2.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.2.3.1">
<span class="ltx_p" id="A5.T8.1.2.3.1.1" style="width:48.4pt;">’A’, ’B’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.2.4">40,398</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.2.5">1,267</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T8.1.2.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T8.1.3">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T8.1.3.1">OpenBookQA</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.3.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.3.2.1">
<span class="ltx_p" id="A5.T8.1.3.2.1.1" style="width:170.7pt;">"{Sentence1} {Sentence2}", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.3.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.3.3.1">
<span class="ltx_p" id="A5.T8.1.3.3.1.1" style="width:48.4pt;">’A’, ’B’, ’C’, ’D’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.3.4">4,957</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.3.5">500</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T8.1.3.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T8.1.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T8.1.4.1">COPA</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.4.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.4.2.1">
<span class="ltx_p" id="A5.T8.1.4.2.1.1" style="width:170.7pt;">""{Sentence1}" What is the {Sentence2}?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T8.1.4.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.4.3.1">
<span class="ltx_p" id="A5.T8.1.4.3.1.1" style="width:48.4pt;">’A’, ’B’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.4.4">400</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T8.1.4.5">100</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T8.1.4.6">Accuracy</td>
</tr>
<tr class="ltx_tr" id="A5.T8.1.5">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r ltx_border_t" id="A5.T8.1.5.1">HellaSwag</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb ltx_border_r ltx_border_t" id="A5.T8.1.5.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.5.2.1">
<span class="ltx_p" id="A5.T8.1.5.2.1.1" style="width:170.7pt;">"What happens next in this paragraph? {Sentence}", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb ltx_border_r ltx_border_t" id="A5.T8.1.5.3">
<span class="ltx_inline-block ltx_align_top" id="A5.T8.1.5.3.1">
<span class="ltx_p" id="A5.T8.1.5.3.1.1" style="width:48.4pt;">’A’, ’B’, ’C’, ’D’</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T8.1.5.4">39,905</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T8.1.5.5">10,042</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="A5.T8.1.5.6">Accuracy</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 8: </span>Multi-choice Task Dataset Details.</figcaption>
</figure>
<figure class="ltx_table" id="A5.T9">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A5.T9.1">
<tr class="ltx_tr" id="A5.T9.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A5.T9.1.1.1"><span class="ltx_text ltx_font_bold" id="A5.T9.1.1.1.1">Dataset Name</span></td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_tt" id="A5.T9.1.1.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.1.2.1">
<span class="ltx_p" id="A5.T9.1.1.2.1.1" style="width:170.7pt;"><span class="ltx_text ltx_font_bold" id="A5.T9.1.1.2.1.1.1">Template</span></span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T9.1.1.3"><span class="ltx_text ltx_font_bold" id="A5.T9.1.1.3.1">Train</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="A5.T9.1.1.4"><span class="ltx_text ltx_font_bold" id="A5.T9.1.1.4.1">Test</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="A5.T9.1.1.5"><span class="ltx_text ltx_font_bold" id="A5.T9.1.1.5.1">Metric</span></td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.2">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T9.1.2.1">AESLC</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T9.1.2.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.2.2.1">
<span class="ltx_p" id="A5.T9.1.2.2.1.1" style="width:170.7pt;">"What is the subject line for this email? {Sentence}", "{Label}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.2.3">13,181</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.2.4">1,750</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T9.1.2.5">ROUGE-L</td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.3">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T9.1.3.1">Gigaword</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T9.1.3.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.3.2.1">
<span class="ltx_p" id="A5.T9.1.3.2.1.1" style="width:170.7pt;">"Write a short summary for this text: {Sentence}", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.3.3">2,044,465</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.3.4">730</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T9.1.3.5">ROUGE-L</td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.4">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T9.1.4.1">SQuAD v1</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T9.1.4.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.4.2.1">
<span class="ltx_p" id="A5.T9.1.4.2.1.1" style="width:170.7pt;">"Please answer a question about the following article about {Sentence}: {Sentence1} {Sentence2}", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.4.3">87,599</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.4.4">10,570</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T9.1.4.5">Exact Match</td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.5">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T9.1.5.1">CommonGen</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T9.1.5.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.5.2.1">
<span class="ltx_p" id="A5.T9.1.5.2.1.1" style="width:170.7pt;">"Concepts: {Sentence}. Write a sentence that includes all these words.", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.5.3">67,389</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.5.4">4,018</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T9.1.5.5">ROUGE-L</td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.6">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A5.T9.1.6.1">DART</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_r ltx_border_t" id="A5.T9.1.6.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.6.2.1">
<span class="ltx_p" id="A5.T9.1.6.2.1.1" style="width:170.7pt;">"Triple: {Sentence} What is a sentence that describes this triple?", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.6.3">62,659</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="A5.T9.1.6.4">2,768</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A5.T9.1.6.5">ROUGE-L</td>
</tr>
<tr class="ltx_tr" id="A5.T9.1.7">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r ltx_border_t" id="A5.T9.1.7.1">E2E NLG</td>
<td class="ltx_td ltx_align_justify ltx_align_top ltx_border_bb ltx_border_r ltx_border_t" id="A5.T9.1.7.2">
<span class="ltx_inline-block ltx_align_top" id="A5.T9.1.7.2.1">
<span class="ltx_p" id="A5.T9.1.7.2.1.1" style="width:170.7pt;">"Attributes: {Sentence}. Produce a detailed sentence about this restaurant.", "{Answer}"</span>
</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T9.1.7.3">33,525</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="A5.T9.1.7.4">1,847</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="A5.T9.1.7.5">ROUGE-L</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 9: </span>Generation Task Dataset Details.</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_appendix" id="A6">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix F </span>Case Study of Our <span class="ltx_text ltx_font_smallcaps" id="A6.1.1">GenICL</span> Method</h2>
<figure class="ltx_table" id="A6.T10">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A6.T10.1">
<tr class="ltx_tr" id="A6.T10.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="A6.T10.1.1.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.1.1.1">Task name</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_tt" id="A6.T10.1.1.2">AGNews</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.2">
<td class="ltx_td ltx_align_left" id="A6.T10.1.2.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.2.1.1">Test Input</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.2.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.2.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.2.2.1.1">"Dominant US captures gold with 79th straight win The US softball team completed its scorched-earth run through the Olympics on Monday with a 5-1 win over Australia, America’s third straight gold medal." What is this text about? World, Sports, Business, or Technology?</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.3">
<td class="ltx_td ltx_align_left" id="A6.T10.1.3.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.3.1.1">Demonstration</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.3.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.3.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.3.2.1.1">"US Women Shatter Olympic 800-Meter Freestyle Relay Record The United States has shattered a 17-year-old world record in the women’s Olympic 800-meter freestyle relay. " What is this text about? World, Sports, Business, or Technology? Sports</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.4">
<td class="ltx_td ltx_align_left" id="A6.T10.1.4.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.4.1.1">Test Answer</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.4.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.4.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.4.2.1.1">"Sports"</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.5">
<td class="ltx_td ltx_align_left ltx_border_t" id="A6.T10.1.5.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.5.1.1">Task name</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="A6.T10.1.5.2">Sentiment140</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.6">
<td class="ltx_td ltx_align_left" id="A6.T10.1.6.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.6.1.1">Test Input</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.6.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.6.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.6.2.1.1">zomg!!! I have a G2!!!!!!! What is the sentiment of this tweet?</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.7">
<td class="ltx_td ltx_align_left" id="A6.T10.1.7.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.7.1.1">Demonstration</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.7.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.7.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.7.2.1.1">My brother got his update for his G1 and I ain’t got shit What is the sentiment of this tweet? Negative</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.8">
<td class="ltx_td ltx_align_left" id="A6.T10.1.8.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.8.1.1">Test Answer</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.8.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.8.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.8.2.1.1">"Positive"</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.9">
<td class="ltx_td ltx_align_left ltx_border_t" id="A6.T10.1.9.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.9.1.1">Task name</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="A6.T10.1.9.2">RTE</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.10">
<td class="ltx_td ltx_align_left" id="A6.T10.1.10.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.10.1.1">Test Input</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.10.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.10.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.10.2.1.1">The west has preferred to focus on endangered animals, rather than endangered humans. African elephants are hunted down and stripped of tusks and hidden by poachers. Their numbers in Africa slumped from 1.2m to 600,000 in a decade until CITES - the Convention on International Trade in Endangered Species - banned the trade in ivory. Based on the paragraph above can we conclude that "African elephants are endangered by ivory poachers."? Yes or No?</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.11">
<td class="ltx_td ltx_align_left" id="A6.T10.1.11.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.11.1.1">Demonstration</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.11.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.11.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.11.2.1.1">Three leading Japanese banks have announced an alliance forming the world’s largest financial group. Fuji Bank, Dai-Ichi Kangyo and the Industrial Bank of Japan say their operations will be integrated by the spring of 2002. Based on the paragraph above can we conclude that "Merger of Japanese Banks creates the world’s biggest bank."? Yes or No? Yes</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.12">
<td class="ltx_td ltx_align_left" id="A6.T10.1.12.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.12.1.1">Test Answer</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.12.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.12.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.12.2.1.1">"Yes"</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.13">
<td class="ltx_td ltx_align_left ltx_border_t" id="A6.T10.1.13.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.13.1.1">Task name</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="A6.T10.1.13.2">SST2</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.14">
<td class="ltx_td ltx_align_left" id="A6.T10.1.14.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.14.1.1">Test Input</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.14.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.14.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.14.2.1.1">Review: "instead of a hyperbolic beat-charged urban western , it ’s an unpretentious , sociologically pointed slice of life . " Is this movie review sentence negative or positive?</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.15">
<td class="ltx_td ltx_align_left" id="A6.T10.1.15.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.15.1.1">Demonstration</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.15.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.15.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.15.2.1.1">Review: "offers an unexpected window into the complexities of the middle east struggle and into the humanity of its people . " Is this movie review sentence negative or positive? Positive</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.16">
<td class="ltx_td ltx_align_left" id="A6.T10.1.16.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.16.1.1">Test Answer</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.16.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.16.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.16.2.1.1">"Positive"</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.17">
<td class="ltx_td ltx_align_left ltx_border_t" id="A6.T10.1.17.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.17.1.1">Task name</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="A6.T10.1.17.2">CommonGen</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.18">
<td class="ltx_td ltx_align_left" id="A6.T10.1.18.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.18.1.1">Test Input</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.18.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.18.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.18.2.1.1">Concepts: kid, yard, ball. Write a sentence that includes all these words.</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.19">
<td class="ltx_td ltx_align_left" id="A6.T10.1.19.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.19.1.1">Demonstration</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left" id="A6.T10.1.19.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.19.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.19.2.1.1">Concepts: kid, grass, crawl. Write a sentence that includes all these words. A kid is about to crawl through some grass.</span>
</span>
</td>
</tr>
<tr class="ltx_tr" id="A6.T10.1.20">
<td class="ltx_td ltx_align_left ltx_border_bb" id="A6.T10.1.20.1"><span class="ltx_text ltx_font_bold" id="A6.T10.1.20.1.1">Test Answer</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb" id="A6.T10.1.20.2">
<span class="ltx_inline-block ltx_minipage ltx_align_top" id="A6.T10.1.20.2.1" style="width:325.2pt;">
<span class="ltx_p" id="A6.T10.1.20.2.1.1">"A kid is playing with a ball in his yard."</span>
</span>
</td>
</tr>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 10: </span>Case Study of Our <span class="ltx_text ltx_font_smallcaps" id="A6.T10.3.1">GenICL</span>.</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon May 26 13:21:45 2025 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
