<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models</title>
<!--Generated on Mon May 26 17:06:24 2025 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2505.20225v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S1" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S2" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S3" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Model Architecture</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S3.SS1" title="In 3 Model Architecture ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>MoE Layer</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S3.SS2" title="In 3 Model Architecture ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Training Loss</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Scaling Law Study for FLAME-MoE</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS1" title="In 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>IsoFLOP Profiles</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS2" title="In 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Parametric Loss Function Fitting</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS3" title="In 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>FLAME-MoE Model Family</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Pretraining FLAME-MoE</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS1" title="In 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Experimental Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS2" title="In 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Evaluation Results</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS3" title="In 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Training Throughput</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Empirical Analyses</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS1" title="In 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1 </span>Expert Specialization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS2" title="In 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2 </span>Expert Co-activation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS3" title="In 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3 </span>Router Saturation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S7" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A1" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Training Efficiency</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A2" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Expert Specialization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A3" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>Expert Co-activation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A4" title="In FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>Router Saturation</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hao Kang<sup class="ltx_sup" id="id7.7.id1"><span class="ltx_text ltx_font_italic" id="id7.7.id1.1">2</span></sup>  Zichun Yu<sup class="ltx_sup" id="id8.8.id2"><span class="ltx_text ltx_font_italic" id="id8.8.id2.1">1</span></sup><span class="ltx_note ltx_role_footnotemark" id="footnotex1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">1</span></span></span></span>  Chenyan Xiong<sup class="ltx_sup" id="id9.9.id3"><span class="ltx_text ltx_font_italic" id="id9.9.id3.1">1,3</span></sup>
<br class="ltx_break"/><sup class="ltx_sup" id="id10.10.id4"><span class="ltx_text ltx_font_italic" id="id10.10.id4.1">1</span></sup>Language Technologies Institute 
<br class="ltx_break"/><sup class="ltx_sup" id="id11.11.id5"><span class="ltx_text ltx_font_italic" id="id11.11.id5.1">2</span></sup>School of Computer Science 
<br class="ltx_break"/><sup class="ltx_sup" id="id12.12.id6"><span class="ltx_text ltx_font_italic" id="id12.12.id6.1">3</span></sup>Foundation and Language Model Center 
<br class="ltx_break"/>Carnegie Mellon University 
<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id13.13.id7">{haok, zichunyu, cx}@andrew.cmu.edu</span>
</span><span class="ltx_author_notes">Equal contribution. Author order determined alphabetically.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id14.id1">Recent large language models such as Gemini-1.5, DeepSeek-V3, and Llama-4 increasingly adopt Mixture-of-Experts (MoE) architectures, which offer strong efficiency-performance trade-offs by activating only a fraction of the model per token. Yet academic researchers still lack a fully open, end-to-end MoE platform for investigating scaling, routing, and expert behavior. We release FLAME-MoE, a completely open-source research suite composed of seven decoder-only models, ranging from 38M to 1.7B active parameters, whose architecture—64 experts with top-8 gating and 2 shared experts—closely reflects modern production LLMs. All training data pipelines, scripts, logs, and checkpoints are publicly available to enable reproducible experimentation. Across six evaluation tasks, FLAME-MoE improves average accuracy by up to 3.4 points over dense baselines trained with identical FLOPs. Leveraging full training trace transparency, we present initial analyses showing that (i) experts increasingly specialize on distinct token subsets, (ii) co-activation matrices remain sparse, reflecting diverse expert usage, and (iii) routing behavior stabilizes early in training. All code, training logs, and model checkpoints are available at <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/cmu-flame/FLAME-MoE" title="">https://github.com/cmu-flame/FLAME-MoE</a>.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Mixture-of-Experts (MoE) architectures have emerged as a powerful paradigm for scaling large language models efficiently. By activating only a sparse subset of expert modules per input token, MoE models significantly expand the number of trainable parameters without a commensurate increase in training or inference cost. This approach enables high effective capacity with strong computational efficiency, and has been adopted in a range of state-of-the-art systems—both open and closed-source—including Gemini-1.5, DeepSeek-V3, and Llama-4 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib34" title="">34</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib21" title="">21</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib23" title="">23</a>]</cite>. As these architectures gain traction, there is a growing need for transparent, reproducible frameworks to facilitate systematic study of MoE behavior, limitations, and scaling dynamics.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Recent open-source efforts such as OLMoE and OpenMoE have made notable progress toward building accessible and performant MoE models, releasing architectural variants, pretrained checkpoints, and analyses of routing and expert specialization <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib36" title="">36</a>]</cite>. These contributions represent valuable steps in expanding the empirical foundation for MoE research. However, they primarily emphasize architectural design and downstream performance, offering limited support for systematic, end-to-end investigation of MoE training dynamics, scaling behavior, and routing evolution. As a result, unlike the dense model community—which has benefited from comprehensive frameworks such as Pythia <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib3" title="">3</a>]</cite>—the MoE research landscape has yet to converge around a shared experimental platform that enables reproducible and extensible analysis across model scales.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">To address the gap in accessible and reproducible research on MoE language models, we introduce FLAME-MoE: a transparent, robust platform for controlled experimentation across model scales, sparsity levels, and architectures. It includes seven decoder-only MoE models (38M–1.7B active parameters), each with 64 experts per layer, top-8 gating, and two shared experts, following DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib20" title="">20</a>]</cite> and OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>. Using empirical scaling laws, we allocate compute-optimal training budgets to ensure fair, efficient pretraining. As summarized in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S1.T1" title="Table 1 ‣ 1 Introduction ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">1</span></a>, FLAME-MoE is the only MoE platform offering full openness—code, data, checkpoints, routing logs, and evaluation results—across a wide range of model sizes, supporting reproducibility, accessibility, and cross-scale analysis.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Empirical evaluations on 6 downstream tasks show that FLAME-MoE consistently outperforms dense counterparts trained under equal compute, with accuracy gains ranging from 1.8 to 3.4 points. More importantly, our training traces reveal nuanced dynamics of MoE models: expert specialization emerges early and intensifies over time; expert co-activation remains sparse and stable; and routing behaviors quickly converge during early pretraining. These findings underscore FLAME-MoE’s value as a tool for in-depth analysis of expert dynamics, sparsity effects, and routing evolution.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">FLAME-MoE is not merely a model release, but a comprehensive platform for advancing research on sparse language models. Our main contributions include: (1) a fully transparent infrastructure for end-to-end MoE experimentation, including models, training scripts, routing traces, and evaluation pipelines; (2) a suite of consistent, modular architectures spanning a wide range of active parameters to facilitate rigorous comparison across scales and with dense baselines; and (3) analytical capabilities that enable fine-grained investigation of routing behavior, expert specialization, load balancing, and parallelization strategies—questions that remain difficult to address without full access to the training process. By opening every stage of model development to the research community, we hope FLAME-MoE could establish a principled and extensible foundation for future work on Mixture-of-Experts.</p>
</div>
<figure class="ltx_table" id="S1.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S1.T1.2.1.1" style="font-size:90%;">Table 1</span>: </span><span class="ltx_text" id="S1.T1.3.2" style="font-size:90%;">Openness comparison between open-source MoE models.</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S1.T1.4" style="width:346.9pt;height:59.8pt;vertical-align:-0.7pt;"><span class="ltx_transformed_inner" style="transform:translate(-90.6pt,15.4pt) scale(0.656936391322448,0.656936391322448) ;">
<table class="ltx_tabular ltx_align_middle" id="S1.T1.4.1">
<tr class="ltx_tr" id="S1.T1.4.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S1.T1.4.1.1.1"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.1.1">Model</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S1.T1.4.1.1.2"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.2.1">Code</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S1.T1.4.1.1.3"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.3.1">Data</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S1.T1.4.1.1.4"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.4.1">All Ckpts</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S1.T1.4.1.1.5"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.5.1">Logs</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S1.T1.4.1.1.6"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.6.1">#Scales</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S1.T1.4.1.1.7"><span class="ltx_text ltx_font_bold" id="S1.T1.4.1.1.7.1">Active/Total Parameters</span></td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S1.T1.4.1.2.1">JetMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib30" title="">30</a>]</cite>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.2"><span class="ltx_text" id="S1.T1.4.1.2.2.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.3"><span class="ltx_text" id="S1.T1.4.1.2.3.1" style="color:#FF0000;">✗</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.4"><span class="ltx_text" id="S1.T1.4.1.2.4.1" style="color:#FF0000;">✗</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.5"><span class="ltx_text" id="S1.T1.4.1.2.5.1" style="color:#FF0000;">✗</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.4.1.2.6">1</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S1.T1.4.1.2.7">2B/8B</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.3">
<td class="ltx_td ltx_align_left" id="S1.T1.4.1.3.1">OpenMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib36" title="">36</a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.2"><span class="ltx_text" id="S1.T1.4.1.3.2.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.3"><span class="ltx_text" id="S1.T1.4.1.3.3.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.4"><span class="ltx_text" id="S1.T1.4.1.3.4.1" style="color:#FF0000;">✗</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.5"><span class="ltx_text" id="S1.T1.4.1.3.5.1" style="color:#FF0000;">✗</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.3.6">3</td>
<td class="ltx_td ltx_align_right" id="S1.T1.4.1.3.7">339M/650M-6.8B/34B</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.4">
<td class="ltx_td ltx_align_left" id="S1.T1.4.1.4.1">OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>
</td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.2"><span class="ltx_text" id="S1.T1.4.1.4.2.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.3"><span class="ltx_text" id="S1.T1.4.1.4.3.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.4"><span class="ltx_text" id="S1.T1.4.1.4.4.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.5"><span class="ltx_text" id="S1.T1.4.1.4.5.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center" id="S1.T1.4.1.4.6">1</td>
<td class="ltx_td ltx_align_right" id="S1.T1.4.1.4.7">1.3B/6.9B</td>
</tr>
<tr class="ltx_tr" id="S1.T1.4.1.5">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S1.T1.4.1.5.1">FLAME-MoE</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.2"><span class="ltx_text" id="S1.T1.4.1.5.2.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.3"><span class="ltx_text" id="S1.T1.4.1.5.3.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.4"><span class="ltx_text" id="S1.T1.4.1.5.4.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.5"><span class="ltx_text" id="S1.T1.4.1.5.5.1" style="color:#99CC80;">✓</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.4.1.5.6">7</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S1.T1.4.1.5.7">38M/100M-1.7B/10.3B</td>
</tr>
</table>
</span></div>
</figure>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">Mixture-of-Experts models aim to increase model capacity without a commensurate rise in computational cost by selectively activating a sparse subset of expert modules per input <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib29" title="">29</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib15" title="">15</a>]</cite>. Foundational works such as GShard <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib17" title="">17</a>]</cite> and Switch Transformer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib7" title="">7</a>]</cite> demonstrated the efficacy of sparse expert routing in enabling the training of large-scale models with substantially reduced floating point operations (FLOPs), while maintaining competitive performance. These models introduced top-<math alttext="k" class="ltx_Math" display="inline" id="S2.p1.1.m1.1"><semantics id="S2.p1.1.m1.1a"><mi id="S2.p1.1.m1.1.1" xref="S2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.p1.1.m1.1b"><ci id="S2.p1.1.m1.1.1.cmml" xref="S2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.p1.1.m1.1d">italic_k</annotation></semantics></math> routing mechanisms alongside auxiliary losses to ensure balanced expert utilization, thus establishing key design principles for scalable sparse training. Subsequent developments, including BASE Layers <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib18" title="">18</a>]</cite>, extended this paradigm by employing global routing via optimal transport to enhance load balancing and training stability. Later models such as DeepSeek-V3 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib21" title="">21</a>]</cite> and M6-T <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib37" title="">37</a>]</cite> scaled these approaches further, incorporating mechanisms such as shared experts and expert prototyping to improve convergence and efficiency, particularly in multilingual and long-context scenarios.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">Recent work has also examined the robustness and specialization of expert routing in MoE architectures <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib5" title="">5</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib36" title="">36</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>. For instance, <cite class="ltx_cite ltx_citemacro_citet">Chi et al. [<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib5" title="">5</a>]</cite> address the issue of representation collapse—where token embeddings become overly concentrated around expert centroids—by projecting tokens and expert keys onto a hypersphere prior to computing routing scores. This modification enhances assignment diversity and yields improved performance on multilingual benchmarks. Other studies have investigated the evolution of routing dynamics throughout training <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib36" title="">36</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>, noting that expert activation patterns frequently correlate with input position and frequency. Collectively, these findings underscore the importance of not only architectural efficiency but also the stability of sparse computation.</p>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">In parallel, large-scale dense model platforms have played a critical role in advancing empirical research by enhancing reproducibility and transparency. Pythia <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib3" title="">3</a>]</cite>, for example, comprises a suite of 16 decoder-only models trained on a common dataset, with full checkpoint availability and precise training reconstructions. This design enables fine-grained analyses of scaling laws, memorization behaviors, and training dynamics. Similarly, OPT <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib39" title="">39</a>]</cite> released dense models ranging from 125M to 175B parameters, along with training code, hyperparameters, and logs, setting a precedent for open large-scale experimentation. Pythia has served as the foundation for a range of downstream studies and systems, including instruction-tuned models such as Dolly 2.0 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib33" title="">33</a>]</cite>. Researchers have leveraged the Pythia suite to examine memorization <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib13" title="">13</a>, <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib2" title="">2</a>]</cite>, convergence patterns <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib22" title="">22</a>]</cite>, and internal circuit development <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib35" title="">35</a>]</cite>. Its consistent data ordering across model sizes enables rigorous scaling analyses, supporting investigations into privacy risks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib1" title="">1</a>]</cite>, interpretability <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib32" title="">32</a>]</cite>, and alignment techniques such as Direct Preference Optimization (DPO) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib26" title="">26</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S2.p4">
<p class="ltx_p" id="S2.p4.1">While early MoE systems were predominantly developed on proprietary infrastructure, recent open-source initiatives have significantly broadened accessibility. Notable efforts such as OpenMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib36" title="">36</a>]</cite> and OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite> have released models, training frameworks, and diagnostic tools, facilitating the study of expert specialization and routing behavior while narrowing the reproducibility gap. From a systems perspective, multiple frameworks have emerged to support efficient MoE training and deployment. DeepSpeed-MoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib27" title="">27</a>]</cite> and Tutel <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib14" title="">14</a>]</cite> offer optimized all-to-all communication, expert parallelism, and high-throughput inference, supporting models at the trillion-parameter scale. FastMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib9" title="">9</a>]</cite> provides a lightweight PyTorch extension with minimal integration overhead, while Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib31" title="">31</a>]</cite> integrates MoE support alongside tensor, expert, and pipeline parallelism. These systems collectively enable scalable, production-grade sparse modeling via optimized infrastructure.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Model Architecture</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">Our model architecture builds upon recent advancements in MoE models, particularly drawing inspirations from DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib20" title="">20</a>]</cite> and OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>.
Specifically, we adopt a decoder-only transformer architecture consisting of <math alttext="N_{L}" class="ltx_Math" display="inline" id="S3.p1.1.m1.1"><semantics id="S3.p1.1.m1.1a"><msub id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.2" xref="S3.p1.1.m1.1.1.2.cmml">N</mi><mi id="S3.p1.1.m1.1.1.3" xref="S3.p1.1.m1.1.1.3.cmml">L</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b"><apply id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.cmml" xref="S3.p1.1.m1.1.1">subscript</csymbol><ci id="S3.p1.1.m1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.2">𝑁</ci><ci id="S3.p1.1.m1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">N_{L}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_L end_POSTSUBSCRIPT</annotation></semantics></math> layers, where all feedforward network (FFN) sublayers except for the first one are replaced by an MoE layer.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>MoE Layer</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.4">Each MoE layer comprises <math alttext="N_{E}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><msub id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2" xref="S3.SS1.p1.1.m1.1.1.2.cmml">N</mi><mi id="S3.SS1.p1.1.m1.1.1.3" xref="S3.SS1.p1.1.m1.1.1.3.cmml">E</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2">𝑁</ci><ci id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3">𝐸</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">N_{E}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT</annotation></semantics></math> expert networks (FFNs) and a router mechanism. For an input token representation <math alttext="x" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><mi id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><ci id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_x</annotation></semantics></math>, we employ Top-<math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><mi id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><ci id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">italic_k</annotation></semantics></math> routing, where only the <math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><mi id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><ci id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">italic_k</annotation></semantics></math> experts with the highest routing scores are selected to process the token:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{MoE}(x)=\sum_{i\in\text{Top-}k(r(x))}\text{softmax}(r(x))_{i}E_{i}(x)" class="ltx_Math" display="block" id="S3.E1.m1.6"><semantics id="S3.E1.m1.6a"><mrow id="S3.E1.m1.6.6" xref="S3.E1.m1.6.6.cmml"><mrow id="S3.E1.m1.6.6.3" xref="S3.E1.m1.6.6.3.cmml"><mtext id="S3.E1.m1.6.6.3.2" xref="S3.E1.m1.6.6.3.2a.cmml">MoE</mtext><mo id="S3.E1.m1.6.6.3.1" xref="S3.E1.m1.6.6.3.1.cmml">⁢</mo><mrow id="S3.E1.m1.6.6.3.3.2" xref="S3.E1.m1.6.6.3.cmml"><mo id="S3.E1.m1.6.6.3.3.2.1" stretchy="false" xref="S3.E1.m1.6.6.3.cmml">(</mo><mi id="S3.E1.m1.3.3" xref="S3.E1.m1.3.3.cmml">x</mi><mo id="S3.E1.m1.6.6.3.3.2.2" stretchy="false" xref="S3.E1.m1.6.6.3.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.6.6.2" rspace="0.111em" xref="S3.E1.m1.6.6.2.cmml">=</mo><mrow id="S3.E1.m1.6.6.1" xref="S3.E1.m1.6.6.1.cmml"><munder id="S3.E1.m1.6.6.1.2" xref="S3.E1.m1.6.6.1.2.cmml"><mo id="S3.E1.m1.6.6.1.2.2" movablelimits="false" xref="S3.E1.m1.6.6.1.2.2.cmml">∑</mo><mrow id="S3.E1.m1.2.2.2" xref="S3.E1.m1.2.2.2.cmml"><mi id="S3.E1.m1.2.2.2.4" xref="S3.E1.m1.2.2.2.4.cmml">i</mi><mo id="S3.E1.m1.2.2.2.3" xref="S3.E1.m1.2.2.2.3.cmml">∈</mo><mrow id="S3.E1.m1.2.2.2.2" xref="S3.E1.m1.2.2.2.2.cmml"><mtext id="S3.E1.m1.2.2.2.2.3" xref="S3.E1.m1.2.2.2.2.3a.cmml">Top-</mtext><mo id="S3.E1.m1.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.cmml">⁢</mo><mi id="S3.E1.m1.2.2.2.2.4" xref="S3.E1.m1.2.2.2.2.4.cmml">k</mi><mo id="S3.E1.m1.2.2.2.2.2a" xref="S3.E1.m1.2.2.2.2.2.cmml">⁢</mo><mrow id="S3.E1.m1.2.2.2.2.1.1" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml"><mo id="S3.E1.m1.2.2.2.2.1.1.2" stretchy="false" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.2.2.2.2.1.1.1" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml"><mi id="S3.E1.m1.2.2.2.2.1.1.1.2" xref="S3.E1.m1.2.2.2.2.1.1.1.2.cmml">r</mi><mo id="S3.E1.m1.2.2.2.2.1.1.1.1" xref="S3.E1.m1.2.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.2.2.2.2.1.1.1.3.2" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml"><mo id="S3.E1.m1.2.2.2.2.1.1.1.3.2.1" stretchy="false" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml">(</mo><mi id="S3.E1.m1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.cmml">x</mi><mo id="S3.E1.m1.2.2.2.2.1.1.1.3.2.2" stretchy="false" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.2.2.2.2.1.1.3" stretchy="false" xref="S3.E1.m1.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow></munder><mrow id="S3.E1.m1.6.6.1.1" xref="S3.E1.m1.6.6.1.1.cmml"><mtext id="S3.E1.m1.6.6.1.1.3" xref="S3.E1.m1.6.6.1.1.3a.cmml">softmax</mtext><mo id="S3.E1.m1.6.6.1.1.2" xref="S3.E1.m1.6.6.1.1.2.cmml">⁢</mo><msub id="S3.E1.m1.6.6.1.1.1" xref="S3.E1.m1.6.6.1.1.1.cmml"><mrow id="S3.E1.m1.6.6.1.1.1.1.1" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.6.6.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.6.6.1.1.1.1.1.1" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.6.6.1.1.1.1.1.1.2" xref="S3.E1.m1.6.6.1.1.1.1.1.1.2.cmml">r</mi><mo id="S3.E1.m1.6.6.1.1.1.1.1.1.1" xref="S3.E1.m1.6.6.1.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.6.6.1.1.1.1.1.1.3.2" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.6.6.1.1.1.1.1.1.3.2.1" stretchy="false" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml">(</mo><mi id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml">x</mi><mo id="S3.E1.m1.6.6.1.1.1.1.1.1.3.2.2" stretchy="false" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.6.6.1.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.6.6.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.E1.m1.6.6.1.1.1.3" xref="S3.E1.m1.6.6.1.1.1.3.cmml">i</mi></msub><mo id="S3.E1.m1.6.6.1.1.2a" xref="S3.E1.m1.6.6.1.1.2.cmml">⁢</mo><msub id="S3.E1.m1.6.6.1.1.4" xref="S3.E1.m1.6.6.1.1.4.cmml"><mi id="S3.E1.m1.6.6.1.1.4.2" xref="S3.E1.m1.6.6.1.1.4.2.cmml">E</mi><mi id="S3.E1.m1.6.6.1.1.4.3" xref="S3.E1.m1.6.6.1.1.4.3.cmml">i</mi></msub><mo id="S3.E1.m1.6.6.1.1.2b" xref="S3.E1.m1.6.6.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.6.6.1.1.5.2" xref="S3.E1.m1.6.6.1.1.cmml"><mo id="S3.E1.m1.6.6.1.1.5.2.1" stretchy="false" xref="S3.E1.m1.6.6.1.1.cmml">(</mo><mi id="S3.E1.m1.5.5" xref="S3.E1.m1.5.5.cmml">x</mi><mo id="S3.E1.m1.6.6.1.1.5.2.2" stretchy="false" xref="S3.E1.m1.6.6.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.6b"><apply id="S3.E1.m1.6.6.cmml" xref="S3.E1.m1.6.6"><eq id="S3.E1.m1.6.6.2.cmml" xref="S3.E1.m1.6.6.2"></eq><apply id="S3.E1.m1.6.6.3.cmml" xref="S3.E1.m1.6.6.3"><times id="S3.E1.m1.6.6.3.1.cmml" xref="S3.E1.m1.6.6.3.1"></times><ci id="S3.E1.m1.6.6.3.2a.cmml" xref="S3.E1.m1.6.6.3.2"><mtext id="S3.E1.m1.6.6.3.2.cmml" xref="S3.E1.m1.6.6.3.2">MoE</mtext></ci><ci id="S3.E1.m1.3.3.cmml" xref="S3.E1.m1.3.3">𝑥</ci></apply><apply id="S3.E1.m1.6.6.1.cmml" xref="S3.E1.m1.6.6.1"><apply id="S3.E1.m1.6.6.1.2.cmml" xref="S3.E1.m1.6.6.1.2"><csymbol cd="ambiguous" id="S3.E1.m1.6.6.1.2.1.cmml" xref="S3.E1.m1.6.6.1.2">subscript</csymbol><sum id="S3.E1.m1.6.6.1.2.2.cmml" xref="S3.E1.m1.6.6.1.2.2"></sum><apply id="S3.E1.m1.2.2.2.cmml" xref="S3.E1.m1.2.2.2"><in id="S3.E1.m1.2.2.2.3.cmml" xref="S3.E1.m1.2.2.2.3"></in><ci id="S3.E1.m1.2.2.2.4.cmml" xref="S3.E1.m1.2.2.2.4">𝑖</ci><apply id="S3.E1.m1.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2"><times id="S3.E1.m1.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2"></times><ci id="S3.E1.m1.2.2.2.2.3a.cmml" xref="S3.E1.m1.2.2.2.2.3"><mtext id="S3.E1.m1.2.2.2.2.3.cmml" mathsize="70%" xref="S3.E1.m1.2.2.2.2.3">Top-</mtext></ci><ci id="S3.E1.m1.2.2.2.2.4.cmml" xref="S3.E1.m1.2.2.2.2.4">𝑘</ci><apply id="S3.E1.m1.2.2.2.2.1.1.1.cmml" xref="S3.E1.m1.2.2.2.2.1.1"><times id="S3.E1.m1.2.2.2.2.1.1.1.1.cmml" xref="S3.E1.m1.2.2.2.2.1.1.1.1"></times><ci id="S3.E1.m1.2.2.2.2.1.1.1.2.cmml" xref="S3.E1.m1.2.2.2.2.1.1.1.2">𝑟</ci><ci id="S3.E1.m1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1">𝑥</ci></apply></apply></apply></apply><apply id="S3.E1.m1.6.6.1.1.cmml" xref="S3.E1.m1.6.6.1.1"><times id="S3.E1.m1.6.6.1.1.2.cmml" xref="S3.E1.m1.6.6.1.1.2"></times><ci id="S3.E1.m1.6.6.1.1.3a.cmml" xref="S3.E1.m1.6.6.1.1.3"><mtext id="S3.E1.m1.6.6.1.1.3.cmml" xref="S3.E1.m1.6.6.1.1.3">softmax</mtext></ci><apply id="S3.E1.m1.6.6.1.1.1.cmml" xref="S3.E1.m1.6.6.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.6.6.1.1.1.2.cmml" xref="S3.E1.m1.6.6.1.1.1">subscript</csymbol><apply id="S3.E1.m1.6.6.1.1.1.1.1.1.cmml" xref="S3.E1.m1.6.6.1.1.1.1.1"><times id="S3.E1.m1.6.6.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.6.6.1.1.1.1.1.1.1"></times><ci id="S3.E1.m1.6.6.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.6.6.1.1.1.1.1.1.2">𝑟</ci><ci id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4">𝑥</ci></apply><ci id="S3.E1.m1.6.6.1.1.1.3.cmml" xref="S3.E1.m1.6.6.1.1.1.3">𝑖</ci></apply><apply id="S3.E1.m1.6.6.1.1.4.cmml" xref="S3.E1.m1.6.6.1.1.4"><csymbol cd="ambiguous" id="S3.E1.m1.6.6.1.1.4.1.cmml" xref="S3.E1.m1.6.6.1.1.4">subscript</csymbol><ci id="S3.E1.m1.6.6.1.1.4.2.cmml" xref="S3.E1.m1.6.6.1.1.4.2">𝐸</ci><ci id="S3.E1.m1.6.6.1.1.4.3.cmml" xref="S3.E1.m1.6.6.1.1.4.3">𝑖</ci></apply><ci id="S3.E1.m1.5.5.cmml" xref="S3.E1.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.6c">\text{MoE}(x)=\sum_{i\in\text{Top-}k(r(x))}\text{softmax}(r(x))_{i}E_{i}(x)</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.6d">MoE ( italic_x ) = ∑ start_POSTSUBSCRIPT italic_i ∈ Top- italic_k ( italic_r ( italic_x ) ) end_POSTSUBSCRIPT softmax ( italic_r ( italic_x ) ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p1.15">where <math alttext="E_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m1.1"><semantics id="S3.SS1.p1.5.m1.1a"><msub id="S3.SS1.p1.5.m1.1.1" xref="S3.SS1.p1.5.m1.1.1.cmml"><mi id="S3.SS1.p1.5.m1.1.1.2" xref="S3.SS1.p1.5.m1.1.1.2.cmml">E</mi><mi id="S3.SS1.p1.5.m1.1.1.3" xref="S3.SS1.p1.5.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m1.1b"><apply id="S3.SS1.p1.5.m1.1.1.cmml" xref="S3.SS1.p1.5.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m1.1.1.1.cmml" xref="S3.SS1.p1.5.m1.1.1">subscript</csymbol><ci id="S3.SS1.p1.5.m1.1.1.2.cmml" xref="S3.SS1.p1.5.m1.1.1.2">𝐸</ci><ci id="S3.SS1.p1.5.m1.1.1.3.cmml" xref="S3.SS1.p1.5.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m1.1c">E_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m1.1d">italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> denotes the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m2.1"><semantics id="S3.SS1.p1.6.m2.1a"><mi id="S3.SS1.p1.6.m2.1.1" xref="S3.SS1.p1.6.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m2.1b"><ci id="S3.SS1.p1.6.m2.1.1.cmml" xref="S3.SS1.p1.6.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m2.1d">italic_i</annotation></semantics></math>-th expert network and <math alttext="r" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m3.1"><semantics id="S3.SS1.p1.7.m3.1a"><mi id="S3.SS1.p1.7.m3.1.1" xref="S3.SS1.p1.7.m3.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m3.1b"><ci id="S3.SS1.p1.7.m3.1.1.cmml" xref="S3.SS1.p1.7.m3.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m3.1c">r</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m3.1d">italic_r</annotation></semantics></math> is a router network that
computes router scores <math alttext="r(x)" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m4.1"><semantics id="S3.SS1.p1.8.m4.1a"><mrow id="S3.SS1.p1.8.m4.1.2" xref="S3.SS1.p1.8.m4.1.2.cmml"><mi id="S3.SS1.p1.8.m4.1.2.2" xref="S3.SS1.p1.8.m4.1.2.2.cmml">r</mi><mo id="S3.SS1.p1.8.m4.1.2.1" xref="S3.SS1.p1.8.m4.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p1.8.m4.1.2.3.2" xref="S3.SS1.p1.8.m4.1.2.cmml"><mo id="S3.SS1.p1.8.m4.1.2.3.2.1" stretchy="false" xref="S3.SS1.p1.8.m4.1.2.cmml">(</mo><mi id="S3.SS1.p1.8.m4.1.1" xref="S3.SS1.p1.8.m4.1.1.cmml">x</mi><mo id="S3.SS1.p1.8.m4.1.2.3.2.2" stretchy="false" xref="S3.SS1.p1.8.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m4.1b"><apply id="S3.SS1.p1.8.m4.1.2.cmml" xref="S3.SS1.p1.8.m4.1.2"><times id="S3.SS1.p1.8.m4.1.2.1.cmml" xref="S3.SS1.p1.8.m4.1.2.1"></times><ci id="S3.SS1.p1.8.m4.1.2.2.cmml" xref="S3.SS1.p1.8.m4.1.2.2">𝑟</ci><ci id="S3.SS1.p1.8.m4.1.1.cmml" xref="S3.SS1.p1.8.m4.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m4.1c">r(x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m4.1d">italic_r ( italic_x )</annotation></semantics></math> for each of the <math alttext="N_{E}" class="ltx_Math" display="inline" id="S3.SS1.p1.9.m5.1"><semantics id="S3.SS1.p1.9.m5.1a"><msub id="S3.SS1.p1.9.m5.1.1" xref="S3.SS1.p1.9.m5.1.1.cmml"><mi id="S3.SS1.p1.9.m5.1.1.2" xref="S3.SS1.p1.9.m5.1.1.2.cmml">N</mi><mi id="S3.SS1.p1.9.m5.1.1.3" xref="S3.SS1.p1.9.m5.1.1.3.cmml">E</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.9.m5.1b"><apply id="S3.SS1.p1.9.m5.1.1.cmml" xref="S3.SS1.p1.9.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.9.m5.1.1.1.cmml" xref="S3.SS1.p1.9.m5.1.1">subscript</csymbol><ci id="S3.SS1.p1.9.m5.1.1.2.cmml" xref="S3.SS1.p1.9.m5.1.1.2">𝑁</ci><ci id="S3.SS1.p1.9.m5.1.1.3.cmml" xref="S3.SS1.p1.9.m5.1.1.3">𝐸</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.9.m5.1c">N_{E}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.9.m5.1d">italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT</annotation></semantics></math> experts based on the input token representation <math alttext="x" class="ltx_Math" display="inline" id="S3.SS1.p1.10.m6.1"><semantics id="S3.SS1.p1.10.m6.1a"><mi id="S3.SS1.p1.10.m6.1.1" xref="S3.SS1.p1.10.m6.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.10.m6.1b"><ci id="S3.SS1.p1.10.m6.1.1.cmml" xref="S3.SS1.p1.10.m6.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.10.m6.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.10.m6.1d">italic_x</annotation></semantics></math>.
The <math alttext="\text{Top-}k" class="ltx_Math" display="inline" id="S3.SS1.p1.11.m7.1"><semantics id="S3.SS1.p1.11.m7.1a"><mrow id="S3.SS1.p1.11.m7.1.1" xref="S3.SS1.p1.11.m7.1.1.cmml"><mtext id="S3.SS1.p1.11.m7.1.1.2" xref="S3.SS1.p1.11.m7.1.1.2a.cmml">Top-</mtext><mo id="S3.SS1.p1.11.m7.1.1.1" xref="S3.SS1.p1.11.m7.1.1.1.cmml">⁢</mo><mi id="S3.SS1.p1.11.m7.1.1.3" xref="S3.SS1.p1.11.m7.1.1.3.cmml">k</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.11.m7.1b"><apply id="S3.SS1.p1.11.m7.1.1.cmml" xref="S3.SS1.p1.11.m7.1.1"><times id="S3.SS1.p1.11.m7.1.1.1.cmml" xref="S3.SS1.p1.11.m7.1.1.1"></times><ci id="S3.SS1.p1.11.m7.1.1.2a.cmml" xref="S3.SS1.p1.11.m7.1.1.2"><mtext id="S3.SS1.p1.11.m7.1.1.2.cmml" xref="S3.SS1.p1.11.m7.1.1.2">Top-</mtext></ci><ci id="S3.SS1.p1.11.m7.1.1.3.cmml" xref="S3.SS1.p1.11.m7.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.11.m7.1c">\text{Top-}k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.11.m7.1d">Top- italic_k</annotation></semantics></math> function selects the indices of the <math alttext="k" class="ltx_Math" display="inline" id="S3.SS1.p1.12.m8.1"><semantics id="S3.SS1.p1.12.m8.1a"><mi id="S3.SS1.p1.12.m8.1.1" xref="S3.SS1.p1.12.m8.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.12.m8.1b"><ci id="S3.SS1.p1.12.m8.1.1.cmml" xref="S3.SS1.p1.12.m8.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.12.m8.1c">k</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.12.m8.1d">italic_k</annotation></semantics></math> experts yielding the highest scores.
These scores are normalized via a softmax function, resulting in gating weights <math alttext="\text{softmax}(r(x))_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.13.m9.2"><semantics id="S3.SS1.p1.13.m9.2a"><mrow id="S3.SS1.p1.13.m9.2.2" xref="S3.SS1.p1.13.m9.2.2.cmml"><mtext id="S3.SS1.p1.13.m9.2.2.3" xref="S3.SS1.p1.13.m9.2.2.3a.cmml">softmax</mtext><mo id="S3.SS1.p1.13.m9.2.2.2" xref="S3.SS1.p1.13.m9.2.2.2.cmml">⁢</mo><msub id="S3.SS1.p1.13.m9.2.2.1" xref="S3.SS1.p1.13.m9.2.2.1.cmml"><mrow id="S3.SS1.p1.13.m9.2.2.1.1.1" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml"><mo id="S3.SS1.p1.13.m9.2.2.1.1.1.2" stretchy="false" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.p1.13.m9.2.2.1.1.1.1" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml"><mi id="S3.SS1.p1.13.m9.2.2.1.1.1.1.2" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.2.cmml">r</mi><mo id="S3.SS1.p1.13.m9.2.2.1.1.1.1.1" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.SS1.p1.13.m9.2.2.1.1.1.1.3.2" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml"><mo id="S3.SS1.p1.13.m9.2.2.1.1.1.1.3.2.1" stretchy="false" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml">(</mo><mi id="S3.SS1.p1.13.m9.1.1" xref="S3.SS1.p1.13.m9.1.1.cmml">x</mi><mo id="S3.SS1.p1.13.m9.2.2.1.1.1.1.3.2.2" stretchy="false" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p1.13.m9.2.2.1.1.1.3" stretchy="false" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml">)</mo></mrow><mi id="S3.SS1.p1.13.m9.2.2.1.3" xref="S3.SS1.p1.13.m9.2.2.1.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.13.m9.2b"><apply id="S3.SS1.p1.13.m9.2.2.cmml" xref="S3.SS1.p1.13.m9.2.2"><times id="S3.SS1.p1.13.m9.2.2.2.cmml" xref="S3.SS1.p1.13.m9.2.2.2"></times><ci id="S3.SS1.p1.13.m9.2.2.3a.cmml" xref="S3.SS1.p1.13.m9.2.2.3"><mtext id="S3.SS1.p1.13.m9.2.2.3.cmml" xref="S3.SS1.p1.13.m9.2.2.3">softmax</mtext></ci><apply id="S3.SS1.p1.13.m9.2.2.1.cmml" xref="S3.SS1.p1.13.m9.2.2.1"><csymbol cd="ambiguous" id="S3.SS1.p1.13.m9.2.2.1.2.cmml" xref="S3.SS1.p1.13.m9.2.2.1">subscript</csymbol><apply id="S3.SS1.p1.13.m9.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.13.m9.2.2.1.1.1"><times id="S3.SS1.p1.13.m9.2.2.1.1.1.1.1.cmml" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.1"></times><ci id="S3.SS1.p1.13.m9.2.2.1.1.1.1.2.cmml" xref="S3.SS1.p1.13.m9.2.2.1.1.1.1.2">𝑟</ci><ci id="S3.SS1.p1.13.m9.1.1.cmml" xref="S3.SS1.p1.13.m9.1.1">𝑥</ci></apply><ci id="S3.SS1.p1.13.m9.2.2.1.3.cmml" xref="S3.SS1.p1.13.m9.2.2.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.13.m9.2c">\text{softmax}(r(x))_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.13.m9.2d">softmax ( italic_r ( italic_x ) ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
The final output of the MoE layer is a weighted sum: the output <math alttext="E_{i}(x)" class="ltx_Math" display="inline" id="S3.SS1.p1.14.m10.1"><semantics id="S3.SS1.p1.14.m10.1a"><mrow id="S3.SS1.p1.14.m10.1.2" xref="S3.SS1.p1.14.m10.1.2.cmml"><msub id="S3.SS1.p1.14.m10.1.2.2" xref="S3.SS1.p1.14.m10.1.2.2.cmml"><mi id="S3.SS1.p1.14.m10.1.2.2.2" xref="S3.SS1.p1.14.m10.1.2.2.2.cmml">E</mi><mi id="S3.SS1.p1.14.m10.1.2.2.3" xref="S3.SS1.p1.14.m10.1.2.2.3.cmml">i</mi></msub><mo id="S3.SS1.p1.14.m10.1.2.1" xref="S3.SS1.p1.14.m10.1.2.1.cmml">⁢</mo><mrow id="S3.SS1.p1.14.m10.1.2.3.2" xref="S3.SS1.p1.14.m10.1.2.cmml"><mo id="S3.SS1.p1.14.m10.1.2.3.2.1" stretchy="false" xref="S3.SS1.p1.14.m10.1.2.cmml">(</mo><mi id="S3.SS1.p1.14.m10.1.1" xref="S3.SS1.p1.14.m10.1.1.cmml">x</mi><mo id="S3.SS1.p1.14.m10.1.2.3.2.2" stretchy="false" xref="S3.SS1.p1.14.m10.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.14.m10.1b"><apply id="S3.SS1.p1.14.m10.1.2.cmml" xref="S3.SS1.p1.14.m10.1.2"><times id="S3.SS1.p1.14.m10.1.2.1.cmml" xref="S3.SS1.p1.14.m10.1.2.1"></times><apply id="S3.SS1.p1.14.m10.1.2.2.cmml" xref="S3.SS1.p1.14.m10.1.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.14.m10.1.2.2.1.cmml" xref="S3.SS1.p1.14.m10.1.2.2">subscript</csymbol><ci id="S3.SS1.p1.14.m10.1.2.2.2.cmml" xref="S3.SS1.p1.14.m10.1.2.2.2">𝐸</ci><ci id="S3.SS1.p1.14.m10.1.2.2.3.cmml" xref="S3.SS1.p1.14.m10.1.2.2.3">𝑖</ci></apply><ci id="S3.SS1.p1.14.m10.1.1.cmml" xref="S3.SS1.p1.14.m10.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.14.m10.1c">E_{i}(x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.14.m10.1d">italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_x )</annotation></semantics></math> of each selected expert <math alttext="i\in\text{Top-}k(r(x))" class="ltx_Math" display="inline" id="S3.SS1.p1.15.m11.2"><semantics id="S3.SS1.p1.15.m11.2a"><mrow id="S3.SS1.p1.15.m11.2.2" xref="S3.SS1.p1.15.m11.2.2.cmml"><mi id="S3.SS1.p1.15.m11.2.2.3" xref="S3.SS1.p1.15.m11.2.2.3.cmml">i</mi><mo id="S3.SS1.p1.15.m11.2.2.2" xref="S3.SS1.p1.15.m11.2.2.2.cmml">∈</mo><mrow id="S3.SS1.p1.15.m11.2.2.1" xref="S3.SS1.p1.15.m11.2.2.1.cmml"><mtext id="S3.SS1.p1.15.m11.2.2.1.3" xref="S3.SS1.p1.15.m11.2.2.1.3a.cmml">Top-</mtext><mo id="S3.SS1.p1.15.m11.2.2.1.2" xref="S3.SS1.p1.15.m11.2.2.1.2.cmml">⁢</mo><mi id="S3.SS1.p1.15.m11.2.2.1.4" xref="S3.SS1.p1.15.m11.2.2.1.4.cmml">k</mi><mo id="S3.SS1.p1.15.m11.2.2.1.2a" xref="S3.SS1.p1.15.m11.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS1.p1.15.m11.2.2.1.1.1" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml"><mo id="S3.SS1.p1.15.m11.2.2.1.1.1.2" stretchy="false" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS1.p1.15.m11.2.2.1.1.1.1" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml"><mi id="S3.SS1.p1.15.m11.2.2.1.1.1.1.2" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.2.cmml">r</mi><mo id="S3.SS1.p1.15.m11.2.2.1.1.1.1.1" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.SS1.p1.15.m11.2.2.1.1.1.1.3.2" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml"><mo id="S3.SS1.p1.15.m11.2.2.1.1.1.1.3.2.1" stretchy="false" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml">(</mo><mi id="S3.SS1.p1.15.m11.1.1" xref="S3.SS1.p1.15.m11.1.1.cmml">x</mi><mo id="S3.SS1.p1.15.m11.2.2.1.1.1.1.3.2.2" stretchy="false" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p1.15.m11.2.2.1.1.1.3" stretchy="false" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.15.m11.2b"><apply id="S3.SS1.p1.15.m11.2.2.cmml" xref="S3.SS1.p1.15.m11.2.2"><in id="S3.SS1.p1.15.m11.2.2.2.cmml" xref="S3.SS1.p1.15.m11.2.2.2"></in><ci id="S3.SS1.p1.15.m11.2.2.3.cmml" xref="S3.SS1.p1.15.m11.2.2.3">𝑖</ci><apply id="S3.SS1.p1.15.m11.2.2.1.cmml" xref="S3.SS1.p1.15.m11.2.2.1"><times id="S3.SS1.p1.15.m11.2.2.1.2.cmml" xref="S3.SS1.p1.15.m11.2.2.1.2"></times><ci id="S3.SS1.p1.15.m11.2.2.1.3a.cmml" xref="S3.SS1.p1.15.m11.2.2.1.3"><mtext id="S3.SS1.p1.15.m11.2.2.1.3.cmml" xref="S3.SS1.p1.15.m11.2.2.1.3">Top-</mtext></ci><ci id="S3.SS1.p1.15.m11.2.2.1.4.cmml" xref="S3.SS1.p1.15.m11.2.2.1.4">𝑘</ci><apply id="S3.SS1.p1.15.m11.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.15.m11.2.2.1.1.1"><times id="S3.SS1.p1.15.m11.2.2.1.1.1.1.1.cmml" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.1"></times><ci id="S3.SS1.p1.15.m11.2.2.1.1.1.1.2.cmml" xref="S3.SS1.p1.15.m11.2.2.1.1.1.1.2">𝑟</ci><ci id="S3.SS1.p1.15.m11.1.1.cmml" xref="S3.SS1.p1.15.m11.1.1">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.15.m11.2c">i\in\text{Top-}k(r(x))</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.15.m11.2d">italic_i ∈ Top- italic_k ( italic_r ( italic_x ) )</annotation></semantics></math> is multiplied by its corresponding gating weight, and these products are summed together.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.2">Following best practice and findings from OLMoE and DeepSeek-V2, we set the total number of experts <math alttext="N_{E}=64" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mrow id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml"><msub id="S3.SS1.p2.1.m1.1.1.2" xref="S3.SS1.p2.1.m1.1.1.2.cmml"><mi id="S3.SS1.p2.1.m1.1.1.2.2" xref="S3.SS1.p2.1.m1.1.1.2.2.cmml">N</mi><mi id="S3.SS1.p2.1.m1.1.1.2.3" xref="S3.SS1.p2.1.m1.1.1.2.3.cmml">E</mi></msub><mo id="S3.SS1.p2.1.m1.1.1.1" xref="S3.SS1.p2.1.m1.1.1.1.cmml">=</mo><mn id="S3.SS1.p2.1.m1.1.1.3" xref="S3.SS1.p2.1.m1.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><apply id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1"><eq id="S3.SS1.p2.1.m1.1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1.1"></eq><apply id="S3.SS1.p2.1.m1.1.1.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p2.1.m1.1.1.2.1.cmml" xref="S3.SS1.p2.1.m1.1.1.2">subscript</csymbol><ci id="S3.SS1.p2.1.m1.1.1.2.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2.2">𝑁</ci><ci id="S3.SS1.p2.1.m1.1.1.2.3.cmml" xref="S3.SS1.p2.1.m1.1.1.2.3">𝐸</ci></apply><cn id="S3.SS1.p2.1.m1.1.1.3.cmml" type="integer" xref="S3.SS1.p2.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">N_{E}=64</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT = 64</annotation></semantics></math> per MoE layer and activate <math alttext="k=8" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1"><semantics id="S3.SS1.p2.2.m2.1a"><mrow id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml"><mi id="S3.SS1.p2.2.m2.1.1.2" xref="S3.SS1.p2.2.m2.1.1.2.cmml">k</mi><mo id="S3.SS1.p2.2.m2.1.1.1" xref="S3.SS1.p2.2.m2.1.1.1.cmml">=</mo><mn id="S3.SS1.p2.2.m2.1.1.3" xref="S3.SS1.p2.2.m2.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b"><apply id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1"><eq id="S3.SS1.p2.2.m2.1.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1.1"></eq><ci id="S3.SS1.p2.2.m2.1.1.2.cmml" xref="S3.SS1.p2.2.m2.1.1.2">𝑘</ci><cn id="S3.SS1.p2.2.m2.1.1.3.cmml" type="integer" xref="S3.SS1.p2.2.m2.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">k=8</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m2.1d">italic_k = 8</annotation></semantics></math> experts per token. Adapting the strategy from DeepSeek-V2, 2 of these 8 active experts are designated as shared experts, meaning they are activated for every token, providing a baseline computation path. The remaining 6 experts are routed experts,
selected dynamically by the router based on the input token.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Training Loss</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.4">Training MoE models effectively often requires auxiliary loss functions to encourage a balanced load across experts and prevent routing collapse.
First, we adopt a load balancing loss from <cite class="ltx_cite ltx_citemacro_citet">Shazeer et al. [<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib29" title="">29</a>]</cite> to ensure that tokens are distributed as evenly as possible among the <math alttext="N_{E}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><msub id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">N</mi><mi id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml">E</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2">𝑁</ci><ci id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3">𝐸</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">N_{E}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT</annotation></semantics></math> experts, which improves both model utilization and parallelism.
For each routing operation, given <math alttext="N_{E}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msub id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">N</mi><mi id="S3.SS2.p1.2.m2.1.1.3" xref="S3.SS2.p1.2.m2.1.1.3.cmml">E</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">𝑁</ci><ci id="S3.SS2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3">𝐸</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">N_{E}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT</annotation></semantics></math> experts and a batch of <math alttext="T" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><mi id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><ci id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">italic_T</annotation></semantics></math> tokens,
the load balancing loss <math alttext="\mathcal{L}_{\text{LB}}" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><msub id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.p1.4.m4.1.1.2" xref="S3.SS2.p1.4.m4.1.1.2.cmml">ℒ</mi><mtext id="S3.SS2.p1.4.m4.1.1.3" xref="S3.SS2.p1.4.m4.1.1.3a.cmml">LB</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><apply id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2">ℒ</ci><ci id="S3.SS2.p1.4.m4.1.1.3a.cmml" xref="S3.SS2.p1.4.m4.1.1.3"><mtext id="S3.SS2.p1.4.m4.1.1.3.cmml" mathsize="70%" xref="S3.SS2.p1.4.m4.1.1.3">LB</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">\mathcal{L}_{\text{LB}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">caligraphic_L start_POSTSUBSCRIPT LB end_POSTSUBSCRIPT</annotation></semantics></math> is defined as:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx1">
<tbody id="S3.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathcal{L}_{\text{LB}}" class="ltx_Math" display="inline" id="S3.E2.m1.1"><semantics id="S3.E2.m1.1a"><msub id="S3.E2.m1.1.1" xref="S3.E2.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.1.1.2" xref="S3.E2.m1.1.1.2.cmml">ℒ</mi><mtext id="S3.E2.m1.1.1.3" xref="S3.E2.m1.1.1.3a.cmml">LB</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.E2.m1.1b"><apply id="S3.E2.m1.1.1.cmml" xref="S3.E2.m1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.cmml" xref="S3.E2.m1.1.1">subscript</csymbol><ci id="S3.E2.m1.1.1.2.cmml" xref="S3.E2.m1.1.1.2">ℒ</ci><ci id="S3.E2.m1.1.1.3a.cmml" xref="S3.E2.m1.1.1.3"><mtext id="S3.E2.m1.1.1.3.cmml" mathsize="70%" xref="S3.E2.m1.1.1.3">LB</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.1c">\displaystyle\mathcal{L}_{\text{LB}}</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.1d">caligraphic_L start_POSTSUBSCRIPT LB end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=N_{E}\cdot\sum_{i=1}^{N_{E}}m_{i}\cdot P_{i}," class="ltx_Math" display="inline" id="S3.E2.m2.1"><semantics id="S3.E2.m2.1a"><mrow id="S3.E2.m2.1.1.1" xref="S3.E2.m2.1.1.1.1.cmml"><mrow id="S3.E2.m2.1.1.1.1" xref="S3.E2.m2.1.1.1.1.cmml"><mi id="S3.E2.m2.1.1.1.1.2" xref="S3.E2.m2.1.1.1.1.2.cmml"></mi><mo id="S3.E2.m2.1.1.1.1.1" xref="S3.E2.m2.1.1.1.1.1.cmml">=</mo><mrow id="S3.E2.m2.1.1.1.1.3" xref="S3.E2.m2.1.1.1.1.3.cmml"><msub id="S3.E2.m2.1.1.1.1.3.2" xref="S3.E2.m2.1.1.1.1.3.2.cmml"><mi id="S3.E2.m2.1.1.1.1.3.2.2" xref="S3.E2.m2.1.1.1.1.3.2.2.cmml">N</mi><mi id="S3.E2.m2.1.1.1.1.3.2.3" xref="S3.E2.m2.1.1.1.1.3.2.3.cmml">E</mi></msub><mo id="S3.E2.m2.1.1.1.1.3.1" lspace="0.222em" rspace="0.222em" xref="S3.E2.m2.1.1.1.1.3.1.cmml">⋅</mo><mrow id="S3.E2.m2.1.1.1.1.3.3" xref="S3.E2.m2.1.1.1.1.3.3.cmml"><mstyle displaystyle="true" id="S3.E2.m2.1.1.1.1.3.3.1" xref="S3.E2.m2.1.1.1.1.3.3.1.cmml"><munderover id="S3.E2.m2.1.1.1.1.3.3.1a" xref="S3.E2.m2.1.1.1.1.3.3.1.cmml"><mo id="S3.E2.m2.1.1.1.1.3.3.1.2.2" movablelimits="false" xref="S3.E2.m2.1.1.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S3.E2.m2.1.1.1.1.3.3.1.2.3" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.cmml"><mi id="S3.E2.m2.1.1.1.1.3.3.1.2.3.2" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S3.E2.m2.1.1.1.1.3.3.1.2.3.1" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S3.E2.m2.1.1.1.1.3.3.1.2.3.3" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><msub id="S3.E2.m2.1.1.1.1.3.3.1.3" xref="S3.E2.m2.1.1.1.1.3.3.1.3.cmml"><mi id="S3.E2.m2.1.1.1.1.3.3.1.3.2" xref="S3.E2.m2.1.1.1.1.3.3.1.3.2.cmml">N</mi><mi id="S3.E2.m2.1.1.1.1.3.3.1.3.3" xref="S3.E2.m2.1.1.1.1.3.3.1.3.3.cmml">E</mi></msub></munderover></mstyle><mrow id="S3.E2.m2.1.1.1.1.3.3.2" xref="S3.E2.m2.1.1.1.1.3.3.2.cmml"><msub id="S3.E2.m2.1.1.1.1.3.3.2.2" xref="S3.E2.m2.1.1.1.1.3.3.2.2.cmml"><mi id="S3.E2.m2.1.1.1.1.3.3.2.2.2" xref="S3.E2.m2.1.1.1.1.3.3.2.2.2.cmml">m</mi><mi id="S3.E2.m2.1.1.1.1.3.3.2.2.3" xref="S3.E2.m2.1.1.1.1.3.3.2.2.3.cmml">i</mi></msub><mo id="S3.E2.m2.1.1.1.1.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S3.E2.m2.1.1.1.1.3.3.2.1.cmml">⋅</mo><msub id="S3.E2.m2.1.1.1.1.3.3.2.3" xref="S3.E2.m2.1.1.1.1.3.3.2.3.cmml"><mi id="S3.E2.m2.1.1.1.1.3.3.2.3.2" xref="S3.E2.m2.1.1.1.1.3.3.2.3.2.cmml">P</mi><mi id="S3.E2.m2.1.1.1.1.3.3.2.3.3" xref="S3.E2.m2.1.1.1.1.3.3.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><mo id="S3.E2.m2.1.1.1.2" xref="S3.E2.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m2.1b"><apply id="S3.E2.m2.1.1.1.1.cmml" xref="S3.E2.m2.1.1.1"><eq id="S3.E2.m2.1.1.1.1.1.cmml" xref="S3.E2.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S3.E2.m2.1.1.1.1.2.cmml" xref="S3.E2.m2.1.1.1.1.2">absent</csymbol><apply id="S3.E2.m2.1.1.1.1.3.cmml" xref="S3.E2.m2.1.1.1.1.3"><ci id="S3.E2.m2.1.1.1.1.3.1.cmml" xref="S3.E2.m2.1.1.1.1.3.1">⋅</ci><apply id="S3.E2.m2.1.1.1.1.3.2.cmml" xref="S3.E2.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.2.1.cmml" xref="S3.E2.m2.1.1.1.1.3.2">subscript</csymbol><ci id="S3.E2.m2.1.1.1.1.3.2.2.cmml" xref="S3.E2.m2.1.1.1.1.3.2.2">𝑁</ci><ci id="S3.E2.m2.1.1.1.1.3.2.3.cmml" xref="S3.E2.m2.1.1.1.1.3.2.3">𝐸</ci></apply><apply id="S3.E2.m2.1.1.1.1.3.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3"><apply id="S3.E2.m2.1.1.1.1.3.3.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.3.1.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1">superscript</csymbol><apply id="S3.E2.m2.1.1.1.1.3.3.1.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.3.1.2.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1">subscript</csymbol><sum id="S3.E2.m2.1.1.1.1.3.3.1.2.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.2.2"></sum><apply id="S3.E2.m2.1.1.1.1.3.3.1.2.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3"><eq id="S3.E2.m2.1.1.1.1.3.3.1.2.3.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.1"></eq><ci id="S3.E2.m2.1.1.1.1.3.3.1.2.3.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.2">𝑖</ci><cn id="S3.E2.m2.1.1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S3.E2.m2.1.1.1.1.3.3.1.2.3.3">1</cn></apply></apply><apply id="S3.E2.m2.1.1.1.1.3.3.1.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.3"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.3.1.3.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.3">subscript</csymbol><ci id="S3.E2.m2.1.1.1.1.3.3.1.3.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.3.2">𝑁</ci><ci id="S3.E2.m2.1.1.1.1.3.3.1.3.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.1.3.3">𝐸</ci></apply></apply><apply id="S3.E2.m2.1.1.1.1.3.3.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2"><ci id="S3.E2.m2.1.1.1.1.3.3.2.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.1">⋅</ci><apply id="S3.E2.m2.1.1.1.1.3.3.2.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.2"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.3.2.2.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.2">subscript</csymbol><ci id="S3.E2.m2.1.1.1.1.3.3.2.2.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.2.2">𝑚</ci><ci id="S3.E2.m2.1.1.1.1.3.3.2.2.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.2.3">𝑖</ci></apply><apply id="S3.E2.m2.1.1.1.1.3.3.2.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="S3.E2.m2.1.1.1.1.3.3.2.3.1.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.3">subscript</csymbol><ci id="S3.E2.m2.1.1.1.1.3.3.2.3.2.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.3.2">𝑃</ci><ci id="S3.E2.m2.1.1.1.1.3.3.2.3.3.cmml" xref="S3.E2.m2.1.1.1.1.3.3.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m2.1c">\displaystyle=N_{E}\cdot\sum_{i=1}^{N_{E}}m_{i}\cdot P_{i},</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m2.1d">= italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT ⋅ ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ⋅ italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
<tbody id="S3.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\text{where }m_{i}=\frac{1}{T}\sum_{j=1}^{T}" class="ltx_Math" display="inline" id="S3.E3.m1.1"><semantics id="S3.E3.m1.1a"><mrow id="S3.E3.m1.1.1" xref="S3.E3.m1.1.1.cmml"><mrow id="S3.E3.m1.1.1.2" xref="S3.E3.m1.1.1.2.cmml"><mtext id="S3.E3.m1.1.1.2.2" xref="S3.E3.m1.1.1.2.2a.cmml">where </mtext><mo id="S3.E3.m1.1.1.2.1" xref="S3.E3.m1.1.1.2.1.cmml">⁢</mo><msub id="S3.E3.m1.1.1.2.3" xref="S3.E3.m1.1.1.2.3.cmml"><mi id="S3.E3.m1.1.1.2.3.2" xref="S3.E3.m1.1.1.2.3.2.cmml">m</mi><mi id="S3.E3.m1.1.1.2.3.3" xref="S3.E3.m1.1.1.2.3.3.cmml">i</mi></msub></mrow><mo id="S3.E3.m1.1.1.1" xref="S3.E3.m1.1.1.1.cmml">=</mo><mrow id="S3.E3.m1.1.1.3" xref="S3.E3.m1.1.1.3.cmml"><mstyle displaystyle="true" id="S3.E3.m1.1.1.3.2" xref="S3.E3.m1.1.1.3.2.cmml"><mfrac id="S3.E3.m1.1.1.3.2a" xref="S3.E3.m1.1.1.3.2.cmml"><mn id="S3.E3.m1.1.1.3.2.2" xref="S3.E3.m1.1.1.3.2.2.cmml">1</mn><mi id="S3.E3.m1.1.1.3.2.3" xref="S3.E3.m1.1.1.3.2.3.cmml">T</mi></mfrac></mstyle><mo id="S3.E3.m1.1.1.3.1" xref="S3.E3.m1.1.1.3.1.cmml">⁢</mo><mstyle displaystyle="true" id="S3.E3.m1.1.1.3.3" xref="S3.E3.m1.1.1.3.3.cmml"><munderover id="S3.E3.m1.1.1.3.3a" xref="S3.E3.m1.1.1.3.3.cmml"><mo id="S3.E3.m1.1.1.3.3.2.2" movablelimits="false" xref="S3.E3.m1.1.1.3.3.2.2.cmml">∑</mo><mrow id="S3.E3.m1.1.1.3.3.2.3" xref="S3.E3.m1.1.1.3.3.2.3.cmml"><mi id="S3.E3.m1.1.1.3.3.2.3.2" xref="S3.E3.m1.1.1.3.3.2.3.2.cmml">j</mi><mo id="S3.E3.m1.1.1.3.3.2.3.1" xref="S3.E3.m1.1.1.3.3.2.3.1.cmml">=</mo><mn id="S3.E3.m1.1.1.3.3.2.3.3" xref="S3.E3.m1.1.1.3.3.2.3.3.cmml">1</mn></mrow><mi id="S3.E3.m1.1.1.3.3.3" xref="S3.E3.m1.1.1.3.3.3.cmml">T</mi></munderover></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m1.1b"><apply id="S3.E3.m1.1.1.cmml" xref="S3.E3.m1.1.1"><eq id="S3.E3.m1.1.1.1.cmml" xref="S3.E3.m1.1.1.1"></eq><apply id="S3.E3.m1.1.1.2.cmml" xref="S3.E3.m1.1.1.2"><times id="S3.E3.m1.1.1.2.1.cmml" xref="S3.E3.m1.1.1.2.1"></times><ci id="S3.E3.m1.1.1.2.2a.cmml" xref="S3.E3.m1.1.1.2.2"><mtext id="S3.E3.m1.1.1.2.2.cmml" xref="S3.E3.m1.1.1.2.2">where </mtext></ci><apply id="S3.E3.m1.1.1.2.3.cmml" xref="S3.E3.m1.1.1.2.3"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.2.3.1.cmml" xref="S3.E3.m1.1.1.2.3">subscript</csymbol><ci id="S3.E3.m1.1.1.2.3.2.cmml" xref="S3.E3.m1.1.1.2.3.2">𝑚</ci><ci id="S3.E3.m1.1.1.2.3.3.cmml" xref="S3.E3.m1.1.1.2.3.3">𝑖</ci></apply></apply><apply id="S3.E3.m1.1.1.3.cmml" xref="S3.E3.m1.1.1.3"><times id="S3.E3.m1.1.1.3.1.cmml" xref="S3.E3.m1.1.1.3.1"></times><apply id="S3.E3.m1.1.1.3.2.cmml" xref="S3.E3.m1.1.1.3.2"><divide id="S3.E3.m1.1.1.3.2.1.cmml" xref="S3.E3.m1.1.1.3.2"></divide><cn id="S3.E3.m1.1.1.3.2.2.cmml" type="integer" xref="S3.E3.m1.1.1.3.2.2">1</cn><ci id="S3.E3.m1.1.1.3.2.3.cmml" xref="S3.E3.m1.1.1.3.2.3">𝑇</ci></apply><apply id="S3.E3.m1.1.1.3.3.cmml" xref="S3.E3.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.1.cmml" xref="S3.E3.m1.1.1.3.3">superscript</csymbol><apply id="S3.E3.m1.1.1.3.3.2.cmml" xref="S3.E3.m1.1.1.3.3"><csymbol cd="ambiguous" id="S3.E3.m1.1.1.3.3.2.1.cmml" xref="S3.E3.m1.1.1.3.3">subscript</csymbol><sum id="S3.E3.m1.1.1.3.3.2.2.cmml" xref="S3.E3.m1.1.1.3.3.2.2"></sum><apply id="S3.E3.m1.1.1.3.3.2.3.cmml" xref="S3.E3.m1.1.1.3.3.2.3"><eq id="S3.E3.m1.1.1.3.3.2.3.1.cmml" xref="S3.E3.m1.1.1.3.3.2.3.1"></eq><ci id="S3.E3.m1.1.1.3.3.2.3.2.cmml" xref="S3.E3.m1.1.1.3.3.2.3.2">𝑗</ci><cn id="S3.E3.m1.1.1.3.3.2.3.3.cmml" type="integer" xref="S3.E3.m1.1.1.3.3.2.3.3">1</cn></apply></apply><ci id="S3.E3.m1.1.1.3.3.3.cmml" xref="S3.E3.m1.1.1.3.3.3">𝑇</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.1c">\displaystyle\text{where }m_{i}=\frac{1}{T}\sum_{j=1}^{T}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.1d">where italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathbf{1}(x_{j})_{i}\text{ and }P_{i}=\frac{1}{T}\sum_{j=1}^{T}%
\text{softmax}(r(x_{j}))_{i}." class="ltx_Math" display="inline" id="S3.E3.m2.1"><semantics id="S3.E3.m2.1a"><mrow id="S3.E3.m2.1.1.1" xref="S3.E3.m2.1.1.1.1.cmml"><mrow id="S3.E3.m2.1.1.1.1" xref="S3.E3.m2.1.1.1.1.cmml"><mrow id="S3.E3.m2.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.1.cmml"><mn id="S3.E3.m2.1.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.1.3.cmml">𝟏</mn><mo id="S3.E3.m2.1.1.1.1.1.2" xref="S3.E3.m2.1.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E3.m2.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.1.1.cmml"><mrow id="S3.E3.m2.1.1.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E3.m2.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E3.m2.1.1.1.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E3.m2.1.1.1.1.1.1.1.1.1.2" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E3.m2.1.1.1.1.1.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.E3.m2.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.E3.m2.1.1.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E3.m2.1.1.1.1.1.2a" xref="S3.E3.m2.1.1.1.1.1.2.cmml">⁢</mo><mtext id="S3.E3.m2.1.1.1.1.1.4" xref="S3.E3.m2.1.1.1.1.1.4a.cmml"> and </mtext><mo id="S3.E3.m2.1.1.1.1.1.2b" xref="S3.E3.m2.1.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E3.m2.1.1.1.1.1.5" xref="S3.E3.m2.1.1.1.1.1.5.cmml"><mi id="S3.E3.m2.1.1.1.1.1.5.2" xref="S3.E3.m2.1.1.1.1.1.5.2.cmml">P</mi><mi id="S3.E3.m2.1.1.1.1.1.5.3" xref="S3.E3.m2.1.1.1.1.1.5.3.cmml">i</mi></msub></mrow><mo id="S3.E3.m2.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.3.cmml">=</mo><mrow id="S3.E3.m2.1.1.1.1.2" xref="S3.E3.m2.1.1.1.1.2.cmml"><mstyle displaystyle="true" id="S3.E3.m2.1.1.1.1.2.3" xref="S3.E3.m2.1.1.1.1.2.3.cmml"><mfrac id="S3.E3.m2.1.1.1.1.2.3a" xref="S3.E3.m2.1.1.1.1.2.3.cmml"><mn id="S3.E3.m2.1.1.1.1.2.3.2" xref="S3.E3.m2.1.1.1.1.2.3.2.cmml">1</mn><mi id="S3.E3.m2.1.1.1.1.2.3.3" xref="S3.E3.m2.1.1.1.1.2.3.3.cmml">T</mi></mfrac></mstyle><mo id="S3.E3.m2.1.1.1.1.2.2" xref="S3.E3.m2.1.1.1.1.2.2.cmml">⁢</mo><mrow id="S3.E3.m2.1.1.1.1.2.1" xref="S3.E3.m2.1.1.1.1.2.1.cmml"><mstyle displaystyle="true" id="S3.E3.m2.1.1.1.1.2.1.2" xref="S3.E3.m2.1.1.1.1.2.1.2.cmml"><munderover id="S3.E3.m2.1.1.1.1.2.1.2a" xref="S3.E3.m2.1.1.1.1.2.1.2.cmml"><mo id="S3.E3.m2.1.1.1.1.2.1.2.2.2" movablelimits="false" xref="S3.E3.m2.1.1.1.1.2.1.2.2.2.cmml">∑</mo><mrow id="S3.E3.m2.1.1.1.1.2.1.2.2.3" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.cmml"><mi id="S3.E3.m2.1.1.1.1.2.1.2.2.3.2" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.2.cmml">j</mi><mo id="S3.E3.m2.1.1.1.1.2.1.2.2.3.1" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.1.cmml">=</mo><mn id="S3.E3.m2.1.1.1.1.2.1.2.2.3.3" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.3.cmml">1</mn></mrow><mi id="S3.E3.m2.1.1.1.1.2.1.2.3" xref="S3.E3.m2.1.1.1.1.2.1.2.3.cmml">T</mi></munderover></mstyle><mrow id="S3.E3.m2.1.1.1.1.2.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.cmml"><mtext id="S3.E3.m2.1.1.1.1.2.1.1.3" xref="S3.E3.m2.1.1.1.1.2.1.1.3a.cmml">softmax</mtext><mo id="S3.E3.m2.1.1.1.1.2.1.1.2" xref="S3.E3.m2.1.1.1.1.2.1.1.2.cmml">⁢</mo><msub id="S3.E3.m2.1.1.1.1.2.1.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.1.cmml"><mrow id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.cmml"><mo id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.cmml"><mi id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.3.cmml">r</mi><mo id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.2" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.2" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.3" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.3" stretchy="false" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.E3.m2.1.1.1.1.2.1.1.1.3" xref="S3.E3.m2.1.1.1.1.2.1.1.1.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><mo id="S3.E3.m2.1.1.1.2" lspace="0em" xref="S3.E3.m2.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E3.m2.1b"><apply id="S3.E3.m2.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1"><eq id="S3.E3.m2.1.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.3"></eq><apply id="S3.E3.m2.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.1"><times id="S3.E3.m2.1.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.1.2"></times><cn id="S3.E3.m2.1.1.1.1.1.3.cmml" type="integer" xref="S3.E3.m2.1.1.1.1.1.3">1</cn><apply id="S3.E3.m2.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E3.m2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E3.m2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E3.m2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply><ci id="S3.E3.m2.1.1.1.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.E3.m2.1.1.1.1.1.4a.cmml" xref="S3.E3.m2.1.1.1.1.1.4"><mtext id="S3.E3.m2.1.1.1.1.1.4.cmml" xref="S3.E3.m2.1.1.1.1.1.4"> and </mtext></ci><apply id="S3.E3.m2.1.1.1.1.1.5.cmml" xref="S3.E3.m2.1.1.1.1.1.5"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.1.5.1.cmml" xref="S3.E3.m2.1.1.1.1.1.5">subscript</csymbol><ci id="S3.E3.m2.1.1.1.1.1.5.2.cmml" xref="S3.E3.m2.1.1.1.1.1.5.2">𝑃</ci><ci id="S3.E3.m2.1.1.1.1.1.5.3.cmml" xref="S3.E3.m2.1.1.1.1.1.5.3">𝑖</ci></apply></apply><apply id="S3.E3.m2.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2"><times id="S3.E3.m2.1.1.1.1.2.2.cmml" xref="S3.E3.m2.1.1.1.1.2.2"></times><apply id="S3.E3.m2.1.1.1.1.2.3.cmml" xref="S3.E3.m2.1.1.1.1.2.3"><divide id="S3.E3.m2.1.1.1.1.2.3.1.cmml" xref="S3.E3.m2.1.1.1.1.2.3"></divide><cn id="S3.E3.m2.1.1.1.1.2.3.2.cmml" type="integer" xref="S3.E3.m2.1.1.1.1.2.3.2">1</cn><ci id="S3.E3.m2.1.1.1.1.2.3.3.cmml" xref="S3.E3.m2.1.1.1.1.2.3.3">𝑇</ci></apply><apply id="S3.E3.m2.1.1.1.1.2.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1"><apply id="S3.E3.m2.1.1.1.1.2.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.2.1.2.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2">superscript</csymbol><apply id="S3.E3.m2.1.1.1.1.2.1.2.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.2.1.2.2.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2">subscript</csymbol><sum id="S3.E3.m2.1.1.1.1.2.1.2.2.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2.2.2"></sum><apply id="S3.E3.m2.1.1.1.1.2.1.2.2.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3"><eq id="S3.E3.m2.1.1.1.1.2.1.2.2.3.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.1"></eq><ci id="S3.E3.m2.1.1.1.1.2.1.2.2.3.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.2">𝑗</ci><cn id="S3.E3.m2.1.1.1.1.2.1.2.2.3.3.cmml" type="integer" xref="S3.E3.m2.1.1.1.1.2.1.2.2.3.3">1</cn></apply></apply><ci id="S3.E3.m2.1.1.1.1.2.1.2.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.2.3">𝑇</ci></apply><apply id="S3.E3.m2.1.1.1.1.2.1.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1"><times id="S3.E3.m2.1.1.1.1.2.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.2"></times><ci id="S3.E3.m2.1.1.1.1.2.1.1.3a.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.3"><mtext id="S3.E3.m2.1.1.1.1.2.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.3">softmax</mtext></ci><apply id="S3.E3.m2.1.1.1.1.2.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.2.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1">subscript</csymbol><apply id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1"><times id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.2"></times><ci id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.3">𝑟</ci><apply id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply></apply><ci id="S3.E3.m2.1.1.1.1.2.1.1.1.3.cmml" xref="S3.E3.m2.1.1.1.1.2.1.1.1.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m2.1c">\displaystyle\mathbf{1}(x_{j})_{i}\text{ and }P_{i}=\frac{1}{T}\sum_{j=1}^{T}%
\text{softmax}(r(x_{j}))_{i}.</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m2.1d">bold_1 ( italic_x start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT and italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT softmax ( italic_r ( italic_x start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.11">Here, <math alttext="m_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m1.1"><semantics id="S3.SS2.p1.5.m1.1a"><msub id="S3.SS2.p1.5.m1.1.1" xref="S3.SS2.p1.5.m1.1.1.cmml"><mi id="S3.SS2.p1.5.m1.1.1.2" xref="S3.SS2.p1.5.m1.1.1.2.cmml">m</mi><mi id="S3.SS2.p1.5.m1.1.1.3" xref="S3.SS2.p1.5.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m1.1b"><apply id="S3.SS2.p1.5.m1.1.1.cmml" xref="S3.SS2.p1.5.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.5.m1.1.1.1.cmml" xref="S3.SS2.p1.5.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.5.m1.1.1.2.cmml" xref="S3.SS2.p1.5.m1.1.1.2">𝑚</ci><ci id="S3.SS2.p1.5.m1.1.1.3.cmml" xref="S3.SS2.p1.5.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.5.m1.1c">m_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.5.m1.1d">italic_m start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the fraction of tokens dispatched to expert <math alttext="i" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m2.1"><semantics id="S3.SS2.p1.6.m2.1a"><mi id="S3.SS2.p1.6.m2.1.1" xref="S3.SS2.p1.6.m2.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m2.1b"><ci id="S3.SS2.p1.6.m2.1.1.cmml" xref="S3.SS2.p1.6.m2.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.6.m2.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.6.m2.1d">italic_i</annotation></semantics></math>;
<math alttext="P_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m3.1"><semantics id="S3.SS2.p1.7.m3.1a"><msub id="S3.SS2.p1.7.m3.1.1" xref="S3.SS2.p1.7.m3.1.1.cmml"><mi id="S3.SS2.p1.7.m3.1.1.2" xref="S3.SS2.p1.7.m3.1.1.2.cmml">P</mi><mi id="S3.SS2.p1.7.m3.1.1.3" xref="S3.SS2.p1.7.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m3.1b"><apply id="S3.SS2.p1.7.m3.1.1.cmml" xref="S3.SS2.p1.7.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m3.1.1.1.cmml" xref="S3.SS2.p1.7.m3.1.1">subscript</csymbol><ci id="S3.SS2.p1.7.m3.1.1.2.cmml" xref="S3.SS2.p1.7.m3.1.1.2">𝑃</ci><ci id="S3.SS2.p1.7.m3.1.1.3.cmml" xref="S3.SS2.p1.7.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m3.1c">P_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m3.1d">italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the average gating weight assigned to expert <math alttext="i" class="ltx_Math" display="inline" id="S3.SS2.p1.8.m4.1"><semantics id="S3.SS2.p1.8.m4.1a"><mi id="S3.SS2.p1.8.m4.1.1" xref="S3.SS2.p1.8.m4.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.8.m4.1b"><ci id="S3.SS2.p1.8.m4.1.1.cmml" xref="S3.SS2.p1.8.m4.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.8.m4.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.8.m4.1d">italic_i</annotation></semantics></math> by the router over the batch;
<math alttext="\mathbf{1}(x_{j})_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.9.m5.1"><semantics id="S3.SS2.p1.9.m5.1a"><mrow id="S3.SS2.p1.9.m5.1.1" xref="S3.SS2.p1.9.m5.1.1.cmml"><mn id="S3.SS2.p1.9.m5.1.1.3" xref="S3.SS2.p1.9.m5.1.1.3.cmml">𝟏</mn><mo id="S3.SS2.p1.9.m5.1.1.2" xref="S3.SS2.p1.9.m5.1.1.2.cmml">⁢</mo><msub id="S3.SS2.p1.9.m5.1.1.1" xref="S3.SS2.p1.9.m5.1.1.1.cmml"><mrow id="S3.SS2.p1.9.m5.1.1.1.1.1" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p1.9.m5.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS2.p1.9.m5.1.1.1.1.1.1" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.cmml"><mi id="S3.SS2.p1.9.m5.1.1.1.1.1.1.2" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS2.p1.9.m5.1.1.1.1.1.1.3" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S3.SS2.p1.9.m5.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.SS2.p1.9.m5.1.1.1.3" xref="S3.SS2.p1.9.m5.1.1.1.3.cmml">i</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.9.m5.1b"><apply id="S3.SS2.p1.9.m5.1.1.cmml" xref="S3.SS2.p1.9.m5.1.1"><times id="S3.SS2.p1.9.m5.1.1.2.cmml" xref="S3.SS2.p1.9.m5.1.1.2"></times><cn id="S3.SS2.p1.9.m5.1.1.3.cmml" type="integer" xref="S3.SS2.p1.9.m5.1.1.3">1</cn><apply id="S3.SS2.p1.9.m5.1.1.1.cmml" xref="S3.SS2.p1.9.m5.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.9.m5.1.1.1.2.cmml" xref="S3.SS2.p1.9.m5.1.1.1">subscript</csymbol><apply id="S3.SS2.p1.9.m5.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.9.m5.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.9.m5.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.9.m5.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p1.9.m5.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS2.p1.9.m5.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p1.9.m5.1.1.1.1.1.1.3">𝑗</ci></apply><ci id="S3.SS2.p1.9.m5.1.1.1.3.cmml" xref="S3.SS2.p1.9.m5.1.1.1.3">𝑖</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.9.m5.1c">\mathbf{1}(x_{j})_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.9.m5.1d">bold_1 ( italic_x start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is an indicator function that equals 1 if token <math alttext="x_{j}" class="ltx_Math" display="inline" id="S3.SS2.p1.10.m6.1"><semantics id="S3.SS2.p1.10.m6.1a"><msub id="S3.SS2.p1.10.m6.1.1" xref="S3.SS2.p1.10.m6.1.1.cmml"><mi id="S3.SS2.p1.10.m6.1.1.2" xref="S3.SS2.p1.10.m6.1.1.2.cmml">x</mi><mi id="S3.SS2.p1.10.m6.1.1.3" xref="S3.SS2.p1.10.m6.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.10.m6.1b"><apply id="S3.SS2.p1.10.m6.1.1.cmml" xref="S3.SS2.p1.10.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.10.m6.1.1.1.cmml" xref="S3.SS2.p1.10.m6.1.1">subscript</csymbol><ci id="S3.SS2.p1.10.m6.1.1.2.cmml" xref="S3.SS2.p1.10.m6.1.1.2">𝑥</ci><ci id="S3.SS2.p1.10.m6.1.1.3.cmml" xref="S3.SS2.p1.10.m6.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.10.m6.1c">x_{j}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.10.m6.1d">italic_x start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is routed to expert <math alttext="i" class="ltx_Math" display="inline" id="S3.SS2.p1.11.m7.1"><semantics id="S3.SS2.p1.11.m7.1a"><mi id="S3.SS2.p1.11.m7.1.1" xref="S3.SS2.p1.11.m7.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.11.m7.1b"><ci id="S3.SS2.p1.11.m7.1.1.cmml" xref="S3.SS2.p1.11.m7.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.11.m7.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.11.m7.1d">italic_i</annotation></semantics></math>, and 0 otherwise.
This loss encourages the router to assign tokens more uniformly across all experts, mitigating the risk of expert underutilization and routing collapse.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.4">In addition to the load balancing loss, we incorporate a router z-loss <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib40" title="">40</a>]</cite> to further stabilize MoE training.
The z-loss penalizes large-magnitude router logits, encouraging the router to produce outputs with smaller absolute values,
which helps reduce numerical instability and round-off errors when passing through the gating function.
Formally, the router z-loss is defined as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{RZ}}(x)=\frac{1}{T}\sum_{i=1}^{T}\left(\log\sum_{j=1}^{N_{E%
}}\exp(r(x_{i})_{j})\right)^{2}," class="ltx_Math" display="block" id="S3.E4.m1.3"><semantics id="S3.E4.m1.3a"><mrow id="S3.E4.m1.3.3.1" xref="S3.E4.m1.3.3.1.1.cmml"><mrow id="S3.E4.m1.3.3.1.1" xref="S3.E4.m1.3.3.1.1.cmml"><mrow id="S3.E4.m1.3.3.1.1.3" xref="S3.E4.m1.3.3.1.1.3.cmml"><msub id="S3.E4.m1.3.3.1.1.3.2" xref="S3.E4.m1.3.3.1.1.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E4.m1.3.3.1.1.3.2.2" xref="S3.E4.m1.3.3.1.1.3.2.2.cmml">ℒ</mi><mtext id="S3.E4.m1.3.3.1.1.3.2.3" xref="S3.E4.m1.3.3.1.1.3.2.3a.cmml">RZ</mtext></msub><mo id="S3.E4.m1.3.3.1.1.3.1" xref="S3.E4.m1.3.3.1.1.3.1.cmml">⁢</mo><mrow id="S3.E4.m1.3.3.1.1.3.3.2" xref="S3.E4.m1.3.3.1.1.3.cmml"><mo id="S3.E4.m1.3.3.1.1.3.3.2.1" stretchy="false" xref="S3.E4.m1.3.3.1.1.3.cmml">(</mo><mi id="S3.E4.m1.1.1" xref="S3.E4.m1.1.1.cmml">x</mi><mo id="S3.E4.m1.3.3.1.1.3.3.2.2" stretchy="false" xref="S3.E4.m1.3.3.1.1.3.cmml">)</mo></mrow></mrow><mo id="S3.E4.m1.3.3.1.1.2" xref="S3.E4.m1.3.3.1.1.2.cmml">=</mo><mrow id="S3.E4.m1.3.3.1.1.1" xref="S3.E4.m1.3.3.1.1.1.cmml"><mfrac id="S3.E4.m1.3.3.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.3.cmml"><mn id="S3.E4.m1.3.3.1.1.1.3.2" xref="S3.E4.m1.3.3.1.1.1.3.2.cmml">1</mn><mi id="S3.E4.m1.3.3.1.1.1.3.3" xref="S3.E4.m1.3.3.1.1.1.3.3.cmml">T</mi></mfrac><mo id="S3.E4.m1.3.3.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.2.cmml">⁢</mo><mrow id="S3.E4.m1.3.3.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.cmml"><munderover id="S3.E4.m1.3.3.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.2.cmml"><mo id="S3.E4.m1.3.3.1.1.1.1.2.2.2" movablelimits="false" rspace="0em" xref="S3.E4.m1.3.3.1.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.2.2.3" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.2.2.3.2" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.2.cmml">i</mi><mo id="S3.E4.m1.3.3.1.1.1.1.2.2.3.1" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.E4.m1.3.3.1.1.1.1.2.2.3.3" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S3.E4.m1.3.3.1.1.1.1.2.3" xref="S3.E4.m1.3.3.1.1.1.1.2.3.cmml">T</mi></munderover><msup id="S3.E4.m1.3.3.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.cmml"><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.3.cmml">log</mi><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.cmml"><munderover id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.2" movablelimits="false" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.2.cmml">j</mi><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.3.cmml">1</mn></mrow><msub id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.2.cmml">N</mi><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.3.cmml">E</mi></msub></munderover><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S3.E4.m1.2.2" xref="S3.E4.m1.2.2.cmml">exp</mi><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1a" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">⁡</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">(</mo><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">r</mi><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><msub id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mrow id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">j</mi></msub></mrow><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.E4.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml">)</mo></mrow><mn id="S3.E4.m1.3.3.1.1.1.1.1.3" xref="S3.E4.m1.3.3.1.1.1.1.1.3.cmml">2</mn></msup></mrow></mrow></mrow><mo id="S3.E4.m1.3.3.1.2" xref="S3.E4.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E4.m1.3b"><apply id="S3.E4.m1.3.3.1.1.cmml" xref="S3.E4.m1.3.3.1"><eq id="S3.E4.m1.3.3.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.2"></eq><apply id="S3.E4.m1.3.3.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.3"><times id="S3.E4.m1.3.3.1.1.3.1.cmml" xref="S3.E4.m1.3.3.1.1.3.1"></times><apply id="S3.E4.m1.3.3.1.1.3.2.cmml" xref="S3.E4.m1.3.3.1.1.3.2"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.3.2.1.cmml" xref="S3.E4.m1.3.3.1.1.3.2">subscript</csymbol><ci id="S3.E4.m1.3.3.1.1.3.2.2.cmml" xref="S3.E4.m1.3.3.1.1.3.2.2">ℒ</ci><ci id="S3.E4.m1.3.3.1.1.3.2.3a.cmml" xref="S3.E4.m1.3.3.1.1.3.2.3"><mtext id="S3.E4.m1.3.3.1.1.3.2.3.cmml" mathsize="70%" xref="S3.E4.m1.3.3.1.1.3.2.3">RZ</mtext></ci></apply><ci id="S3.E4.m1.1.1.cmml" xref="S3.E4.m1.1.1">𝑥</ci></apply><apply id="S3.E4.m1.3.3.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1"><times id="S3.E4.m1.3.3.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.2"></times><apply id="S3.E4.m1.3.3.1.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.1.3"><divide id="S3.E4.m1.3.3.1.1.1.3.1.cmml" xref="S3.E4.m1.3.3.1.1.1.3"></divide><cn id="S3.E4.m1.3.3.1.1.1.3.2.cmml" type="integer" xref="S3.E4.m1.3.3.1.1.1.3.2">1</cn><ci id="S3.E4.m1.3.3.1.1.1.3.3.cmml" xref="S3.E4.m1.3.3.1.1.1.3.3">𝑇</ci></apply><apply id="S3.E4.m1.3.3.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1"><apply id="S3.E4.m1.3.3.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.2.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2">superscript</csymbol><apply id="S3.E4.m1.3.3.1.1.1.1.2.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.2.2.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2">subscript</csymbol><sum id="S3.E4.m1.3.3.1.1.1.1.2.2.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2.2.2"></sum><apply id="S3.E4.m1.3.3.1.1.1.1.2.2.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3"><eq id="S3.E4.m1.3.3.1.1.1.1.2.2.3.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.1"></eq><ci id="S3.E4.m1.3.3.1.1.1.1.2.2.3.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.2">𝑖</ci><cn id="S3.E4.m1.3.3.1.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E4.m1.3.3.1.1.1.1.2.2.3.3">1</cn></apply></apply><ci id="S3.E4.m1.3.3.1.1.1.1.2.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.2.3">𝑇</ci></apply><apply id="S3.E4.m1.3.3.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1">superscript</csymbol><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1"><times id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.2"></times><log id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.3"></log><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1"><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2">superscript</csymbol><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2">subscript</csymbol><sum id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.2"></sum><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3"><eq id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.1"></eq><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.2">𝑗</ci><cn id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.2.3.3">1</cn></apply></apply><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3">subscript</csymbol><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.2">𝑁</ci><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.2.3.3">𝐸</ci></apply></apply><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1"><exp id="S3.E4.m1.2.2.cmml" xref="S3.E4.m1.2.2"></exp><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1"><times id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.2"></times><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑟</ci><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.3.3.1.1.1.1.1.1.1.1.1.1.1.1.1.1.3">𝑗</ci></apply></apply></apply></apply></apply><cn id="S3.E4.m1.3.3.1.1.1.1.1.3.cmml" type="integer" xref="S3.E4.m1.3.3.1.1.1.1.1.3">2</cn></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.3c">\mathcal{L}_{\text{RZ}}(x)=\frac{1}{T}\sum_{i=1}^{T}\left(\log\sum_{j=1}^{N_{E%
}}\exp(r(x_{i})_{j})\right)^{2},</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.3d">caligraphic_L start_POSTSUBSCRIPT RZ end_POSTSUBSCRIPT ( italic_x ) = divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT ( roman_log ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_E end_POSTSUBSCRIPT end_POSTSUPERSCRIPT roman_exp ( italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) ) start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p2.3">where <math alttext="r(x_{i})_{j}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mrow id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.3.cmml">r</mi><mo id="S3.SS2.p2.1.m1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.2.cmml">⁢</mo><msub id="S3.SS2.p2.1.m1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.1.cmml"><mrow id="S3.SS2.p2.1.m1.1.1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p2.1.m1.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS2.p2.1.m1.1.1.1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.1.1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS2.p2.1.m1.1.1.1.1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS2.p2.1.m1.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.SS2.p2.1.m1.1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.1.3.cmml">j</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><apply id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1"><times id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.2"></times><ci id="S3.SS2.p2.1.m1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.3">𝑟</ci><apply id="S3.SS2.p2.1.m1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.1">subscript</csymbol><apply id="S3.SS2.p2.1.m1.1.1.1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p2.1.m1.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS2.p2.1.m1.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.SS2.p2.1.m1.1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.1.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">r(x_{i})_{j}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> denotes the router logit for token <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><msub id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml"><mi id="S3.SS2.p2.2.m2.1.1.2" xref="S3.SS2.p2.2.m2.1.1.2.cmml">x</mi><mi id="S3.SS2.p2.2.m2.1.1.3" xref="S3.SS2.p2.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><apply id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.2.m2.1.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p2.2.m2.1.1.2.cmml" xref="S3.SS2.p2.2.m2.1.1.2">𝑥</ci><ci id="S3.SS2.p2.2.m2.1.1.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> and expert <math alttext="j" class="ltx_Math" display="inline" id="S3.SS2.p2.3.m3.1"><semantics id="S3.SS2.p2.3.m3.1a"><mi id="S3.SS2.p2.3.m3.1.1" xref="S3.SS2.p2.3.m3.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.1b"><ci id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.1c">j</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.3.m3.1d">italic_j</annotation></semantics></math>.
This loss encourages the router logits to remain well-behaved, improving the stability and efficacy of MoE training.</p>
</div>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1">The final training objective combines the standard cross-entropy loss (<math alttext="\mathcal{L}_{\text{CE}}" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><msub id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">ℒ</mi><mtext id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3a.cmml">CE</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p3.1.m1.1.1.2.cmml" xref="S3.SS2.p3.1.m1.1.1.2">ℒ</ci><ci id="S3.SS2.p3.1.m1.1.1.3a.cmml" xref="S3.SS2.p3.1.m1.1.1.3"><mtext id="S3.SS2.p3.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.SS2.p3.1.m1.1.1.3">CE</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">\mathcal{L}_{\text{CE}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">caligraphic_L start_POSTSUBSCRIPT CE end_POSTSUBSCRIPT</annotation></semantics></math>) with two auxiliary losses:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{train}}=\mathcal{L}_{\text{CE}}+\gamma\mathcal{L}_{\text{LB%
}}+\eta\mathcal{L}_{\text{RZ}}," class="ltx_Math" display="block" id="S3.E5.m1.1"><semantics id="S3.E5.m1.1a"><mrow id="S3.E5.m1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml"><mrow id="S3.E5.m1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.cmml"><msub id="S3.E5.m1.1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1.1.1.2.2" xref="S3.E5.m1.1.1.1.1.2.2.cmml">ℒ</mi><mtext id="S3.E5.m1.1.1.1.1.2.3" xref="S3.E5.m1.1.1.1.1.2.3a.cmml">train</mtext></msub><mo id="S3.E5.m1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.cmml">=</mo><mrow id="S3.E5.m1.1.1.1.1.3" xref="S3.E5.m1.1.1.1.1.3.cmml"><msub id="S3.E5.m1.1.1.1.1.3.2" xref="S3.E5.m1.1.1.1.1.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1.1.1.3.2.2" xref="S3.E5.m1.1.1.1.1.3.2.2.cmml">ℒ</mi><mtext id="S3.E5.m1.1.1.1.1.3.2.3" xref="S3.E5.m1.1.1.1.1.3.2.3a.cmml">CE</mtext></msub><mo id="S3.E5.m1.1.1.1.1.3.1" xref="S3.E5.m1.1.1.1.1.3.1.cmml">+</mo><mrow id="S3.E5.m1.1.1.1.1.3.3" xref="S3.E5.m1.1.1.1.1.3.3.cmml"><mi id="S3.E5.m1.1.1.1.1.3.3.2" xref="S3.E5.m1.1.1.1.1.3.3.2.cmml">γ</mi><mo id="S3.E5.m1.1.1.1.1.3.3.1" xref="S3.E5.m1.1.1.1.1.3.3.1.cmml">⁢</mo><msub id="S3.E5.m1.1.1.1.1.3.3.3" xref="S3.E5.m1.1.1.1.1.3.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1.1.1.3.3.3.2" xref="S3.E5.m1.1.1.1.1.3.3.3.2.cmml">ℒ</mi><mtext id="S3.E5.m1.1.1.1.1.3.3.3.3" xref="S3.E5.m1.1.1.1.1.3.3.3.3a.cmml">LB</mtext></msub></mrow><mo id="S3.E5.m1.1.1.1.1.3.1a" xref="S3.E5.m1.1.1.1.1.3.1.cmml">+</mo><mrow id="S3.E5.m1.1.1.1.1.3.4" xref="S3.E5.m1.1.1.1.1.3.4.cmml"><mi id="S3.E5.m1.1.1.1.1.3.4.2" xref="S3.E5.m1.1.1.1.1.3.4.2.cmml">η</mi><mo id="S3.E5.m1.1.1.1.1.3.4.1" xref="S3.E5.m1.1.1.1.1.3.4.1.cmml">⁢</mo><msub id="S3.E5.m1.1.1.1.1.3.4.3" xref="S3.E5.m1.1.1.1.1.3.4.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E5.m1.1.1.1.1.3.4.3.2" xref="S3.E5.m1.1.1.1.1.3.4.3.2.cmml">ℒ</mi><mtext id="S3.E5.m1.1.1.1.1.3.4.3.3" xref="S3.E5.m1.1.1.1.1.3.4.3.3a.cmml">RZ</mtext></msub></mrow></mrow></mrow><mo id="S3.E5.m1.1.1.1.2" xref="S3.E5.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E5.m1.1b"><apply id="S3.E5.m1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1"><eq id="S3.E5.m1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1"></eq><apply id="S3.E5.m1.1.1.1.1.2.cmml" xref="S3.E5.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.2.1.cmml" xref="S3.E5.m1.1.1.1.1.2">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.2.2.cmml" xref="S3.E5.m1.1.1.1.1.2.2">ℒ</ci><ci id="S3.E5.m1.1.1.1.1.2.3a.cmml" xref="S3.E5.m1.1.1.1.1.2.3"><mtext id="S3.E5.m1.1.1.1.1.2.3.cmml" mathsize="70%" xref="S3.E5.m1.1.1.1.1.2.3">train</mtext></ci></apply><apply id="S3.E5.m1.1.1.1.1.3.cmml" xref="S3.E5.m1.1.1.1.1.3"><plus id="S3.E5.m1.1.1.1.1.3.1.cmml" xref="S3.E5.m1.1.1.1.1.3.1"></plus><apply id="S3.E5.m1.1.1.1.1.3.2.cmml" xref="S3.E5.m1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.3.2.1.cmml" xref="S3.E5.m1.1.1.1.1.3.2">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.3.2.2.cmml" xref="S3.E5.m1.1.1.1.1.3.2.2">ℒ</ci><ci id="S3.E5.m1.1.1.1.1.3.2.3a.cmml" xref="S3.E5.m1.1.1.1.1.3.2.3"><mtext id="S3.E5.m1.1.1.1.1.3.2.3.cmml" mathsize="70%" xref="S3.E5.m1.1.1.1.1.3.2.3">CE</mtext></ci></apply><apply id="S3.E5.m1.1.1.1.1.3.3.cmml" xref="S3.E5.m1.1.1.1.1.3.3"><times id="S3.E5.m1.1.1.1.1.3.3.1.cmml" xref="S3.E5.m1.1.1.1.1.3.3.1"></times><ci id="S3.E5.m1.1.1.1.1.3.3.2.cmml" xref="S3.E5.m1.1.1.1.1.3.3.2">𝛾</ci><apply id="S3.E5.m1.1.1.1.1.3.3.3.cmml" xref="S3.E5.m1.1.1.1.1.3.3.3"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.3.3.3.1.cmml" xref="S3.E5.m1.1.1.1.1.3.3.3">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.3.3.3.2.cmml" xref="S3.E5.m1.1.1.1.1.3.3.3.2">ℒ</ci><ci id="S3.E5.m1.1.1.1.1.3.3.3.3a.cmml" xref="S3.E5.m1.1.1.1.1.3.3.3.3"><mtext id="S3.E5.m1.1.1.1.1.3.3.3.3.cmml" mathsize="70%" xref="S3.E5.m1.1.1.1.1.3.3.3.3">LB</mtext></ci></apply></apply><apply id="S3.E5.m1.1.1.1.1.3.4.cmml" xref="S3.E5.m1.1.1.1.1.3.4"><times id="S3.E5.m1.1.1.1.1.3.4.1.cmml" xref="S3.E5.m1.1.1.1.1.3.4.1"></times><ci id="S3.E5.m1.1.1.1.1.3.4.2.cmml" xref="S3.E5.m1.1.1.1.1.3.4.2">𝜂</ci><apply id="S3.E5.m1.1.1.1.1.3.4.3.cmml" xref="S3.E5.m1.1.1.1.1.3.4.3"><csymbol cd="ambiguous" id="S3.E5.m1.1.1.1.1.3.4.3.1.cmml" xref="S3.E5.m1.1.1.1.1.3.4.3">subscript</csymbol><ci id="S3.E5.m1.1.1.1.1.3.4.3.2.cmml" xref="S3.E5.m1.1.1.1.1.3.4.3.2">ℒ</ci><ci id="S3.E5.m1.1.1.1.1.3.4.3.3a.cmml" xref="S3.E5.m1.1.1.1.1.3.4.3.3"><mtext id="S3.E5.m1.1.1.1.1.3.4.3.3.cmml" mathsize="70%" xref="S3.E5.m1.1.1.1.1.3.4.3.3">RZ</mtext></ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.1c">\mathcal{L}_{\text{train}}=\mathcal{L}_{\text{CE}}+\gamma\mathcal{L}_{\text{LB%
}}+\eta\mathcal{L}_{\text{RZ}},</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.1d">caligraphic_L start_POSTSUBSCRIPT train end_POSTSUBSCRIPT = caligraphic_L start_POSTSUBSCRIPT CE end_POSTSUBSCRIPT + italic_γ caligraphic_L start_POSTSUBSCRIPT LB end_POSTSUBSCRIPT + italic_η caligraphic_L start_POSTSUBSCRIPT RZ end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p3.5">where <math alttext="\gamma" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m1.1"><semantics id="S3.SS2.p3.2.m1.1a"><mi id="S3.SS2.p3.2.m1.1.1" xref="S3.SS2.p3.2.m1.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m1.1b"><ci id="S3.SS2.p3.2.m1.1.1.cmml" xref="S3.SS2.p3.2.m1.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m1.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.2.m1.1d">italic_γ</annotation></semantics></math> and <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS2.p3.3.m2.1"><semantics id="S3.SS2.p3.3.m2.1a"><mi id="S3.SS2.p3.3.m2.1.1" xref="S3.SS2.p3.3.m2.1.1.cmml">η</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.3.m2.1b"><ci id="S3.SS2.p3.3.m2.1.1.cmml" xref="S3.SS2.p3.3.m2.1.1">𝜂</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.3.m2.1c">\eta</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.3.m2.1d">italic_η</annotation></semantics></math> are two hyperparameters controlling the strengths of the load balancing loss and the router z-loss.
Following OLMoE, we set <math alttext="\gamma=0.01" class="ltx_Math" display="inline" id="S3.SS2.p3.4.m3.1"><semantics id="S3.SS2.p3.4.m3.1a"><mrow id="S3.SS2.p3.4.m3.1.1" xref="S3.SS2.p3.4.m3.1.1.cmml"><mi id="S3.SS2.p3.4.m3.1.1.2" xref="S3.SS2.p3.4.m3.1.1.2.cmml">γ</mi><mo id="S3.SS2.p3.4.m3.1.1.1" xref="S3.SS2.p3.4.m3.1.1.1.cmml">=</mo><mn id="S3.SS2.p3.4.m3.1.1.3" xref="S3.SS2.p3.4.m3.1.1.3.cmml">0.01</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.4.m3.1b"><apply id="S3.SS2.p3.4.m3.1.1.cmml" xref="S3.SS2.p3.4.m3.1.1"><eq id="S3.SS2.p3.4.m3.1.1.1.cmml" xref="S3.SS2.p3.4.m3.1.1.1"></eq><ci id="S3.SS2.p3.4.m3.1.1.2.cmml" xref="S3.SS2.p3.4.m3.1.1.2">𝛾</ci><cn id="S3.SS2.p3.4.m3.1.1.3.cmml" type="float" xref="S3.SS2.p3.4.m3.1.1.3">0.01</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.4.m3.1c">\gamma=0.01</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.4.m3.1d">italic_γ = 0.01</annotation></semantics></math> and <math alttext="\eta=0.001" class="ltx_Math" display="inline" id="S3.SS2.p3.5.m4.1"><semantics id="S3.SS2.p3.5.m4.1a"><mrow id="S3.SS2.p3.5.m4.1.1" xref="S3.SS2.p3.5.m4.1.1.cmml"><mi id="S3.SS2.p3.5.m4.1.1.2" xref="S3.SS2.p3.5.m4.1.1.2.cmml">η</mi><mo id="S3.SS2.p3.5.m4.1.1.1" xref="S3.SS2.p3.5.m4.1.1.1.cmml">=</mo><mn id="S3.SS2.p3.5.m4.1.1.3" xref="S3.SS2.p3.5.m4.1.1.3.cmml">0.001</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.5.m4.1b"><apply id="S3.SS2.p3.5.m4.1.1.cmml" xref="S3.SS2.p3.5.m4.1.1"><eq id="S3.SS2.p3.5.m4.1.1.1.cmml" xref="S3.SS2.p3.5.m4.1.1.1"></eq><ci id="S3.SS2.p3.5.m4.1.1.2.cmml" xref="S3.SS2.p3.5.m4.1.1.2">𝜂</ci><cn id="S3.SS2.p3.5.m4.1.1.3.cmml" type="float" xref="S3.SS2.p3.5.m4.1.1.3">0.001</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.5.m4.1c">\eta=0.001</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.5.m4.1d">italic_η = 0.001</annotation></semantics></math> for all experiments.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Scaling Law Study for FLAME-MoE</h2>
<figure class="ltx_figure" id="S4.F1">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F1.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="814" id="S4.F1.sf1.g1" src="x1.png" width="831"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F1.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S4.F1.sf1.3.2" style="font-size:90%;">IsoFLOP profiles.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F1.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="812" id="S4.F1.sf2.g1" src="x2.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F1.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S4.F1.sf2.3.2" style="font-size:90%;">Parametric loss.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F1.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="717" id="S4.F1.sf3.g1" src="x3.png" width="829"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F1.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S4.F1.sf3.3.2" style="font-size:90%;">Fitted scaling law.</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F1.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="810" id="S4.F1.sf4.g1" src="x4.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F1.sf4.2.1.1" style="font-size:90%;">(d)</span> </span><span class="ltx_text" id="S4.F1.sf4.3.2" style="font-size:90%;">Generalization ability.</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F1.2.1.1" style="font-size:90%;">Figure 1</span>: </span><span class="ltx_text" id="S4.F1.3.2" style="font-size:90%;">Scaling law experiments: (a) IsoFLOP profiles; (b) parametric loss function fitting; (c) fitted scaling law; (d) generalization from validation loss to downstream performance.</span></figcaption>
</figure>
<figure class="ltx_table" id="S4.T2">
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">Table 2: </span>Model cards of 7 FLAME-MoE models.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T2.4" style="width:433.6pt;height:116pt;vertical-align:-0.8pt;"><span class="ltx_transformed_inner" style="transform:translate(-54.3pt,14.4pt) scale(0.799814288598737,0.799814288598737) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T2.4.1">
<tr class="ltx_tr" id="S4.T2.4.1.1">
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.1"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.1.1" style="font-size:90%;">Active-Total</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.2"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.2.1" style="font-size:90%;">Layers</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.3"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.3.1" style="font-size:90%;">Hidden Size</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.4"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.4.1" style="font-size:90%;">FFN Hidden</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.5"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.5.1" style="font-size:90%;">MoE FFN Hidden</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.6"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.6.1" style="font-size:90%;">Total/Active/Shared</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.7"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.7.1" style="font-size:90%;">#FLOPs</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.8"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.8.1" style="font-size:90%;">H100 Hours</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="S4.T2.4.1.1.9"><span class="ltx_text ltx_font_bold" id="S4.T2.4.1.1.9.1" style="font-size:90%;">Tokens</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.2">
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.1"><span class="ltx_text" id="S4.T2.4.1.2.1.1" style="font-size:90%;">38M-100M</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.2"><span class="ltx_text" id="S4.T2.4.1.2.2.1" style="font-size:90%;">9</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.3"><span class="ltx_text" id="S4.T2.4.1.2.3.1" style="font-size:90%;">256</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.4"><span class="ltx_text" id="S4.T2.4.1.2.4.1" style="font-size:90%;">1368</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.5"><span class="ltx_text" id="S4.T2.4.1.2.5.1" style="font-size:90%;">176</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.6"><span class="ltx_text" id="S4.T2.4.1.2.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.7"><span class="ltx_text" id="S4.T2.4.1.2.7.1" style="font-size:90%;">1.0e18</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.8"><span class="ltx_text" id="S4.T2.4.1.2.8.1" style="font-size:90%;">5.7</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S4.T2.4.1.2.9"><span class="ltx_text" id="S4.T2.4.1.2.9.1" style="font-size:90%;">4.4B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.3">
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.1"><span class="ltx_text" id="S4.T2.4.1.3.1.1" style="font-size:90%;">98M-349M</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.2"><span class="ltx_text" id="S4.T2.4.1.3.2.1" style="font-size:90%;">9</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.3"><span class="ltx_text" id="S4.T2.4.1.3.3.1" style="font-size:90%;">512</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.4"><span class="ltx_text" id="S4.T2.4.1.3.4.1" style="font-size:90%;">2736</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.5"><span class="ltx_text" id="S4.T2.4.1.3.5.1" style="font-size:90%;">352</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.6"><span class="ltx_text" id="S4.T2.4.1.3.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.7"><span class="ltx_text" id="S4.T2.4.1.3.7.1" style="font-size:90%;">3.0e18</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.8"><span class="ltx_text" id="S4.T2.4.1.3.8.1" style="font-size:90%;">8.2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.3.9"><span class="ltx_text" id="S4.T2.4.1.3.9.1" style="font-size:90%;">5.0B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.4">
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.1"><span class="ltx_text" id="S4.T2.4.1.4.1.1" style="font-size:90%;">115M-459M</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.2"><span class="ltx_text" id="S4.T2.4.1.4.2.1" style="font-size:90%;">12</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.3"><span class="ltx_text" id="S4.T2.4.1.4.3.1" style="font-size:90%;">512</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.4"><span class="ltx_text" id="S4.T2.4.1.4.4.1" style="font-size:90%;">2736</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.5"><span class="ltx_text" id="S4.T2.4.1.4.5.1" style="font-size:90%;">352</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.6"><span class="ltx_text" id="S4.T2.4.1.4.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.7"><span class="ltx_text" id="S4.T2.4.1.4.7.1" style="font-size:90%;">6.0e18</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.8"><span class="ltx_text" id="S4.T2.4.1.4.8.1" style="font-size:90%;">20.9</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.4.9"><span class="ltx_text" id="S4.T2.4.1.4.9.1" style="font-size:90%;">8.7B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.5">
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.1"><span class="ltx_text" id="S4.T2.4.1.5.1.1" style="font-size:90%;">290M-1.3B</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.2"><span class="ltx_text" id="S4.T2.4.1.5.2.1" style="font-size:90%;">9</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.3"><span class="ltx_text" id="S4.T2.4.1.5.3.1" style="font-size:90%;">1024</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.4"><span class="ltx_text" id="S4.T2.4.1.5.4.1" style="font-size:90%;">5472</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.5"><span class="ltx_text" id="S4.T2.4.1.5.5.1" style="font-size:90%;">704</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.6"><span class="ltx_text" id="S4.T2.4.1.5.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.7"><span class="ltx_text" id="S4.T2.4.1.5.7.1" style="font-size:90%;">2.0e19</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.8"><span class="ltx_text" id="S4.T2.4.1.5.8.1" style="font-size:90%;">63.4</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.5.9"><span class="ltx_text" id="S4.T2.4.1.5.9.1" style="font-size:90%;">11.4B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.6">
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.1"><span class="ltx_text" id="S4.T2.4.1.6.1.1" style="font-size:90%;">419M-2.2B</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.2"><span class="ltx_text" id="S4.T2.4.1.6.2.1" style="font-size:90%;">15</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.3"><span class="ltx_text" id="S4.T2.4.1.6.3.1" style="font-size:90%;">1024</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.4"><span class="ltx_text" id="S4.T2.4.1.6.4.1" style="font-size:90%;">5472</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.5"><span class="ltx_text" id="S4.T2.4.1.6.5.1" style="font-size:90%;">704</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.6"><span class="ltx_text" id="S4.T2.4.1.6.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.7"><span class="ltx_text" id="S4.T2.4.1.6.7.1" style="font-size:90%;">3.0e19</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.8"><span class="ltx_text" id="S4.T2.4.1.6.8.1" style="font-size:90%;">66.4</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.6.9"><span class="ltx_text" id="S4.T2.4.1.6.9.1" style="font-size:90%;">11.9B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.7">
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.1"><span class="ltx_text" id="S4.T2.4.1.7.1.1" style="font-size:90%;">721M-3.8B</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.2"><span class="ltx_text" id="S4.T2.4.1.7.2.1" style="font-size:90%;">12</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.3"><span class="ltx_text" id="S4.T2.4.1.7.3.1" style="font-size:90%;">1536</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.4"><span class="ltx_text" id="S4.T2.4.1.7.4.1" style="font-size:90%;">8208</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.5"><span class="ltx_text" id="S4.T2.4.1.7.5.1" style="font-size:90%;">1056</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.6"><span class="ltx_text" id="S4.T2.4.1.7.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.7"><span class="ltx_text" id="S4.T2.4.1.7.7.1" style="font-size:90%;">8.0e19</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.8"><span class="ltx_text" id="S4.T2.4.1.7.8.1" style="font-size:90%;">172.8</span></td>
<td class="ltx_td ltx_align_right" id="S4.T2.4.1.7.9"><span class="ltx_text" id="S4.T2.4.1.7.9.1" style="font-size:90%;">18.4B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.4.1.8">
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.1"><span class="ltx_text" id="S4.T2.4.1.8.1.1" style="font-size:90%;">1.7B-10.3B</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.2"><span class="ltx_text" id="S4.T2.4.1.8.2.1" style="font-size:90%;">18</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.3"><span class="ltx_text" id="S4.T2.4.1.8.3.1" style="font-size:90%;">2048</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.4"><span class="ltx_text" id="S4.T2.4.1.8.4.1" style="font-size:90%;">10944</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.5"><span class="ltx_text" id="S4.T2.4.1.8.5.1" style="font-size:90%;">1408</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.6"><span class="ltx_text" id="S4.T2.4.1.8.6.1" style="font-size:90%;">64/8/2</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.7"><span class="ltx_text" id="S4.T2.4.1.8.7.1" style="font-size:90%;">2.4e20</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.8"><span class="ltx_text" id="S4.T2.4.1.8.8.1" style="font-size:90%;">560.5</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="S4.T2.4.1.8.9"><span class="ltx_text" id="S4.T2.4.1.8.9.1" style="font-size:90%;">23.1B</span></td>
</tr>
</table>
</span></div>
</figure>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">Determining the optimal allocation between the model size and the number of training tokens for a fixed compute budget (FLOPs) is crucial to training LLMs efficiently.
As we fix the total number of experts and the number of active experts per token for FLAME-MoE,
we concentrate on the number of active parameters as the primary variable for our scaling law study.
This simplification allows us to adapt established methodologies in dense models for finding compute-optimal MoE configurations.
</p>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1">Specifically, we investigate two primary approaches employed in Chinchilla <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib11" title="">11</a>]</cite>, to determine the optimal <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.p2.1.m1.1"><semantics id="S4.p2.1.m1.1a"><msub id="S4.p2.1.m1.1.1" xref="S4.p2.1.m1.1.1.cmml"><mi id="S4.p2.1.m1.1.1.2" xref="S4.p2.1.m1.1.1.2.cmml">N</mi><mtext id="S4.p2.1.m1.1.1.3" xref="S4.p2.1.m1.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p2.1.m1.1b"><apply id="S4.p2.1.m1.1.1.cmml" xref="S4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.p2.1.m1.1.1.1.cmml" xref="S4.p2.1.m1.1.1">subscript</csymbol><ci id="S4.p2.1.m1.1.1.2.cmml" xref="S4.p2.1.m1.1.1.2">𝑁</ci><ci id="S4.p2.1.m1.1.1.3a.cmml" xref="S4.p2.1.m1.1.1.3"><mtext id="S4.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.p2.1.m1.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.1.m1.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.1.m1.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> for our MoE models given a fixed FLOPs budget,
IsoFLOP profiles (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS1" title="4.1 IsoFLOP Profiles ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">4.1</span></a>) and parametric loss function fitting (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS2" title="4.2 Parametric Loss Function Fitting ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">4.2</span></a>). Finally, we apply our fitted scaling law to predict the optimal number of parameters to configure our released FLAME-MoE model family (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.SS3" title="4.3 FLAME-MoE Model Family ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">4.3</span></a>).
In all following experiments, we use the data sampled from the state-of-the-art open-source pretraining corpus, DataComp-LM (DCLM) <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib19" title="">19</a>]</cite>, to train our models.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>IsoFLOP Profiles</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.4">The first approach generates IsoFLOP profiles by varying the number of active parameters <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.1"><semantics id="S4.SS1.p1.1.m1.1a"><msub id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml"><mi id="S4.SS1.p1.1.m1.1.1.2" xref="S4.SS1.p1.1.m1.1.1.2.cmml">N</mi><mtext id="S4.SS1.p1.1.m1.1.1.3" xref="S4.SS1.p1.1.m1.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.1b"><apply id="S4.SS1.p1.1.m1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.1.m1.1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p1.1.m1.1.1.2.cmml" xref="S4.SS1.p1.1.m1.1.1.2">𝑁</ci><ci id="S4.SS1.p1.1.m1.1.1.3a.cmml" xref="S4.SS1.p1.1.m1.1.1.3"><mtext id="S4.SS1.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.1.m1.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> while keeping the computational budget <math alttext="C" class="ltx_Math" display="inline" id="S4.SS1.p1.2.m2.1"><semantics id="S4.SS1.p1.2.m2.1a"><mi id="S4.SS1.p1.2.m2.1.1" xref="S4.SS1.p1.2.m2.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.2.m2.1b"><ci id="S4.SS1.p1.2.m2.1.1.cmml" xref="S4.SS1.p1.2.m2.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.2.m2.1c">C</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.2.m2.1d">italic_C</annotation></semantics></math> fixed.
For each fixed FLOPs budget, we calculate the number of training tokens <math alttext="D" class="ltx_Math" display="inline" id="S4.SS1.p1.3.m3.1"><semantics id="S4.SS1.p1.3.m3.1a"><mi id="S4.SS1.p1.3.m3.1.1" xref="S4.SS1.p1.3.m3.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.3.m3.1b"><ci id="S4.SS1.p1.3.m3.1.1.cmml" xref="S4.SS1.p1.3.m3.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.3.m3.1c">D</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.3.m3.1d">italic_D</annotation></semantics></math> as a function of <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p1.4.m4.1"><semantics id="S4.SS1.p1.4.m4.1a"><msub id="S4.SS1.p1.4.m4.1.1" xref="S4.SS1.p1.4.m4.1.1.cmml"><mi id="S4.SS1.p1.4.m4.1.1.2" xref="S4.SS1.p1.4.m4.1.1.2.cmml">N</mi><mtext id="S4.SS1.p1.4.m4.1.1.3" xref="S4.SS1.p1.4.m4.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.4.m4.1b"><apply id="S4.SS1.p1.4.m4.1.1.cmml" xref="S4.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.4.m4.1.1.1.cmml" xref="S4.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS1.p1.4.m4.1.1.2.cmml" xref="S4.SS1.p1.4.m4.1.1.2">𝑁</ci><ci id="S4.SS1.p1.4.m4.1.1.3a.cmml" xref="S4.SS1.p1.4.m4.1.1.3"><mtext id="S4.SS1.p1.4.m4.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.4.m4.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.4.m4.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.4.m4.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> using the formula:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="D=\frac{C}{\kappa N_{\text{active}}}" class="ltx_Math" display="block" id="S4.E6.m1.1"><semantics id="S4.E6.m1.1a"><mrow id="S4.E6.m1.1.1" xref="S4.E6.m1.1.1.cmml"><mi id="S4.E6.m1.1.1.2" xref="S4.E6.m1.1.1.2.cmml">D</mi><mo id="S4.E6.m1.1.1.1" xref="S4.E6.m1.1.1.1.cmml">=</mo><mfrac id="S4.E6.m1.1.1.3" xref="S4.E6.m1.1.1.3.cmml"><mi id="S4.E6.m1.1.1.3.2" xref="S4.E6.m1.1.1.3.2.cmml">C</mi><mrow id="S4.E6.m1.1.1.3.3" xref="S4.E6.m1.1.1.3.3.cmml"><mi id="S4.E6.m1.1.1.3.3.2" xref="S4.E6.m1.1.1.3.3.2.cmml">κ</mi><mo id="S4.E6.m1.1.1.3.3.1" xref="S4.E6.m1.1.1.3.3.1.cmml">⁢</mo><msub id="S4.E6.m1.1.1.3.3.3" xref="S4.E6.m1.1.1.3.3.3.cmml"><mi id="S4.E6.m1.1.1.3.3.3.2" xref="S4.E6.m1.1.1.3.3.3.2.cmml">N</mi><mtext id="S4.E6.m1.1.1.3.3.3.3" xref="S4.E6.m1.1.1.3.3.3.3a.cmml">active</mtext></msub></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.E6.m1.1b"><apply id="S4.E6.m1.1.1.cmml" xref="S4.E6.m1.1.1"><eq id="S4.E6.m1.1.1.1.cmml" xref="S4.E6.m1.1.1.1"></eq><ci id="S4.E6.m1.1.1.2.cmml" xref="S4.E6.m1.1.1.2">𝐷</ci><apply id="S4.E6.m1.1.1.3.cmml" xref="S4.E6.m1.1.1.3"><divide id="S4.E6.m1.1.1.3.1.cmml" xref="S4.E6.m1.1.1.3"></divide><ci id="S4.E6.m1.1.1.3.2.cmml" xref="S4.E6.m1.1.1.3.2">𝐶</ci><apply id="S4.E6.m1.1.1.3.3.cmml" xref="S4.E6.m1.1.1.3.3"><times id="S4.E6.m1.1.1.3.3.1.cmml" xref="S4.E6.m1.1.1.3.3.1"></times><ci id="S4.E6.m1.1.1.3.3.2.cmml" xref="S4.E6.m1.1.1.3.3.2">𝜅</ci><apply id="S4.E6.m1.1.1.3.3.3.cmml" xref="S4.E6.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="S4.E6.m1.1.1.3.3.3.1.cmml" xref="S4.E6.m1.1.1.3.3.3">subscript</csymbol><ci id="S4.E6.m1.1.1.3.3.3.2.cmml" xref="S4.E6.m1.1.1.3.3.3.2">𝑁</ci><ci id="S4.E6.m1.1.1.3.3.3.3a.cmml" xref="S4.E6.m1.1.1.3.3.3.3"><mtext id="S4.E6.m1.1.1.3.3.3.3.cmml" mathsize="70%" xref="S4.E6.m1.1.1.3.3.3.3">active</mtext></ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E6.m1.1c">D=\frac{C}{\kappa N_{\text{active}}}</annotation><annotation encoding="application/x-llamapun" id="S4.E6.m1.1d">italic_D = divide start_ARG italic_C end_ARG start_ARG italic_κ italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.p1.14">where <math alttext="\kappa" class="ltx_Math" display="inline" id="S4.SS1.p1.5.m1.1"><semantics id="S4.SS1.p1.5.m1.1a"><mi id="S4.SS1.p1.5.m1.1.1" xref="S4.SS1.p1.5.m1.1.1.cmml">κ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.5.m1.1b"><ci id="S4.SS1.p1.5.m1.1.1.cmml" xref="S4.SS1.p1.5.m1.1.1">𝜅</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.5.m1.1c">\kappa</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.5.m1.1d">italic_κ</annotation></semantics></math> is a constant commonly set to 6 in previous works <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib11" title="">11</a>]</cite>.
By plotting the final validation loss achieved by each model configuration against its <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p1.6.m2.1"><semantics id="S4.SS1.p1.6.m2.1a"><msub id="S4.SS1.p1.6.m2.1.1" xref="S4.SS1.p1.6.m2.1.1.cmml"><mi id="S4.SS1.p1.6.m2.1.1.2" xref="S4.SS1.p1.6.m2.1.1.2.cmml">N</mi><mtext id="S4.SS1.p1.6.m2.1.1.3" xref="S4.SS1.p1.6.m2.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.6.m2.1b"><apply id="S4.SS1.p1.6.m2.1.1.cmml" xref="S4.SS1.p1.6.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.6.m2.1.1.1.cmml" xref="S4.SS1.p1.6.m2.1.1">subscript</csymbol><ci id="S4.SS1.p1.6.m2.1.1.2.cmml" xref="S4.SS1.p1.6.m2.1.1.2">𝑁</ci><ci id="S4.SS1.p1.6.m2.1.1.3a.cmml" xref="S4.SS1.p1.6.m2.1.1.3"><mtext id="S4.SS1.p1.6.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.6.m2.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.6.m2.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.6.m2.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> for a given FLOPs budget, we obtain an IsoFLOP curve.
We then fit a parabolic function to each of these curves.
The minimum of this parabola provides an estimate of the optimal <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p1.7.m3.1"><semantics id="S4.SS1.p1.7.m3.1a"><msub id="S4.SS1.p1.7.m3.1.1" xref="S4.SS1.p1.7.m3.1.1.cmml"><mi id="S4.SS1.p1.7.m3.1.1.2" xref="S4.SS1.p1.7.m3.1.1.2.cmml">N</mi><mtext id="S4.SS1.p1.7.m3.1.1.3" xref="S4.SS1.p1.7.m3.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.7.m3.1b"><apply id="S4.SS1.p1.7.m3.1.1.cmml" xref="S4.SS1.p1.7.m3.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.7.m3.1.1.1.cmml" xref="S4.SS1.p1.7.m3.1.1">subscript</csymbol><ci id="S4.SS1.p1.7.m3.1.1.2.cmml" xref="S4.SS1.p1.7.m3.1.1.2">𝑁</ci><ci id="S4.SS1.p1.7.m3.1.1.3a.cmml" xref="S4.SS1.p1.7.m3.1.1.3"><mtext id="S4.SS1.p1.7.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.7.m3.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.7.m3.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.7.m3.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> for that specific computational budget.
Finally, we fit a power law to these data points to model the relationship <math alttext="N_{\text{active}}^{*}(C)\propto C^{a}" class="ltx_Math" display="inline" id="S4.SS1.p1.8.m4.1"><semantics id="S4.SS1.p1.8.m4.1a"><mrow id="S4.SS1.p1.8.m4.1.2" xref="S4.SS1.p1.8.m4.1.2.cmml"><mrow id="S4.SS1.p1.8.m4.1.2.2" xref="S4.SS1.p1.8.m4.1.2.2.cmml"><msubsup id="S4.SS1.p1.8.m4.1.2.2.2" xref="S4.SS1.p1.8.m4.1.2.2.2.cmml"><mi id="S4.SS1.p1.8.m4.1.2.2.2.2.2" xref="S4.SS1.p1.8.m4.1.2.2.2.2.2.cmml">N</mi><mtext id="S4.SS1.p1.8.m4.1.2.2.2.2.3" xref="S4.SS1.p1.8.m4.1.2.2.2.2.3a.cmml">active</mtext><mo id="S4.SS1.p1.8.m4.1.2.2.2.3" xref="S4.SS1.p1.8.m4.1.2.2.2.3.cmml">∗</mo></msubsup><mo id="S4.SS1.p1.8.m4.1.2.2.1" xref="S4.SS1.p1.8.m4.1.2.2.1.cmml">⁢</mo><mrow id="S4.SS1.p1.8.m4.1.2.2.3.2" xref="S4.SS1.p1.8.m4.1.2.2.cmml"><mo id="S4.SS1.p1.8.m4.1.2.2.3.2.1" stretchy="false" xref="S4.SS1.p1.8.m4.1.2.2.cmml">(</mo><mi id="S4.SS1.p1.8.m4.1.1" xref="S4.SS1.p1.8.m4.1.1.cmml">C</mi><mo id="S4.SS1.p1.8.m4.1.2.2.3.2.2" stretchy="false" xref="S4.SS1.p1.8.m4.1.2.2.cmml">)</mo></mrow></mrow><mo id="S4.SS1.p1.8.m4.1.2.1" xref="S4.SS1.p1.8.m4.1.2.1.cmml">∝</mo><msup id="S4.SS1.p1.8.m4.1.2.3" xref="S4.SS1.p1.8.m4.1.2.3.cmml"><mi id="S4.SS1.p1.8.m4.1.2.3.2" xref="S4.SS1.p1.8.m4.1.2.3.2.cmml">C</mi><mi id="S4.SS1.p1.8.m4.1.2.3.3" xref="S4.SS1.p1.8.m4.1.2.3.3.cmml">a</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.8.m4.1b"><apply id="S4.SS1.p1.8.m4.1.2.cmml" xref="S4.SS1.p1.8.m4.1.2"><csymbol cd="latexml" id="S4.SS1.p1.8.m4.1.2.1.cmml" xref="S4.SS1.p1.8.m4.1.2.1">proportional-to</csymbol><apply id="S4.SS1.p1.8.m4.1.2.2.cmml" xref="S4.SS1.p1.8.m4.1.2.2"><times id="S4.SS1.p1.8.m4.1.2.2.1.cmml" xref="S4.SS1.p1.8.m4.1.2.2.1"></times><apply id="S4.SS1.p1.8.m4.1.2.2.2.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.p1.8.m4.1.2.2.2.1.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2">superscript</csymbol><apply id="S4.SS1.p1.8.m4.1.2.2.2.2.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.p1.8.m4.1.2.2.2.2.1.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2">subscript</csymbol><ci id="S4.SS1.p1.8.m4.1.2.2.2.2.2.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2.2.2">𝑁</ci><ci id="S4.SS1.p1.8.m4.1.2.2.2.2.3a.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2.2.3"><mtext id="S4.SS1.p1.8.m4.1.2.2.2.2.3.cmml" mathsize="70%" xref="S4.SS1.p1.8.m4.1.2.2.2.2.3">active</mtext></ci></apply><times id="S4.SS1.p1.8.m4.1.2.2.2.3.cmml" xref="S4.SS1.p1.8.m4.1.2.2.2.3"></times></apply><ci id="S4.SS1.p1.8.m4.1.1.cmml" xref="S4.SS1.p1.8.m4.1.1">𝐶</ci></apply><apply id="S4.SS1.p1.8.m4.1.2.3.cmml" xref="S4.SS1.p1.8.m4.1.2.3"><csymbol cd="ambiguous" id="S4.SS1.p1.8.m4.1.2.3.1.cmml" xref="S4.SS1.p1.8.m4.1.2.3">superscript</csymbol><ci id="S4.SS1.p1.8.m4.1.2.3.2.cmml" xref="S4.SS1.p1.8.m4.1.2.3.2">𝐶</ci><ci id="S4.SS1.p1.8.m4.1.2.3.3.cmml" xref="S4.SS1.p1.8.m4.1.2.3.3">𝑎</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.8.m4.1c">N_{\text{active}}^{*}(C)\propto C^{a}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.8.m4.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ( italic_C ) ∝ italic_C start_POSTSUPERSCRIPT italic_a end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="D^{*}(C)\propto C^{b}" class="ltx_Math" display="inline" id="S4.SS1.p1.9.m5.1"><semantics id="S4.SS1.p1.9.m5.1a"><mrow id="S4.SS1.p1.9.m5.1.2" xref="S4.SS1.p1.9.m5.1.2.cmml"><mrow id="S4.SS1.p1.9.m5.1.2.2" xref="S4.SS1.p1.9.m5.1.2.2.cmml"><msup id="S4.SS1.p1.9.m5.1.2.2.2" xref="S4.SS1.p1.9.m5.1.2.2.2.cmml"><mi id="S4.SS1.p1.9.m5.1.2.2.2.2" xref="S4.SS1.p1.9.m5.1.2.2.2.2.cmml">D</mi><mo id="S4.SS1.p1.9.m5.1.2.2.2.3" xref="S4.SS1.p1.9.m5.1.2.2.2.3.cmml">∗</mo></msup><mo id="S4.SS1.p1.9.m5.1.2.2.1" xref="S4.SS1.p1.9.m5.1.2.2.1.cmml">⁢</mo><mrow id="S4.SS1.p1.9.m5.1.2.2.3.2" xref="S4.SS1.p1.9.m5.1.2.2.cmml"><mo id="S4.SS1.p1.9.m5.1.2.2.3.2.1" stretchy="false" xref="S4.SS1.p1.9.m5.1.2.2.cmml">(</mo><mi id="S4.SS1.p1.9.m5.1.1" xref="S4.SS1.p1.9.m5.1.1.cmml">C</mi><mo id="S4.SS1.p1.9.m5.1.2.2.3.2.2" stretchy="false" xref="S4.SS1.p1.9.m5.1.2.2.cmml">)</mo></mrow></mrow><mo id="S4.SS1.p1.9.m5.1.2.1" xref="S4.SS1.p1.9.m5.1.2.1.cmml">∝</mo><msup id="S4.SS1.p1.9.m5.1.2.3" xref="S4.SS1.p1.9.m5.1.2.3.cmml"><mi id="S4.SS1.p1.9.m5.1.2.3.2" xref="S4.SS1.p1.9.m5.1.2.3.2.cmml">C</mi><mi id="S4.SS1.p1.9.m5.1.2.3.3" xref="S4.SS1.p1.9.m5.1.2.3.3.cmml">b</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.9.m5.1b"><apply id="S4.SS1.p1.9.m5.1.2.cmml" xref="S4.SS1.p1.9.m5.1.2"><csymbol cd="latexml" id="S4.SS1.p1.9.m5.1.2.1.cmml" xref="S4.SS1.p1.9.m5.1.2.1">proportional-to</csymbol><apply id="S4.SS1.p1.9.m5.1.2.2.cmml" xref="S4.SS1.p1.9.m5.1.2.2"><times id="S4.SS1.p1.9.m5.1.2.2.1.cmml" xref="S4.SS1.p1.9.m5.1.2.2.1"></times><apply id="S4.SS1.p1.9.m5.1.2.2.2.cmml" xref="S4.SS1.p1.9.m5.1.2.2.2"><csymbol cd="ambiguous" id="S4.SS1.p1.9.m5.1.2.2.2.1.cmml" xref="S4.SS1.p1.9.m5.1.2.2.2">superscript</csymbol><ci id="S4.SS1.p1.9.m5.1.2.2.2.2.cmml" xref="S4.SS1.p1.9.m5.1.2.2.2.2">𝐷</ci><times id="S4.SS1.p1.9.m5.1.2.2.2.3.cmml" xref="S4.SS1.p1.9.m5.1.2.2.2.3"></times></apply><ci id="S4.SS1.p1.9.m5.1.1.cmml" xref="S4.SS1.p1.9.m5.1.1">𝐶</ci></apply><apply id="S4.SS1.p1.9.m5.1.2.3.cmml" xref="S4.SS1.p1.9.m5.1.2.3"><csymbol cd="ambiguous" id="S4.SS1.p1.9.m5.1.2.3.1.cmml" xref="S4.SS1.p1.9.m5.1.2.3">superscript</csymbol><ci id="S4.SS1.p1.9.m5.1.2.3.2.cmml" xref="S4.SS1.p1.9.m5.1.2.3.2">𝐶</ci><ci id="S4.SS1.p1.9.m5.1.2.3.3.cmml" xref="S4.SS1.p1.9.m5.1.2.3.3">𝑏</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.9.m5.1c">D^{*}(C)\propto C^{b}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.9.m5.1d">italic_D start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ( italic_C ) ∝ italic_C start_POSTSUPERSCRIPT italic_b end_POSTSUPERSCRIPT</annotation></semantics></math>,
where <math alttext="N_{\text{active}}^{*}" class="ltx_Math" display="inline" id="S4.SS1.p1.10.m6.1"><semantics id="S4.SS1.p1.10.m6.1a"><msubsup id="S4.SS1.p1.10.m6.1.1" xref="S4.SS1.p1.10.m6.1.1.cmml"><mi id="S4.SS1.p1.10.m6.1.1.2.2" xref="S4.SS1.p1.10.m6.1.1.2.2.cmml">N</mi><mtext id="S4.SS1.p1.10.m6.1.1.2.3" xref="S4.SS1.p1.10.m6.1.1.2.3a.cmml">active</mtext><mo id="S4.SS1.p1.10.m6.1.1.3" xref="S4.SS1.p1.10.m6.1.1.3.cmml">∗</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.10.m6.1b"><apply id="S4.SS1.p1.10.m6.1.1.cmml" xref="S4.SS1.p1.10.m6.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.10.m6.1.1.1.cmml" xref="S4.SS1.p1.10.m6.1.1">superscript</csymbol><apply id="S4.SS1.p1.10.m6.1.1.2.cmml" xref="S4.SS1.p1.10.m6.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.10.m6.1.1.2.1.cmml" xref="S4.SS1.p1.10.m6.1.1">subscript</csymbol><ci id="S4.SS1.p1.10.m6.1.1.2.2.cmml" xref="S4.SS1.p1.10.m6.1.1.2.2">𝑁</ci><ci id="S4.SS1.p1.10.m6.1.1.2.3a.cmml" xref="S4.SS1.p1.10.m6.1.1.2.3"><mtext id="S4.SS1.p1.10.m6.1.1.2.3.cmml" mathsize="70%" xref="S4.SS1.p1.10.m6.1.1.2.3">active</mtext></ci></apply><times id="S4.SS1.p1.10.m6.1.1.3.cmml" xref="S4.SS1.p1.10.m6.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.10.m6.1c">N_{\text{active}}^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.10.m6.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> is the optimal <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p1.11.m7.1"><semantics id="S4.SS1.p1.11.m7.1a"><msub id="S4.SS1.p1.11.m7.1.1" xref="S4.SS1.p1.11.m7.1.1.cmml"><mi id="S4.SS1.p1.11.m7.1.1.2" xref="S4.SS1.p1.11.m7.1.1.2.cmml">N</mi><mtext id="S4.SS1.p1.11.m7.1.1.3" xref="S4.SS1.p1.11.m7.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.11.m7.1b"><apply id="S4.SS1.p1.11.m7.1.1.cmml" xref="S4.SS1.p1.11.m7.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.11.m7.1.1.1.cmml" xref="S4.SS1.p1.11.m7.1.1">subscript</csymbol><ci id="S4.SS1.p1.11.m7.1.1.2.cmml" xref="S4.SS1.p1.11.m7.1.1.2">𝑁</ci><ci id="S4.SS1.p1.11.m7.1.1.3a.cmml" xref="S4.SS1.p1.11.m7.1.1.3"><mtext id="S4.SS1.p1.11.m7.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p1.11.m7.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.11.m7.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.11.m7.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="D^{*}" class="ltx_Math" display="inline" id="S4.SS1.p1.12.m8.1"><semantics id="S4.SS1.p1.12.m8.1a"><msup id="S4.SS1.p1.12.m8.1.1" xref="S4.SS1.p1.12.m8.1.1.cmml"><mi id="S4.SS1.p1.12.m8.1.1.2" xref="S4.SS1.p1.12.m8.1.1.2.cmml">D</mi><mo id="S4.SS1.p1.12.m8.1.1.3" xref="S4.SS1.p1.12.m8.1.1.3.cmml">∗</mo></msup><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.12.m8.1b"><apply id="S4.SS1.p1.12.m8.1.1.cmml" xref="S4.SS1.p1.12.m8.1.1"><csymbol cd="ambiguous" id="S4.SS1.p1.12.m8.1.1.1.cmml" xref="S4.SS1.p1.12.m8.1.1">superscript</csymbol><ci id="S4.SS1.p1.12.m8.1.1.2.cmml" xref="S4.SS1.p1.12.m8.1.1.2">𝐷</ci><times id="S4.SS1.p1.12.m8.1.1.3.cmml" xref="S4.SS1.p1.12.m8.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.12.m8.1c">D^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.12.m8.1d">italic_D start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> is the optimal number of training tokens, <math alttext="C" class="ltx_Math" display="inline" id="S4.SS1.p1.13.m9.1"><semantics id="S4.SS1.p1.13.m9.1a"><mi id="S4.SS1.p1.13.m9.1.1" xref="S4.SS1.p1.13.m9.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.13.m9.1b"><ci id="S4.SS1.p1.13.m9.1.1.cmml" xref="S4.SS1.p1.13.m9.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.13.m9.1c">C</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.13.m9.1d">italic_C</annotation></semantics></math> is the computational budget, and <math alttext="a,b" class="ltx_Math" display="inline" id="S4.SS1.p1.14.m10.2"><semantics id="S4.SS1.p1.14.m10.2a"><mrow id="S4.SS1.p1.14.m10.2.3.2" xref="S4.SS1.p1.14.m10.2.3.1.cmml"><mi id="S4.SS1.p1.14.m10.1.1" xref="S4.SS1.p1.14.m10.1.1.cmml">a</mi><mo id="S4.SS1.p1.14.m10.2.3.2.1" xref="S4.SS1.p1.14.m10.2.3.1.cmml">,</mo><mi id="S4.SS1.p1.14.m10.2.2" xref="S4.SS1.p1.14.m10.2.2.cmml">b</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.14.m10.2b"><list id="S4.SS1.p1.14.m10.2.3.1.cmml" xref="S4.SS1.p1.14.m10.2.3.2"><ci id="S4.SS1.p1.14.m10.1.1.cmml" xref="S4.SS1.p1.14.m10.1.1">𝑎</ci><ci id="S4.SS1.p1.14.m10.2.2.cmml" xref="S4.SS1.p1.14.m10.2.2">𝑏</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.14.m10.2c">a,b</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.14.m10.2d">italic_a , italic_b</annotation></semantics></math> are exponents to be determined.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1">In our experiments, we choose 4 computational budgets (1e18, 3e18, 6e18, and 3e19). For each budget, we train 16 models with different <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS1.p2.1.m1.1"><semantics id="S4.SS1.p2.1.m1.1a"><msub id="S4.SS1.p2.1.m1.1.1" xref="S4.SS1.p2.1.m1.1.1.cmml"><mi id="S4.SS1.p2.1.m1.1.1.2" xref="S4.SS1.p2.1.m1.1.1.2.cmml">N</mi><mtext id="S4.SS1.p2.1.m1.1.1.3" xref="S4.SS1.p2.1.m1.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p2.1.m1.1b"><apply id="S4.SS1.p2.1.m1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p2.1.m1.1.1.1.cmml" xref="S4.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS1.p2.1.m1.1.1.2.cmml" xref="S4.SS1.p2.1.m1.1.1.2">𝑁</ci><ci id="S4.SS1.p2.1.m1.1.1.3a.cmml" xref="S4.SS1.p2.1.m1.1.1.3"><mtext id="S4.SS1.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS1.p2.1.m1.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p2.1.m1.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p2.1.m1.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math>, ranging from 33.4M to 1.7B.
The plotted IsoFLOP profiles are shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.F1.sf1" title="In Figure 1 ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">1(a)</span></a>, where the parabolas decently fit the data points.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Parametric Loss Function Fitting</h3>
<div class="ltx_para" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.4">The second approach fits a single parametric function to all experimental data points (final validation loss, <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.1"><semantics id="S4.SS2.p1.1.m1.1a"><msub id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml"><mi id="S4.SS2.p1.1.m1.1.1.2" xref="S4.SS2.p1.1.m1.1.1.2.cmml">N</mi><mtext id="S4.SS2.p1.1.m1.1.1.3" xref="S4.SS2.p1.1.m1.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.1b"><apply id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.p1.1.m1.1.1.2">𝑁</ci><ci id="S4.SS2.p1.1.m1.1.1.3a.cmml" xref="S4.SS2.p1.1.m1.1.1.3"><mtext id="S4.SS2.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p1.1.m1.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math>, number of training tokens) collected from the IsoFLOP experiments.
Following <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib11" title="">11</a>]</cite>, we model the final validation loss <math alttext="\mathcal{L}_{\text{val}}" class="ltx_Math" display="inline" id="S4.SS2.p1.2.m2.1"><semantics id="S4.SS2.p1.2.m2.1a"><msub id="S4.SS2.p1.2.m2.1.1" xref="S4.SS2.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p1.2.m2.1.1.2" xref="S4.SS2.p1.2.m2.1.1.2.cmml">ℒ</mi><mtext id="S4.SS2.p1.2.m2.1.1.3" xref="S4.SS2.p1.2.m2.1.1.3a.cmml">val</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.2.m2.1b"><apply id="S4.SS2.p1.2.m2.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.p1.2.m2.1.1.2">ℒ</ci><ci id="S4.SS2.p1.2.m2.1.1.3a.cmml" xref="S4.SS2.p1.2.m2.1.1.3"><mtext id="S4.SS2.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p1.2.m2.1.1.3">val</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.2.m2.1c">\mathcal{L}_{\text{val}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.2.m2.1d">caligraphic_L start_POSTSUBSCRIPT val end_POSTSUBSCRIPT</annotation></semantics></math> as a function of <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS2.p1.3.m3.1"><semantics id="S4.SS2.p1.3.m3.1a"><msub id="S4.SS2.p1.3.m3.1.1" xref="S4.SS2.p1.3.m3.1.1.cmml"><mi id="S4.SS2.p1.3.m3.1.1.2" xref="S4.SS2.p1.3.m3.1.1.2.cmml">N</mi><mtext id="S4.SS2.p1.3.m3.1.1.3" xref="S4.SS2.p1.3.m3.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.3.m3.1b"><apply id="S4.SS2.p1.3.m3.1.1.cmml" xref="S4.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.3.m3.1.1.1.cmml" xref="S4.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.p1.3.m3.1.1.2.cmml" xref="S4.SS2.p1.3.m3.1.1.2">𝑁</ci><ci id="S4.SS2.p1.3.m3.1.1.3a.cmml" xref="S4.SS2.p1.3.m3.1.1.3"><mtext id="S4.SS2.p1.3.m3.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p1.3.m3.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.3.m3.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.3.m3.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="D" class="ltx_Math" display="inline" id="S4.SS2.p1.4.m4.1"><semantics id="S4.SS2.p1.4.m4.1a"><mi id="S4.SS2.p1.4.m4.1.1" xref="S4.SS2.p1.4.m4.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.4.m4.1b"><ci id="S4.SS2.p1.4.m4.1.1.cmml" xref="S4.SS2.p1.4.m4.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.4.m4.1c">D</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.4.m4.1d">italic_D</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{val}}(N_{\text{active}},D)=\frac{A}{(N_{\text{active}})^{%
\alpha}}+\frac{B}{D^{\beta}}+L_{0}" class="ltx_Math" display="block" id="S4.E7.m1.3"><semantics id="S4.E7.m1.3a"><mrow id="S4.E7.m1.3.3" xref="S4.E7.m1.3.3.cmml"><mrow id="S4.E7.m1.3.3.1" xref="S4.E7.m1.3.3.1.cmml"><msub id="S4.E7.m1.3.3.1.3" xref="S4.E7.m1.3.3.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E7.m1.3.3.1.3.2" xref="S4.E7.m1.3.3.1.3.2.cmml">ℒ</mi><mtext id="S4.E7.m1.3.3.1.3.3" xref="S4.E7.m1.3.3.1.3.3a.cmml">val</mtext></msub><mo id="S4.E7.m1.3.3.1.2" xref="S4.E7.m1.3.3.1.2.cmml">⁢</mo><mrow id="S4.E7.m1.3.3.1.1.1" xref="S4.E7.m1.3.3.1.1.2.cmml"><mo id="S4.E7.m1.3.3.1.1.1.2" stretchy="false" xref="S4.E7.m1.3.3.1.1.2.cmml">(</mo><msub id="S4.E7.m1.3.3.1.1.1.1" xref="S4.E7.m1.3.3.1.1.1.1.cmml"><mi id="S4.E7.m1.3.3.1.1.1.1.2" xref="S4.E7.m1.3.3.1.1.1.1.2.cmml">N</mi><mtext id="S4.E7.m1.3.3.1.1.1.1.3" xref="S4.E7.m1.3.3.1.1.1.1.3a.cmml">active</mtext></msub><mo id="S4.E7.m1.3.3.1.1.1.3" xref="S4.E7.m1.3.3.1.1.2.cmml">,</mo><mi id="S4.E7.m1.2.2" xref="S4.E7.m1.2.2.cmml">D</mi><mo id="S4.E7.m1.3.3.1.1.1.4" stretchy="false" xref="S4.E7.m1.3.3.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E7.m1.3.3.2" xref="S4.E7.m1.3.3.2.cmml">=</mo><mrow id="S4.E7.m1.3.3.3" xref="S4.E7.m1.3.3.3.cmml"><mfrac id="S4.E7.m1.1.1" xref="S4.E7.m1.1.1.cmml"><mi id="S4.E7.m1.1.1.3" xref="S4.E7.m1.1.1.3.cmml">A</mi><msup id="S4.E7.m1.1.1.1" xref="S4.E7.m1.1.1.1.cmml"><mrow id="S4.E7.m1.1.1.1.1.1" xref="S4.E7.m1.1.1.1.1.1.1.cmml"><mo id="S4.E7.m1.1.1.1.1.1.2" stretchy="false" xref="S4.E7.m1.1.1.1.1.1.1.cmml">(</mo><msub id="S4.E7.m1.1.1.1.1.1.1" xref="S4.E7.m1.1.1.1.1.1.1.cmml"><mi id="S4.E7.m1.1.1.1.1.1.1.2" xref="S4.E7.m1.1.1.1.1.1.1.2.cmml">N</mi><mtext id="S4.E7.m1.1.1.1.1.1.1.3" xref="S4.E7.m1.1.1.1.1.1.1.3a.cmml">active</mtext></msub><mo id="S4.E7.m1.1.1.1.1.1.3" stretchy="false" xref="S4.E7.m1.1.1.1.1.1.1.cmml">)</mo></mrow><mi id="S4.E7.m1.1.1.1.3" xref="S4.E7.m1.1.1.1.3.cmml">α</mi></msup></mfrac><mo id="S4.E7.m1.3.3.3.1" xref="S4.E7.m1.3.3.3.1.cmml">+</mo><mfrac id="S4.E7.m1.3.3.3.2" xref="S4.E7.m1.3.3.3.2.cmml"><mi id="S4.E7.m1.3.3.3.2.2" xref="S4.E7.m1.3.3.3.2.2.cmml">B</mi><msup id="S4.E7.m1.3.3.3.2.3" xref="S4.E7.m1.3.3.3.2.3.cmml"><mi id="S4.E7.m1.3.3.3.2.3.2" xref="S4.E7.m1.3.3.3.2.3.2.cmml">D</mi><mi id="S4.E7.m1.3.3.3.2.3.3" xref="S4.E7.m1.3.3.3.2.3.3.cmml">β</mi></msup></mfrac><mo id="S4.E7.m1.3.3.3.1a" xref="S4.E7.m1.3.3.3.1.cmml">+</mo><msub id="S4.E7.m1.3.3.3.3" xref="S4.E7.m1.3.3.3.3.cmml"><mi id="S4.E7.m1.3.3.3.3.2" xref="S4.E7.m1.3.3.3.3.2.cmml">L</mi><mn id="S4.E7.m1.3.3.3.3.3" xref="S4.E7.m1.3.3.3.3.3.cmml">0</mn></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E7.m1.3b"><apply id="S4.E7.m1.3.3.cmml" xref="S4.E7.m1.3.3"><eq id="S4.E7.m1.3.3.2.cmml" xref="S4.E7.m1.3.3.2"></eq><apply id="S4.E7.m1.3.3.1.cmml" xref="S4.E7.m1.3.3.1"><times id="S4.E7.m1.3.3.1.2.cmml" xref="S4.E7.m1.3.3.1.2"></times><apply id="S4.E7.m1.3.3.1.3.cmml" xref="S4.E7.m1.3.3.1.3"><csymbol cd="ambiguous" id="S4.E7.m1.3.3.1.3.1.cmml" xref="S4.E7.m1.3.3.1.3">subscript</csymbol><ci id="S4.E7.m1.3.3.1.3.2.cmml" xref="S4.E7.m1.3.3.1.3.2">ℒ</ci><ci id="S4.E7.m1.3.3.1.3.3a.cmml" xref="S4.E7.m1.3.3.1.3.3"><mtext id="S4.E7.m1.3.3.1.3.3.cmml" mathsize="70%" xref="S4.E7.m1.3.3.1.3.3">val</mtext></ci></apply><interval closure="open" id="S4.E7.m1.3.3.1.1.2.cmml" xref="S4.E7.m1.3.3.1.1.1"><apply id="S4.E7.m1.3.3.1.1.1.1.cmml" xref="S4.E7.m1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.3.3.1.1.1.1.1.cmml" xref="S4.E7.m1.3.3.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.3.3.1.1.1.1.2.cmml" xref="S4.E7.m1.3.3.1.1.1.1.2">𝑁</ci><ci id="S4.E7.m1.3.3.1.1.1.1.3a.cmml" xref="S4.E7.m1.3.3.1.1.1.1.3"><mtext id="S4.E7.m1.3.3.1.1.1.1.3.cmml" mathsize="70%" xref="S4.E7.m1.3.3.1.1.1.1.3">active</mtext></ci></apply><ci id="S4.E7.m1.2.2.cmml" xref="S4.E7.m1.2.2">𝐷</ci></interval></apply><apply id="S4.E7.m1.3.3.3.cmml" xref="S4.E7.m1.3.3.3"><plus id="S4.E7.m1.3.3.3.1.cmml" xref="S4.E7.m1.3.3.3.1"></plus><apply id="S4.E7.m1.1.1.cmml" xref="S4.E7.m1.1.1"><divide id="S4.E7.m1.1.1.2.cmml" xref="S4.E7.m1.1.1"></divide><ci id="S4.E7.m1.1.1.3.cmml" xref="S4.E7.m1.1.1.3">𝐴</ci><apply id="S4.E7.m1.1.1.1.cmml" xref="S4.E7.m1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.1.1.1.2.cmml" xref="S4.E7.m1.1.1.1">superscript</csymbol><apply id="S4.E7.m1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.1.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.1.1.1.1.1.1.2.cmml" xref="S4.E7.m1.1.1.1.1.1.1.2">𝑁</ci><ci id="S4.E7.m1.1.1.1.1.1.1.3a.cmml" xref="S4.E7.m1.1.1.1.1.1.1.3"><mtext id="S4.E7.m1.1.1.1.1.1.1.3.cmml" mathsize="70%" xref="S4.E7.m1.1.1.1.1.1.1.3">active</mtext></ci></apply><ci id="S4.E7.m1.1.1.1.3.cmml" xref="S4.E7.m1.1.1.1.3">𝛼</ci></apply></apply><apply id="S4.E7.m1.3.3.3.2.cmml" xref="S4.E7.m1.3.3.3.2"><divide id="S4.E7.m1.3.3.3.2.1.cmml" xref="S4.E7.m1.3.3.3.2"></divide><ci id="S4.E7.m1.3.3.3.2.2.cmml" xref="S4.E7.m1.3.3.3.2.2">𝐵</ci><apply id="S4.E7.m1.3.3.3.2.3.cmml" xref="S4.E7.m1.3.3.3.2.3"><csymbol cd="ambiguous" id="S4.E7.m1.3.3.3.2.3.1.cmml" xref="S4.E7.m1.3.3.3.2.3">superscript</csymbol><ci id="S4.E7.m1.3.3.3.2.3.2.cmml" xref="S4.E7.m1.3.3.3.2.3.2">𝐷</ci><ci id="S4.E7.m1.3.3.3.2.3.3.cmml" xref="S4.E7.m1.3.3.3.2.3.3">𝛽</ci></apply></apply><apply id="S4.E7.m1.3.3.3.3.cmml" xref="S4.E7.m1.3.3.3.3"><csymbol cd="ambiguous" id="S4.E7.m1.3.3.3.3.1.cmml" xref="S4.E7.m1.3.3.3.3">subscript</csymbol><ci id="S4.E7.m1.3.3.3.3.2.cmml" xref="S4.E7.m1.3.3.3.3.2">𝐿</ci><cn id="S4.E7.m1.3.3.3.3.3.cmml" type="integer" xref="S4.E7.m1.3.3.3.3.3">0</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E7.m1.3c">\mathcal{L}_{\text{val}}(N_{\text{active}},D)=\frac{A}{(N_{\text{active}})^{%
\alpha}}+\frac{B}{D^{\beta}}+L_{0}</annotation><annotation encoding="application/x-llamapun" id="S4.E7.m1.3d">caligraphic_L start_POSTSUBSCRIPT val end_POSTSUBSCRIPT ( italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT , italic_D ) = divide start_ARG italic_A end_ARG start_ARG ( italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT ) start_POSTSUPERSCRIPT italic_α end_POSTSUPERSCRIPT end_ARG + divide start_ARG italic_B end_ARG start_ARG italic_D start_POSTSUPERSCRIPT italic_β end_POSTSUPERSCRIPT end_ARG + italic_L start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS2.p1.6">where <math alttext="A,B,\alpha,\beta," class="ltx_Math" display="inline" id="S4.SS2.p1.5.m1.5"><semantics id="S4.SS2.p1.5.m1.5a"><mrow id="S4.SS2.p1.5.m1.5.5.1"><mrow id="S4.SS2.p1.5.m1.5.5.1.1.2" xref="S4.SS2.p1.5.m1.5.5.1.1.1.cmml"><mi id="S4.SS2.p1.5.m1.1.1" xref="S4.SS2.p1.5.m1.1.1.cmml">A</mi><mo id="S4.SS2.p1.5.m1.5.5.1.1.2.1" xref="S4.SS2.p1.5.m1.5.5.1.1.1.cmml">,</mo><mi id="S4.SS2.p1.5.m1.2.2" xref="S4.SS2.p1.5.m1.2.2.cmml">B</mi><mo id="S4.SS2.p1.5.m1.5.5.1.1.2.2" xref="S4.SS2.p1.5.m1.5.5.1.1.1.cmml">,</mo><mi id="S4.SS2.p1.5.m1.3.3" xref="S4.SS2.p1.5.m1.3.3.cmml">α</mi><mo id="S4.SS2.p1.5.m1.5.5.1.1.2.3" xref="S4.SS2.p1.5.m1.5.5.1.1.1.cmml">,</mo><mi id="S4.SS2.p1.5.m1.4.4" xref="S4.SS2.p1.5.m1.4.4.cmml">β</mi></mrow><mo id="S4.SS2.p1.5.m1.5.5.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.5.m1.5b"><list id="S4.SS2.p1.5.m1.5.5.1.1.1.cmml" xref="S4.SS2.p1.5.m1.5.5.1.1.2"><ci id="S4.SS2.p1.5.m1.1.1.cmml" xref="S4.SS2.p1.5.m1.1.1">𝐴</ci><ci id="S4.SS2.p1.5.m1.2.2.cmml" xref="S4.SS2.p1.5.m1.2.2">𝐵</ci><ci id="S4.SS2.p1.5.m1.3.3.cmml" xref="S4.SS2.p1.5.m1.3.3">𝛼</ci><ci id="S4.SS2.p1.5.m1.4.4.cmml" xref="S4.SS2.p1.5.m1.4.4">𝛽</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.5.m1.5c">A,B,\alpha,\beta,</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.5.m1.5d">italic_A , italic_B , italic_α , italic_β ,</annotation></semantics></math> and <math alttext="L_{0}" class="ltx_Math" display="inline" id="S4.SS2.p1.6.m2.1"><semantics id="S4.SS2.p1.6.m2.1a"><msub id="S4.SS2.p1.6.m2.1.1" xref="S4.SS2.p1.6.m2.1.1.cmml"><mi id="S4.SS2.p1.6.m2.1.1.2" xref="S4.SS2.p1.6.m2.1.1.2.cmml">L</mi><mn id="S4.SS2.p1.6.m2.1.1.3" xref="S4.SS2.p1.6.m2.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.6.m2.1b"><apply id="S4.SS2.p1.6.m2.1.1.cmml" xref="S4.SS2.p1.6.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.6.m2.1.1.1.cmml" xref="S4.SS2.p1.6.m2.1.1">subscript</csymbol><ci id="S4.SS2.p1.6.m2.1.1.2.cmml" xref="S4.SS2.p1.6.m2.1.1.2">𝐿</ci><cn id="S4.SS2.p1.6.m2.1.1.3.cmml" type="integer" xref="S4.SS2.p1.6.m2.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.6.m2.1c">L_{0}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.6.m2.1d">italic_L start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math> (an irreducible loss term) are parameters to be fitted from the experimental data.
To ensure the robustness of our fitted parametric loss function,
we account for potential local minima by employing a grid search over initial parameter values for the fitting algorithm.</p>
</div>
<div class="ltx_para" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.4">Furthermore, we utilize a Huber loss function with <math alttext="\delta=10^{-3}" class="ltx_Math" display="inline" id="S4.SS2.p2.1.m1.1"><semantics id="S4.SS2.p2.1.m1.1a"><mrow id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml"><mi id="S4.SS2.p2.1.m1.1.1.2" xref="S4.SS2.p2.1.m1.1.1.2.cmml">δ</mi><mo id="S4.SS2.p2.1.m1.1.1.1" xref="S4.SS2.p2.1.m1.1.1.1.cmml">=</mo><msup id="S4.SS2.p2.1.m1.1.1.3" xref="S4.SS2.p2.1.m1.1.1.3.cmml"><mn id="S4.SS2.p2.1.m1.1.1.3.2" xref="S4.SS2.p2.1.m1.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.p2.1.m1.1.1.3.3" xref="S4.SS2.p2.1.m1.1.1.3.3.cmml"><mo id="S4.SS2.p2.1.m1.1.1.3.3a" xref="S4.SS2.p2.1.m1.1.1.3.3.cmml">−</mo><mn id="S4.SS2.p2.1.m1.1.1.3.3.2" xref="S4.SS2.p2.1.m1.1.1.3.3.2.cmml">3</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><apply id="S4.SS2.p2.1.m1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1"><eq id="S4.SS2.p2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1.1"></eq><ci id="S4.SS2.p2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.1.m1.1.1.2">𝛿</ci><apply id="S4.SS2.p2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.3.1.cmml" xref="S4.SS2.p2.1.m1.1.1.3">superscript</csymbol><cn id="S4.SS2.p2.1.m1.1.1.3.2.cmml" type="integer" xref="S4.SS2.p2.1.m1.1.1.3.2">10</cn><apply id="S4.SS2.p2.1.m1.1.1.3.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3.3"><minus id="S4.SS2.p2.1.m1.1.1.3.3.1.cmml" xref="S4.SS2.p2.1.m1.1.1.3.3"></minus><cn id="S4.SS2.p2.1.m1.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.p2.1.m1.1.1.3.3.2">3</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">\delta=10^{-3}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.1.m1.1d">italic_δ = 10 start_POSTSUPERSCRIPT - 3 end_POSTSUPERSCRIPT</annotation></semantics></math> for the fitting.
The Huber loss is less sensitive to outliers in the experimental data compared to a standard mean squared error loss,
which is crucial for achieving generalized predictive performance when extrapolating to larger computational budgets.
As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.F1.sf2" title="In Figure 1 ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">1(b)</span></a>, the fitted parametric loss function precisely predicts loss values, demonstrating its effectiveness in capturing the underlying relationship between <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS2.p2.2.m2.1"><semantics id="S4.SS2.p2.2.m2.1a"><msub id="S4.SS2.p2.2.m2.1.1" xref="S4.SS2.p2.2.m2.1.1.cmml"><mi id="S4.SS2.p2.2.m2.1.1.2" xref="S4.SS2.p2.2.m2.1.1.2.cmml">N</mi><mtext id="S4.SS2.p2.2.m2.1.1.3" xref="S4.SS2.p2.2.m2.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.2.m2.1b"><apply id="S4.SS2.p2.2.m2.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.2.m2.1.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.p2.2.m2.1.1.2.cmml" xref="S4.SS2.p2.2.m2.1.1.2">𝑁</ci><ci id="S4.SS2.p2.2.m2.1.1.3a.cmml" xref="S4.SS2.p2.2.m2.1.1.3"><mtext id="S4.SS2.p2.2.m2.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p2.2.m2.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.2.m2.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.2.m2.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="D" class="ltx_Math" display="inline" id="S4.SS2.p2.3.m3.1"><semantics id="S4.SS2.p2.3.m3.1a"><mi id="S4.SS2.p2.3.m3.1.1" xref="S4.SS2.p2.3.m3.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.3.m3.1b"><ci id="S4.SS2.p2.3.m3.1.1.cmml" xref="S4.SS2.p2.3.m3.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.3.m3.1c">D</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.3.m3.1d">italic_D</annotation></semantics></math>, and <math alttext="\mathcal{L}_{\text{val}}" class="ltx_Math" display="inline" id="S4.SS2.p2.4.m4.1"><semantics id="S4.SS2.p2.4.m4.1a"><msub id="S4.SS2.p2.4.m4.1.1" xref="S4.SS2.p2.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p2.4.m4.1.1.2" xref="S4.SS2.p2.4.m4.1.1.2.cmml">ℒ</mi><mtext id="S4.SS2.p2.4.m4.1.1.3" xref="S4.SS2.p2.4.m4.1.1.3a.cmml">val</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.4.m4.1b"><apply id="S4.SS2.p2.4.m4.1.1.cmml" xref="S4.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.4.m4.1.1.1.cmml" xref="S4.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.p2.4.m4.1.1.2.cmml" xref="S4.SS2.p2.4.m4.1.1.2">ℒ</ci><ci id="S4.SS2.p2.4.m4.1.1.3a.cmml" xref="S4.SS2.p2.4.m4.1.1.3"><mtext id="S4.SS2.p2.4.m4.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p2.4.m4.1.1.3">val</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.4.m4.1c">\mathcal{L}_{\text{val}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.4.m4.1d">caligraphic_L start_POSTSUBSCRIPT val end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S4.SS2.p3">
<p class="ltx_p" id="S4.SS2.p3.8">Once this parametric loss function is fitted, we can use it to predict the optimal <math alttext="N_{\text{active}}" class="ltx_Math" display="inline" id="S4.SS2.p3.1.m1.1"><semantics id="S4.SS2.p3.1.m1.1a"><msub id="S4.SS2.p3.1.m1.1.1" xref="S4.SS2.p3.1.m1.1.1.cmml"><mi id="S4.SS2.p3.1.m1.1.1.2" xref="S4.SS2.p3.1.m1.1.1.2.cmml">N</mi><mtext id="S4.SS2.p3.1.m1.1.1.3" xref="S4.SS2.p3.1.m1.1.1.3a.cmml">active</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.1.m1.1b"><apply id="S4.SS2.p3.1.m1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.1.m1.1.1.1.cmml" xref="S4.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.p3.1.m1.1.1.2.cmml" xref="S4.SS2.p3.1.m1.1.1.2">𝑁</ci><ci id="S4.SS2.p3.1.m1.1.1.3a.cmml" xref="S4.SS2.p3.1.m1.1.1.3"><mtext id="S4.SS2.p3.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p3.1.m1.1.1.3">active</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.1.m1.1c">N_{\text{active}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.1.m1.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT</annotation></semantics></math> and training tokens <math alttext="D" class="ltx_Math" display="inline" id="S4.SS2.p3.2.m2.1"><semantics id="S4.SS2.p3.2.m2.1a"><mi id="S4.SS2.p3.2.m2.1.1" xref="S4.SS2.p3.2.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.2.m2.1b"><ci id="S4.SS2.p3.2.m2.1.1.cmml" xref="S4.SS2.p3.2.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.2.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.2.m2.1d">italic_D</annotation></semantics></math> for any given computational budget <math alttext="C" class="ltx_Math" display="inline" id="S4.SS2.p3.3.m3.1"><semantics id="S4.SS2.p3.3.m3.1a"><mi id="S4.SS2.p3.3.m3.1.1" xref="S4.SS2.p3.3.m3.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.3.m3.1b"><ci id="S4.SS2.p3.3.m3.1.1.cmml" xref="S4.SS2.p3.3.m3.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.3.m3.1c">C</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.3.m3.1d">italic_C</annotation></semantics></math>.
By minimizing <math alttext="\mathcal{L}_{\text{val}}(N_{\text{active}},D)" class="ltx_Math" display="inline" id="S4.SS2.p3.4.m4.2"><semantics id="S4.SS2.p3.4.m4.2a"><mrow id="S4.SS2.p3.4.m4.2.2" xref="S4.SS2.p3.4.m4.2.2.cmml"><msub id="S4.SS2.p3.4.m4.2.2.3" xref="S4.SS2.p3.4.m4.2.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.SS2.p3.4.m4.2.2.3.2" xref="S4.SS2.p3.4.m4.2.2.3.2.cmml">ℒ</mi><mtext id="S4.SS2.p3.4.m4.2.2.3.3" xref="S4.SS2.p3.4.m4.2.2.3.3a.cmml">val</mtext></msub><mo id="S4.SS2.p3.4.m4.2.2.2" xref="S4.SS2.p3.4.m4.2.2.2.cmml">⁢</mo><mrow id="S4.SS2.p3.4.m4.2.2.1.1" xref="S4.SS2.p3.4.m4.2.2.1.2.cmml"><mo id="S4.SS2.p3.4.m4.2.2.1.1.2" stretchy="false" xref="S4.SS2.p3.4.m4.2.2.1.2.cmml">(</mo><msub id="S4.SS2.p3.4.m4.2.2.1.1.1" xref="S4.SS2.p3.4.m4.2.2.1.1.1.cmml"><mi id="S4.SS2.p3.4.m4.2.2.1.1.1.2" xref="S4.SS2.p3.4.m4.2.2.1.1.1.2.cmml">N</mi><mtext id="S4.SS2.p3.4.m4.2.2.1.1.1.3" xref="S4.SS2.p3.4.m4.2.2.1.1.1.3a.cmml">active</mtext></msub><mo id="S4.SS2.p3.4.m4.2.2.1.1.3" xref="S4.SS2.p3.4.m4.2.2.1.2.cmml">,</mo><mi id="S4.SS2.p3.4.m4.1.1" xref="S4.SS2.p3.4.m4.1.1.cmml">D</mi><mo id="S4.SS2.p3.4.m4.2.2.1.1.4" stretchy="false" xref="S4.SS2.p3.4.m4.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.4.m4.2b"><apply id="S4.SS2.p3.4.m4.2.2.cmml" xref="S4.SS2.p3.4.m4.2.2"><times id="S4.SS2.p3.4.m4.2.2.2.cmml" xref="S4.SS2.p3.4.m4.2.2.2"></times><apply id="S4.SS2.p3.4.m4.2.2.3.cmml" xref="S4.SS2.p3.4.m4.2.2.3"><csymbol cd="ambiguous" id="S4.SS2.p3.4.m4.2.2.3.1.cmml" xref="S4.SS2.p3.4.m4.2.2.3">subscript</csymbol><ci id="S4.SS2.p3.4.m4.2.2.3.2.cmml" xref="S4.SS2.p3.4.m4.2.2.3.2">ℒ</ci><ci id="S4.SS2.p3.4.m4.2.2.3.3a.cmml" xref="S4.SS2.p3.4.m4.2.2.3.3"><mtext id="S4.SS2.p3.4.m4.2.2.3.3.cmml" mathsize="70%" xref="S4.SS2.p3.4.m4.2.2.3.3">val</mtext></ci></apply><interval closure="open" id="S4.SS2.p3.4.m4.2.2.1.2.cmml" xref="S4.SS2.p3.4.m4.2.2.1.1"><apply id="S4.SS2.p3.4.m4.2.2.1.1.1.cmml" xref="S4.SS2.p3.4.m4.2.2.1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p3.4.m4.2.2.1.1.1.1.cmml" xref="S4.SS2.p3.4.m4.2.2.1.1.1">subscript</csymbol><ci id="S4.SS2.p3.4.m4.2.2.1.1.1.2.cmml" xref="S4.SS2.p3.4.m4.2.2.1.1.1.2">𝑁</ci><ci id="S4.SS2.p3.4.m4.2.2.1.1.1.3a.cmml" xref="S4.SS2.p3.4.m4.2.2.1.1.1.3"><mtext id="S4.SS2.p3.4.m4.2.2.1.1.1.3.cmml" mathsize="70%" xref="S4.SS2.p3.4.m4.2.2.1.1.1.3">active</mtext></ci></apply><ci id="S4.SS2.p3.4.m4.1.1.cmml" xref="S4.SS2.p3.4.m4.1.1">𝐷</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.4.m4.2c">\mathcal{L}_{\text{val}}(N_{\text{active}},D)</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.4.m4.2d">caligraphic_L start_POSTSUBSCRIPT val end_POSTSUBSCRIPT ( italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT , italic_D )</annotation></semantics></math> subject to the constraint <math alttext="C=\kappa N_{\text{active}}D" class="ltx_Math" display="inline" id="S4.SS2.p3.5.m5.1"><semantics id="S4.SS2.p3.5.m5.1a"><mrow id="S4.SS2.p3.5.m5.1.1" xref="S4.SS2.p3.5.m5.1.1.cmml"><mi id="S4.SS2.p3.5.m5.1.1.2" xref="S4.SS2.p3.5.m5.1.1.2.cmml">C</mi><mo id="S4.SS2.p3.5.m5.1.1.1" xref="S4.SS2.p3.5.m5.1.1.1.cmml">=</mo><mrow id="S4.SS2.p3.5.m5.1.1.3" xref="S4.SS2.p3.5.m5.1.1.3.cmml"><mi id="S4.SS2.p3.5.m5.1.1.3.2" xref="S4.SS2.p3.5.m5.1.1.3.2.cmml">κ</mi><mo id="S4.SS2.p3.5.m5.1.1.3.1" xref="S4.SS2.p3.5.m5.1.1.3.1.cmml">⁢</mo><msub id="S4.SS2.p3.5.m5.1.1.3.3" xref="S4.SS2.p3.5.m5.1.1.3.3.cmml"><mi id="S4.SS2.p3.5.m5.1.1.3.3.2" xref="S4.SS2.p3.5.m5.1.1.3.3.2.cmml">N</mi><mtext id="S4.SS2.p3.5.m5.1.1.3.3.3" xref="S4.SS2.p3.5.m5.1.1.3.3.3a.cmml">active</mtext></msub><mo id="S4.SS2.p3.5.m5.1.1.3.1a" xref="S4.SS2.p3.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S4.SS2.p3.5.m5.1.1.3.4" xref="S4.SS2.p3.5.m5.1.1.3.4.cmml">D</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.5.m5.1b"><apply id="S4.SS2.p3.5.m5.1.1.cmml" xref="S4.SS2.p3.5.m5.1.1"><eq id="S4.SS2.p3.5.m5.1.1.1.cmml" xref="S4.SS2.p3.5.m5.1.1.1"></eq><ci id="S4.SS2.p3.5.m5.1.1.2.cmml" xref="S4.SS2.p3.5.m5.1.1.2">𝐶</ci><apply id="S4.SS2.p3.5.m5.1.1.3.cmml" xref="S4.SS2.p3.5.m5.1.1.3"><times id="S4.SS2.p3.5.m5.1.1.3.1.cmml" xref="S4.SS2.p3.5.m5.1.1.3.1"></times><ci id="S4.SS2.p3.5.m5.1.1.3.2.cmml" xref="S4.SS2.p3.5.m5.1.1.3.2">𝜅</ci><apply id="S4.SS2.p3.5.m5.1.1.3.3.cmml" xref="S4.SS2.p3.5.m5.1.1.3.3"><csymbol cd="ambiguous" id="S4.SS2.p3.5.m5.1.1.3.3.1.cmml" xref="S4.SS2.p3.5.m5.1.1.3.3">subscript</csymbol><ci id="S4.SS2.p3.5.m5.1.1.3.3.2.cmml" xref="S4.SS2.p3.5.m5.1.1.3.3.2">𝑁</ci><ci id="S4.SS2.p3.5.m5.1.1.3.3.3a.cmml" xref="S4.SS2.p3.5.m5.1.1.3.3.3"><mtext id="S4.SS2.p3.5.m5.1.1.3.3.3.cmml" mathsize="70%" xref="S4.SS2.p3.5.m5.1.1.3.3.3">active</mtext></ci></apply><ci id="S4.SS2.p3.5.m5.1.1.3.4.cmml" xref="S4.SS2.p3.5.m5.1.1.3.4">𝐷</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.5.m5.1c">C=\kappa N_{\text{active}}D</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.5.m5.1d">italic_C = italic_κ italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT italic_D</annotation></semantics></math>, we can derive the optimal <math alttext="N_{\text{active}}^{*}(C)" class="ltx_Math" display="inline" id="S4.SS2.p3.6.m6.1"><semantics id="S4.SS2.p3.6.m6.1a"><mrow id="S4.SS2.p3.6.m6.1.2" xref="S4.SS2.p3.6.m6.1.2.cmml"><msubsup id="S4.SS2.p3.6.m6.1.2.2" xref="S4.SS2.p3.6.m6.1.2.2.cmml"><mi id="S4.SS2.p3.6.m6.1.2.2.2.2" xref="S4.SS2.p3.6.m6.1.2.2.2.2.cmml">N</mi><mtext id="S4.SS2.p3.6.m6.1.2.2.2.3" xref="S4.SS2.p3.6.m6.1.2.2.2.3a.cmml">active</mtext><mo id="S4.SS2.p3.6.m6.1.2.2.3" xref="S4.SS2.p3.6.m6.1.2.2.3.cmml">∗</mo></msubsup><mo id="S4.SS2.p3.6.m6.1.2.1" xref="S4.SS2.p3.6.m6.1.2.1.cmml">⁢</mo><mrow id="S4.SS2.p3.6.m6.1.2.3.2" xref="S4.SS2.p3.6.m6.1.2.cmml"><mo id="S4.SS2.p3.6.m6.1.2.3.2.1" stretchy="false" xref="S4.SS2.p3.6.m6.1.2.cmml">(</mo><mi id="S4.SS2.p3.6.m6.1.1" xref="S4.SS2.p3.6.m6.1.1.cmml">C</mi><mo id="S4.SS2.p3.6.m6.1.2.3.2.2" stretchy="false" xref="S4.SS2.p3.6.m6.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.6.m6.1b"><apply id="S4.SS2.p3.6.m6.1.2.cmml" xref="S4.SS2.p3.6.m6.1.2"><times id="S4.SS2.p3.6.m6.1.2.1.cmml" xref="S4.SS2.p3.6.m6.1.2.1"></times><apply id="S4.SS2.p3.6.m6.1.2.2.cmml" xref="S4.SS2.p3.6.m6.1.2.2"><csymbol cd="ambiguous" id="S4.SS2.p3.6.m6.1.2.2.1.cmml" xref="S4.SS2.p3.6.m6.1.2.2">superscript</csymbol><apply id="S4.SS2.p3.6.m6.1.2.2.2.cmml" xref="S4.SS2.p3.6.m6.1.2.2"><csymbol cd="ambiguous" id="S4.SS2.p3.6.m6.1.2.2.2.1.cmml" xref="S4.SS2.p3.6.m6.1.2.2">subscript</csymbol><ci id="S4.SS2.p3.6.m6.1.2.2.2.2.cmml" xref="S4.SS2.p3.6.m6.1.2.2.2.2">𝑁</ci><ci id="S4.SS2.p3.6.m6.1.2.2.2.3a.cmml" xref="S4.SS2.p3.6.m6.1.2.2.2.3"><mtext id="S4.SS2.p3.6.m6.1.2.2.2.3.cmml" mathsize="70%" xref="S4.SS2.p3.6.m6.1.2.2.2.3">active</mtext></ci></apply><times id="S4.SS2.p3.6.m6.1.2.2.3.cmml" xref="S4.SS2.p3.6.m6.1.2.2.3"></times></apply><ci id="S4.SS2.p3.6.m6.1.1.cmml" xref="S4.SS2.p3.6.m6.1.1">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.6.m6.1c">N_{\text{active}}^{*}(C)</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.6.m6.1d">italic_N start_POSTSUBSCRIPT active end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ( italic_C )</annotation></semantics></math> and <math alttext="D^{*}(C)" class="ltx_Math" display="inline" id="S4.SS2.p3.7.m7.1"><semantics id="S4.SS2.p3.7.m7.1a"><mrow id="S4.SS2.p3.7.m7.1.2" xref="S4.SS2.p3.7.m7.1.2.cmml"><msup id="S4.SS2.p3.7.m7.1.2.2" xref="S4.SS2.p3.7.m7.1.2.2.cmml"><mi id="S4.SS2.p3.7.m7.1.2.2.2" xref="S4.SS2.p3.7.m7.1.2.2.2.cmml">D</mi><mo id="S4.SS2.p3.7.m7.1.2.2.3" xref="S4.SS2.p3.7.m7.1.2.2.3.cmml">∗</mo></msup><mo id="S4.SS2.p3.7.m7.1.2.1" xref="S4.SS2.p3.7.m7.1.2.1.cmml">⁢</mo><mrow id="S4.SS2.p3.7.m7.1.2.3.2" xref="S4.SS2.p3.7.m7.1.2.cmml"><mo id="S4.SS2.p3.7.m7.1.2.3.2.1" stretchy="false" xref="S4.SS2.p3.7.m7.1.2.cmml">(</mo><mi id="S4.SS2.p3.7.m7.1.1" xref="S4.SS2.p3.7.m7.1.1.cmml">C</mi><mo id="S4.SS2.p3.7.m7.1.2.3.2.2" stretchy="false" xref="S4.SS2.p3.7.m7.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.7.m7.1b"><apply id="S4.SS2.p3.7.m7.1.2.cmml" xref="S4.SS2.p3.7.m7.1.2"><times id="S4.SS2.p3.7.m7.1.2.1.cmml" xref="S4.SS2.p3.7.m7.1.2.1"></times><apply id="S4.SS2.p3.7.m7.1.2.2.cmml" xref="S4.SS2.p3.7.m7.1.2.2"><csymbol cd="ambiguous" id="S4.SS2.p3.7.m7.1.2.2.1.cmml" xref="S4.SS2.p3.7.m7.1.2.2">superscript</csymbol><ci id="S4.SS2.p3.7.m7.1.2.2.2.cmml" xref="S4.SS2.p3.7.m7.1.2.2.2">𝐷</ci><times id="S4.SS2.p3.7.m7.1.2.2.3.cmml" xref="S4.SS2.p3.7.m7.1.2.2.3"></times></apply><ci id="S4.SS2.p3.7.m7.1.1.cmml" xref="S4.SS2.p3.7.m7.1.1">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.7.m7.1c">D^{*}(C)</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.7.m7.1d">italic_D start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ( italic_C )</annotation></semantics></math>. Similar to the IsoFLOP approach, we can then fit power laws to these derived optimal values as a function of <math alttext="C" class="ltx_Math" display="inline" id="S4.SS2.p3.8.m8.1"><semantics id="S4.SS2.p3.8.m8.1a"><mi id="S4.SS2.p3.8.m8.1.1" xref="S4.SS2.p3.8.m8.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.p3.8.m8.1b"><ci id="S4.SS2.p3.8.m8.1.1.cmml" xref="S4.SS2.p3.8.m8.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p3.8.m8.1c">C</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p3.8.m8.1d">italic_C</annotation></semantics></math>.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>FLAME-MoE Model Family</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1">We present our fitted scaling law in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.F1.sf3" title="In Figure 1 ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">1(c)</span></a> and Table <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A0.T5" title="Table 5 ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5</span></a>,
where the results from both the IsoFLOP and parametric loss approaches closely align, demonstrating the robustness and consistency of our experimental methodology.
The generalization ability of our scaling law is also confirmed in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.F1.sf4" title="In Figure 1 ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">1(d)</span></a>,
where we observe a strong correlation (Spearman=0.89) between the validation loss and the performance on a representative downstream task, HellaSwag <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib38" title="">38</a>]</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS3.p2">
<p class="ltx_p" id="S4.SS3.p2.1">We choose three additional #FLOPs from DCLM (2e19, 8e19, and 2.4e20) and apply our fitted scaling law to
predict the optimal number of parameters under these #FLOPs.
The resulting compute-optimal models are FLAME-MoE-290M-1.3B, 721M-3.8B, and 1.7B-10.3B, where the first number denotes active parameters, and the second denotes total parameters.
We then combine these three with the 4 compute-optimal models from our IsoFLOP experiments (FLAME-MoE-38M-100M, 98M-349M, 115M-459M, and 419M-2.2B) to form FLAME-MoE model family.
The detailed configurations for each model scale within the FLAME-MoE family are presented in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.T2" title="Table 2 ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T3.9.1.1" style="font-size:90%;">Table 3</span>: </span><span class="ltx_text" id="S4.T3.10.2" style="font-size:90%;">Performance of FLAME-MoE on downstream tasks across different compute budgets. 1: DCLM 400M-1x; 2: DCLM 400M-4x; 3: DCLM 1B-1x. The other 4 #FLOPs are what we used in our scaling law experiments. We report accuracy for each task. Best performances are marked <span class="ltx_text ltx_font_bold" id="S4.T3.10.2.1">bold</span>.
</span></figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T3.6" style="width:433.6pt;height:225.2pt;vertical-align:-0.8pt;"><span class="ltx_transformed_inner" style="transform:translate(-44.0pt,22.8pt) scale(0.831241193862257,0.831241193862257) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T3.6.6">
<tr class="ltx_tr" id="S4.T3.6.6.7">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="S4.T3.6.6.7.1"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.1.1">Model</span></td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="S4.T3.6.6.7.2"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.2.1">#FLOPs</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.3.1">ARC-E</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.4.1">ARC-C</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.5.1">OBQA</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.6.1">HellaSwag</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.7.1">PIQA</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.8.1">WinoGrande</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.6.6.7.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.7.9.1">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.8">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.8.1">Dense-77M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.8.2">1.0e18</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.3">0.3266</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.4">0.2193</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.8.5.1">0.2460</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.8.6.1">0.2588</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.7">0.5582</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.8">0.4949</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.8.9">0.3506</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.9">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.9.1">FLAME-MoE-38M-100M</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.9.2">1.0e18</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.3.1">0.3607</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.4.1">0.2235</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.5.1">0.2460</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.6">0.2582</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.7.1">0.5615</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.8.1">0.4949</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.9.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.9.9.1">0.3575</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.10">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.10.1">Dense-77M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.10.2">3.0e18</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.3">0.3754</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.4">0.2065</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.5">0.2440</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.6">0.2632</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.7">0.5832</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.8">0.5043</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.10.9">0.3628</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.11">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.11.1">FLAME-MoE-98M-349M</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.11.2">3.0e18</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.3.1">0.4217</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.4.1">0.2150</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.5.1">0.2660</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.6.1">0.2790</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.7.1">0.6137</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.8.1">0.5241</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.11.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.11.9.1">0.3866</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.12">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.12.1">Dense-191M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.12.2">6.0e18</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.3">0.4318</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.4">0.2099</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.12.5.1">0.2780</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.6">0.2769</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.7">0.6023</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.8">0.4917</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.12.9">0.3818</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.13">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.13.1">FLAME-MoE-115M-459M</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.13.2">6.0e18</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.3.1">0.4651</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.4.1">0.2406</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.5">0.2700</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.6.1">0.3103</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.7.1">0.6240</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.8.1">0.5201</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.13.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.13.9.1">0.4050</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.1.1.1.2">Dense-411M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.1.1.1.1">2.0e19<sup class="ltx_sup" id="S4.T3.1.1.1.1.1">1</sup>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.3">0.4802</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.4">0.2415</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.5">0.2940</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.6">0.3237</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.7">0.6398</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.8"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.8.1">0.5130</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.1.1.9">0.4154</td>
</tr>
<tr class="ltx_tr" id="S4.T3.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.2.2.2.2">FLAME-MoE-290M-1.3B</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.2.2.2.1">2.0e19<sup class="ltx_sup" id="S4.T3.2.2.2.1.1">1</sup>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.3"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.3.1">0.5198</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.4"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.4.1">0.2474</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.5"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.5.1">0.3020</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.6"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.6.1">0.3567</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.7"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.7.1">0.6676</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.8">0.5036</td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2.9"><span class="ltx_text ltx_font_bold" id="S4.T3.2.2.2.9.1">0.4329</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.14">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.14.1">Dense-411M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.6.6.14.2">3.0e19</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.3">0.5046</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.4">0.2568</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.5">0.2940</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.6">0.3353</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.7">0.6387</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.14.8.1">0.5099</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.6.6.14.9">0.4232</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.15">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.15.1">FLAME-MoE-419M-2.2B</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.6.6.15.2">3.0e19</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.3.1">0.5476</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.4.1">0.2841</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.5.1">0.3100</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.6.1">0.3936</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.7.1">0.6806</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.8">0.5059</td>
<td class="ltx_td ltx_align_center" id="S4.T3.6.6.15.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.15.9.1">0.4536</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.3.3.3">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.3.3.3.2">Dense-411M</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.3.3.3.1">8.0e19<sup class="ltx_sup" id="S4.T3.3.3.3.1.1">2</sup>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.3">0.5484</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.4">0.2568</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.5">0.2940</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.6">0.3776</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.7">0.6654</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.8"><span class="ltx_text ltx_font_bold" id="S4.T3.3.3.3.8.1">0.5257</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.3.3.3.9">0.4447</td>
</tr>
<tr class="ltx_tr" id="S4.T3.4.4.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.4.4.4.2">FLAME-MoE-721M-3.8B</td>
<td class="ltx_td ltx_align_left ltx_border_r" id="S4.T3.4.4.4.1">8.0e19<sup class="ltx_sup" id="S4.T3.4.4.4.1.1">2</sup>
</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.3"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.3.1">0.5955</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.4"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.4.1">0.2884</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.5"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.5.1">0.3200</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.6"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.6.1">0.4536</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.7"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.7.1">0.6986</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.8">0.5130</td>
<td class="ltx_td ltx_align_center" id="S4.T3.4.4.4.9"><span class="ltx_text ltx_font_bold" id="S4.T3.4.4.4.9.1">0.4782</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.5.5.5">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.5.5.5.2">Dense-1.4B</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S4.T3.5.5.5.1">2.4e20<sup class="ltx_sup" id="S4.T3.5.5.5.1.1">3</sup>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.3">0.6035</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.4">0.3020</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.5">0.3360</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.6">0.4653</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.7">0.6844</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.8">0.5178</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.5.5.5.9">0.4848</td>
</tr>
<tr class="ltx_tr" id="S4.T3.6.6.6">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S4.T3.6.6.6.2">FLAME-MoE-1.7B-10.3B</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r" id="S4.T3.6.6.6.1">2.4e20<sup class="ltx_sup" id="S4.T3.6.6.6.1.1">3</sup>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.3"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.3.1">0.6469</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.4"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.4.1">0.3174</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.5"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.5.1">0.3500</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.6"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.6.1">0.5304</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.7"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.7.1">0.7236</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.8"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.8.1">0.5359</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.6.6.6.9"><span class="ltx_text ltx_font_bold" id="S4.T3.6.6.6.9.1">0.5174</span></td>
</tr>
</table>
</span></div>
</figure>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Pretraining FLAME-MoE</h2>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this section, we present the setup (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS1" title="5.1 Experimental Setup ‣ 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5.1</span></a>), evaluation results (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS2" title="5.2 Evaluation Results ‣ 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5.2</span></a>), and throughput (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.SS3" title="5.3 Training Throughput ‣ 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5.3</span></a>) of our pretraining experiments.</p>
</div>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Experimental Setup</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">Our pretraining implementations are based on Megatron-LM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib31" title="">31</a>]</cite>,
a highly optimized and integrated platform designed for large-scale training.
We compare the performance of FLAME-MoE with dense baseline models of similar sizes, which are configured following the same architectures used in Pythia <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib3" title="">3</a>]</cite> (Dense-77M and Dense-191M) or DCLM <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib19" title="">19</a>]</cite> (Dense-411M and Dense-1.4B).
We train these baselines ourselves using the same codebase as FLAME-MoE to facilitate a fair comparison.
For training, we use the Adam optimizer <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib16" title="">16</a>]</cite> with a maximum learning rate of 3e-4, a global batch size of 1024, and a sequence length of 2048.
The learning rate is configured using a WSD scheduler <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib12" title="">12</a>]</cite>, with a warmup ratio of 0.01 and a decay ratio of 0.1 relative to the total number of training steps.
We use 32 NVIDIA H100 GPUs for training and store 10 checkpoints across evenly splitted training steps to study its performance trends.
We provide a summary of all training configurations in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A0.T5" title="Table 5 ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5</span></a>.</p>
</div>
<div class="ltx_para" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1">For evaluation, we adapt lm-evaluation-harness <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib8" title="">8</a>]</cite>
to work with models trained using Megatron-LM.
We assess the performance of FLAME-MoE on 6 downstream tasks from OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite><span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>We replace MMLU <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib10" title="">10</a>]</cite> with OBQA as the MMLU performance of small models is near random guess.</span></span></span>,
including ARC-E <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib6" title="">6</a>]</cite>, ARC-C <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib6" title="">6</a>]</cite>, OBQA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib24" title="">24</a>]</cite>, HellaSwag <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib38" title="">38</a>]</cite>, PIQA <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib4" title="">4</a>]</cite>, and WinoGrande <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib28" title="">28</a>]</cite>.
Following DCLM, we use 10-shot evaluation for ARC-E, ARC-C, HellaSwag and PIQA, and 0-shot for OBQA and WinoGrande.
The evaluation metric for all tasks is accuracy.</p>
</div>
<figure class="ltx_figure" id="S5.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F2.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="697" id="S5.F2.sf1.g1" src="x5.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F2.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="S5.F2.sf1.3.2" style="font-size:90%;">400M-1x (2.0e19 #FLOPs).</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F2.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="697" id="S5.F2.sf2.g1" src="x6.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F2.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="S5.F2.sf2.3.2" style="font-size:90%;">400M-4x (8.0e19 #FLOPs).</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F2.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="697" id="S5.F2.sf3.g1" src="x7.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F2.sf3.2.1.1" style="font-size:90%;">(c)</span> </span><span class="ltx_text" id="S5.F2.sf3.3.2" style="font-size:90%;">1B-1x (2.4e20 #FLOPs).</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F2.2.1.1" style="font-size:90%;">Figure 2</span>: </span><span class="ltx_text" id="S5.F2.3.2" style="font-size:90%;">Downstream comparison between FLAME-MoE and dense models during pretraining.</span></figcaption>
</figure>
<figure class="ltx_figure" id="S5.F3">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F3.1"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="829" id="S5.F3.1.g1" src="x8.png" width="831"/>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F3.2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="829" id="S5.F3.2.g1" src="x9.png" width="830"/>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F3.3"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="827" id="S5.F3.3.g1" src="x10.png" width="830"/>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_4">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F3.4"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="827" id="S5.F3.4.g1" src="x11.png" width="830"/>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S5.F3.6.1.1" style="font-size:90%;">Figure 3</span>: </span><span class="ltx_text" id="S5.F3.7.2" style="font-size:90%;"> Training efficiency of FLAME-MoE-1.7B-10.3B under different parallelization strategies (EP = Expert Parallel, PP = Pipeline Parallel). Dense-1.4B is also included here as a comparison.</span></figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Evaluation Results</h3>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.1">We present the evaluation results of FLAME-MoE in Table <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S4.T3" title="Table 3 ‣ 4.3 FLAME-MoE Model Family ‣ 4 Scaling Law Study for FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">3</span></a>.
FLAME-MoE significantly outperforms the
dense counterparts with the same pretraining FLOPs on almost every task,
demonstrating the effectiveness of our scaling law and the superiority of MoE models.
The advantages of FLAME-MoE are more pronounced at larger scales, with more than
3 points of average accuracy improvements over dense baselines under both 8.0e19 and 2.4e20 budgets.</p>
</div>
<div class="ltx_para" id="S5.SS2.p2">
<p class="ltx_p" id="S5.SS2.p2.1">We further illustrate the scaling curves of FLAME-MoE and dense models in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.F2" title="Figure 2 ‣ 5.1 Experimental Setup ‣ 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">2</span></a>.
We observe that the performance gap between FLAME-MoE and dense models
continuously improves with the increase of pretraining FLOPs,
and FLAME-MoE can match or even outperform dense models trained with 2x FLOPs (e.g., in 400M-4x).
These results demonstrate that FLAME-MoE substantially improves pretraining efficiency,
achieving a better speed-quality frontier.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Training Throughput</h3>
<div class="ltx_para" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.1">In addition to task performance, we also evaluate the efficiency of training in various parallelization strategies. We profile both throughput (TFLOPs/s/GPU) and elapsed time per training step under different combinations of pipeline parallelism (PP) and expert parallelism (EP) that can fit into one node (8 GPUs). As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S5.F3" title="Figure 3 ‣ 5.1 Experimental Setup ‣ 5 Pretraining FLAME-MoE ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">3</span></a>, increasing EP generally improves utilization and reduces latency, while deeper pipeline parallelism (e.g., PP=2) can further enhance scalability. Based on these findings, we adopt the best-performing configuration of PP=1 and EP=8 for training our FLAME-MoE models, ensuring that our experiments efficiently utilize compute resources.</p>
</div>
<div class="ltx_para" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.1">However, while MoE models demonstrate great utilization under EP=8 as presented in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A1" title="Appendix A Training Efficiency ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">A</span></a>, the overall FLOPs throughput still lags behind dense models. This discrepancy primarily arises from the inherent sparsity and communication overheads introduced by MoE architectures, which pose unique infrastructure challenges. These limitations highlight an area for improvement in open-source MoE implementations, such as those in Megatron-LM. Despite being among the most optimized open MoE frameworks available, current performance still trails that of proprietary systems with tightly integrated hardware-software co-design.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Empirical Analyses</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">A central advantage of the FLAME-MoE suite is the release of full pretraining checkpoints, which enables fine-grained analysis of model behavior across all stages of training—not just at convergence. In this section, we use this capability to explore key MoE-specific behaviors, including expert specialization (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS1" title="6.1 Expert Specialization ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">6.1</span></a>), co-activation (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS2" title="6.2 Expert Co-activation ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">6.2</span></a>), and router saturation (§<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.SS3" title="6.3 Router Saturation ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">6.3</span></a>). These analyses exemplify how FLAME-MoE can support the broader academic community in studying the training dynamics of large-scale MoE models.</p>
</div>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1 </span>Expert Specialization</h3>
<figure class="ltx_figure" id="S6.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="165" id="S6.F4.g1" src="x12.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F4.2.1.1" style="font-size:90%;">Figure 4</span>: </span><span class="ltx_text" id="S6.F4.3.2" style="font-size:90%;">Evolution of specialization scores for the top-2 most specialized tokens across Experts 0, 1, 6, 9 at the final layer in FLAME-MoE-1.7B-10.3B on the validation set.</span></figcaption>
</figure>
<div class="ltx_para" id="S6.SS1.p1">
<p class="ltx_p" id="S6.SS1.p1.1">To characterize expert behavior during pretraining, we analyze the routing patterns of individual tokens over time. In particular, we focus on whether certain experts consistently process specific tokens, which may indicate a form of specialization.</p>
</div>
<div class="ltx_para" id="S6.SS1.p2">
<p class="ltx_p" id="S6.SS1.p2.2">We define expert specialization as the fraction of times a given token is routed to a specific expert, normalized by the token’s total frequency in the evaluation corpus. Formally, for a token <math alttext="t" class="ltx_Math" display="inline" id="S6.SS1.p2.1.m1.1"><semantics id="S6.SS1.p2.1.m1.1a"><mi id="S6.SS1.p2.1.m1.1.1" xref="S6.SS1.p2.1.m1.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S6.SS1.p2.1.m1.1b"><ci id="S6.SS1.p2.1.m1.1.1.cmml" xref="S6.SS1.p2.1.m1.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p2.1.m1.1c">t</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p2.1.m1.1d">italic_t</annotation></semantics></math> and an expert <math alttext="e" class="ltx_Math" display="inline" id="S6.SS1.p2.2.m2.1"><semantics id="S6.SS1.p2.2.m2.1a"><mi id="S6.SS1.p2.2.m2.1.1" xref="S6.SS1.p2.2.m2.1.1.cmml">e</mi><annotation-xml encoding="MathML-Content" id="S6.SS1.p2.2.m2.1b"><ci id="S6.SS1.p2.2.m2.1.1.cmml" xref="S6.SS1.p2.2.m2.1.1">𝑒</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p2.2.m2.1c">e</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p2.2.m2.1d">italic_e</annotation></semantics></math>, the specialization score is:</p>
<table class="ltx_equation ltx_eqn_table" id="S6.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{Specialization}_{e}(t)=\frac{\text{\# times expert}~{}e~{}\text{%
activates on}~{}t}{\text{\# times}~{}t~{}\text{appears in the evaluation set}}" class="ltx_Math" display="block" id="S6.E8.m1.1"><semantics id="S6.E8.m1.1a"><mrow id="S6.E8.m1.1.2" xref="S6.E8.m1.1.2.cmml"><mrow id="S6.E8.m1.1.2.2" xref="S6.E8.m1.1.2.2.cmml"><msub id="S6.E8.m1.1.2.2.2" xref="S6.E8.m1.1.2.2.2.cmml"><mtext id="S6.E8.m1.1.2.2.2.2" xref="S6.E8.m1.1.2.2.2.2a.cmml">Specialization</mtext><mi id="S6.E8.m1.1.2.2.2.3" xref="S6.E8.m1.1.2.2.2.3.cmml">e</mi></msub><mo id="S6.E8.m1.1.2.2.1" xref="S6.E8.m1.1.2.2.1.cmml">⁢</mo><mrow id="S6.E8.m1.1.2.2.3.2" xref="S6.E8.m1.1.2.2.cmml"><mo id="S6.E8.m1.1.2.2.3.2.1" stretchy="false" xref="S6.E8.m1.1.2.2.cmml">(</mo><mi id="S6.E8.m1.1.1" xref="S6.E8.m1.1.1.cmml">t</mi><mo id="S6.E8.m1.1.2.2.3.2.2" stretchy="false" xref="S6.E8.m1.1.2.2.cmml">)</mo></mrow></mrow><mo id="S6.E8.m1.1.2.1" xref="S6.E8.m1.1.2.1.cmml">=</mo><mfrac id="S6.E8.m1.1.2.3" xref="S6.E8.m1.1.2.3.cmml"><mrow id="S6.E8.m1.1.2.3.2" xref="S6.E8.m1.1.2.3.2.cmml"><mtext id="S6.E8.m1.1.2.3.2.2" xref="S6.E8.m1.1.2.3.2.2a.cmml"># times expert</mtext><mo id="S6.E8.m1.1.2.3.2.1" lspace="0.330em" xref="S6.E8.m1.1.2.3.2.1.cmml">⁢</mo><mi id="S6.E8.m1.1.2.3.2.3" xref="S6.E8.m1.1.2.3.2.3.cmml">e</mi><mo id="S6.E8.m1.1.2.3.2.1a" lspace="0.330em" xref="S6.E8.m1.1.2.3.2.1.cmml">⁢</mo><mtext id="S6.E8.m1.1.2.3.2.4" xref="S6.E8.m1.1.2.3.2.4a.cmml">activates on</mtext><mo id="S6.E8.m1.1.2.3.2.1b" lspace="0.330em" xref="S6.E8.m1.1.2.3.2.1.cmml">⁢</mo><mi id="S6.E8.m1.1.2.3.2.5" xref="S6.E8.m1.1.2.3.2.5.cmml">t</mi></mrow><mrow id="S6.E8.m1.1.2.3.3" xref="S6.E8.m1.1.2.3.3.cmml"><mtext id="S6.E8.m1.1.2.3.3.2" xref="S6.E8.m1.1.2.3.3.2a.cmml"># times</mtext><mo id="S6.E8.m1.1.2.3.3.1" lspace="0.330em" xref="S6.E8.m1.1.2.3.3.1.cmml">⁢</mo><mi id="S6.E8.m1.1.2.3.3.3" xref="S6.E8.m1.1.2.3.3.3.cmml">t</mi><mo id="S6.E8.m1.1.2.3.3.1a" lspace="0.330em" xref="S6.E8.m1.1.2.3.3.1.cmml">⁢</mo><mtext id="S6.E8.m1.1.2.3.3.4" xref="S6.E8.m1.1.2.3.3.4a.cmml">appears in the evaluation set</mtext></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S6.E8.m1.1b"><apply id="S6.E8.m1.1.2.cmml" xref="S6.E8.m1.1.2"><eq id="S6.E8.m1.1.2.1.cmml" xref="S6.E8.m1.1.2.1"></eq><apply id="S6.E8.m1.1.2.2.cmml" xref="S6.E8.m1.1.2.2"><times id="S6.E8.m1.1.2.2.1.cmml" xref="S6.E8.m1.1.2.2.1"></times><apply id="S6.E8.m1.1.2.2.2.cmml" xref="S6.E8.m1.1.2.2.2"><csymbol cd="ambiguous" id="S6.E8.m1.1.2.2.2.1.cmml" xref="S6.E8.m1.1.2.2.2">subscript</csymbol><ci id="S6.E8.m1.1.2.2.2.2a.cmml" xref="S6.E8.m1.1.2.2.2.2"><mtext id="S6.E8.m1.1.2.2.2.2.cmml" xref="S6.E8.m1.1.2.2.2.2">Specialization</mtext></ci><ci id="S6.E8.m1.1.2.2.2.3.cmml" xref="S6.E8.m1.1.2.2.2.3">𝑒</ci></apply><ci id="S6.E8.m1.1.1.cmml" xref="S6.E8.m1.1.1">𝑡</ci></apply><apply id="S6.E8.m1.1.2.3.cmml" xref="S6.E8.m1.1.2.3"><divide id="S6.E8.m1.1.2.3.1.cmml" xref="S6.E8.m1.1.2.3"></divide><apply id="S6.E8.m1.1.2.3.2.cmml" xref="S6.E8.m1.1.2.3.2"><times id="S6.E8.m1.1.2.3.2.1.cmml" xref="S6.E8.m1.1.2.3.2.1"></times><ci id="S6.E8.m1.1.2.3.2.2a.cmml" xref="S6.E8.m1.1.2.3.2.2"><mtext id="S6.E8.m1.1.2.3.2.2.cmml" xref="S6.E8.m1.1.2.3.2.2"># times expert</mtext></ci><ci id="S6.E8.m1.1.2.3.2.3.cmml" xref="S6.E8.m1.1.2.3.2.3">𝑒</ci><ci id="S6.E8.m1.1.2.3.2.4a.cmml" xref="S6.E8.m1.1.2.3.2.4"><mtext id="S6.E8.m1.1.2.3.2.4.cmml" xref="S6.E8.m1.1.2.3.2.4">activates on</mtext></ci><ci id="S6.E8.m1.1.2.3.2.5.cmml" xref="S6.E8.m1.1.2.3.2.5">𝑡</ci></apply><apply id="S6.E8.m1.1.2.3.3.cmml" xref="S6.E8.m1.1.2.3.3"><times id="S6.E8.m1.1.2.3.3.1.cmml" xref="S6.E8.m1.1.2.3.3.1"></times><ci id="S6.E8.m1.1.2.3.3.2a.cmml" xref="S6.E8.m1.1.2.3.3.2"><mtext id="S6.E8.m1.1.2.3.3.2.cmml" xref="S6.E8.m1.1.2.3.3.2"># times</mtext></ci><ci id="S6.E8.m1.1.2.3.3.3.cmml" xref="S6.E8.m1.1.2.3.3.3">𝑡</ci><ci id="S6.E8.m1.1.2.3.3.4a.cmml" xref="S6.E8.m1.1.2.3.3.4"><mtext id="S6.E8.m1.1.2.3.3.4.cmml" xref="S6.E8.m1.1.2.3.3.4">appears in the evaluation set</mtext></ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.E8.m1.1c">\text{Specialization}_{e}(t)=\frac{\text{\# times expert}~{}e~{}\text{%
activates on}~{}t}{\text{\# times}~{}t~{}\text{appears in the evaluation set}}</annotation><annotation encoding="application/x-llamapun" id="S6.E8.m1.1d">Specialization start_POSTSUBSCRIPT italic_e end_POSTSUBSCRIPT ( italic_t ) = divide start_ARG # times expert italic_e activates on italic_t end_ARG start_ARG # times italic_t appears in the evaluation set end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S6.SS1.p2.3">This formulation quantifies how “responsible” an expert becomes for handling a particular token. The definition aligns closely with vocabulary specialization explored in OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>, but is evaluated here across full pretraining trajectories.</p>
</div>
<div class="ltx_para" id="S6.SS1.p3">
<p class="ltx_p" id="S6.SS1.p3.1">To track specialization over time, we fix the top-2 most specialized tokens for each expert at the end of pretraining and retrospectively evaluate their scores at earlier checkpoints. As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.F4" title="Figure 4 ‣ 6.1 Expert Specialization ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">4</span></a>, we observe a consistent upward trend for these specialization scores across all experts analyzed. This indicates that token-level specialization gradually emerges and solidifies during pretraining. Additional details are presented in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A2" title="Appendix B Expert Specialization ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">B</span></a>.</p>
</div>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2 </span>Expert Co-activation</h3>
<figure class="ltx_figure" id="S6.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="188" id="S6.F5.g1" src="x13.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F5.2.1.1" style="font-size:90%;">Figure 5</span>: </span><span class="ltx_text" id="S6.F5.3.2" style="font-size:90%;">Expert co-activation in FLAME-MoE-1.7B-10.3B at the final checkpoint on the validation set. The heatmap shows pairwise co-activation scores among the 16 experts with the highest co-activation across layers 2, 6, 12, and 18. Expert IDs are shown on the axes.</span></figcaption>
</figure>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.3">To understand expert interactions under top-<math alttext="k" class="ltx_Math" display="inline" id="S6.SS2.p1.1.m1.1"><semantics id="S6.SS2.p1.1.m1.1a"><mi id="S6.SS2.p1.1.m1.1.1" xref="S6.SS2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.1.m1.1b"><ci id="S6.SS2.p1.1.m1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.1.m1.1d">italic_k</annotation></semantics></math> routing, we analyze expert co-activation—how often expert pairs are selected together for the same token. This reveals whether experts behave independently or tend to co-operate. Following OLMoE <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#bib.bib25" title="">25</a>]</cite>, we define the directional co-activation score from expert <math alttext="E_{i}" class="ltx_Math" display="inline" id="S6.SS2.p1.2.m2.1"><semantics id="S6.SS2.p1.2.m2.1a"><msub id="S6.SS2.p1.2.m2.1.1" xref="S6.SS2.p1.2.m2.1.1.cmml"><mi id="S6.SS2.p1.2.m2.1.1.2" xref="S6.SS2.p1.2.m2.1.1.2.cmml">E</mi><mi id="S6.SS2.p1.2.m2.1.1.3" xref="S6.SS2.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.2.m2.1b"><apply id="S6.SS2.p1.2.m2.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S6.SS2.p1.2.m2.1.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S6.SS2.p1.2.m2.1.1.2.cmml" xref="S6.SS2.p1.2.m2.1.1.2">𝐸</ci><ci id="S6.SS2.p1.2.m2.1.1.3.cmml" xref="S6.SS2.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.2.m2.1c">E_{i}</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.2.m2.1d">italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to expert <math alttext="E_{j}" class="ltx_Math" display="inline" id="S6.SS2.p1.3.m3.1"><semantics id="S6.SS2.p1.3.m3.1a"><msub id="S6.SS2.p1.3.m3.1.1" xref="S6.SS2.p1.3.m3.1.1.cmml"><mi id="S6.SS2.p1.3.m3.1.1.2" xref="S6.SS2.p1.3.m3.1.1.2.cmml">E</mi><mi id="S6.SS2.p1.3.m3.1.1.3" xref="S6.SS2.p1.3.m3.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.3.m3.1b"><apply id="S6.SS2.p1.3.m3.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S6.SS2.p1.3.m3.1.1.1.cmml" xref="S6.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S6.SS2.p1.3.m3.1.1.2.cmml" xref="S6.SS2.p1.3.m3.1.1.2">𝐸</ci><ci id="S6.SS2.p1.3.m3.1.1.3.cmml" xref="S6.SS2.p1.3.m3.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.3.m3.1c">E_{j}</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.3.m3.1d">italic_E start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> as:</p>
<table class="ltx_equation ltx_eqn_table" id="S6.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{CoAct}(E_{i},E_{j})=\frac{|\{E_{i}\in\text{Top-}k(x),\,E_{j}\in\text{Top%
-}k(x)\mid x\in\mathcal{T}\}|}{|\{E_{i}\in\text{Top-}k(x)\mid x\in\mathcal{T}%
\}|}" class="ltx_Math" display="block" id="S6.E9.m1.7"><semantics id="S6.E9.m1.7a"><mrow id="S6.E9.m1.7.7" xref="S6.E9.m1.7.7.cmml"><mrow id="S6.E9.m1.7.7.2" xref="S6.E9.m1.7.7.2.cmml"><mtext id="S6.E9.m1.7.7.2.4" xref="S6.E9.m1.7.7.2.4a.cmml">CoAct</mtext><mo id="S6.E9.m1.7.7.2.3" xref="S6.E9.m1.7.7.2.3.cmml">⁢</mo><mrow id="S6.E9.m1.7.7.2.2.2" xref="S6.E9.m1.7.7.2.2.3.cmml"><mo id="S6.E9.m1.7.7.2.2.2.3" stretchy="false" xref="S6.E9.m1.7.7.2.2.3.cmml">(</mo><msub id="S6.E9.m1.6.6.1.1.1.1" xref="S6.E9.m1.6.6.1.1.1.1.cmml"><mi id="S6.E9.m1.6.6.1.1.1.1.2" xref="S6.E9.m1.6.6.1.1.1.1.2.cmml">E</mi><mi id="S6.E9.m1.6.6.1.1.1.1.3" xref="S6.E9.m1.6.6.1.1.1.1.3.cmml">i</mi></msub><mo id="S6.E9.m1.7.7.2.2.2.4" xref="S6.E9.m1.7.7.2.2.3.cmml">,</mo><msub id="S6.E9.m1.7.7.2.2.2.2" xref="S6.E9.m1.7.7.2.2.2.2.cmml"><mi id="S6.E9.m1.7.7.2.2.2.2.2" xref="S6.E9.m1.7.7.2.2.2.2.2.cmml">E</mi><mi id="S6.E9.m1.7.7.2.2.2.2.3" xref="S6.E9.m1.7.7.2.2.2.2.3.cmml">j</mi></msub><mo id="S6.E9.m1.7.7.2.2.2.5" stretchy="false" xref="S6.E9.m1.7.7.2.2.3.cmml">)</mo></mrow></mrow><mo id="S6.E9.m1.7.7.3" xref="S6.E9.m1.7.7.3.cmml">=</mo><mfrac id="S6.E9.m1.5.5" xref="S6.E9.m1.5.5.cmml"><mrow id="S6.E9.m1.3.3.3.3" xref="S6.E9.m1.3.3.3.4.cmml"><mo id="S6.E9.m1.3.3.3.3.2" stretchy="false" xref="S6.E9.m1.3.3.3.4.1.cmml">|</mo><mrow id="S6.E9.m1.3.3.3.3.1.2" xref="S6.E9.m1.3.3.3.3.1.3.cmml"><mo id="S6.E9.m1.3.3.3.3.1.2.3" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.3.1.cmml">{</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.2" xref="S6.E9.m1.3.3.3.3.1.1.1.3.cmml"><mrow id="S6.E9.m1.3.3.3.3.1.1.1.1.1" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.cmml"><msub id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.cmml"><mi id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.2" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.2.cmml">E</mi><mi id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.3" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.3.cmml">i</mi></msub><mo id="S6.E9.m1.3.3.3.3.1.1.1.1.1.1" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.1.cmml">∈</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.cmml"><mtext id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2a.cmml">Top-</mtext><mo id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.3" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.3.cmml">k</mi><mo id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1a" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.4.2" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.cmml"><mo id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.4.2.1" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.cmml">(</mo><mi id="S6.E9.m1.1.1.1.1" xref="S6.E9.m1.1.1.1.1.cmml">x</mi><mo id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.4.2.2" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.3" rspace="0.337em" xref="S6.E9.m1.3.3.3.3.1.1.1.3a.cmml">,</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.2.2" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.cmml"><msub id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.cmml"><mi id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.2" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.2.cmml">E</mi><mi id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.3" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.3.cmml">j</mi></msub><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.2.1" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.1.cmml">∈</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.cmml"><mtext id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2a.cmml">Top-</mtext><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1.cmml">⁢</mo><mi id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.3" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.3.cmml">k</mi><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1a" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1.cmml">⁢</mo><mrow id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.4.2" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.cmml"><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.4.2.1" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.cmml">(</mo><mi id="S6.E9.m1.2.2.2.2" xref="S6.E9.m1.2.2.2.2.cmml">x</mi><mo id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.4.2.2" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow><mo fence="true" id="S6.E9.m1.3.3.3.3.1.2.4" lspace="0em" rspace="0em" xref="S6.E9.m1.3.3.3.3.1.3.1.cmml">∣</mo><mrow id="S6.E9.m1.3.3.3.3.1.2.2" xref="S6.E9.m1.3.3.3.3.1.2.2.cmml"><mi id="S6.E9.m1.3.3.3.3.1.2.2.2" xref="S6.E9.m1.3.3.3.3.1.2.2.2.cmml">x</mi><mo id="S6.E9.m1.3.3.3.3.1.2.2.1" xref="S6.E9.m1.3.3.3.3.1.2.2.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S6.E9.m1.3.3.3.3.1.2.2.3" xref="S6.E9.m1.3.3.3.3.1.2.2.3.cmml">𝒯</mi></mrow><mo id="S6.E9.m1.3.3.3.3.1.2.5" stretchy="false" xref="S6.E9.m1.3.3.3.3.1.3.1.cmml">}</mo></mrow><mo id="S6.E9.m1.3.3.3.3.3" stretchy="false" xref="S6.E9.m1.3.3.3.4.1.cmml">|</mo></mrow><mrow id="S6.E9.m1.5.5.5.2" xref="S6.E9.m1.5.5.5.3.cmml"><mo id="S6.E9.m1.5.5.5.2.2" stretchy="false" xref="S6.E9.m1.5.5.5.3.1.cmml">|</mo><mrow id="S6.E9.m1.5.5.5.2.1.2" xref="S6.E9.m1.5.5.5.2.1.3.cmml"><mo id="S6.E9.m1.5.5.5.2.1.2.3" stretchy="false" xref="S6.E9.m1.5.5.5.2.1.3.1.cmml">{</mo><mrow id="S6.E9.m1.5.5.5.2.1.1.1" xref="S6.E9.m1.5.5.5.2.1.1.1.cmml"><msub id="S6.E9.m1.5.5.5.2.1.1.1.2" xref="S6.E9.m1.5.5.5.2.1.1.1.2.cmml"><mi id="S6.E9.m1.5.5.5.2.1.1.1.2.2" xref="S6.E9.m1.5.5.5.2.1.1.1.2.2.cmml">E</mi><mi id="S6.E9.m1.5.5.5.2.1.1.1.2.3" xref="S6.E9.m1.5.5.5.2.1.1.1.2.3.cmml">i</mi></msub><mo id="S6.E9.m1.5.5.5.2.1.1.1.1" xref="S6.E9.m1.5.5.5.2.1.1.1.1.cmml">∈</mo><mrow id="S6.E9.m1.5.5.5.2.1.1.1.3" xref="S6.E9.m1.5.5.5.2.1.1.1.3.cmml"><mtext id="S6.E9.m1.5.5.5.2.1.1.1.3.2" xref="S6.E9.m1.5.5.5.2.1.1.1.3.2a.cmml">Top-</mtext><mo id="S6.E9.m1.5.5.5.2.1.1.1.3.1" xref="S6.E9.m1.5.5.5.2.1.1.1.3.1.cmml">⁢</mo><mi id="S6.E9.m1.5.5.5.2.1.1.1.3.3" xref="S6.E9.m1.5.5.5.2.1.1.1.3.3.cmml">k</mi><mo id="S6.E9.m1.5.5.5.2.1.1.1.3.1a" xref="S6.E9.m1.5.5.5.2.1.1.1.3.1.cmml">⁢</mo><mrow id="S6.E9.m1.5.5.5.2.1.1.1.3.4.2" xref="S6.E9.m1.5.5.5.2.1.1.1.3.cmml"><mo id="S6.E9.m1.5.5.5.2.1.1.1.3.4.2.1" stretchy="false" xref="S6.E9.m1.5.5.5.2.1.1.1.3.cmml">(</mo><mi id="S6.E9.m1.4.4.4.1" xref="S6.E9.m1.4.4.4.1.cmml">x</mi><mo id="S6.E9.m1.5.5.5.2.1.1.1.3.4.2.2" stretchy="false" xref="S6.E9.m1.5.5.5.2.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo fence="true" id="S6.E9.m1.5.5.5.2.1.2.4" lspace="0em" rspace="0em" xref="S6.E9.m1.5.5.5.2.1.3.1.cmml">∣</mo><mrow id="S6.E9.m1.5.5.5.2.1.2.2" xref="S6.E9.m1.5.5.5.2.1.2.2.cmml"><mi id="S6.E9.m1.5.5.5.2.1.2.2.2" xref="S6.E9.m1.5.5.5.2.1.2.2.2.cmml">x</mi><mo id="S6.E9.m1.5.5.5.2.1.2.2.1" xref="S6.E9.m1.5.5.5.2.1.2.2.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S6.E9.m1.5.5.5.2.1.2.2.3" xref="S6.E9.m1.5.5.5.2.1.2.2.3.cmml">𝒯</mi></mrow><mo id="S6.E9.m1.5.5.5.2.1.2.5" stretchy="false" xref="S6.E9.m1.5.5.5.2.1.3.1.cmml">}</mo></mrow><mo id="S6.E9.m1.5.5.5.2.3" stretchy="false" xref="S6.E9.m1.5.5.5.3.1.cmml">|</mo></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S6.E9.m1.7b"><apply id="S6.E9.m1.7.7.cmml" xref="S6.E9.m1.7.7"><eq id="S6.E9.m1.7.7.3.cmml" xref="S6.E9.m1.7.7.3"></eq><apply id="S6.E9.m1.7.7.2.cmml" xref="S6.E9.m1.7.7.2"><times id="S6.E9.m1.7.7.2.3.cmml" xref="S6.E9.m1.7.7.2.3"></times><ci id="S6.E9.m1.7.7.2.4a.cmml" xref="S6.E9.m1.7.7.2.4"><mtext id="S6.E9.m1.7.7.2.4.cmml" xref="S6.E9.m1.7.7.2.4">CoAct</mtext></ci><interval closure="open" id="S6.E9.m1.7.7.2.2.3.cmml" xref="S6.E9.m1.7.7.2.2.2"><apply id="S6.E9.m1.6.6.1.1.1.1.cmml" xref="S6.E9.m1.6.6.1.1.1.1"><csymbol cd="ambiguous" id="S6.E9.m1.6.6.1.1.1.1.1.cmml" xref="S6.E9.m1.6.6.1.1.1.1">subscript</csymbol><ci id="S6.E9.m1.6.6.1.1.1.1.2.cmml" xref="S6.E9.m1.6.6.1.1.1.1.2">𝐸</ci><ci id="S6.E9.m1.6.6.1.1.1.1.3.cmml" xref="S6.E9.m1.6.6.1.1.1.1.3">𝑖</ci></apply><apply id="S6.E9.m1.7.7.2.2.2.2.cmml" xref="S6.E9.m1.7.7.2.2.2.2"><csymbol cd="ambiguous" id="S6.E9.m1.7.7.2.2.2.2.1.cmml" xref="S6.E9.m1.7.7.2.2.2.2">subscript</csymbol><ci id="S6.E9.m1.7.7.2.2.2.2.2.cmml" xref="S6.E9.m1.7.7.2.2.2.2.2">𝐸</ci><ci id="S6.E9.m1.7.7.2.2.2.2.3.cmml" xref="S6.E9.m1.7.7.2.2.2.2.3">𝑗</ci></apply></interval></apply><apply id="S6.E9.m1.5.5.cmml" xref="S6.E9.m1.5.5"><divide id="S6.E9.m1.5.5.6.cmml" xref="S6.E9.m1.5.5"></divide><apply id="S6.E9.m1.3.3.3.4.cmml" xref="S6.E9.m1.3.3.3.3"><abs id="S6.E9.m1.3.3.3.4.1.cmml" xref="S6.E9.m1.3.3.3.3.2"></abs><apply id="S6.E9.m1.3.3.3.3.1.3.cmml" xref="S6.E9.m1.3.3.3.3.1.2"><csymbol cd="latexml" id="S6.E9.m1.3.3.3.3.1.3.1.cmml" xref="S6.E9.m1.3.3.3.3.1.2.3">conditional-set</csymbol><apply id="S6.E9.m1.3.3.3.3.1.1.1.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S6.E9.m1.3.3.3.3.1.1.1.3a.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.3">formulae-sequence</csymbol><apply id="S6.E9.m1.3.3.3.3.1.1.1.1.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1"><in id="S6.E9.m1.3.3.3.3.1.1.1.1.1.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.1"></in><apply id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2">subscript</csymbol><ci id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.2">𝐸</ci><ci id="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3"><times id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.1"></times><ci id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2a.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2"><mtext id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.2">Top-</mtext></ci><ci id="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.1.1.3.3">𝑘</ci><ci id="S6.E9.m1.1.1.1.1.cmml" xref="S6.E9.m1.1.1.1.1">𝑥</ci></apply></apply><apply id="S6.E9.m1.3.3.3.3.1.1.1.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2"><in id="S6.E9.m1.3.3.3.3.1.1.1.2.2.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.1"></in><apply id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2">subscript</csymbol><ci id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.2">𝐸</ci><ci id="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.2.3">𝑗</ci></apply><apply id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3"><times id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.1"></times><ci id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2a.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2"><mtext id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.2">Top-</mtext></ci><ci id="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.3.cmml" xref="S6.E9.m1.3.3.3.3.1.1.1.2.2.3.3">𝑘</ci><ci id="S6.E9.m1.2.2.2.2.cmml" xref="S6.E9.m1.2.2.2.2">𝑥</ci></apply></apply></apply><apply id="S6.E9.m1.3.3.3.3.1.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.2.2"><in id="S6.E9.m1.3.3.3.3.1.2.2.1.cmml" xref="S6.E9.m1.3.3.3.3.1.2.2.1"></in><ci id="S6.E9.m1.3.3.3.3.1.2.2.2.cmml" xref="S6.E9.m1.3.3.3.3.1.2.2.2">𝑥</ci><ci id="S6.E9.m1.3.3.3.3.1.2.2.3.cmml" xref="S6.E9.m1.3.3.3.3.1.2.2.3">𝒯</ci></apply></apply></apply><apply id="S6.E9.m1.5.5.5.3.cmml" xref="S6.E9.m1.5.5.5.2"><abs id="S6.E9.m1.5.5.5.3.1.cmml" xref="S6.E9.m1.5.5.5.2.2"></abs><apply id="S6.E9.m1.5.5.5.2.1.3.cmml" xref="S6.E9.m1.5.5.5.2.1.2"><csymbol cd="latexml" id="S6.E9.m1.5.5.5.2.1.3.1.cmml" xref="S6.E9.m1.5.5.5.2.1.2.3">conditional-set</csymbol><apply id="S6.E9.m1.5.5.5.2.1.1.1.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1"><in id="S6.E9.m1.5.5.5.2.1.1.1.1.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.1"></in><apply id="S6.E9.m1.5.5.5.2.1.1.1.2.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.2"><csymbol cd="ambiguous" id="S6.E9.m1.5.5.5.2.1.1.1.2.1.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.2">subscript</csymbol><ci id="S6.E9.m1.5.5.5.2.1.1.1.2.2.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.2.2">𝐸</ci><ci id="S6.E9.m1.5.5.5.2.1.1.1.2.3.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.2.3">𝑖</ci></apply><apply id="S6.E9.m1.5.5.5.2.1.1.1.3.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.3"><times id="S6.E9.m1.5.5.5.2.1.1.1.3.1.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.3.1"></times><ci id="S6.E9.m1.5.5.5.2.1.1.1.3.2a.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.3.2"><mtext id="S6.E9.m1.5.5.5.2.1.1.1.3.2.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.3.2">Top-</mtext></ci><ci id="S6.E9.m1.5.5.5.2.1.1.1.3.3.cmml" xref="S6.E9.m1.5.5.5.2.1.1.1.3.3">𝑘</ci><ci id="S6.E9.m1.4.4.4.1.cmml" xref="S6.E9.m1.4.4.4.1">𝑥</ci></apply></apply><apply id="S6.E9.m1.5.5.5.2.1.2.2.cmml" xref="S6.E9.m1.5.5.5.2.1.2.2"><in id="S6.E9.m1.5.5.5.2.1.2.2.1.cmml" xref="S6.E9.m1.5.5.5.2.1.2.2.1"></in><ci id="S6.E9.m1.5.5.5.2.1.2.2.2.cmml" xref="S6.E9.m1.5.5.5.2.1.2.2.2">𝑥</ci><ci id="S6.E9.m1.5.5.5.2.1.2.2.3.cmml" xref="S6.E9.m1.5.5.5.2.1.2.2.3">𝒯</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.E9.m1.7c">\text{CoAct}(E_{i},E_{j})=\frac{|\{E_{i}\in\text{Top-}k(x),\,E_{j}\in\text{Top%
-}k(x)\mid x\in\mathcal{T}\}|}{|\{E_{i}\in\text{Top-}k(x)\mid x\in\mathcal{T}%
\}|}</annotation><annotation encoding="application/x-llamapun" id="S6.E9.m1.7d">CoAct ( italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_E start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ) = divide start_ARG | { italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ Top- italic_k ( italic_x ) , italic_E start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ∈ Top- italic_k ( italic_x ) ∣ italic_x ∈ caligraphic_T } | end_ARG start_ARG | { italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ Top- italic_k ( italic_x ) ∣ italic_x ∈ caligraphic_T } | end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S6.SS2.p1.7">where <math alttext="\mathcal{T}" class="ltx_Math" display="inline" id="S6.SS2.p1.4.m1.1"><semantics id="S6.SS2.p1.4.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S6.SS2.p1.4.m1.1.1" xref="S6.SS2.p1.4.m1.1.1.cmml">𝒯</mi><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.4.m1.1b"><ci id="S6.SS2.p1.4.m1.1.1.cmml" xref="S6.SS2.p1.4.m1.1.1">𝒯</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.4.m1.1c">\mathcal{T}</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.4.m1.1d">caligraphic_T</annotation></semantics></math> is the evaluation token set.
CoAct measures the conditional likelihood that <math alttext="E_{j}" class="ltx_Math" display="inline" id="S6.SS2.p1.5.m2.1"><semantics id="S6.SS2.p1.5.m2.1a"><msub id="S6.SS2.p1.5.m2.1.1" xref="S6.SS2.p1.5.m2.1.1.cmml"><mi id="S6.SS2.p1.5.m2.1.1.2" xref="S6.SS2.p1.5.m2.1.1.2.cmml">E</mi><mi id="S6.SS2.p1.5.m2.1.1.3" xref="S6.SS2.p1.5.m2.1.1.3.cmml">j</mi></msub><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.5.m2.1b"><apply id="S6.SS2.p1.5.m2.1.1.cmml" xref="S6.SS2.p1.5.m2.1.1"><csymbol cd="ambiguous" id="S6.SS2.p1.5.m2.1.1.1.cmml" xref="S6.SS2.p1.5.m2.1.1">subscript</csymbol><ci id="S6.SS2.p1.5.m2.1.1.2.cmml" xref="S6.SS2.p1.5.m2.1.1.2">𝐸</ci><ci id="S6.SS2.p1.5.m2.1.1.3.cmml" xref="S6.SS2.p1.5.m2.1.1.3">𝑗</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.5.m2.1c">E_{j}</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.5.m2.1d">italic_E start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is co-activated with <math alttext="E_{i}" class="ltx_Math" display="inline" id="S6.SS2.p1.6.m3.1"><semantics id="S6.SS2.p1.6.m3.1a"><msub id="S6.SS2.p1.6.m3.1.1" xref="S6.SS2.p1.6.m3.1.1.cmml"><mi id="S6.SS2.p1.6.m3.1.1.2" xref="S6.SS2.p1.6.m3.1.1.2.cmml">E</mi><mi id="S6.SS2.p1.6.m3.1.1.3" xref="S6.SS2.p1.6.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.6.m3.1b"><apply id="S6.SS2.p1.6.m3.1.1.cmml" xref="S6.SS2.p1.6.m3.1.1"><csymbol cd="ambiguous" id="S6.SS2.p1.6.m3.1.1.1.cmml" xref="S6.SS2.p1.6.m3.1.1">subscript</csymbol><ci id="S6.SS2.p1.6.m3.1.1.2.cmml" xref="S6.SS2.p1.6.m3.1.1.2">𝐸</ci><ci id="S6.SS2.p1.6.m3.1.1.3.cmml" xref="S6.SS2.p1.6.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.6.m3.1c">E_{i}</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.6.m3.1d">italic_E start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. A high score indicates tight coupling between the two experts, whereas a low score suggests independence.
Importantly, this formulation is asymmetric, i.e. <math alttext="\text{CoAct}(i,j)\neq\text{CoAct}(j,i)" class="ltx_Math" display="inline" id="S6.SS2.p1.7.m4.4"><semantics id="S6.SS2.p1.7.m4.4a"><mrow id="S6.SS2.p1.7.m4.4.5" xref="S6.SS2.p1.7.m4.4.5.cmml"><mrow id="S6.SS2.p1.7.m4.4.5.2" xref="S6.SS2.p1.7.m4.4.5.2.cmml"><mtext id="S6.SS2.p1.7.m4.4.5.2.2" xref="S6.SS2.p1.7.m4.4.5.2.2a.cmml">CoAct</mtext><mo id="S6.SS2.p1.7.m4.4.5.2.1" xref="S6.SS2.p1.7.m4.4.5.2.1.cmml">⁢</mo><mrow id="S6.SS2.p1.7.m4.4.5.2.3.2" xref="S6.SS2.p1.7.m4.4.5.2.3.1.cmml"><mo id="S6.SS2.p1.7.m4.4.5.2.3.2.1" stretchy="false" xref="S6.SS2.p1.7.m4.4.5.2.3.1.cmml">(</mo><mi id="S6.SS2.p1.7.m4.1.1" xref="S6.SS2.p1.7.m4.1.1.cmml">i</mi><mo id="S6.SS2.p1.7.m4.4.5.2.3.2.2" xref="S6.SS2.p1.7.m4.4.5.2.3.1.cmml">,</mo><mi id="S6.SS2.p1.7.m4.2.2" xref="S6.SS2.p1.7.m4.2.2.cmml">j</mi><mo id="S6.SS2.p1.7.m4.4.5.2.3.2.3" stretchy="false" xref="S6.SS2.p1.7.m4.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="S6.SS2.p1.7.m4.4.5.1" xref="S6.SS2.p1.7.m4.4.5.1.cmml">≠</mo><mrow id="S6.SS2.p1.7.m4.4.5.3" xref="S6.SS2.p1.7.m4.4.5.3.cmml"><mtext id="S6.SS2.p1.7.m4.4.5.3.2" xref="S6.SS2.p1.7.m4.4.5.3.2a.cmml">CoAct</mtext><mo id="S6.SS2.p1.7.m4.4.5.3.1" xref="S6.SS2.p1.7.m4.4.5.3.1.cmml">⁢</mo><mrow id="S6.SS2.p1.7.m4.4.5.3.3.2" xref="S6.SS2.p1.7.m4.4.5.3.3.1.cmml"><mo id="S6.SS2.p1.7.m4.4.5.3.3.2.1" stretchy="false" xref="S6.SS2.p1.7.m4.4.5.3.3.1.cmml">(</mo><mi id="S6.SS2.p1.7.m4.3.3" xref="S6.SS2.p1.7.m4.3.3.cmml">j</mi><mo id="S6.SS2.p1.7.m4.4.5.3.3.2.2" xref="S6.SS2.p1.7.m4.4.5.3.3.1.cmml">,</mo><mi id="S6.SS2.p1.7.m4.4.4" xref="S6.SS2.p1.7.m4.4.4.cmml">i</mi><mo id="S6.SS2.p1.7.m4.4.5.3.3.2.3" stretchy="false" xref="S6.SS2.p1.7.m4.4.5.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.7.m4.4b"><apply id="S6.SS2.p1.7.m4.4.5.cmml" xref="S6.SS2.p1.7.m4.4.5"><neq id="S6.SS2.p1.7.m4.4.5.1.cmml" xref="S6.SS2.p1.7.m4.4.5.1"></neq><apply id="S6.SS2.p1.7.m4.4.5.2.cmml" xref="S6.SS2.p1.7.m4.4.5.2"><times id="S6.SS2.p1.7.m4.4.5.2.1.cmml" xref="S6.SS2.p1.7.m4.4.5.2.1"></times><ci id="S6.SS2.p1.7.m4.4.5.2.2a.cmml" xref="S6.SS2.p1.7.m4.4.5.2.2"><mtext id="S6.SS2.p1.7.m4.4.5.2.2.cmml" xref="S6.SS2.p1.7.m4.4.5.2.2">CoAct</mtext></ci><interval closure="open" id="S6.SS2.p1.7.m4.4.5.2.3.1.cmml" xref="S6.SS2.p1.7.m4.4.5.2.3.2"><ci id="S6.SS2.p1.7.m4.1.1.cmml" xref="S6.SS2.p1.7.m4.1.1">𝑖</ci><ci id="S6.SS2.p1.7.m4.2.2.cmml" xref="S6.SS2.p1.7.m4.2.2">𝑗</ci></interval></apply><apply id="S6.SS2.p1.7.m4.4.5.3.cmml" xref="S6.SS2.p1.7.m4.4.5.3"><times id="S6.SS2.p1.7.m4.4.5.3.1.cmml" xref="S6.SS2.p1.7.m4.4.5.3.1"></times><ci id="S6.SS2.p1.7.m4.4.5.3.2a.cmml" xref="S6.SS2.p1.7.m4.4.5.3.2"><mtext id="S6.SS2.p1.7.m4.4.5.3.2.cmml" xref="S6.SS2.p1.7.m4.4.5.3.2">CoAct</mtext></ci><interval closure="open" id="S6.SS2.p1.7.m4.4.5.3.3.1.cmml" xref="S6.SS2.p1.7.m4.4.5.3.3.2"><ci id="S6.SS2.p1.7.m4.3.3.cmml" xref="S6.SS2.p1.7.m4.3.3">𝑗</ci><ci id="S6.SS2.p1.7.m4.4.4.cmml" xref="S6.SS2.p1.7.m4.4.4">𝑖</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.7.m4.4c">\text{CoAct}(i,j)\neq\text{CoAct}(j,i)</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.7.m4.4d">CoAct ( italic_i , italic_j ) ≠ CoAct ( italic_j , italic_i )</annotation></semantics></math> in general.</p>
</div>
<div class="ltx_para" id="S6.SS2.p2">
<p class="ltx_p" id="S6.SS2.p2.1">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.F5" title="Figure 5 ‣ 6.2 Expert Co-activation ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">5</span></a>, co-activation is generally sparse, with most expert pairs exhibiting low scores. This suggests limited redundancy and indicates that experts are learning to be diverse instead of frequently overlapping in activation. In addition, co-activation increases with depth: the maximum score rises from 0.38 (Layer 2) and 0.39 (Layer 6) to 0.50 (Layer 12) and 0.70 (Layer 18). This pattern becomes more pronounced as training progresses; in Layer 18, the peak score grows from 0.51 to 0.70 between 10% and 100% of pretraining. Shallower layers show weaker trends. Additional results across different training steps and model scales are provided in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A3" title="Appendix C Expert Co-activation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">C</span></a>.</p>
</div>
</section>
<section class="ltx_subsection" id="S6.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.3 </span>Router Saturation</h3>
<figure class="ltx_figure" id="S6.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="195" id="S6.F6.g1" src="x14.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S6.F6.4.2.1" style="font-size:90%;">Figure 6</span>: </span><span class="ltx_text" id="S6.F6.2.1" style="font-size:90%;">Router saturation across training for FLAME-MoE-1.7B-10.3B. Each subplot shows the average expert selection overlap with the final checkpoint using different top-<math alttext="k" class="ltx_Math" display="inline" id="S6.F6.2.1.m1.1"><semantics id="S6.F6.2.1.m1.1b"><mi id="S6.F6.2.1.m1.1.1" xref="S6.F6.2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.F6.2.1.m1.1c"><ci id="S6.F6.2.1.m1.1.1.cmml" xref="S6.F6.2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.F6.2.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S6.F6.2.1.m1.1e">italic_k</annotation></semantics></math> values (1, 2, 4, 8).</span></figcaption>
</figure>
<div class="ltx_para" id="S6.SS3.p1">
<p class="ltx_p" id="S6.SS3.p1.1">Another key question in understanding MoE behavior is how early and how consistently the router converges on its expert selection patterns. Unlike expert co-activation, which focuses on the interactions among experts within a single forward pass, router saturation examines the temporal stability of routing decisions throughout pretraining. Understanding the saturation dynamics offers insight into how MoE models balance early specialization with continued learning capacity.</p>
</div>
<div class="ltx_para" id="S6.SS3.p2">
<p class="ltx_p" id="S6.SS3.p2.8">We define saturation as the average overlap between the top-<math alttext="k" class="ltx_Math" display="inline" id="S6.SS3.p2.1.m1.1"><semantics id="S6.SS3.p2.1.m1.1a"><mi id="S6.SS3.p2.1.m1.1.1" xref="S6.SS3.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.1.m1.1b"><ci id="S6.SS3.p2.1.m1.1.1.cmml" xref="S6.SS3.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.1.m1.1d">italic_k</annotation></semantics></math> experts selected for each token at step <math alttext="t" class="ltx_Math" display="inline" id="S6.SS3.p2.2.m2.1"><semantics id="S6.SS3.p2.2.m2.1a"><mi id="S6.SS3.p2.2.m2.1.1" xref="S6.SS3.p2.2.m2.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.2.m2.1b"><ci id="S6.SS3.p2.2.m2.1.1.cmml" xref="S6.SS3.p2.2.m2.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.2.m2.1c">t</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.2.m2.1d">italic_t</annotation></semantics></math> and at convergence. For a token <math alttext="x" class="ltx_Math" display="inline" id="S6.SS3.p2.3.m3.1"><semantics id="S6.SS3.p2.3.m3.1a"><mi id="S6.SS3.p2.3.m3.1.1" xref="S6.SS3.p2.3.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.3.m3.1b"><ci id="S6.SS3.p2.3.m3.1.1.cmml" xref="S6.SS3.p2.3.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.3.m3.1c">x</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.3.m3.1d">italic_x</annotation></semantics></math> and layer <math alttext="l" class="ltx_Math" display="inline" id="S6.SS3.p2.4.m4.1"><semantics id="S6.SS3.p2.4.m4.1a"><mi id="S6.SS3.p2.4.m4.1.1" xref="S6.SS3.p2.4.m4.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.4.m4.1b"><ci id="S6.SS3.p2.4.m4.1.1.cmml" xref="S6.SS3.p2.4.m4.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.4.m4.1c">l</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.4.m4.1d">italic_l</annotation></semantics></math>, let <math alttext="\text{Top-}k^{(t)}_{l}(x)" class="ltx_Math" display="inline" id="S6.SS3.p2.5.m5.2"><semantics id="S6.SS3.p2.5.m5.2a"><mrow id="S6.SS3.p2.5.m5.2.3" xref="S6.SS3.p2.5.m5.2.3.cmml"><mtext id="S6.SS3.p2.5.m5.2.3.2" xref="S6.SS3.p2.5.m5.2.3.2a.cmml">Top-</mtext><mo id="S6.SS3.p2.5.m5.2.3.1" xref="S6.SS3.p2.5.m5.2.3.1.cmml">⁢</mo><msubsup id="S6.SS3.p2.5.m5.2.3.3" xref="S6.SS3.p2.5.m5.2.3.3.cmml"><mi id="S6.SS3.p2.5.m5.2.3.3.2.2" xref="S6.SS3.p2.5.m5.2.3.3.2.2.cmml">k</mi><mi id="S6.SS3.p2.5.m5.2.3.3.3" xref="S6.SS3.p2.5.m5.2.3.3.3.cmml">l</mi><mrow id="S6.SS3.p2.5.m5.1.1.1.3" xref="S6.SS3.p2.5.m5.2.3.3.cmml"><mo id="S6.SS3.p2.5.m5.1.1.1.3.1" stretchy="false" xref="S6.SS3.p2.5.m5.2.3.3.cmml">(</mo><mi id="S6.SS3.p2.5.m5.1.1.1.1" xref="S6.SS3.p2.5.m5.1.1.1.1.cmml">t</mi><mo id="S6.SS3.p2.5.m5.1.1.1.3.2" stretchy="false" xref="S6.SS3.p2.5.m5.2.3.3.cmml">)</mo></mrow></msubsup><mo id="S6.SS3.p2.5.m5.2.3.1a" xref="S6.SS3.p2.5.m5.2.3.1.cmml">⁢</mo><mrow id="S6.SS3.p2.5.m5.2.3.4.2" xref="S6.SS3.p2.5.m5.2.3.cmml"><mo id="S6.SS3.p2.5.m5.2.3.4.2.1" stretchy="false" xref="S6.SS3.p2.5.m5.2.3.cmml">(</mo><mi id="S6.SS3.p2.5.m5.2.2" xref="S6.SS3.p2.5.m5.2.2.cmml">x</mi><mo id="S6.SS3.p2.5.m5.2.3.4.2.2" stretchy="false" xref="S6.SS3.p2.5.m5.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.5.m5.2b"><apply id="S6.SS3.p2.5.m5.2.3.cmml" xref="S6.SS3.p2.5.m5.2.3"><times id="S6.SS3.p2.5.m5.2.3.1.cmml" xref="S6.SS3.p2.5.m5.2.3.1"></times><ci id="S6.SS3.p2.5.m5.2.3.2a.cmml" xref="S6.SS3.p2.5.m5.2.3.2"><mtext id="S6.SS3.p2.5.m5.2.3.2.cmml" xref="S6.SS3.p2.5.m5.2.3.2">Top-</mtext></ci><apply id="S6.SS3.p2.5.m5.2.3.3.cmml" xref="S6.SS3.p2.5.m5.2.3.3"><csymbol cd="ambiguous" id="S6.SS3.p2.5.m5.2.3.3.1.cmml" xref="S6.SS3.p2.5.m5.2.3.3">subscript</csymbol><apply id="S6.SS3.p2.5.m5.2.3.3.2.cmml" xref="S6.SS3.p2.5.m5.2.3.3"><csymbol cd="ambiguous" id="S6.SS3.p2.5.m5.2.3.3.2.1.cmml" xref="S6.SS3.p2.5.m5.2.3.3">superscript</csymbol><ci id="S6.SS3.p2.5.m5.2.3.3.2.2.cmml" xref="S6.SS3.p2.5.m5.2.3.3.2.2">𝑘</ci><ci id="S6.SS3.p2.5.m5.1.1.1.1.cmml" xref="S6.SS3.p2.5.m5.1.1.1.1">𝑡</ci></apply><ci id="S6.SS3.p2.5.m5.2.3.3.3.cmml" xref="S6.SS3.p2.5.m5.2.3.3.3">𝑙</ci></apply><ci id="S6.SS3.p2.5.m5.2.2.cmml" xref="S6.SS3.p2.5.m5.2.2">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.5.m5.2c">\text{Top-}k^{(t)}_{l}(x)</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.5.m5.2d">Top- italic_k start_POSTSUPERSCRIPT ( italic_t ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ( italic_x )</annotation></semantics></math> denote the top-<math alttext="k" class="ltx_Math" display="inline" id="S6.SS3.p2.6.m6.1"><semantics id="S6.SS3.p2.6.m6.1a"><mi id="S6.SS3.p2.6.m6.1.1" xref="S6.SS3.p2.6.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.6.m6.1b"><ci id="S6.SS3.p2.6.m6.1.1.cmml" xref="S6.SS3.p2.6.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.6.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.6.m6.1d">italic_k</annotation></semantics></math> experts at step <math alttext="t" class="ltx_Math" display="inline" id="S6.SS3.p2.7.m7.1"><semantics id="S6.SS3.p2.7.m7.1a"><mi id="S6.SS3.p2.7.m7.1.1" xref="S6.SS3.p2.7.m7.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.7.m7.1b"><ci id="S6.SS3.p2.7.m7.1.1.cmml" xref="S6.SS3.p2.7.m7.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.7.m7.1c">t</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.7.m7.1d">italic_t</annotation></semantics></math>, and <math alttext="\text{Top-}k^{(T)}_{l}(x)" class="ltx_Math" display="inline" id="S6.SS3.p2.8.m8.2"><semantics id="S6.SS3.p2.8.m8.2a"><mrow id="S6.SS3.p2.8.m8.2.3" xref="S6.SS3.p2.8.m8.2.3.cmml"><mtext id="S6.SS3.p2.8.m8.2.3.2" xref="S6.SS3.p2.8.m8.2.3.2a.cmml">Top-</mtext><mo id="S6.SS3.p2.8.m8.2.3.1" xref="S6.SS3.p2.8.m8.2.3.1.cmml">⁢</mo><msubsup id="S6.SS3.p2.8.m8.2.3.3" xref="S6.SS3.p2.8.m8.2.3.3.cmml"><mi id="S6.SS3.p2.8.m8.2.3.3.2.2" xref="S6.SS3.p2.8.m8.2.3.3.2.2.cmml">k</mi><mi id="S6.SS3.p2.8.m8.2.3.3.3" xref="S6.SS3.p2.8.m8.2.3.3.3.cmml">l</mi><mrow id="S6.SS3.p2.8.m8.1.1.1.3" xref="S6.SS3.p2.8.m8.2.3.3.cmml"><mo id="S6.SS3.p2.8.m8.1.1.1.3.1" stretchy="false" xref="S6.SS3.p2.8.m8.2.3.3.cmml">(</mo><mi id="S6.SS3.p2.8.m8.1.1.1.1" xref="S6.SS3.p2.8.m8.1.1.1.1.cmml">T</mi><mo id="S6.SS3.p2.8.m8.1.1.1.3.2" stretchy="false" xref="S6.SS3.p2.8.m8.2.3.3.cmml">)</mo></mrow></msubsup><mo id="S6.SS3.p2.8.m8.2.3.1a" xref="S6.SS3.p2.8.m8.2.3.1.cmml">⁢</mo><mrow id="S6.SS3.p2.8.m8.2.3.4.2" xref="S6.SS3.p2.8.m8.2.3.cmml"><mo id="S6.SS3.p2.8.m8.2.3.4.2.1" stretchy="false" xref="S6.SS3.p2.8.m8.2.3.cmml">(</mo><mi id="S6.SS3.p2.8.m8.2.2" xref="S6.SS3.p2.8.m8.2.2.cmml">x</mi><mo id="S6.SS3.p2.8.m8.2.3.4.2.2" stretchy="false" xref="S6.SS3.p2.8.m8.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS3.p2.8.m8.2b"><apply id="S6.SS3.p2.8.m8.2.3.cmml" xref="S6.SS3.p2.8.m8.2.3"><times id="S6.SS3.p2.8.m8.2.3.1.cmml" xref="S6.SS3.p2.8.m8.2.3.1"></times><ci id="S6.SS3.p2.8.m8.2.3.2a.cmml" xref="S6.SS3.p2.8.m8.2.3.2"><mtext id="S6.SS3.p2.8.m8.2.3.2.cmml" xref="S6.SS3.p2.8.m8.2.3.2">Top-</mtext></ci><apply id="S6.SS3.p2.8.m8.2.3.3.cmml" xref="S6.SS3.p2.8.m8.2.3.3"><csymbol cd="ambiguous" id="S6.SS3.p2.8.m8.2.3.3.1.cmml" xref="S6.SS3.p2.8.m8.2.3.3">subscript</csymbol><apply id="S6.SS3.p2.8.m8.2.3.3.2.cmml" xref="S6.SS3.p2.8.m8.2.3.3"><csymbol cd="ambiguous" id="S6.SS3.p2.8.m8.2.3.3.2.1.cmml" xref="S6.SS3.p2.8.m8.2.3.3">superscript</csymbol><ci id="S6.SS3.p2.8.m8.2.3.3.2.2.cmml" xref="S6.SS3.p2.8.m8.2.3.3.2.2">𝑘</ci><ci id="S6.SS3.p2.8.m8.1.1.1.1.cmml" xref="S6.SS3.p2.8.m8.1.1.1.1">𝑇</ci></apply><ci id="S6.SS3.p2.8.m8.2.3.3.3.cmml" xref="S6.SS3.p2.8.m8.2.3.3.3">𝑙</ci></apply><ci id="S6.SS3.p2.8.m8.2.2.cmml" xref="S6.SS3.p2.8.m8.2.2">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p2.8.m8.2c">\text{Top-}k^{(T)}_{l}(x)</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p2.8.m8.2d">Top- italic_k start_POSTSUPERSCRIPT ( italic_T ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ( italic_x )</annotation></semantics></math> the final selection. Then,</p>
</div>
<div class="ltx_para" id="S6.SS3.p3">
<table class="ltx_equation ltx_eqn_table" id="S6.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{Saturation}_{l}(t)=\frac{1}{|\mathcal{T}|}\sum_{x\in\mathcal{T}}\frac{|%
\text{Top-}k^{(t)}_{l}(x)\cap\text{Top-}k^{(T)}_{l}(x)|}{k}" class="ltx_Math" display="block" id="S6.E10.m1.7"><semantics id="S6.E10.m1.7a"><mrow id="S6.E10.m1.7.8" xref="S6.E10.m1.7.8.cmml"><mrow id="S6.E10.m1.7.8.2" xref="S6.E10.m1.7.8.2.cmml"><msub id="S6.E10.m1.7.8.2.2" xref="S6.E10.m1.7.8.2.2.cmml"><mtext id="S6.E10.m1.7.8.2.2.2" xref="S6.E10.m1.7.8.2.2.2a.cmml">Saturation</mtext><mi id="S6.E10.m1.7.8.2.2.3" xref="S6.E10.m1.7.8.2.2.3.cmml">l</mi></msub><mo id="S6.E10.m1.7.8.2.1" xref="S6.E10.m1.7.8.2.1.cmml">⁢</mo><mrow id="S6.E10.m1.7.8.2.3.2" xref="S6.E10.m1.7.8.2.cmml"><mo id="S6.E10.m1.7.8.2.3.2.1" stretchy="false" xref="S6.E10.m1.7.8.2.cmml">(</mo><mi id="S6.E10.m1.7.7" xref="S6.E10.m1.7.7.cmml">t</mi><mo id="S6.E10.m1.7.8.2.3.2.2" stretchy="false" xref="S6.E10.m1.7.8.2.cmml">)</mo></mrow></mrow><mo id="S6.E10.m1.7.8.1" xref="S6.E10.m1.7.8.1.cmml">=</mo><mrow id="S6.E10.m1.7.8.3" xref="S6.E10.m1.7.8.3.cmml"><mfrac id="S6.E10.m1.1.1" xref="S6.E10.m1.1.1.cmml"><mn id="S6.E10.m1.1.1.3" xref="S6.E10.m1.1.1.3.cmml">1</mn><mrow id="S6.E10.m1.1.1.1.3" xref="S6.E10.m1.1.1.1.2.cmml"><mo id="S6.E10.m1.1.1.1.3.1" stretchy="false" xref="S6.E10.m1.1.1.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S6.E10.m1.1.1.1.1" xref="S6.E10.m1.1.1.1.1.cmml">𝒯</mi><mo id="S6.E10.m1.1.1.1.3.2" stretchy="false" xref="S6.E10.m1.1.1.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S6.E10.m1.7.8.3.1" xref="S6.E10.m1.7.8.3.1.cmml">⁢</mo><mrow id="S6.E10.m1.7.8.3.2" xref="S6.E10.m1.7.8.3.2.cmml"><munder id="S6.E10.m1.7.8.3.2.1" xref="S6.E10.m1.7.8.3.2.1.cmml"><mo id="S6.E10.m1.7.8.3.2.1.2" movablelimits="false" xref="S6.E10.m1.7.8.3.2.1.2.cmml">∑</mo><mrow id="S6.E10.m1.7.8.3.2.1.3" xref="S6.E10.m1.7.8.3.2.1.3.cmml"><mi id="S6.E10.m1.7.8.3.2.1.3.2" xref="S6.E10.m1.7.8.3.2.1.3.2.cmml">x</mi><mo id="S6.E10.m1.7.8.3.2.1.3.1" xref="S6.E10.m1.7.8.3.2.1.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S6.E10.m1.7.8.3.2.1.3.3" xref="S6.E10.m1.7.8.3.2.1.3.3.cmml">𝒯</mi></mrow></munder><mfrac id="S6.E10.m1.6.6" xref="S6.E10.m1.6.6.cmml"><mrow id="S6.E10.m1.6.6.5.5" xref="S6.E10.m1.6.6.5.6.cmml"><mo id="S6.E10.m1.6.6.5.5.2" stretchy="false" xref="S6.E10.m1.6.6.5.6.1.cmml">|</mo><mrow id="S6.E10.m1.6.6.5.5.1" xref="S6.E10.m1.6.6.5.5.1.cmml"><mrow id="S6.E10.m1.6.6.5.5.1.2" xref="S6.E10.m1.6.6.5.5.1.2.cmml"><mtext id="S6.E10.m1.6.6.5.5.1.2.2" xref="S6.E10.m1.6.6.5.5.1.2.2a.cmml">Top-</mtext><mo id="S6.E10.m1.6.6.5.5.1.2.1" xref="S6.E10.m1.6.6.5.5.1.2.1.cmml">⁢</mo><msubsup id="S6.E10.m1.6.6.5.5.1.2.3" xref="S6.E10.m1.6.6.5.5.1.2.3.cmml"><mi id="S6.E10.m1.6.6.5.5.1.2.3.2.2" xref="S6.E10.m1.6.6.5.5.1.2.3.2.2.cmml">k</mi><mi id="S6.E10.m1.6.6.5.5.1.2.3.3" xref="S6.E10.m1.6.6.5.5.1.2.3.3.cmml">l</mi><mrow id="S6.E10.m1.2.2.1.1.1.3" xref="S6.E10.m1.6.6.5.5.1.2.3.cmml"><mo id="S6.E10.m1.2.2.1.1.1.3.1" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.2.3.cmml">(</mo><mi id="S6.E10.m1.2.2.1.1.1.1" xref="S6.E10.m1.2.2.1.1.1.1.cmml">t</mi><mo id="S6.E10.m1.2.2.1.1.1.3.2" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.2.3.cmml">)</mo></mrow></msubsup><mo id="S6.E10.m1.6.6.5.5.1.2.1a" xref="S6.E10.m1.6.6.5.5.1.2.1.cmml">⁢</mo><mrow id="S6.E10.m1.6.6.5.5.1.2.4.2" xref="S6.E10.m1.6.6.5.5.1.2.cmml"><mo id="S6.E10.m1.6.6.5.5.1.2.4.2.1" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.2.cmml">(</mo><mi id="S6.E10.m1.4.4.3.3" xref="S6.E10.m1.4.4.3.3.cmml">x</mi><mo id="S6.E10.m1.6.6.5.5.1.2.4.2.2" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.2.cmml">)</mo></mrow></mrow><mo id="S6.E10.m1.6.6.5.5.1.1" xref="S6.E10.m1.6.6.5.5.1.1.cmml">∩</mo><mrow id="S6.E10.m1.6.6.5.5.1.3" xref="S6.E10.m1.6.6.5.5.1.3.cmml"><mtext id="S6.E10.m1.6.6.5.5.1.3.2" xref="S6.E10.m1.6.6.5.5.1.3.2a.cmml">Top-</mtext><mo id="S6.E10.m1.6.6.5.5.1.3.1" xref="S6.E10.m1.6.6.5.5.1.3.1.cmml">⁢</mo><msubsup id="S6.E10.m1.6.6.5.5.1.3.3" xref="S6.E10.m1.6.6.5.5.1.3.3.cmml"><mi id="S6.E10.m1.6.6.5.5.1.3.3.2.2" xref="S6.E10.m1.6.6.5.5.1.3.3.2.2.cmml">k</mi><mi id="S6.E10.m1.6.6.5.5.1.3.3.3" xref="S6.E10.m1.6.6.5.5.1.3.3.3.cmml">l</mi><mrow id="S6.E10.m1.3.3.2.2.1.3" xref="S6.E10.m1.6.6.5.5.1.3.3.cmml"><mo id="S6.E10.m1.3.3.2.2.1.3.1" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.3.3.cmml">(</mo><mi id="S6.E10.m1.3.3.2.2.1.1" xref="S6.E10.m1.3.3.2.2.1.1.cmml">T</mi><mo id="S6.E10.m1.3.3.2.2.1.3.2" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.3.3.cmml">)</mo></mrow></msubsup><mo id="S6.E10.m1.6.6.5.5.1.3.1a" xref="S6.E10.m1.6.6.5.5.1.3.1.cmml">⁢</mo><mrow id="S6.E10.m1.6.6.5.5.1.3.4.2" xref="S6.E10.m1.6.6.5.5.1.3.cmml"><mo id="S6.E10.m1.6.6.5.5.1.3.4.2.1" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.3.cmml">(</mo><mi id="S6.E10.m1.5.5.4.4" xref="S6.E10.m1.5.5.4.4.cmml">x</mi><mo id="S6.E10.m1.6.6.5.5.1.3.4.2.2" stretchy="false" xref="S6.E10.m1.6.6.5.5.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S6.E10.m1.6.6.5.5.3" stretchy="false" xref="S6.E10.m1.6.6.5.6.1.cmml">|</mo></mrow><mi id="S6.E10.m1.6.6.7" xref="S6.E10.m1.6.6.7.cmml">k</mi></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.E10.m1.7b"><apply id="S6.E10.m1.7.8.cmml" xref="S6.E10.m1.7.8"><eq id="S6.E10.m1.7.8.1.cmml" xref="S6.E10.m1.7.8.1"></eq><apply id="S6.E10.m1.7.8.2.cmml" xref="S6.E10.m1.7.8.2"><times id="S6.E10.m1.7.8.2.1.cmml" xref="S6.E10.m1.7.8.2.1"></times><apply id="S6.E10.m1.7.8.2.2.cmml" xref="S6.E10.m1.7.8.2.2"><csymbol cd="ambiguous" id="S6.E10.m1.7.8.2.2.1.cmml" xref="S6.E10.m1.7.8.2.2">subscript</csymbol><ci id="S6.E10.m1.7.8.2.2.2a.cmml" xref="S6.E10.m1.7.8.2.2.2"><mtext id="S6.E10.m1.7.8.2.2.2.cmml" xref="S6.E10.m1.7.8.2.2.2">Saturation</mtext></ci><ci id="S6.E10.m1.7.8.2.2.3.cmml" xref="S6.E10.m1.7.8.2.2.3">𝑙</ci></apply><ci id="S6.E10.m1.7.7.cmml" xref="S6.E10.m1.7.7">𝑡</ci></apply><apply id="S6.E10.m1.7.8.3.cmml" xref="S6.E10.m1.7.8.3"><times id="S6.E10.m1.7.8.3.1.cmml" xref="S6.E10.m1.7.8.3.1"></times><apply id="S6.E10.m1.1.1.cmml" xref="S6.E10.m1.1.1"><divide id="S6.E10.m1.1.1.2.cmml" xref="S6.E10.m1.1.1"></divide><cn id="S6.E10.m1.1.1.3.cmml" type="integer" xref="S6.E10.m1.1.1.3">1</cn><apply id="S6.E10.m1.1.1.1.2.cmml" xref="S6.E10.m1.1.1.1.3"><abs id="S6.E10.m1.1.1.1.2.1.cmml" xref="S6.E10.m1.1.1.1.3.1"></abs><ci id="S6.E10.m1.1.1.1.1.cmml" xref="S6.E10.m1.1.1.1.1">𝒯</ci></apply></apply><apply id="S6.E10.m1.7.8.3.2.cmml" xref="S6.E10.m1.7.8.3.2"><apply id="S6.E10.m1.7.8.3.2.1.cmml" xref="S6.E10.m1.7.8.3.2.1"><csymbol cd="ambiguous" id="S6.E10.m1.7.8.3.2.1.1.cmml" xref="S6.E10.m1.7.8.3.2.1">subscript</csymbol><sum id="S6.E10.m1.7.8.3.2.1.2.cmml" xref="S6.E10.m1.7.8.3.2.1.2"></sum><apply id="S6.E10.m1.7.8.3.2.1.3.cmml" xref="S6.E10.m1.7.8.3.2.1.3"><in id="S6.E10.m1.7.8.3.2.1.3.1.cmml" xref="S6.E10.m1.7.8.3.2.1.3.1"></in><ci id="S6.E10.m1.7.8.3.2.1.3.2.cmml" xref="S6.E10.m1.7.8.3.2.1.3.2">𝑥</ci><ci id="S6.E10.m1.7.8.3.2.1.3.3.cmml" xref="S6.E10.m1.7.8.3.2.1.3.3">𝒯</ci></apply></apply><apply id="S6.E10.m1.6.6.cmml" xref="S6.E10.m1.6.6"><divide id="S6.E10.m1.6.6.6.cmml" xref="S6.E10.m1.6.6"></divide><apply id="S6.E10.m1.6.6.5.6.cmml" xref="S6.E10.m1.6.6.5.5"><abs id="S6.E10.m1.6.6.5.6.1.cmml" xref="S6.E10.m1.6.6.5.5.2"></abs><apply id="S6.E10.m1.6.6.5.5.1.cmml" xref="S6.E10.m1.6.6.5.5.1"><intersect id="S6.E10.m1.6.6.5.5.1.1.cmml" xref="S6.E10.m1.6.6.5.5.1.1"></intersect><apply id="S6.E10.m1.6.6.5.5.1.2.cmml" xref="S6.E10.m1.6.6.5.5.1.2"><times id="S6.E10.m1.6.6.5.5.1.2.1.cmml" xref="S6.E10.m1.6.6.5.5.1.2.1"></times><ci id="S6.E10.m1.6.6.5.5.1.2.2a.cmml" xref="S6.E10.m1.6.6.5.5.1.2.2"><mtext id="S6.E10.m1.6.6.5.5.1.2.2.cmml" xref="S6.E10.m1.6.6.5.5.1.2.2">Top-</mtext></ci><apply id="S6.E10.m1.6.6.5.5.1.2.3.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3"><csymbol cd="ambiguous" id="S6.E10.m1.6.6.5.5.1.2.3.1.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3">subscript</csymbol><apply id="S6.E10.m1.6.6.5.5.1.2.3.2.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3"><csymbol cd="ambiguous" id="S6.E10.m1.6.6.5.5.1.2.3.2.1.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3">superscript</csymbol><ci id="S6.E10.m1.6.6.5.5.1.2.3.2.2.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3.2.2">𝑘</ci><ci id="S6.E10.m1.2.2.1.1.1.1.cmml" xref="S6.E10.m1.2.2.1.1.1.1">𝑡</ci></apply><ci id="S6.E10.m1.6.6.5.5.1.2.3.3.cmml" xref="S6.E10.m1.6.6.5.5.1.2.3.3">𝑙</ci></apply><ci id="S6.E10.m1.4.4.3.3.cmml" xref="S6.E10.m1.4.4.3.3">𝑥</ci></apply><apply id="S6.E10.m1.6.6.5.5.1.3.cmml" xref="S6.E10.m1.6.6.5.5.1.3"><times id="S6.E10.m1.6.6.5.5.1.3.1.cmml" xref="S6.E10.m1.6.6.5.5.1.3.1"></times><ci id="S6.E10.m1.6.6.5.5.1.3.2a.cmml" xref="S6.E10.m1.6.6.5.5.1.3.2"><mtext id="S6.E10.m1.6.6.5.5.1.3.2.cmml" xref="S6.E10.m1.6.6.5.5.1.3.2">Top-</mtext></ci><apply id="S6.E10.m1.6.6.5.5.1.3.3.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3"><csymbol cd="ambiguous" id="S6.E10.m1.6.6.5.5.1.3.3.1.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3">subscript</csymbol><apply id="S6.E10.m1.6.6.5.5.1.3.3.2.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3"><csymbol cd="ambiguous" id="S6.E10.m1.6.6.5.5.1.3.3.2.1.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3">superscript</csymbol><ci id="S6.E10.m1.6.6.5.5.1.3.3.2.2.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3.2.2">𝑘</ci><ci id="S6.E10.m1.3.3.2.2.1.1.cmml" xref="S6.E10.m1.3.3.2.2.1.1">𝑇</ci></apply><ci id="S6.E10.m1.6.6.5.5.1.3.3.3.cmml" xref="S6.E10.m1.6.6.5.5.1.3.3.3">𝑙</ci></apply><ci id="S6.E10.m1.5.5.4.4.cmml" xref="S6.E10.m1.5.5.4.4">𝑥</ci></apply></apply></apply><ci id="S6.E10.m1.6.6.7.cmml" xref="S6.E10.m1.6.6.7">𝑘</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.E10.m1.7c">\text{Saturation}_{l}(t)=\frac{1}{|\mathcal{T}|}\sum_{x\in\mathcal{T}}\frac{|%
\text{Top-}k^{(t)}_{l}(x)\cap\text{Top-}k^{(T)}_{l}(x)|}{k}</annotation><annotation encoding="application/x-llamapun" id="S6.E10.m1.7d">Saturation start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ( italic_t ) = divide start_ARG 1 end_ARG start_ARG | caligraphic_T | end_ARG ∑ start_POSTSUBSCRIPT italic_x ∈ caligraphic_T end_POSTSUBSCRIPT divide start_ARG | Top- italic_k start_POSTSUPERSCRIPT ( italic_t ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ( italic_x ) ∩ Top- italic_k start_POSTSUPERSCRIPT ( italic_T ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ( italic_x ) | end_ARG start_ARG italic_k end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S6.SS3.p4">
<p class="ltx_p" id="S6.SS3.p4.2">Although FLAME-MoE was trained with top-<math alttext="k=8" class="ltx_Math" display="inline" id="S6.SS3.p4.1.m1.1"><semantics id="S6.SS3.p4.1.m1.1a"><mrow id="S6.SS3.p4.1.m1.1.1" xref="S6.SS3.p4.1.m1.1.1.cmml"><mi id="S6.SS3.p4.1.m1.1.1.2" xref="S6.SS3.p4.1.m1.1.1.2.cmml">k</mi><mo id="S6.SS3.p4.1.m1.1.1.1" xref="S6.SS3.p4.1.m1.1.1.1.cmml">=</mo><mn id="S6.SS3.p4.1.m1.1.1.3" xref="S6.SS3.p4.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S6.SS3.p4.1.m1.1b"><apply id="S6.SS3.p4.1.m1.1.1.cmml" xref="S6.SS3.p4.1.m1.1.1"><eq id="S6.SS3.p4.1.m1.1.1.1.cmml" xref="S6.SS3.p4.1.m1.1.1.1"></eq><ci id="S6.SS3.p4.1.m1.1.1.2.cmml" xref="S6.SS3.p4.1.m1.1.1.2">𝑘</ci><cn id="S6.SS3.p4.1.m1.1.1.3.cmml" type="integer" xref="S6.SS3.p4.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p4.1.m1.1c">k=8</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p4.1.m1.1d">italic_k = 8</annotation></semantics></math> routing, we report saturation under different evaluation settings (<math alttext="k=1" class="ltx_Math" display="inline" id="S6.SS3.p4.2.m2.1"><semantics id="S6.SS3.p4.2.m2.1a"><mrow id="S6.SS3.p4.2.m2.1.1" xref="S6.SS3.p4.2.m2.1.1.cmml"><mi id="S6.SS3.p4.2.m2.1.1.2" xref="S6.SS3.p4.2.m2.1.1.2.cmml">k</mi><mo id="S6.SS3.p4.2.m2.1.1.1" xref="S6.SS3.p4.2.m2.1.1.1.cmml">=</mo><mn id="S6.SS3.p4.2.m2.1.1.3" xref="S6.SS3.p4.2.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S6.SS3.p4.2.m2.1b"><apply id="S6.SS3.p4.2.m2.1.1.cmml" xref="S6.SS3.p4.2.m2.1.1"><eq id="S6.SS3.p4.2.m2.1.1.1.cmml" xref="S6.SS3.p4.2.m2.1.1.1"></eq><ci id="S6.SS3.p4.2.m2.1.1.2.cmml" xref="S6.SS3.p4.2.m2.1.1.2">𝑘</ci><cn id="S6.SS3.p4.2.m2.1.1.3.cmml" type="integer" xref="S6.SS3.p4.2.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p4.2.m2.1c">k=1</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p4.2.m2.1d">italic_k = 1</annotation></semantics></math>, 2, 4, 8) to capture finer-grained changes in expert preference.</p>
</div>
<div class="ltx_para" id="S6.SS3.p5">
<p class="ltx_p" id="S6.SS3.p5.2">As shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#S6.F6" title="Figure 6 ‣ 6.3 Router Saturation ‣ 6 Empirical Analyses ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">6</span></a>, saturation increases steadily with training, with most layers reaching over 70% agreement by the midpoint of training. Notably, saturation rises sharply within the first few thousand steps, suggesting that the router converges to stable expert assignments early in pretraining. This pattern is consistent across all top-<math alttext="k" class="ltx_Math" display="inline" id="S6.SS3.p5.1.m1.1"><semantics id="S6.SS3.p5.1.m1.1a"><mi id="S6.SS3.p5.1.m1.1.1" xref="S6.SS3.p5.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p5.1.m1.1b"><ci id="S6.SS3.p5.1.m1.1.1.cmml" xref="S6.SS3.p5.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p5.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p5.1.m1.1d">italic_k</annotation></semantics></math> settings, though absolute scores are higher for a smaller <math alttext="k" class="ltx_Math" display="inline" id="S6.SS3.p5.2.m2.1"><semantics id="S6.SS3.p5.2.m2.1a"><mi id="S6.SS3.p5.2.m2.1.1" xref="S6.SS3.p5.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S6.SS3.p5.2.m2.1b"><ci id="S6.SS3.p5.2.m2.1.1.cmml" xref="S6.SS3.p5.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS3.p5.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S6.SS3.p5.2.m2.1d">italic_k</annotation></semantics></math>, reflecting greater selection consistency among the most preferred experts. Deeper layers generally saturate faster than shallower ones, indicating more stable routing behavior as depth increases. Additional results across different model scales are provided in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A4" title="Appendix D Router Saturation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">D</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Conclusion</h2>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">We present FLAME-MoE, a transparent and reproducible research platform built to advance the study of Mixture-of-Experts language models. By releasing a family of seven compute-optimal models along with complete training artifacts—including logs, checkpoints, routing traces, and evaluation scripts — we enable a rigorous, end-to-end study of MoE systems. Empirically, our models significantly outperform dense baselines under the same compute budgets, validating the effectiveness of our scaling law methodology that offers a principled guide for resource allocation. FLAME-MoE is not limited to isolated benchmark evaluation; rather, it offers an infrastructure to study every facet of MoE models, including expert specialization, routing dynamics, scaling behavior, training stability, parallel efficiency, and generalization performance.
We believe that FLAME-MoE lays the groundwork for systematic, transparent exploration of sparse model architectures and invites broader community engagement in understanding and advancing MoE systems.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We sincerely thank CMU Foundation and Language Model (FLAME) Center for providing support of computational resources. We sincerely thank Tianqi Chen, Ruihang Lai, Zihao Ye, Hongyi Jin, and Bohan Hou for discussing ideas and providing helpful feedback on this work.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Akkus et al. [2024]</span>
<span class="ltx_bibblock">
Atilla Akkus, Mingjie Li, Junjie Chu, Michael Backes, Yang Zhang, and Sinem Sav.

</span>
<span class="ltx_bibblock">Generated data with fake privacy: Hidden dangers of fine-tuning large language models on generated data.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">arXiv preprint arXiv:2409.11423</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Biderman et al. [2023a]</span>
<span class="ltx_bibblock">
Stella Biderman, Usvsn Prashanth, Lintang Sutawika, Hailey Schoelkopf, Quentin Anthony, Shivanshu Purohit, and Edward Raff.

</span>
<span class="ltx_bibblock">Emergent and predictable memorization in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">Advances in Neural Information Processing Systems</em>, 36:28072–28090, 2023a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Biderman et al. [2023b]</span>
<span class="ltx_bibblock">
Stella Biderman, Hailey Schoelkopf, Quentin Gregory Anthony, Herbie Bradley, Kyle O’Brien, Eric Hallahan, Mohammad Aflah Khan, Shivanshu Purohit, USVSN Sai Prashanth, Edward Raff, Aviya Skowron, Lintang Sutawika, and Oskar van der Wal.

</span>
<span class="ltx_bibblock">Pythia: A suite for analyzing large language models across training and scaling.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Proc. of ICML</em>, 2023b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bisk et al. [2020]</span>
<span class="ltx_bibblock">
Yonatan Bisk, Rowan Zellers, Ronan LeBras, Jianfeng Gao, and Yejin Choi.

</span>
<span class="ltx_bibblock">PIQA: Reasoning about physical commonsense in natural language.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Proc. of AAAI</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chi et al. [2022]</span>
<span class="ltx_bibblock">
Zewen Chi, Li Dong, Shaohan Huang, Damai Dai, Shuming Ma, Barun Patra, Saksham Singhal, Payal Bajaj, Xia Song, Xian-Ling Mao, et al.

</span>
<span class="ltx_bibblock">On the representation collapse of sparse mixture of experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Proc. of NeurIPS</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. [2018]</span>
<span class="ltx_bibblock">
Peter Clark, Isaac Cowhey, Oren Etzioni, Tushar Khot, Ashish Sabharwal, Carissa Schoenick, and Oyvind Tafjord.

</span>
<span class="ltx_bibblock">Think you have solved question answering? Try ARC, the ai2 reasoning challenge.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">ArXiv preprint</em>, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fedus et al. [2022]</span>
<span class="ltx_bibblock">
William Fedus, Barret Zoph, and Noam Shazeer.

</span>
<span class="ltx_bibblock">Switch transformers: Scaling to trillion parameter models with simple and efficient sparsity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">JMLR</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al. [2023]</span>
<span class="ltx_bibblock">
Leo Gao, Jonathan Tow, Baber Abbasi, Stella Biderman, Sid Black, Anthony DiPofi, Charles Foster, Laurence Golding, Jeffrey Hsu, Alain Le Noac’h, Haonan Li, Kyle McDonell, Niklas Muennighoff, Chris Ociepa, Jason Phang, Laria Reynolds, Hailey Schoelkopf, Aviya Skowron, Lintang Sutawika, Eric Tang, Anish Thite, Ben Wang, Kevin Wang, and Andy Zou.

</span>
<span class="ltx_bibblock">A framework for few-shot language model evaluation, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">He et al. [2021]</span>
<span class="ltx_bibblock">
Jiaao He, Jiezhong Qiu, Aohan Zeng, Zhilin Yang, Jidong Zhai, and Jie Tang.

</span>
<span class="ltx_bibblock">Fastmoe: A fast mixture-of-expert training system.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">ArXiv preprint</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al. [2021]</span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt.

</span>
<span class="ltx_bibblock">Measuring massive multitask language understanding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">Proc. of ICLR</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hoffmann et al. [2022]</span>
<span class="ltx_bibblock">
Jordan Hoffmann, Sebastian Borgeaud, Arthur Mensch, Elena Buchatskaya, Trevor Cai, Eliza Rutherford, Diego de Las Casas, Lisa Anne Hendricks, Johannes Welbl, Aidan Clark, Tom Hennigan, Eric Noland, Katherine Millican, George van den Driessche, Bogdan Damoc, Aurelia Guy, Simon Osindero, Karen Simonyan, Erich Elsen, Oriol Vinyals, Jack W. Rae, and Laurent Sifre.

</span>
<span class="ltx_bibblock">An empirical analysis of compute-optimal large language model training.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Proc. of NeurIPS</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al. [2024]</span>
<span class="ltx_bibblock">
Shengding Hu, Yuge Tu, Xu Han, Chaoqun He, Ganqu Cui, Xiang Long, Zhi Zheng, Yewei Fang, Yuxiang Huang, Weilin Zhao, et al.

</span>
<span class="ltx_bibblock">MiniCPM: Unveiling the potential of small language models with scalable training strategies.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">ArXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Huang et al. [2024]</span>
<span class="ltx_bibblock">
Jing Huang, Diyi Yang, and Christopher Potts.

</span>
<span class="ltx_bibblock">Demystifying verbatim memorization in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">arXiv preprint arXiv:2407.17817</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hwang et al. [2023]</span>
<span class="ltx_bibblock">
Changho Hwang, Wei Cui, Yifan Xiong, Ziyue Yang, Ze Liu, Han Hu, Zilong Wang, Rafael Salas, Jithin Jose, Prabhat Ram, et al.

</span>
<span class="ltx_bibblock">Tutel: Adaptive mixture-of-experts at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">Proc. of MLSys</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. [2024]</span>
<span class="ltx_bibblock">
Albert Q Jiang, Alexandre Sablayrolles, Antoine Roux, Arthur Mensch, Blanche Savary, Chris Bamford, Devendra Singh Chaplot, Diego de las Casas, Emma Bou Hanna, Florian Bressand, et al.

</span>
<span class="ltx_bibblock">Mixtral of experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">ArXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma and Ba [2015]</span>
<span class="ltx_bibblock">
Diederik P. Kingma and Jimmy Ba.

</span>
<span class="ltx_bibblock">Adam: A method for stochastic optimization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Proc. of ICLR</em>, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lepikhin et al. [2020]</span>
<span class="ltx_bibblock">
Dmitry Lepikhin, HyoukJoong Lee, Yuanzhong Xu, Dehao Chen, Orhan Firat, Yanping Huang, Maxim Krikun, Noam Shazeer, and Zhifeng Chen.

</span>
<span class="ltx_bibblock">Gshard: Scaling giant models with conditional computation and automatic sharding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">ArXiv preprint</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al. [2021]</span>
<span class="ltx_bibblock">
Mike Lewis, Shruti Bhosale, Tim Dettmers, Naman Goyal, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Base layers: Simplifying training of large, sparse models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Proc. of ICML</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. [2024]</span>
<span class="ltx_bibblock">
Jeffrey Li, Alex Fang, Georgios Smyrnis, Maor Ivgi, Matt Jordan, Samir Gadre, Hritik Bansal, Etash Guha, Sedrick Keh, Kushal Arora, et al.

</span>
<span class="ltx_bibblock">DataComp-LM: In search of the next generation of training sets for language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Proc. of NeurIPS</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. [2024a]</span>
<span class="ltx_bibblock">
Aixin Liu, Bei Feng, Bin Wang, Bingxuan Wang, Bo Liu, Chenggang Zhao, Chengqi Dengr, Chong Ruan, Damai Dai, Daya Guo, et al.

</span>
<span class="ltx_bibblock">DeepSeek-V2: A strong, economical, and efficient mixture-of-experts language model.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">ArXiv preprint</em>, 2024a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. [2024b]</span>
<span class="ltx_bibblock">
Aixin Liu, Bei Feng, Bing Xue, Bingxuan Wang, Bochao Wu, Chengda Lu, Chenggang Zhao, Chengqi Deng, Chenyu Zhang, Chong Ruan, et al.

</span>
<span class="ltx_bibblock">Deepseek-v3 technical report.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">ArXiv preprint</em>, 2024b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Martinez et al. [2024]</span>
<span class="ltx_bibblock">
Richard Diehl Martinez, Pietro Lesci, and Paula Buttery.

</span>
<span class="ltx_bibblock">Tending towards stability: Convergence challenges in small language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2410.11451</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Meta AI [2025]</span>
<span class="ltx_bibblock">
Meta AI.

</span>
<span class="ltx_bibblock">The llama 4 herd: The beginning of a new era of natively multimodal ai innovation, 2025.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mihaylov et al. [2018]</span>
<span class="ltx_bibblock">
Todor Mihaylov, Peter Clark, Tushar Khot, and Ashish Sabharwal.

</span>
<span class="ltx_bibblock">Can a suit of armor conduct electricity? A new dataset for open book question answering.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Proc. of EMNLP</em>, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Muennighoff et al. [2025]</span>
<span class="ltx_bibblock">
Niklas Muennighoff, Luca Soldaini, Dirk Groeneveld, Kyle Lo, Jacob Morrison, Sewon Min, Weijia Shi, Pete Walsh, Oyvind Tafjord, Nathan Lambert, et al.

</span>
<span class="ltx_bibblock">OLMoE: Open mixture-of-experts language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Proc. of ICLR</em>, 2025.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">O’Mahony et al. [2024]</span>
<span class="ltx_bibblock">
Laura O’Mahony, Leo Grinsztajn, Hailey Schoelkopf, and Stella Biderman.

</span>
<span class="ltx_bibblock">Attributing mode collapse in the fine-tuning of large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">ICLR 2024 Workshop on Mathematical and Empirical Understanding of Foundation Models</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rajbhandari et al. [2022]</span>
<span class="ltx_bibblock">
Samyam Rajbhandari, Conglong Li, Zhewei Yao, Minjia Zhang, Reza Yazdani Aminabadi, Ammar Ahmad Awan, Jeff Rasley, and Yuxiong He.

</span>
<span class="ltx_bibblock">Deepspeed-moe: Advancing mixture-of-experts inference and training to power next-generation ai scale.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">Proc. of ICML</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sakaguchi et al. [2020]</span>
<span class="ltx_bibblock">
Keisuke Sakaguchi, Ronan Le Bras, Chandra Bhagavatula, and Yejin Choi.

</span>
<span class="ltx_bibblock">Winogrande: An adversarial winograd schema challenge at scale.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proc. of AAAI</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer et al. [2017]</span>
<span class="ltx_bibblock">
Noam Shazeer, Azalia Mirhoseini, Krzysztof Maziarz, Andy Davis, Quoc Le, Geoffrey Hinton, and Jeff Dean.

</span>
<span class="ltx_bibblock">Outrageously large neural networks: The sparsely-gated mixture-of-experts layer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">ArXiv preprint</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shen et al. [2024]</span>
<span class="ltx_bibblock">
Yikang Shen, Zhen Guo, Tianle Cai, and Zengyi Qin.

</span>
<span class="ltx_bibblock">JetMoE: Reaching llama2 performance with 0.1 m dollars.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">ArXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shoeybi et al. [2019]</span>
<span class="ltx_bibblock">
Mohammad Shoeybi, Mostofa Patwary, Raul Puri, Patrick LeGresley, Jared Casper, and Bryan Catanzaro.

</span>
<span class="ltx_bibblock">Megatron-lm: Training multi-billion parameter language models using model parallelism.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">ArXiv preprint</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Skean et al. [2025]</span>
<span class="ltx_bibblock">
Oscar Skean, Md Rifat Arefin, Dan Zhao, Niket Patel, Jalal Naghiyev, Yann LeCun, and Ravid Shwartz-Ziv.

</span>
<span class="ltx_bibblock">Layer by layer: Uncovering hidden representations in language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">arXiv preprint arXiv:2502.02013</em>, 2025.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Team [2023]</span>
<span class="ltx_bibblock">
Databricks Team.

</span>
<span class="ltx_bibblock">Free dolly: Introducing the world’s first truly open instruction-tuned llm.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm" title="">https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm</a>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Team et al. [2024]</span>
<span class="ltx_bibblock">
Gemini Team, Petko Georgiev, Ving Ian Lei, Ryan Burnell, Libin Bai, Anmol Gulati, Garrett Tanzer, Damien Vincent, Zhufeng Pan, Shibo Wang, et al.

</span>
<span class="ltx_bibblock">Gemini 1.5: Unlocking multimodal understanding across millions of tokens of context.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">ArXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tigges et al. [2024]</span>
<span class="ltx_bibblock">
Curt Tigges, Michael Hanna, Qinan Yu, and Stella Biderman.

</span>
<span class="ltx_bibblock">Llm circuit analyses are consistent across training and scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">arXiv preprint arXiv:2407.10827</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xue et al. [2024]</span>
<span class="ltx_bibblock">
Fuzhao Xue, Zian Zheng, Yao Fu, Jinjie Ni, Zangwei Zheng, Wangchunshu Zhou, and Yang You.

</span>
<span class="ltx_bibblock">OpenMoE: An early effort on open mixture-of-experts language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">ArXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yang et al. [2021]</span>
<span class="ltx_bibblock">
An Yang, Junyang Lin, Rui Men, Chang Zhou, Le Jiang, Xianyan Jia, Ang Wang, Jie Zhang, Jiamang Wang, Yong Li, et al.

</span>
<span class="ltx_bibblock">M6-T: Exploring sparse expert models and beyond.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">arXiv preprint</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zellers et al. [2019]</span>
<span class="ltx_bibblock">
Rowan Zellers, Ari Holtzman, Yonatan Bisk, Ali Farhadi, and Yejin Choi.

</span>
<span class="ltx_bibblock">HellaSwag: Can a machine really finish your sentence?

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">Proc. of ACL</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. [2022]</span>
<span class="ltx_bibblock">
Susan Zhang, Stephen Roller, Naman Goyal, Mikel Artetxe, Moya Chen, Shuohui Chen, Christopher Dewan, Mona Diab, Xian Li, Xi Victoria Lin, Todor Mihaylov, Myle Ott, Sam Shleifer, Kurt Shuster, Daniel Simig, Punit Singh Koura, Anjali Sridhar, Tianlu Wang, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">OPT: Open pre-trained transformer language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">ArXiv preprint</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zoph et al. [2022]</span>
<span class="ltx_bibblock">
Barret Zoph, Irwan Bello, Sameer Kumar, Nan Du, Yanping Huang, Jeff Dean, Noam Shazeer, and William Fedus.

</span>
<span class="ltx_bibblock">ST-MoE: Designing stable and transferable sparse expert models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">ArXiv preprint</em>, 2022.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<figure class="ltx_table" id="A0.T5">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="A0.T5.7" style="width:216.8pt;">
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_figure">Table 4: </span>Scaling law parameters of FLAME-MoE.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A0.T5.7.7" style="width:260.2pt;height:320.8pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(74.7pt,-92.1pt) scale(2.34920147453999,2.34920147453999) ;">
<table class="ltx_tabular ltx_align_middle" id="A0.T5.7.7.7">
<tr class="ltx_tr" id="A0.T5.7.7.7.8">
<td class="ltx_td ltx_align_left ltx_border_tt" id="A0.T5.7.7.7.8.1"><span class="ltx_text" id="A0.T5.7.7.7.8.1.1" style="font-size:90%;">Name</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A0.T5.7.7.7.8.2"><span class="ltx_text" id="A0.T5.7.7.7.8.2.1" style="font-size:90%;">Value</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.1.1.1.1">
<td class="ltx_td ltx_align_left ltx_border_t" id="A0.T5.1.1.1.1.1"><math alttext="A" class="ltx_Math" display="inline" id="A0.T5.1.1.1.1.1.m1.1"><semantics id="A0.T5.1.1.1.1.1.m1.1a"><mi id="A0.T5.1.1.1.1.1.m1.1.1" mathsize="90%" xref="A0.T5.1.1.1.1.1.m1.1.1.cmml">A</mi><annotation-xml encoding="MathML-Content" id="A0.T5.1.1.1.1.1.m1.1b"><ci id="A0.T5.1.1.1.1.1.m1.1.1.cmml" xref="A0.T5.1.1.1.1.1.m1.1.1">𝐴</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.1.1.1.1.1.m1.1c">A</annotation><annotation encoding="application/x-llamapun" id="A0.T5.1.1.1.1.1.m1.1d">italic_A</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A0.T5.1.1.1.1.2"><span class="ltx_text" id="A0.T5.1.1.1.1.2.1" style="font-size:90%;">148.413257</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.2.2.2.2">
<td class="ltx_td ltx_align_left" id="A0.T5.2.2.2.2.1"><math alttext="B" class="ltx_Math" display="inline" id="A0.T5.2.2.2.2.1.m1.1"><semantics id="A0.T5.2.2.2.2.1.m1.1a"><mi id="A0.T5.2.2.2.2.1.m1.1.1" mathsize="90%" xref="A0.T5.2.2.2.2.1.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="A0.T5.2.2.2.2.1.m1.1b"><ci id="A0.T5.2.2.2.2.1.m1.1.1.cmml" xref="A0.T5.2.2.2.2.1.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.2.2.2.2.1.m1.1c">B</annotation><annotation encoding="application/x-llamapun" id="A0.T5.2.2.2.2.1.m1.1d">italic_B</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right" id="A0.T5.2.2.2.2.2"><span class="ltx_text" id="A0.T5.2.2.2.2.2.1" style="font-size:90%;">3269017.372472</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.3.3.3.3">
<td class="ltx_td ltx_align_left" id="A0.T5.3.3.3.3.1"><math alttext="L_{0}" class="ltx_Math" display="inline" id="A0.T5.3.3.3.3.1.m1.1"><semantics id="A0.T5.3.3.3.3.1.m1.1a"><msub id="A0.T5.3.3.3.3.1.m1.1.1" xref="A0.T5.3.3.3.3.1.m1.1.1.cmml"><mi id="A0.T5.3.3.3.3.1.m1.1.1.2" mathsize="90%" xref="A0.T5.3.3.3.3.1.m1.1.1.2.cmml">L</mi><mn id="A0.T5.3.3.3.3.1.m1.1.1.3" mathsize="90%" xref="A0.T5.3.3.3.3.1.m1.1.1.3.cmml">0</mn></msub><annotation-xml encoding="MathML-Content" id="A0.T5.3.3.3.3.1.m1.1b"><apply id="A0.T5.3.3.3.3.1.m1.1.1.cmml" xref="A0.T5.3.3.3.3.1.m1.1.1"><csymbol cd="ambiguous" id="A0.T5.3.3.3.3.1.m1.1.1.1.cmml" xref="A0.T5.3.3.3.3.1.m1.1.1">subscript</csymbol><ci id="A0.T5.3.3.3.3.1.m1.1.1.2.cmml" xref="A0.T5.3.3.3.3.1.m1.1.1.2">𝐿</ci><cn id="A0.T5.3.3.3.3.1.m1.1.1.3.cmml" type="integer" xref="A0.T5.3.3.3.3.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.3.3.3.3.1.m1.1c">L_{0}</annotation><annotation encoding="application/x-llamapun" id="A0.T5.3.3.3.3.1.m1.1d">italic_L start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right" id="A0.T5.3.3.3.3.2"><span class="ltx_text" id="A0.T5.3.3.3.3.2.1" style="font-size:90%;">2.241716</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.4.4.4.4">
<td class="ltx_td ltx_align_left" id="A0.T5.4.4.4.4.1"><math alttext="\alpha" class="ltx_Math" display="inline" id="A0.T5.4.4.4.4.1.m1.1"><semantics id="A0.T5.4.4.4.4.1.m1.1a"><mi id="A0.T5.4.4.4.4.1.m1.1.1" mathsize="90%" xref="A0.T5.4.4.4.4.1.m1.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="A0.T5.4.4.4.4.1.m1.1b"><ci id="A0.T5.4.4.4.4.1.m1.1.1.cmml" xref="A0.T5.4.4.4.4.1.m1.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.4.4.4.4.1.m1.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="A0.T5.4.4.4.4.1.m1.1d">italic_α</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right" id="A0.T5.4.4.4.4.2"><span class="ltx_text" id="A0.T5.4.4.4.4.2.1" style="font-size:90%;">0.279702</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.5.5.5.5">
<td class="ltx_td ltx_align_left" id="A0.T5.5.5.5.5.1"><math alttext="\beta" class="ltx_Math" display="inline" id="A0.T5.5.5.5.5.1.m1.1"><semantics id="A0.T5.5.5.5.5.1.m1.1a"><mi id="A0.T5.5.5.5.5.1.m1.1.1" mathsize="90%" xref="A0.T5.5.5.5.5.1.m1.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="A0.T5.5.5.5.5.1.m1.1b"><ci id="A0.T5.5.5.5.5.1.m1.1.1.cmml" xref="A0.T5.5.5.5.5.1.m1.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.5.5.5.5.1.m1.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="A0.T5.5.5.5.5.1.m1.1d">italic_β</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right" id="A0.T5.5.5.5.5.2"><span class="ltx_text" id="A0.T5.5.5.5.5.2.1" style="font-size:90%;">0.715500</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.6.6.6.6">
<td class="ltx_td ltx_align_left" id="A0.T5.6.6.6.6.1"><math alttext="a" class="ltx_Math" display="inline" id="A0.T5.6.6.6.6.1.m1.1"><semantics id="A0.T5.6.6.6.6.1.m1.1a"><mi id="A0.T5.6.6.6.6.1.m1.1.1" mathsize="90%" xref="A0.T5.6.6.6.6.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="A0.T5.6.6.6.6.1.m1.1b"><ci id="A0.T5.6.6.6.6.1.m1.1.1.cmml" xref="A0.T5.6.6.6.6.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.6.6.6.6.1.m1.1c">a</annotation><annotation encoding="application/x-llamapun" id="A0.T5.6.6.6.6.1.m1.1d">italic_a</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right" id="A0.T5.6.6.6.6.2"><span class="ltx_text" id="A0.T5.6.6.6.6.2.1" style="font-size:90%;">0.689902</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.7.7.7.7">
<td class="ltx_td ltx_align_left ltx_border_bb" id="A0.T5.7.7.7.7.1"><math alttext="b" class="ltx_Math" display="inline" id="A0.T5.7.7.7.7.1.m1.1"><semantics id="A0.T5.7.7.7.7.1.m1.1a"><mi id="A0.T5.7.7.7.7.1.m1.1.1" mathsize="90%" xref="A0.T5.7.7.7.7.1.m1.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="A0.T5.7.7.7.7.1.m1.1b"><ci id="A0.T5.7.7.7.7.1.m1.1.1.cmml" xref="A0.T5.7.7.7.7.1.m1.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="A0.T5.7.7.7.7.1.m1.1c">b</annotation><annotation encoding="application/x-llamapun" id="A0.T5.7.7.7.7.1.m1.1d">italic_b</annotation></semantics></math></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A0.T5.7.7.7.7.2"><span class="ltx_text" id="A0.T5.7.7.7.7.2.1" style="font-size:90%;">0.310098</span></td>
</tr>
</table>
</span></div>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="A0.T5.fig1" style="width:216.8pt;">
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_figure">Table 5: </span>Training details of FLAME-MoE.</figcaption>
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="A0.T5.fig1.3" style="width:303.5pt;height:451.3pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(82.9pt,-123.2pt) scale(2.20310006192105,2.20310006192105) ;">
<table class="ltx_tabular ltx_align_middle" id="A0.T5.fig1.3.1">
<tr class="ltx_tr" id="A0.T5.fig1.3.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="A0.T5.fig1.3.1.1.1"><span class="ltx_text" id="A0.T5.fig1.3.1.1.1.1" style="font-size:90%;">Name</span></td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A0.T5.fig1.3.1.1.2"><span class="ltx_text" id="A0.T5.fig1.3.1.1.2.1" style="font-size:90%;">Value</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="A0.T5.fig1.3.1.2.1"><span class="ltx_text" id="A0.T5.fig1.3.1.2.1.1" style="font-size:90%;">Batch Size</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A0.T5.fig1.3.1.2.2"><span class="ltx_text" id="A0.T5.fig1.3.1.2.2.1" style="font-size:90%;">1024</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.3">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.3.1"><span class="ltx_text" id="A0.T5.fig1.3.1.3.1.1" style="font-size:90%;">Sequence Length</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.3.2"><span class="ltx_text" id="A0.T5.fig1.3.1.3.2.1" style="font-size:90%;">2048</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.4">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.4.1"><span class="ltx_text" id="A0.T5.fig1.3.1.4.1.1" style="font-size:90%;">Optimizer</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.4.2"><span class="ltx_text" id="A0.T5.fig1.3.1.4.2.1" style="font-size:90%;">Adam</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.5">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.5.1"><span class="ltx_text" id="A0.T5.fig1.3.1.5.1.1" style="font-size:90%;">Scheduler</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.5.2"><span class="ltx_text" id="A0.T5.fig1.3.1.5.2.1" style="font-size:90%;">WSD</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.6">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.6.1"><span class="ltx_text" id="A0.T5.fig1.3.1.6.1.1" style="font-size:90%;">Max Learning Rate</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.6.2"><span class="ltx_text" id="A0.T5.fig1.3.1.6.2.1" style="font-size:90%;">3e-4</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.7">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.7.1"><span class="ltx_text" id="A0.T5.fig1.3.1.7.1.1" style="font-size:90%;">Min Learning Rate</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.7.2"><span class="ltx_text" id="A0.T5.fig1.3.1.7.2.1" style="font-size:90%;">3e-5</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.8">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.8.1"><span class="ltx_text" id="A0.T5.fig1.3.1.8.1.1" style="font-size:90%;">Warmup Ratio</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.8.2"><span class="ltx_text" id="A0.T5.fig1.3.1.8.2.1" style="font-size:90%;">0.01</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.9">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.9.1"><span class="ltx_text" id="A0.T5.fig1.3.1.9.1.1" style="font-size:90%;">Decay Ratio</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.9.2"><span class="ltx_text" id="A0.T5.fig1.3.1.9.2.1" style="font-size:90%;">0.1</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.10">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.10.1"><span class="ltx_text" id="A0.T5.fig1.3.1.10.1.1" style="font-size:90%;">Pipeline Parallel</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.10.2"><span class="ltx_text" id="A0.T5.fig1.3.1.10.2.1" style="font-size:90%;">1</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.11">
<td class="ltx_td ltx_align_left" id="A0.T5.fig1.3.1.11.1"><span class="ltx_text" id="A0.T5.fig1.3.1.11.1.1" style="font-size:90%;">Expert Parallel</span></td>
<td class="ltx_td ltx_align_right" id="A0.T5.fig1.3.1.11.2"><span class="ltx_text" id="A0.T5.fig1.3.1.11.2.1" style="font-size:90%;">8</span></td>
</tr>
<tr class="ltx_tr" id="A0.T5.fig1.3.1.12">
<td class="ltx_td ltx_align_left ltx_border_bb" id="A0.T5.fig1.3.1.12.1"><span class="ltx_text" id="A0.T5.fig1.3.1.12.1.1" style="font-size:90%;">Device</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A0.T5.fig1.3.1.12.2"><span class="ltx_text" id="A0.T5.fig1.3.1.12.2.1" style="font-size:90%;">32xH100</span></td>
</tr>
</table>
</span></div>
</figure>
</div>
</div>
</figure>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Training Efficiency</h2>
<figure class="ltx_figure" id="A1.F7">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="A1.F7.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="315" id="A1.F7.sf1.g1" src="extracted/6472968/figures/gpu-utilization/pp-1_ep-2.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A1.F7.sf1.2.1.1" style="font-size:90%;">(a)</span> </span><span class="ltx_text" id="A1.F7.sf1.3.2" style="font-size:90%;">EP=2, PP=1</span></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="A1.F7.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="315" id="A1.F7.sf2.g1" src="extracted/6472968/figures/gpu-utilization/pp-1_ep-8.png" width="598"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A1.F7.sf2.2.1.1" style="font-size:90%;">(b)</span> </span><span class="ltx_text" id="A1.F7.sf2.3.2" style="font-size:90%;">EP=8, PP=1</span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A1.F7.2.1.1" style="font-size:90%;">Figure 7</span>: </span><span class="ltx_text" id="A1.F7.3.2" style="font-size:90%;">GPU utilization under different parallelization strategies (EP = Expert Parallel, PP = Pipeline Parallel) using Megatron-LM, collected by Wandb.</span></figcaption>
</figure>
<div class="ltx_para" id="A1.p1">
<p class="ltx_p" id="A1.p1.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A1.F7" title="Figure 7 ‣ Appendix A Training Efficiency ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">7</span></a> illustrates the variation in GPU utilization under different levels of expert parallelism while keeping the pipeline parallelism constant. As observed, increasing the number of expert parallel groups (EP) from 2 to 8 leads to a marked improvement in GPU utilization. Specifically, in the configuration with EP=8 and PP=1, the majority of GPU utilization samples exceed 90%, indicating consistently high utilization across devices.</p>
</div>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Expert Specialization</h2>
<div class="ltx_para" id="A2.p1">
<p class="ltx_p" id="A2.p1.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A2.F8" title="Figure 8 ‣ Appendix B Expert Specialization ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">8</span></a> shows how expert specialization develops over training in the final layer of FLAME-MoE-1.7B-10.3B. Each plot represents an individual expert’s specialization score trajectory, computed for its top-1 and top-2 most frequently routed tokens. The results indicate that specialization progress is heterogeneous across experts—some develop clear specialization early, while others follow a more gradual or fluctuating trajectory. Nonetheless, a general upward trend is evident in the majority of experts, particularly for the top-1 and top-2 tokens. This suggests that, over time, most experts become more confidently and consistently associated with a subset of tokens, supporting the emergence of functional specialization within the MoE architecture.</p>
</div>
<figure class="ltx_figure" id="A2.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="827" id="A2.F8.g1" src="x15.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A2.F8.2.1.1" style="font-size:90%;">Figure 8</span>: </span><span class="ltx_text" id="A2.F8.3.2" style="font-size:90%;">Evolution of expert specialization scores over the course of training in the final layer of FLAME-MoE-1.7B-10.3B. Each subplot tracks the specialization score of one expert across training steps, measured for its top-1 and top-2 most specialized tokens. The score reflects how consistently each expert is selected for specific tokens.</span></figcaption>
</figure>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>Expert Co-activation</h2>
<figure class="ltx_figure" id="A3.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="616" id="A3.F9.g1" src="x16.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F9.2.1.1" style="font-size:90%;">Figure 9</span>: </span><span class="ltx_text" id="A3.F9.3.2" style="font-size:90%;">Evolution of expert co-activation in FLAME-MoE-1.7B-10.3B at 10%, 50%, and 100% of pretraining (steps 1,100, 5,500, and 11,029), shown across layers 2, 6, 12, and 18. Each heatmap visualizes pairwise co-activation frequencies among the 16 most frequently co-activated experts at that layer and training stage.</span></figcaption>
</figure>
<div class="ltx_para" id="A3.p1">
<p class="ltx_p" id="A3.p1.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A3.F9" title="Figure 9 ‣ Appendix C Expert Co-activation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">9</span></a> presents expert co-activation heatmaps at 10%, 50%, and 100% of pretraining (corresponding to steps 1,100, 5,500; and 11,029, respectively). These visualizations illustrate the evolution of routing dynamics across training. As pretraining progresses, deeper layers display increasingly sharp co-activation patterns, with only a small subset of expert pairs being consistently co-activated. In contrast, co-activation in shallower layers remains more diffuse throughout. Notably, we do not observe global or widespread co-activation—most heatmaps are sparsely activated, indicating that the model does not route inputs uniformly across all expert pairs.</p>
</div>
<figure class="ltx_figure" id="A3.F10"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="269" id="A3.F10.g1" src="x17.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F10.2.1.1" style="font-size:90%;">Figure 10</span>: </span><span class="ltx_text" id="A3.F10.3.2" style="font-size:90%;">Expert co-activation patterns in FLAME-MoE models of varying scales at the final checkpoint on the validation set. Each heatmap shows pairwise co-activation scores among the 16 most frequently co-activated experts in the first MoE layer.</span></figcaption>
</figure>
<figure class="ltx_figure" id="A3.F11"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="271" id="A3.F11.g1" src="x18.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.2.1.1" style="font-size:90%;">Figure 11</span>: </span><span class="ltx_text" id="A3.F11.3.2" style="font-size:90%;">Expert co-activation patterns in FLAME-MoE models of varying scales at the final checkpoint on the validation set. Each heatmap shows pairwise co-activation scores among the 16 most frequently co-activated experts in the final MoE layer.</span></figcaption>
</figure>
<div class="ltx_para" id="A3.p2">
<p class="ltx_p" id="A3.p2.1">Figures <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A3.F10" title="Figure 10 ‣ Appendix C Expert Co-activation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">10</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A3.F11" title="Figure 11 ‣ Appendix C Expert Co-activation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">11</span></a> illustrate expert co-activation patterns across FLAME-MoE models of different scales—FLAME-MoE-290M-1.3B, FLAME-MoE-721M-3.8B, and FLAME-MoE-1.7B-10.3B—at both shallow and deep layers. The visualizations present pairwise co-activation scores among the 16 most frequently co-activated experts within the first and final Mixture-of-Experts (MoE) layers for each model, respectively. Darker shades in the heatmaps denote stronger co-activation, with expert indices shown along both axes.</p>
</div>
<div class="ltx_para" id="A3.p3">
<p class="ltx_p" id="A3.p3.1">At shallow layers (e.g., layer 2), larger models exhibit broader and more intense expert co-activation, as seen in the FLAME-MoE-1.7B-10.3B model, which shows darker and more widespread patterns. This suggests that larger models tend to engage more experts early in processing, likely to capture more diverse or complex input features. In contrast, at deeper layers, the co-activation patterns appear relatively similar across model scales, with no pronounced differences, indicating a more consistent expert utilization behavior regardless of model size.</p>
</div>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>Router Saturation</h2>
<figure class="ltx_figure" id="A4.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="252" id="A4.F12.g1" src="x19.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A4.F12.2.1.1" style="font-size:90%;">Figure 12</span>: </span><span class="ltx_text" id="A4.F12.3.2" style="font-size:90%;">Router saturation over the course of training for FLAME-MoE models of different scales under top-1 routing. Each line represents a different MoE layer, showing the trend of average expert selection overlap with the final checkpoint.</span></figcaption>
</figure>
<figure class="ltx_figure" id="A4.F13"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="252" id="A4.F13.g1" src="x20.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A4.F13.2.1.1" style="font-size:90%;">Figure 13</span>: </span><span class="ltx_text" id="A4.F13.3.2" style="font-size:90%;">Router saturation over the course of training for FLAME-MoE models of different scales under top-6 routing. Each line represents a different MoE layer, showing the trend of average expert selection overlap with the final checkpoint.</span></figcaption>
</figure>
<div class="ltx_para" id="A4.p1">
<p class="ltx_p" id="A4.p1.1">Figures <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A4.F12" title="Figure 12 ‣ Appendix D Router Saturation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">12</span></a> and <a class="ltx_ref" href="https://arxiv.org/html/2505.20225v1#A4.F13" title="Figure 13 ‣ Appendix D Router Saturation ‣ FLAME-MoE: A Transparent End-to-End Research Platform for Mixture-of-Experts Language Models"><span class="ltx_text ltx_ref_tag">13</span></a> show how router saturation evolves during training across FLAME-MoE models of different scales under top-1 and top-6 routing, respectively. Each line represents the saturation trend of a specific MoE layer, measured as the average overlap in expert selection with the final checkpoint.</p>
</div>
<div class="ltx_para" id="A4.p2">
<p class="ltx_p" id="A4.p2.1">We observe that larger models exhibit slower saturation, particularly in early layers. For example, in FLAME-MoE-1.7B-10.3B under top-1 routing, the saturation in layer 2 (blue line) starts notably lower compared to smaller models, indicating a greater degree of route plasticity early in training. More broadly, as model scale increases, a greater number of shallow layers show delayed saturation—evidenced by a wider set of lines starting at lower values—suggesting increased flexibility in routing decisions during early stages of training.</p>
</div>
<div class="ltx_para" id="A4.p3">
<p class="ltx_p" id="A4.p3.1">These trends imply that larger models maintain more potential for route refinement throughout training, especially in initial layers, which may contribute to their improved capacity for learning complex patterns and adapting expert utilization over time.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon May 26 17:06:24 2025 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
